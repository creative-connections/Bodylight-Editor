(window["webpackJsonp"] = window["webpackJsonp"] || []).push([["vendors~9e0f4621"],{

/***/ "hij8":
/*!***********************************************************************************!*\
  !*** ./node_modules/aurelia-templating/dist/native-modules/aurelia-templating.js ***!
  \***********************************************************************************/
/*! exports provided: Animator, BehaviorInstruction, BehaviorPropertyObserver, BindableProperty, BindingLanguage, BoundViewFactory, CompositionEngine, CompositionTransaction, CompositionTransactionNotifier, CompositionTransactionOwnershipToken, Controller, ConventionalViewStrategy, ElementConfigResource, ElementEvents, HtmlBehaviorResource, InlineViewStrategy, ModuleAnalyzer, NoViewStrategy, PassThroughSlot, RelativeViewStrategy, ResourceDescription, ResourceLoadContext, ResourceModule, ShadowDOM, ShadowSlot, SlotCustomAttribute, StaticViewStrategy, SwapStrategies, TargetInstruction, TemplateRegistryViewStrategy, TemplatingEngine, View, ViewCompileInstruction, ViewCompiler, ViewEngine, ViewEngineHooksResource, ViewFactory, ViewLocator, ViewResources, ViewSlot, _hyphenate, _isAllWhitespace, animationEvent, behavior, bindable, child, children, containerless, customAttribute, customElement, dynamicOptions, elementConfig, inlineView, noView, processAttributes, processContent, resource, templateController, useShadowDOM, useView, useViewStrategy, validateBehaviorName, view, viewEngineHooks, viewResources, viewStrategy */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Animator\", function() { return Animator; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"BehaviorInstruction\", function() { return BehaviorInstruction; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"BehaviorPropertyObserver\", function() { return BehaviorPropertyObserver; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"BindableProperty\", function() { return BindableProperty; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"BindingLanguage\", function() { return BindingLanguage; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"BoundViewFactory\", function() { return BoundViewFactory; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"CompositionEngine\", function() { return CompositionEngine; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"CompositionTransaction\", function() { return CompositionTransaction; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"CompositionTransactionNotifier\", function() { return CompositionTransactionNotifier; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"CompositionTransactionOwnershipToken\", function() { return CompositionTransactionOwnershipToken; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Controller\", function() { return Controller; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ConventionalViewStrategy\", function() { return ConventionalViewStrategy; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ElementConfigResource\", function() { return ElementConfigResource; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ElementEvents\", function() { return ElementEvents; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"HtmlBehaviorResource\", function() { return HtmlBehaviorResource; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"InlineViewStrategy\", function() { return InlineViewStrategy; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ModuleAnalyzer\", function() { return ModuleAnalyzer; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"NoViewStrategy\", function() { return NoViewStrategy; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"PassThroughSlot\", function() { return PassThroughSlot; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"RelativeViewStrategy\", function() { return RelativeViewStrategy; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ResourceDescription\", function() { return ResourceDescription; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ResourceLoadContext\", function() { return ResourceLoadContext; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ResourceModule\", function() { return ResourceModule; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ShadowDOM\", function() { return ShadowDOM; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ShadowSlot\", function() { return ShadowSlot; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"SlotCustomAttribute\", function() { return SlotCustomAttribute; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"StaticViewStrategy\", function() { return StaticViewStrategy; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"SwapStrategies\", function() { return SwapStrategies; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"TargetInstruction\", function() { return TargetInstruction; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"TemplateRegistryViewStrategy\", function() { return TemplateRegistryViewStrategy; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"TemplatingEngine\", function() { return TemplatingEngine; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"View\", function() { return View; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ViewCompileInstruction\", function() { return ViewCompileInstruction; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ViewCompiler\", function() { return ViewCompiler; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ViewEngine\", function() { return ViewEngine; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ViewEngineHooksResource\", function() { return ViewEngineHooksResource; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ViewFactory\", function() { return ViewFactory; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ViewLocator\", function() { return ViewLocator; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ViewResources\", function() { return ViewResources; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ViewSlot\", function() { return ViewSlot; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"_hyphenate\", function() { return _hyphenate; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"_isAllWhitespace\", function() { return _isAllWhitespace; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"animationEvent\", function() { return animationEvent; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"behavior\", function() { return behavior; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"bindable\", function() { return bindable; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"child\", function() { return child; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"children\", function() { return children; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"containerless\", function() { return containerless; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"customAttribute\", function() { return customAttribute; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"customElement\", function() { return customElement; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"dynamicOptions\", function() { return dynamicOptions; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"elementConfig\", function() { return elementConfig; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"inlineView\", function() { return inlineView; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"noView\", function() { return noView; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"processAttributes\", function() { return processAttributes; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"processContent\", function() { return processContent; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"resource\", function() { return resource; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"templateController\", function() { return templateController; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"useShadowDOM\", function() { return useShadowDOM; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"useView\", function() { return useView; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"useViewStrategy\", function() { return useViewStrategy; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"validateBehaviorName\", function() { return validateBehaviorName; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"view\", function() { return view; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"viewEngineHooks\", function() { return viewEngineHooks; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"viewResources\", function() { return viewResources; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"viewStrategy\", function() { return viewStrategy; });\n/* harmony import */ var aurelia_pal__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! aurelia-pal */ \"70NS\");\n/* harmony import */ var aurelia_loader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! aurelia-loader */ \"ZdUM\");\n/* harmony import */ var aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! aurelia-metadata */ \"qrcG\");\n/* harmony import */ var aurelia_path__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! aurelia-path */ \"iD3O\");\n/* harmony import */ var aurelia_logging__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! aurelia-logging */ \"MP1E\");\n/* harmony import */ var aurelia_binding__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! aurelia-binding */ \"X5gX\");\n/* harmony import */ var aurelia_dependency_injection__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! aurelia-dependency-injection */ \"3U8n\");\n/* harmony import */ var aurelia_task_queue__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! aurelia-task-queue */ \"K/SW\");\n\n\n\n\n\n\n\n\n\nvar ElementEvents = (function () {\r\n    function ElementEvents(element) {\r\n        this.element = element;\r\n        this.subscriptions = {};\r\n    }\r\n    ElementEvents.prototype._enqueueHandler = function (handler) {\r\n        this.subscriptions[handler.eventName] = this.subscriptions[handler.eventName] || [];\r\n        this.subscriptions[handler.eventName].push(handler);\r\n    };\r\n    ElementEvents.prototype._dequeueHandler = function (handler) {\r\n        var index;\r\n        var subscriptions = this.subscriptions[handler.eventName];\r\n        if (subscriptions) {\r\n            index = subscriptions.indexOf(handler);\r\n            if (index > -1) {\r\n                subscriptions.splice(index, 1);\r\n            }\r\n        }\r\n        return handler;\r\n    };\r\n    ElementEvents.prototype.publish = function (eventName, detail, bubbles, cancelable) {\r\n        if (detail === void 0) { detail = {}; }\r\n        if (bubbles === void 0) { bubbles = true; }\r\n        if (cancelable === void 0) { cancelable = true; }\r\n        var event = aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].createCustomEvent(eventName, { cancelable: cancelable, bubbles: bubbles, detail: detail });\r\n        this.element.dispatchEvent(event);\r\n    };\r\n    ElementEvents.prototype.subscribe = function (eventName, handler, captureOrOptions) {\r\n        if (typeof handler === 'function') {\r\n            if (captureOrOptions === undefined) {\r\n                captureOrOptions = ElementEvents.defaultListenerOptions;\r\n            }\r\n            var eventHandler = new EventHandlerImpl(this, eventName, handler, captureOrOptions, false);\r\n            return eventHandler;\r\n        }\r\n        return undefined;\r\n    };\r\n    ElementEvents.prototype.subscribeOnce = function (eventName, handler, captureOrOptions) {\r\n        if (typeof handler === 'function') {\r\n            if (captureOrOptions === undefined) {\r\n                captureOrOptions = ElementEvents.defaultListenerOptions;\r\n            }\r\n            var eventHandler = new EventHandlerImpl(this, eventName, handler, captureOrOptions, true);\r\n            return eventHandler;\r\n        }\r\n        return undefined;\r\n    };\r\n    ElementEvents.prototype.dispose = function (eventName) {\r\n        if (eventName && typeof eventName === 'string') {\r\n            var subscriptions = this.subscriptions[eventName];\r\n            if (subscriptions) {\r\n                while (subscriptions.length) {\r\n                    var subscription = subscriptions.pop();\r\n                    if (subscription) {\r\n                        subscription.dispose();\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            this.disposeAll();\r\n        }\r\n    };\r\n    ElementEvents.prototype.disposeAll = function () {\r\n        for (var key in this.subscriptions) {\r\n            this.dispose(key);\r\n        }\r\n    };\r\n    ElementEvents.defaultListenerOptions = true;\r\n    return ElementEvents;\r\n}());\r\nvar EventHandlerImpl = (function () {\r\n    function EventHandlerImpl(owner, eventName, handler, captureOrOptions, once) {\r\n        this.owner = owner;\r\n        this.eventName = eventName;\r\n        this.handler = handler;\r\n        this.capture = typeof captureOrOptions === 'boolean' ? captureOrOptions : captureOrOptions.capture;\r\n        this.bubbles = !this.capture;\r\n        this.captureOrOptions = captureOrOptions;\r\n        this.once = once;\r\n        owner.element.addEventListener(eventName, this, captureOrOptions);\r\n        owner._enqueueHandler(this);\r\n    }\r\n    EventHandlerImpl.prototype.handleEvent = function (e) {\r\n        var fn = this.handler;\r\n        fn(e);\r\n        if (this.once) {\r\n            this.dispose();\r\n        }\r\n    };\r\n    EventHandlerImpl.prototype.dispose = function () {\r\n        this.owner.element.removeEventListener(this.eventName, this, this.captureOrOptions);\r\n        this.owner._dequeueHandler(this);\r\n        this.owner = this.handler = null;\r\n    };\r\n    return EventHandlerImpl;\r\n}());\n\nvar ResourceLoadContext = (function () {\r\n    function ResourceLoadContext() {\r\n        this.dependencies = {};\r\n    }\r\n    ResourceLoadContext.prototype.addDependency = function (url) {\r\n        this.dependencies[url] = true;\r\n    };\r\n    ResourceLoadContext.prototype.hasDependency = function (url) {\r\n        return url in this.dependencies;\r\n    };\r\n    return ResourceLoadContext;\r\n}());\r\nvar ViewCompileInstruction = (function () {\r\n    function ViewCompileInstruction(targetShadowDOM, compileSurrogate) {\r\n        if (targetShadowDOM === void 0) { targetShadowDOM = false; }\r\n        if (compileSurrogate === void 0) { compileSurrogate = false; }\r\n        this.targetShadowDOM = targetShadowDOM;\r\n        this.compileSurrogate = compileSurrogate;\r\n        this.associatedModuleId = null;\r\n    }\r\n    ViewCompileInstruction.normal = new ViewCompileInstruction();\r\n    return ViewCompileInstruction;\r\n}());\r\nvar BehaviorInstruction = (function () {\r\n    function BehaviorInstruction() {\r\n    }\r\n    BehaviorInstruction.enhance = function () {\r\n        var instruction = new BehaviorInstruction();\r\n        instruction.enhance = true;\r\n        return instruction;\r\n    };\r\n    BehaviorInstruction.unitTest = function (type, attributes) {\r\n        var instruction = new BehaviorInstruction();\r\n        instruction.type = type;\r\n        instruction.attributes = attributes || {};\r\n        return instruction;\r\n    };\r\n    BehaviorInstruction.element = function (node, type) {\r\n        var instruction = new BehaviorInstruction();\r\n        instruction.type = type;\r\n        instruction.attributes = {};\r\n        instruction.anchorIsContainer = !(node.hasAttribute('containerless') || type.containerless);\r\n        instruction.initiatedByBehavior = true;\r\n        return instruction;\r\n    };\r\n    BehaviorInstruction.attribute = function (attrName, type) {\r\n        var instruction = new BehaviorInstruction();\r\n        instruction.attrName = attrName;\r\n        instruction.type = type || null;\r\n        instruction.attributes = {};\r\n        return instruction;\r\n    };\r\n    BehaviorInstruction.dynamic = function (host, viewModel, viewFactory) {\r\n        var instruction = new BehaviorInstruction();\r\n        instruction.host = host;\r\n        instruction.viewModel = viewModel;\r\n        instruction.viewFactory = viewFactory;\r\n        instruction.inheritBindingContext = true;\r\n        return instruction;\r\n    };\r\n    BehaviorInstruction.normal = new BehaviorInstruction();\r\n    return BehaviorInstruction;\r\n}());\r\nvar biProto = BehaviorInstruction.prototype;\r\nbiProto.initiatedByBehavior = false;\r\nbiProto.enhance = false;\r\nbiProto.partReplacements = null;\r\nbiProto.viewFactory = null;\r\nbiProto.originalAttrName = null;\r\nbiProto.skipContentProcessing = false;\r\nbiProto.contentFactory = null;\r\nbiProto.viewModel = null;\r\nbiProto.anchorIsContainer = false;\r\nbiProto.host = null;\r\nbiProto.attributes = null;\r\nbiProto.type = null;\r\nbiProto.attrName = null;\r\nbiProto.inheritBindingContext = false;\r\nvar TargetInstruction = (function () {\r\n    function TargetInstruction() {\r\n    }\r\n    TargetInstruction.shadowSlot = function (parentInjectorId) {\r\n        var instruction = new TargetInstruction();\r\n        instruction.parentInjectorId = parentInjectorId;\r\n        instruction.shadowSlot = true;\r\n        return instruction;\r\n    };\r\n    TargetInstruction.contentExpression = function (expression) {\r\n        var instruction = new TargetInstruction();\r\n        instruction.contentExpression = expression;\r\n        return instruction;\r\n    };\r\n    TargetInstruction.letElement = function (expressions) {\r\n        var instruction = new TargetInstruction();\r\n        instruction.expressions = expressions;\r\n        instruction.letElement = true;\r\n        return instruction;\r\n    };\r\n    TargetInstruction.lifting = function (parentInjectorId, liftingInstruction) {\r\n        var instruction = new TargetInstruction();\r\n        instruction.parentInjectorId = parentInjectorId;\r\n        instruction.expressions = TargetInstruction.noExpressions;\r\n        instruction.behaviorInstructions = [liftingInstruction];\r\n        instruction.viewFactory = liftingInstruction.viewFactory;\r\n        instruction.providers = [liftingInstruction.type.target];\r\n        instruction.lifting = true;\r\n        return instruction;\r\n    };\r\n    TargetInstruction.normal = function (injectorId, parentInjectorId, providers, behaviorInstructions, expressions, elementInstruction) {\r\n        var instruction = new TargetInstruction();\r\n        instruction.injectorId = injectorId;\r\n        instruction.parentInjectorId = parentInjectorId;\r\n        instruction.providers = providers;\r\n        instruction.behaviorInstructions = behaviorInstructions;\r\n        instruction.expressions = expressions;\r\n        instruction.anchorIsContainer = elementInstruction ? elementInstruction.anchorIsContainer : true;\r\n        instruction.elementInstruction = elementInstruction;\r\n        return instruction;\r\n    };\r\n    TargetInstruction.surrogate = function (providers, behaviorInstructions, expressions, values) {\r\n        var instruction = new TargetInstruction();\r\n        instruction.expressions = expressions;\r\n        instruction.behaviorInstructions = behaviorInstructions;\r\n        instruction.providers = providers;\r\n        instruction.values = values;\r\n        return instruction;\r\n    };\r\n    TargetInstruction.noExpressions = Object.freeze([]);\r\n    return TargetInstruction;\r\n}());\r\nvar tiProto = TargetInstruction.prototype;\r\ntiProto.injectorId = null;\r\ntiProto.parentInjectorId = null;\r\ntiProto.shadowSlot = false;\r\ntiProto.slotName = null;\r\ntiProto.slotFallbackFactory = null;\r\ntiProto.contentExpression = null;\r\ntiProto.letElement = false;\r\ntiProto.expressions = null;\r\ntiProto.expressions = null;\r\ntiProto.providers = null;\r\ntiProto.viewFactory = null;\r\ntiProto.anchorIsContainer = false;\r\ntiProto.elementInstruction = null;\r\ntiProto.lifting = false;\r\ntiProto.values = null;\n\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n\r\nfunction __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\n\nvar capitalMatcher = /([A-Z])/g;\r\nfunction addHyphenAndLower(char) {\r\n    return '-' + char.toLowerCase();\r\n}\r\nfunction _hyphenate(name) {\r\n    return (name.charAt(0).toLowerCase() + name.slice(1)).replace(capitalMatcher, addHyphenAndLower);\r\n}\r\nfunction _isAllWhitespace(node) {\r\n    return !(node.auInterpolationTarget || (/[^\\t\\n\\r ]/.test(node.textContent)));\r\n}\n\nvar BehaviorPropertyObserver = (function () {\r\n    function BehaviorPropertyObserver(taskQueue, obj, propertyName, selfSubscriber, initialValue) {\r\n        this.taskQueue = taskQueue;\r\n        this.obj = obj;\r\n        this.propertyName = propertyName;\r\n        this.notqueued = true;\r\n        this.publishing = false;\r\n        this.selfSubscriber = selfSubscriber;\r\n        this.currentValue = this.oldValue = initialValue;\r\n    }\r\n    BehaviorPropertyObserver.prototype.getValue = function () {\r\n        return this.currentValue;\r\n    };\r\n    BehaviorPropertyObserver.prototype.setValue = function (newValue) {\r\n        var oldValue = this.currentValue;\r\n        if (!Object.is(newValue, oldValue)) {\r\n            this.oldValue = oldValue;\r\n            this.currentValue = newValue;\r\n            if (this.publishing && this.notqueued) {\r\n                if (this.taskQueue.flushing) {\r\n                    this.call();\r\n                }\r\n                else {\r\n                    this.notqueued = false;\r\n                    this.taskQueue.queueMicroTask(this);\r\n                }\r\n            }\r\n        }\r\n    };\r\n    BehaviorPropertyObserver.prototype.call = function () {\r\n        var oldValue = this.oldValue;\r\n        var newValue = this.currentValue;\r\n        this.notqueued = true;\r\n        if (Object.is(newValue, oldValue)) {\r\n            return;\r\n        }\r\n        if (this.selfSubscriber) {\r\n            this.selfSubscriber(newValue, oldValue);\r\n        }\r\n        this.callSubscribers(newValue, oldValue);\r\n        this.oldValue = newValue;\r\n    };\r\n    BehaviorPropertyObserver.prototype.callSubscribers = function (newValue, oldValue) {\r\n        throw new Error('Method not implemented.');\r\n    };\r\n    BehaviorPropertyObserver.prototype.subscribe = function (context, callable) {\r\n        this.addSubscriber(context, callable);\r\n    };\r\n    BehaviorPropertyObserver.prototype.addSubscriber = function (context, callable) {\r\n        throw new Error('Method not implemented.');\r\n    };\r\n    BehaviorPropertyObserver.prototype.unsubscribe = function (context, callable) {\r\n        this.removeSubscriber(context, callable);\r\n    };\r\n    BehaviorPropertyObserver.prototype.removeSubscriber = function (context, callable) {\r\n        throw new Error('Method not implemented.');\r\n    };\r\n    BehaviorPropertyObserver = __decorate([\r\n        Object(aurelia_binding__WEBPACK_IMPORTED_MODULE_5__[\"subscriberCollection\"])()\r\n    ], BehaviorPropertyObserver);\r\n    return BehaviorPropertyObserver;\r\n}());\n\nfunction getObserver(instance, name) {\r\n    var lookup = instance.__observers__;\r\n    if (lookup === undefined) {\r\n        var ctor = Object.getPrototypeOf(instance).constructor;\r\n        var behavior = aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].get(aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].resource, ctor);\r\n        if (!behavior.isInitialized) {\r\n            behavior.initialize(aurelia_dependency_injection__WEBPACK_IMPORTED_MODULE_6__[\"Container\"].instance || new aurelia_dependency_injection__WEBPACK_IMPORTED_MODULE_6__[\"Container\"](), instance.constructor);\r\n        }\r\n        lookup = behavior.observerLocator.getOrCreateObserversLookup(instance);\r\n        behavior._ensurePropertiesDefined(instance, lookup);\r\n    }\r\n    return lookup[name];\r\n}\r\nvar BindableProperty = (function () {\r\n    function BindableProperty(nameOrConfig) {\r\n        if (typeof nameOrConfig === 'string') {\r\n            this.name = nameOrConfig;\r\n        }\r\n        else {\r\n            Object.assign(this, nameOrConfig);\r\n        }\r\n        this.attribute = this.attribute || _hyphenate(this.name);\r\n        var defaultBindingMode = this.defaultBindingMode;\r\n        if (defaultBindingMode === null || defaultBindingMode === undefined) {\r\n            this.defaultBindingMode = aurelia_binding__WEBPACK_IMPORTED_MODULE_5__[\"bindingMode\"].oneWay;\r\n        }\r\n        else if (typeof defaultBindingMode === 'string') {\r\n            this.defaultBindingMode = aurelia_binding__WEBPACK_IMPORTED_MODULE_5__[\"bindingMode\"][defaultBindingMode] || aurelia_binding__WEBPACK_IMPORTED_MODULE_5__[\"bindingMode\"].oneWay;\r\n        }\r\n        this.changeHandler = this.changeHandler || null;\r\n        this.owner = null;\r\n        this.descriptor = null;\r\n    }\r\n    BindableProperty.prototype.registerWith = function (target, behavior, descriptor) {\r\n        behavior.properties.push(this);\r\n        behavior.attributes[this.attribute] = this;\r\n        this.owner = behavior;\r\n        if (descriptor) {\r\n            this.descriptor = descriptor;\r\n            return this._configureDescriptor(descriptor);\r\n        }\r\n        return undefined;\r\n    };\r\n    BindableProperty.prototype._configureDescriptor = function (descriptor) {\r\n        var name = this.name;\r\n        descriptor.configurable = true;\r\n        descriptor.enumerable = true;\r\n        if ('initializer' in descriptor) {\r\n            this.defaultValue = descriptor.initializer;\r\n            delete descriptor.initializer;\r\n            delete descriptor.writable;\r\n        }\r\n        if ('value' in descriptor) {\r\n            this.defaultValue = descriptor.value;\r\n            delete descriptor.value;\r\n            delete descriptor.writable;\r\n        }\r\n        descriptor.get = function () {\r\n            return getObserver(this, name).getValue();\r\n        };\r\n        descriptor.set = function (value) {\r\n            getObserver(this, name).setValue(value);\r\n        };\r\n        descriptor.get.getObserver = function (obj) {\r\n            return getObserver(obj, name);\r\n        };\r\n        return descriptor;\r\n    };\r\n    BindableProperty.prototype.defineOn = function (target, behavior) {\r\n        var name = this.name;\r\n        var handlerName;\r\n        if (this.changeHandler === null) {\r\n            handlerName = name + 'Changed';\r\n            if (handlerName in target.prototype) {\r\n                this.changeHandler = handlerName;\r\n            }\r\n        }\r\n        if (this.descriptor === null) {\r\n            Object.defineProperty(target.prototype, name, this._configureDescriptor({}));\r\n        }\r\n    };\r\n    BindableProperty.prototype.createObserver = function (viewModel) {\r\n        var selfSubscriber = null;\r\n        var defaultValue = this.defaultValue;\r\n        var changeHandlerName = this.changeHandler;\r\n        var name = this.name;\r\n        var initialValue;\r\n        if (this.hasOptions) {\r\n            return undefined;\r\n        }\r\n        if (changeHandlerName in viewModel) {\r\n            if ('propertyChanged' in viewModel) {\r\n                selfSubscriber = function (newValue, oldValue) {\r\n                    viewModel[changeHandlerName](newValue, oldValue);\r\n                    viewModel.propertyChanged(name, newValue, oldValue);\r\n                };\r\n            }\r\n            else {\r\n                selfSubscriber = function (newValue, oldValue) { return viewModel[changeHandlerName](newValue, oldValue); };\r\n            }\r\n        }\r\n        else if ('propertyChanged' in viewModel) {\r\n            selfSubscriber = function (newValue, oldValue) { return viewModel.propertyChanged(name, newValue, oldValue); };\r\n        }\r\n        else if (changeHandlerName !== null) {\r\n            throw new Error(\"Change handler \".concat(changeHandlerName, \" was specified but not declared on the class.\"));\r\n        }\r\n        if (defaultValue !== undefined) {\r\n            initialValue = typeof defaultValue === 'function' ? defaultValue.call(viewModel) : defaultValue;\r\n        }\r\n        return new BehaviorPropertyObserver(this.owner.taskQueue, viewModel, this.name, selfSubscriber, initialValue);\r\n    };\r\n    BindableProperty.prototype._initialize = function (viewModel, observerLookup, attributes, behaviorHandlesBind, boundProperties) {\r\n        var selfSubscriber;\r\n        var observer;\r\n        var attribute;\r\n        var defaultValue = this.defaultValue;\r\n        if (this.isDynamic) {\r\n            for (var key in attributes) {\r\n                this._createDynamicProperty(viewModel, observerLookup, behaviorHandlesBind, key, attributes[key], boundProperties);\r\n            }\r\n        }\r\n        else if (!this.hasOptions) {\r\n            observer = observerLookup[this.name];\r\n            if (attributes !== null) {\r\n                selfSubscriber = observer.selfSubscriber;\r\n                attribute = attributes[this.attribute];\r\n                if (behaviorHandlesBind) {\r\n                    observer.selfSubscriber = null;\r\n                }\r\n                if (typeof attribute === 'string') {\r\n                    viewModel[this.name] = attribute;\r\n                    observer.call();\r\n                }\r\n                else if (attribute) {\r\n                    boundProperties.push({ observer: observer, binding: attribute.createBinding(viewModel) });\r\n                }\r\n                else if (defaultValue !== undefined) {\r\n                    observer.call();\r\n                }\r\n                observer.selfSubscriber = selfSubscriber;\r\n            }\r\n            observer.publishing = true;\r\n        }\r\n    };\r\n    BindableProperty.prototype._createDynamicProperty = function (viewModel, observerLookup, behaviorHandlesBind, name, attribute, boundProperties) {\r\n        var changeHandlerName = name + 'Changed';\r\n        var selfSubscriber = null;\r\n        var observer;\r\n        var info;\r\n        if (changeHandlerName in viewModel) {\r\n            if ('propertyChanged' in viewModel) {\r\n                selfSubscriber = function (newValue, oldValue) {\r\n                    viewModel[changeHandlerName](newValue, oldValue);\r\n                    viewModel.propertyChanged(name, newValue, oldValue);\r\n                };\r\n            }\r\n            else {\r\n                selfSubscriber = function (newValue, oldValue) { return viewModel[changeHandlerName](newValue, oldValue); };\r\n            }\r\n        }\r\n        else if ('propertyChanged' in viewModel) {\r\n            selfSubscriber = function (newValue, oldValue) { return viewModel.propertyChanged(name, newValue, oldValue); };\r\n        }\r\n        observer = observerLookup[name] = new BehaviorPropertyObserver(this.owner.taskQueue, viewModel, name, selfSubscriber);\r\n        Object.defineProperty(viewModel, name, {\r\n            configurable: true,\r\n            enumerable: true,\r\n            get: observer.getValue.bind(observer),\r\n            set: observer.setValue.bind(observer)\r\n        });\r\n        if (behaviorHandlesBind) {\r\n            observer.selfSubscriber = null;\r\n        }\r\n        if (typeof attribute === 'string') {\r\n            viewModel[name] = attribute;\r\n            observer.call();\r\n        }\r\n        else if (attribute) {\r\n            info = { observer: observer, binding: attribute.createBinding(viewModel) };\r\n            boundProperties.push(info);\r\n        }\r\n        observer.publishing = true;\r\n        observer.selfSubscriber = selfSubscriber;\r\n    };\r\n    return BindableProperty;\r\n}());\n\nvar ViewLocator = (function () {\r\n    function ViewLocator() {\r\n    }\r\n    ViewLocator.prototype.getViewStrategy = function (value) {\r\n        if (!value) {\r\n            return null;\r\n        }\r\n        if (typeof value === 'object' && 'getViewStrategy' in value) {\r\n            var origin_1 = aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"Origin\"].get(value.constructor);\r\n            value = value.getViewStrategy();\r\n            if (typeof value === 'string') {\r\n                value = new RelativeViewStrategy(value);\r\n            }\r\n            viewStrategy.assert(value);\r\n            if (origin_1.moduleId) {\r\n                value.makeRelativeTo(origin_1.moduleId);\r\n            }\r\n            return value;\r\n        }\r\n        if (typeof value === 'string') {\r\n            value = new RelativeViewStrategy(value);\r\n        }\r\n        if (viewStrategy.validate(value)) {\r\n            return value;\r\n        }\r\n        if (typeof value !== 'function') {\r\n            value = value.constructor;\r\n        }\r\n        if ('$view' in value) {\r\n            var c = value.$view;\r\n            var view = void 0;\r\n            c = typeof c === 'function' ? c.call(value) : c;\r\n            if (c === null) {\r\n                view = new NoViewStrategy();\r\n            }\r\n            else {\r\n                view = c instanceof StaticViewStrategy ? c : new StaticViewStrategy(c);\r\n            }\r\n            aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].define(ViewLocator.viewStrategyMetadataKey, view, value);\r\n            return view;\r\n        }\r\n        var origin = aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"Origin\"].get(value);\r\n        var strategy = aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].get(ViewLocator.viewStrategyMetadataKey, value);\r\n        if (!strategy) {\r\n            if (!origin.moduleId) {\r\n                throw new Error('Cannot determine default view strategy for object.\\n' + value);\r\n            }\r\n            strategy = this.createFallbackViewStrategy(origin);\r\n        }\r\n        else if (origin.moduleId) {\r\n            strategy.moduleId = origin.moduleId;\r\n        }\r\n        return strategy;\r\n    };\r\n    ViewLocator.prototype.createFallbackViewStrategy = function (origin) {\r\n        return new ConventionalViewStrategy(this, origin);\r\n    };\r\n    ViewLocator.prototype.convertOriginToViewUrl = function (origin) {\r\n        var moduleId = origin.moduleId;\r\n        var id = (moduleId.endsWith('.js') || moduleId.endsWith('.ts')) ? moduleId.substring(0, moduleId.length - 3) : moduleId;\r\n        return id + '.html';\r\n    };\r\n    ViewLocator.viewStrategyMetadataKey = 'aurelia:view-strategy';\r\n    return ViewLocator;\r\n}());\n\nfunction mi(name) {\r\n    throw new Error(\"BindingLanguage must implement \".concat(name, \"().\"));\r\n}\r\nvar BindingLanguage = (function () {\r\n    function BindingLanguage() {\r\n    }\r\n    BindingLanguage.prototype.inspectAttribute = function (resources, elementName, attrName, attrValue) {\r\n        mi('inspectAttribute');\r\n    };\r\n    BindingLanguage.prototype.createAttributeInstruction = function (resources, element, info, existingInstruction, context) {\r\n        mi('createAttributeInstruction');\r\n    };\r\n    BindingLanguage.prototype.createLetExpressions = function (resources, element) {\r\n        mi('createLetExpressions');\r\n    };\r\n    BindingLanguage.prototype.inspectTextContent = function (resources, value) {\r\n        mi('inspectTextContent');\r\n    };\r\n    return BindingLanguage;\r\n}());\n\nvar noNodes = Object.freeze([]);\r\nvar SlotCustomAttribute = (function () {\r\n    function SlotCustomAttribute(element) {\r\n        this.element = element;\r\n        this.element.auSlotAttribute = this;\r\n    }\r\n    SlotCustomAttribute.inject = function () {\r\n        return [aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].Element];\r\n    };\r\n    SlotCustomAttribute.prototype.valueChanged = function (newValue, oldValue) { };\r\n    return SlotCustomAttribute;\r\n}());\r\nvar PassThroughSlot = (function () {\r\n    function PassThroughSlot(anchor, name, destinationName, fallbackFactory) {\r\n        this.anchor = anchor;\r\n        this.anchor.viewSlot = this;\r\n        this.name = name;\r\n        this.destinationName = destinationName;\r\n        this.fallbackFactory = fallbackFactory;\r\n        this.destinationSlot = null;\r\n        this.projections = 0;\r\n        this.contentView = null;\r\n        var attr = new SlotCustomAttribute(this.anchor);\r\n        attr.value = this.destinationName;\r\n    }\r\n    Object.defineProperty(PassThroughSlot.prototype, \"needsFallbackRendering\", {\r\n        get: function () {\r\n            return this.fallbackFactory && this.projections === 0;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    PassThroughSlot.prototype.renderFallbackContent = function (view, nodes, projectionSource, index) {\r\n        if (this.contentView === null) {\r\n            this.contentView = this.fallbackFactory.create(this.ownerView.container);\r\n            this.contentView.bind(this.ownerView.bindingContext, this.ownerView.overrideContext);\r\n            var slots = Object.create(null);\r\n            slots[this.destinationSlot.name] = this.destinationSlot;\r\n            ShadowDOM.distributeView(this.contentView, slots, projectionSource, index, this.destinationSlot.name);\r\n        }\r\n    };\r\n    PassThroughSlot.prototype.passThroughTo = function (destinationSlot) {\r\n        this.destinationSlot = destinationSlot;\r\n    };\r\n    PassThroughSlot.prototype.addNode = function (view, node, projectionSource, index) {\r\n        if (this.contentView !== null) {\r\n            this.contentView.removeNodes();\r\n            this.contentView.detached();\r\n            this.contentView.unbind();\r\n            this.contentView = null;\r\n        }\r\n        if (node.viewSlot instanceof PassThroughSlot) {\r\n            node.viewSlot.passThroughTo(this);\r\n            return;\r\n        }\r\n        this.projections++;\r\n        this.destinationSlot.addNode(view, node, projectionSource, index);\r\n    };\r\n    PassThroughSlot.prototype.removeView = function (view, projectionSource) {\r\n        this.projections--;\r\n        this.destinationSlot.removeView(view, projectionSource);\r\n        if (this.needsFallbackRendering) {\r\n            this.renderFallbackContent(null, noNodes, projectionSource);\r\n        }\r\n    };\r\n    PassThroughSlot.prototype.removeAll = function (projectionSource) {\r\n        this.projections = 0;\r\n        this.destinationSlot.removeAll(projectionSource);\r\n        if (this.needsFallbackRendering) {\r\n            this.renderFallbackContent(null, noNodes, projectionSource);\r\n        }\r\n    };\r\n    PassThroughSlot.prototype.projectFrom = function (view, projectionSource) {\r\n        this.destinationSlot.projectFrom(view, projectionSource);\r\n    };\r\n    PassThroughSlot.prototype.created = function (ownerView) {\r\n        this.ownerView = ownerView;\r\n    };\r\n    PassThroughSlot.prototype.bind = function (view) {\r\n        if (this.contentView) {\r\n            this.contentView.bind(view.bindingContext, view.overrideContext);\r\n        }\r\n    };\r\n    PassThroughSlot.prototype.attached = function () {\r\n        if (this.contentView) {\r\n            this.contentView.attached();\r\n        }\r\n    };\r\n    PassThroughSlot.prototype.detached = function () {\r\n        if (this.contentView) {\r\n            this.contentView.detached();\r\n        }\r\n    };\r\n    PassThroughSlot.prototype.unbind = function () {\r\n        if (this.contentView) {\r\n            this.contentView.unbind();\r\n        }\r\n    };\r\n    return PassThroughSlot;\r\n}());\r\nvar ShadowSlot = (function () {\r\n    function ShadowSlot(anchor, name, fallbackFactory) {\r\n        this.anchor = anchor;\r\n        this.anchor.isContentProjectionSource = true;\r\n        this.anchor.viewSlot = this;\r\n        this.name = name;\r\n        this.fallbackFactory = fallbackFactory;\r\n        this.contentView = null;\r\n        this.projections = 0;\r\n        this.children = [];\r\n        this.projectFromAnchors = null;\r\n        this.destinationSlots = null;\r\n    }\r\n    Object.defineProperty(ShadowSlot.prototype, \"needsFallbackRendering\", {\r\n        get: function () {\r\n            return this.fallbackFactory && this.projections === 0;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    ShadowSlot.prototype.addNode = function (view, node, projectionSource, index, destination) {\r\n        var $node = node;\r\n        if (this.contentView !== null) {\r\n            this.contentView.removeNodes();\r\n            this.contentView.detached();\r\n            this.contentView.unbind();\r\n            this.contentView = null;\r\n        }\r\n        if ($node.viewSlot instanceof PassThroughSlot) {\r\n            $node.viewSlot.passThroughTo(this);\r\n            return;\r\n        }\r\n        if (this.destinationSlots !== null) {\r\n            ShadowDOM.distributeNodes(view, [$node], this.destinationSlots, this, index);\r\n        }\r\n        else {\r\n            $node.auOwnerView = view;\r\n            $node.auProjectionSource = projectionSource;\r\n            $node.auAssignedSlot = this;\r\n            var anchor = this._findAnchor(view, $node, projectionSource, index);\r\n            var parent_1 = anchor.parentNode;\r\n            parent_1.insertBefore($node, anchor);\r\n            this.children.push($node);\r\n            this.projections++;\r\n        }\r\n    };\r\n    ShadowSlot.prototype.removeView = function (view, projectionSource) {\r\n        if (this.destinationSlots !== null) {\r\n            ShadowDOM.undistributeView(view, this.destinationSlots, this);\r\n        }\r\n        else if (this.contentView && this.contentView.hasSlots) {\r\n            ShadowDOM.undistributeView(view, this.contentView.slots, projectionSource);\r\n        }\r\n        else {\r\n            var found = this.children.find(function (x) { return x.auSlotProjectFrom === projectionSource; });\r\n            if (found) {\r\n                var children = found.auProjectionChildren;\r\n                var ownChildren = this.children;\r\n                for (var i = 0, ii = children.length; i < ii; ++i) {\r\n                    var child = children[i];\r\n                    if (child.auOwnerView === view) {\r\n                        children.splice(i, 1);\r\n                        view.fragment.appendChild(child);\r\n                        i--;\r\n                        ii--;\r\n                        this.projections--;\r\n                        var idx = ownChildren.indexOf(child);\r\n                        if (idx > -1) {\r\n                            ownChildren.splice(idx, 1);\r\n                        }\r\n                    }\r\n                }\r\n                if (this.needsFallbackRendering) {\r\n                    this.renderFallbackContent(view, noNodes, projectionSource);\r\n                }\r\n            }\r\n        }\r\n    };\r\n    ShadowSlot.prototype.removeAll = function (projectionSource) {\r\n        if (this.destinationSlots !== null) {\r\n            ShadowDOM.undistributeAll(this.destinationSlots, this);\r\n        }\r\n        else if (this.contentView && this.contentView.hasSlots) {\r\n            ShadowDOM.undistributeAll(this.contentView.slots, projectionSource);\r\n        }\r\n        else {\r\n            var found = this.children.find(function (x) { return x.auSlotProjectFrom === projectionSource; });\r\n            if (found) {\r\n                var children = found.auProjectionChildren;\r\n                var ownChildren = this.children;\r\n                for (var i = 0, ii = children.length; i < ii; ++i) {\r\n                    var child = children[i];\r\n                    child.auOwnerView.fragment.appendChild(child);\r\n                    this.projections--;\r\n                    var idx = ownChildren.indexOf(child);\r\n                    if (idx > -1) {\r\n                        ownChildren.splice(idx, 1);\r\n                    }\r\n                }\r\n                found.auProjectionChildren = [];\r\n                if (this.needsFallbackRendering) {\r\n                    this.renderFallbackContent(null, noNodes, projectionSource);\r\n                }\r\n            }\r\n        }\r\n    };\r\n    ShadowSlot.prototype._findAnchor = function (view, node, projectionSource, index) {\r\n        if (projectionSource) {\r\n            var found = this.children.find(function (x) { return x.auSlotProjectFrom === projectionSource; });\r\n            if (found) {\r\n                if (index !== undefined) {\r\n                    var children = found.auProjectionChildren;\r\n                    var viewIndex = -1;\r\n                    var lastView = void 0;\r\n                    for (var i = 0, ii = children.length; i < ii; ++i) {\r\n                        var current = children[i];\r\n                        if (current.auOwnerView !== lastView) {\r\n                            viewIndex++;\r\n                            lastView = current.auOwnerView;\r\n                            if (viewIndex >= index && lastView !== view) {\r\n                                children.splice(i, 0, node);\r\n                                return current;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                found.auProjectionChildren.push(node);\r\n                return found;\r\n            }\r\n        }\r\n        return this.anchor;\r\n    };\r\n    ShadowSlot.prototype.projectTo = function (slots) {\r\n        this.destinationSlots = slots;\r\n    };\r\n    ShadowSlot.prototype.projectFrom = function (view, projectionSource) {\r\n        var anchor = aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].createComment('anchor');\r\n        var parent = this.anchor.parentNode;\r\n        anchor.auSlotProjectFrom = projectionSource;\r\n        anchor.auOwnerView = view;\r\n        anchor.auProjectionChildren = [];\r\n        parent.insertBefore(anchor, this.anchor);\r\n        this.children.push(anchor);\r\n        if (this.projectFromAnchors === null) {\r\n            this.projectFromAnchors = [];\r\n        }\r\n        this.projectFromAnchors.push(anchor);\r\n    };\r\n    ShadowSlot.prototype.renderFallbackContent = function (view, nodes, projectionSource, index) {\r\n        if (this.contentView === null) {\r\n            this.contentView = this.fallbackFactory.create(this.ownerView.container);\r\n            this.contentView.bind(this.ownerView.bindingContext, this.ownerView.overrideContext);\r\n            this.contentView.insertNodesBefore(this.anchor);\r\n        }\r\n        if (this.contentView.hasSlots) {\r\n            var slots = this.contentView.slots;\r\n            var projectFromAnchors = this.projectFromAnchors;\r\n            if (projectFromAnchors !== null) {\r\n                for (var slotName in slots) {\r\n                    var slot = slots[slotName];\r\n                    for (var i = 0, ii = projectFromAnchors.length; i < ii; ++i) {\r\n                        var anchor = projectFromAnchors[i];\r\n                        slot.projectFrom(anchor.auOwnerView, anchor.auSlotProjectFrom);\r\n                    }\r\n                }\r\n            }\r\n            this.fallbackSlots = slots;\r\n            ShadowDOM.distributeNodes(view, nodes, slots, projectionSource, index);\r\n        }\r\n    };\r\n    ShadowSlot.prototype.created = function (ownerView) {\r\n        this.ownerView = ownerView;\r\n    };\r\n    ShadowSlot.prototype.bind = function (view) {\r\n        if (this.contentView) {\r\n            this.contentView.bind(view.bindingContext, view.overrideContext);\r\n        }\r\n    };\r\n    ShadowSlot.prototype.attached = function () {\r\n        if (this.contentView) {\r\n            this.contentView.attached();\r\n        }\r\n    };\r\n    ShadowSlot.prototype.detached = function () {\r\n        if (this.contentView) {\r\n            this.contentView.detached();\r\n        }\r\n    };\r\n    ShadowSlot.prototype.unbind = function () {\r\n        if (this.contentView) {\r\n            this.contentView.unbind();\r\n        }\r\n    };\r\n    return ShadowSlot;\r\n}());\r\nvar ShadowDOM = (function () {\r\n    function ShadowDOM() {\r\n    }\r\n    ShadowDOM.getSlotName = function (node) {\r\n        if (node.auSlotAttribute === undefined) {\r\n            return ShadowDOM.defaultSlotKey;\r\n        }\r\n        return node.auSlotAttribute.value;\r\n    };\r\n    ShadowDOM.distributeView = function (view, slots, projectionSource, index, destinationOverride) {\r\n        var nodes;\r\n        if (view === null) {\r\n            nodes = noNodes;\r\n        }\r\n        else {\r\n            var childNodes = view.fragment.childNodes;\r\n            var ii = childNodes.length;\r\n            nodes = new Array(ii);\r\n            for (var i = 0; i < ii; ++i) {\r\n                nodes[i] = childNodes[i];\r\n            }\r\n        }\r\n        ShadowDOM.distributeNodes(view, nodes, slots, projectionSource, index, destinationOverride);\r\n    };\r\n    ShadowDOM.undistributeView = function (view, slots, projectionSource) {\r\n        for (var slotName in slots) {\r\n            slots[slotName].removeView(view, projectionSource);\r\n        }\r\n    };\r\n    ShadowDOM.undistributeAll = function (slots, projectionSource) {\r\n        for (var slotName in slots) {\r\n            slots[slotName].removeAll(projectionSource);\r\n        }\r\n    };\r\n    ShadowDOM.distributeNodes = function (view, nodes, slots, projectionSource, index, destinationOverride) {\r\n        for (var i = 0, ii = nodes.length; i < ii; ++i) {\r\n            var currentNode = nodes[i];\r\n            var nodeType = currentNode.nodeType;\r\n            if (currentNode.isContentProjectionSource) {\r\n                currentNode.viewSlot.projectTo(slots);\r\n                for (var slotName in slots) {\r\n                    slots[slotName].projectFrom(view, currentNode.viewSlot);\r\n                }\r\n                nodes.splice(i, 1);\r\n                ii--;\r\n                i--;\r\n            }\r\n            else if (nodeType === 1 || nodeType === 3 || currentNode.viewSlot instanceof PassThroughSlot) {\r\n                if (nodeType === 3 && _isAllWhitespace(currentNode)) {\r\n                    nodes.splice(i, 1);\r\n                    ii--;\r\n                    i--;\r\n                }\r\n                else {\r\n                    var found = slots[destinationOverride || ShadowDOM.getSlotName(currentNode)];\r\n                    if (found) {\r\n                        found.addNode(view, currentNode, projectionSource, index);\r\n                        nodes.splice(i, 1);\r\n                        ii--;\r\n                        i--;\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                nodes.splice(i, 1);\r\n                ii--;\r\n                i--;\r\n            }\r\n        }\r\n        for (var slotName in slots) {\r\n            var slot = slots[slotName];\r\n            if (slot.needsFallbackRendering) {\r\n                slot.renderFallbackContent(view, nodes, projectionSource, index);\r\n            }\r\n        }\r\n    };\r\n    ShadowDOM.defaultSlotKey = '__au-default-slot-key__';\r\n    return ShadowDOM;\r\n}());\n\nvar CompositionTransactionNotifier = (function () {\r\n    function CompositionTransactionNotifier(owner) {\r\n        this.owner = owner;\r\n        this.owner._compositionCount++;\r\n    }\r\n    CompositionTransactionNotifier.prototype.done = function () {\r\n        this.owner._compositionCount--;\r\n        this.owner._tryCompleteTransaction();\r\n    };\r\n    return CompositionTransactionNotifier;\r\n}());\r\nvar CompositionTransactionOwnershipToken = (function () {\r\n    function CompositionTransactionOwnershipToken(owner) {\r\n        this.owner = owner;\r\n        this.owner._ownershipToken = this;\r\n        this.thenable = this._createThenable();\r\n    }\r\n    CompositionTransactionOwnershipToken.prototype.waitForCompositionComplete = function () {\r\n        this.owner._tryCompleteTransaction();\r\n        return this.thenable;\r\n    };\r\n    CompositionTransactionOwnershipToken.prototype.resolve = function () {\r\n        this._resolveCallback();\r\n    };\r\n    CompositionTransactionOwnershipToken.prototype._resolveCallback = function () {\r\n        throw new Error(\"Method not implemented.\");\r\n    };\r\n    CompositionTransactionOwnershipToken.prototype._createThenable = function () {\r\n        var _this = this;\r\n        return new Promise(function (resolve) {\r\n            _this._resolveCallback = resolve;\r\n        });\r\n    };\r\n    return CompositionTransactionOwnershipToken;\r\n}());\r\nvar CompositionTransaction = (function () {\r\n    function CompositionTransaction() {\r\n        this._ownershipToken = null;\r\n        this._compositionCount = 0;\r\n    }\r\n    CompositionTransaction.prototype.tryCapture = function () {\r\n        return this._ownershipToken === null\r\n            ? new CompositionTransactionOwnershipToken(this)\r\n            : null;\r\n    };\r\n    CompositionTransaction.prototype.enlist = function () {\r\n        return new CompositionTransactionNotifier(this);\r\n    };\r\n    CompositionTransaction.prototype._tryCompleteTransaction = function () {\r\n        if (this._compositionCount <= 0) {\r\n            this._compositionCount = 0;\r\n            if (this._ownershipToken !== null) {\r\n                var token = this._ownershipToken;\r\n                this._ownershipToken = null;\r\n                token.resolve();\r\n            }\r\n        }\r\n    };\r\n    return CompositionTransaction;\r\n}());\n\nvar View = (function () {\r\n    function View(container, viewFactory, fragment, controllers, bindings, children, slots) {\r\n        this.container = container;\r\n        this.viewFactory = viewFactory;\r\n        this.resources = viewFactory.resources;\r\n        this.fragment = fragment;\r\n        this.firstChild = fragment.firstChild;\r\n        this.lastChild = fragment.lastChild;\r\n        this.controllers = controllers;\r\n        this.bindings = bindings;\r\n        this.children = children;\r\n        this.slots = slots;\r\n        this.hasSlots = false;\r\n        this.fromCache = false;\r\n        this.isBound = false;\r\n        this.isAttached = false;\r\n        this.bindingContext = null;\r\n        this.overrideContext = null;\r\n        this.controller = null;\r\n        this.viewModelScope = null;\r\n        this.animatableElement = undefined;\r\n        this._isUserControlled = false;\r\n        this.contentView = null;\r\n        for (var _ in slots) {\r\n            this.hasSlots = true;\r\n            break;\r\n        }\r\n    }\r\n    View.prototype.returnToCache = function () {\r\n        this.viewFactory.returnViewToCache(this);\r\n    };\r\n    View.prototype.created = function () {\r\n        var i;\r\n        var ii;\r\n        var controllers = this.controllers;\r\n        for (i = 0, ii = controllers.length; i < ii; ++i) {\r\n            controllers[i].created(this);\r\n        }\r\n    };\r\n    View.prototype.bind = function (bindingContext, overrideContext, _systemUpdate) {\r\n        var controllers;\r\n        var bindings;\r\n        var children;\r\n        var i;\r\n        var ii;\r\n        if (_systemUpdate && this._isUserControlled) {\r\n            return;\r\n        }\r\n        if (this.isBound) {\r\n            if (this.bindingContext === bindingContext) {\r\n                return;\r\n            }\r\n            this.unbind();\r\n        }\r\n        this.isBound = true;\r\n        this.bindingContext = bindingContext;\r\n        this.overrideContext = overrideContext || Object(aurelia_binding__WEBPACK_IMPORTED_MODULE_5__[\"createOverrideContext\"])(bindingContext);\r\n        this.resources._invokeHook('beforeBind', this);\r\n        bindings = this.bindings;\r\n        for (i = 0, ii = bindings.length; i < ii; ++i) {\r\n            bindings[i].bind(this);\r\n        }\r\n        if (this.viewModelScope !== null) {\r\n            bindingContext.bind(this.viewModelScope.bindingContext, this.viewModelScope.overrideContext);\r\n            this.viewModelScope = null;\r\n        }\r\n        controllers = this.controllers;\r\n        for (i = 0, ii = controllers.length; i < ii; ++i) {\r\n            controllers[i].bind(this);\r\n        }\r\n        children = this.children;\r\n        for (i = 0, ii = children.length; i < ii; ++i) {\r\n            children[i].bind(bindingContext, overrideContext, true);\r\n        }\r\n        if (this.hasSlots) {\r\n            ShadowDOM.distributeView(this.contentView, this.slots);\r\n        }\r\n    };\r\n    View.prototype.addBinding = function (binding) {\r\n        this.bindings.push(binding);\r\n        if (this.isBound) {\r\n            binding.bind(this);\r\n        }\r\n    };\r\n    View.prototype.unbind = function () {\r\n        var controllers;\r\n        var bindings;\r\n        var children;\r\n        var i;\r\n        var ii;\r\n        if (this.isBound) {\r\n            this.isBound = false;\r\n            this.resources._invokeHook('beforeUnbind', this);\r\n            if (this.controller !== null) {\r\n                this.controller.unbind();\r\n            }\r\n            bindings = this.bindings;\r\n            for (i = 0, ii = bindings.length; i < ii; ++i) {\r\n                bindings[i].unbind();\r\n            }\r\n            controllers = this.controllers;\r\n            for (i = 0, ii = controllers.length; i < ii; ++i) {\r\n                controllers[i].unbind();\r\n            }\r\n            children = this.children;\r\n            for (i = 0, ii = children.length; i < ii; ++i) {\r\n                children[i].unbind();\r\n            }\r\n            this.bindingContext = null;\r\n            this.overrideContext = null;\r\n        }\r\n    };\r\n    View.prototype.insertNodesBefore = function (refNode) {\r\n        refNode.parentNode.insertBefore(this.fragment, refNode);\r\n    };\r\n    View.prototype.appendNodesTo = function (parent) {\r\n        parent.appendChild(this.fragment);\r\n    };\r\n    View.prototype.removeNodes = function () {\r\n        var fragment = this.fragment;\r\n        var current = this.firstChild;\r\n        var end = this.lastChild;\r\n        var next;\r\n        while (current) {\r\n            next = current.nextSibling;\r\n            fragment.appendChild(current);\r\n            if (current === end) {\r\n                break;\r\n            }\r\n            current = next;\r\n        }\r\n    };\r\n    View.prototype.attached = function () {\r\n        var controllers;\r\n        var children;\r\n        var i;\r\n        var ii;\r\n        if (this.isAttached) {\r\n            return;\r\n        }\r\n        this.isAttached = true;\r\n        if (this.controller !== null) {\r\n            this.controller.attached();\r\n        }\r\n        controllers = this.controllers;\r\n        for (i = 0, ii = controllers.length; i < ii; ++i) {\r\n            controllers[i].attached();\r\n        }\r\n        children = this.children;\r\n        for (i = 0, ii = children.length; i < ii; ++i) {\r\n            children[i].attached();\r\n        }\r\n    };\r\n    View.prototype.detached = function () {\r\n        var controllers;\r\n        var children;\r\n        var i;\r\n        var ii;\r\n        if (this.isAttached) {\r\n            this.isAttached = false;\r\n            if (this.controller !== null) {\r\n                this.controller.detached();\r\n            }\r\n            controllers = this.controllers;\r\n            for (i = 0, ii = controllers.length; i < ii; ++i) {\r\n                controllers[i].detached();\r\n            }\r\n            children = this.children;\r\n            for (i = 0, ii = children.length; i < ii; ++i) {\r\n                children[i].detached();\r\n            }\r\n        }\r\n    };\r\n    return View;\r\n}());\n\nvar Animator = (function () {\r\n    function Animator() {\r\n    }\r\n    Animator.prototype.enter = function (element) {\r\n        return Promise.resolve(false);\r\n    };\r\n    Animator.prototype.leave = function (element) {\r\n        return Promise.resolve(false);\r\n    };\r\n    Animator.prototype.removeClass = function (element, className) {\r\n        element.classList.remove(className);\r\n        return Promise.resolve(false);\r\n    };\r\n    Animator.prototype.addClass = function (element, className) {\r\n        element.classList.add(className);\r\n        return Promise.resolve(false);\r\n    };\r\n    Animator.prototype.animate = function (element, className) {\r\n        return Promise.resolve(false);\r\n    };\r\n    Animator.prototype.runSequence = function (animations) {\r\n        return Promise.resolve(false);\r\n    };\r\n    Animator.prototype.registerEffect = function (effectName, properties) { };\r\n    Animator.prototype.unregisterEffect = function (effectName) { };\r\n    return Animator;\r\n}());\n\nfunction getAnimatableElement(view) {\r\n    if (view.animatableElement !== undefined) {\r\n        return view.animatableElement;\r\n    }\r\n    var current = view.firstChild;\r\n    while (current && current.nodeType !== 1) {\r\n        current = current.nextSibling;\r\n    }\r\n    if (current && current.nodeType === 1) {\r\n        return (view.animatableElement = current.classList.contains('au-animate') ? current : null);\r\n    }\r\n    return (view.animatableElement = null);\r\n}\r\nvar ViewSlot = (function () {\r\n    function ViewSlot(anchor, anchorIsContainer, animator) {\r\n        if (animator === void 0) { animator = Animator.instance; }\r\n        this.anchor = anchor;\r\n        this.anchorIsContainer = anchorIsContainer;\r\n        this.bindingContext = null;\r\n        this.overrideContext = null;\r\n        this.animator = animator;\r\n        this.children = [];\r\n        this.isBound = false;\r\n        this.isAttached = false;\r\n        this.contentSelectors = null;\r\n        anchor.viewSlot = this;\r\n        anchor.isContentProjectionSource = false;\r\n    }\r\n    ViewSlot.prototype.animateView = function (view, direction) {\r\n        if (direction === void 0) { direction = 'enter'; }\r\n        var animatableElement = getAnimatableElement(view);\r\n        if (animatableElement !== null) {\r\n            switch (direction) {\r\n                case 'enter':\r\n                    return this.animator.enter(animatableElement);\r\n                case 'leave':\r\n                    return this.animator.leave(animatableElement);\r\n                default:\r\n                    throw new Error('Invalid animation direction: ' + direction);\r\n            }\r\n        }\r\n    };\r\n    ViewSlot.prototype.transformChildNodesIntoView = function () {\r\n        var parent = this.anchor;\r\n        this.children.push({\r\n            fragment: parent,\r\n            firstChild: parent.firstChild,\r\n            lastChild: parent.lastChild,\r\n            returnToCache: function () { },\r\n            removeNodes: function () {\r\n                var last;\r\n                while (last = parent.lastChild) {\r\n                    parent.removeChild(last);\r\n                }\r\n            },\r\n            created: function () { },\r\n            bind: function () { },\r\n            unbind: function () { },\r\n            attached: function () { },\r\n            detached: function () { }\r\n        });\r\n    };\r\n    ViewSlot.prototype.bind = function (bindingContext, overrideContext) {\r\n        var i;\r\n        var ii;\r\n        var children;\r\n        if (this.isBound) {\r\n            if (this.bindingContext === bindingContext) {\r\n                return;\r\n            }\r\n            this.unbind();\r\n        }\r\n        this.isBound = true;\r\n        this.bindingContext = bindingContext = bindingContext || this.bindingContext;\r\n        this.overrideContext = overrideContext = overrideContext || this.overrideContext;\r\n        children = this.children;\r\n        for (i = 0, ii = children.length; i < ii; ++i) {\r\n            children[i].bind(bindingContext, overrideContext, true);\r\n        }\r\n    };\r\n    ViewSlot.prototype.unbind = function () {\r\n        if (this.isBound) {\r\n            var i = void 0;\r\n            var ii = void 0;\r\n            var children = this.children;\r\n            this.isBound = false;\r\n            this.bindingContext = null;\r\n            this.overrideContext = null;\r\n            for (i = 0, ii = children.length; i < ii; ++i) {\r\n                children[i].unbind();\r\n            }\r\n        }\r\n    };\r\n    ViewSlot.prototype.add = function (view) {\r\n        if (this.anchorIsContainer) {\r\n            view.appendNodesTo(this.anchor);\r\n        }\r\n        else {\r\n            view.insertNodesBefore(this.anchor);\r\n        }\r\n        this.children.push(view);\r\n        if (this.isAttached) {\r\n            view.attached();\r\n            return this.animateView(view, 'enter');\r\n        }\r\n    };\r\n    ViewSlot.prototype.insert = function (index, view) {\r\n        var children = this.children;\r\n        var length = children.length;\r\n        if ((index === 0 && length === 0) || index >= length) {\r\n            return this.add(view);\r\n        }\r\n        view.insertNodesBefore(children[index].firstChild);\r\n        children.splice(index, 0, view);\r\n        if (this.isAttached) {\r\n            view.attached();\r\n            return this.animateView(view, 'enter');\r\n        }\r\n    };\r\n    ViewSlot.prototype.move = function (sourceIndex, targetIndex) {\r\n        if (sourceIndex === targetIndex) {\r\n            return;\r\n        }\r\n        var children = this.children;\r\n        var view = children[sourceIndex];\r\n        view.removeNodes();\r\n        view.insertNodesBefore(children[targetIndex].firstChild);\r\n        children.splice(sourceIndex, 1);\r\n        children.splice(targetIndex, 0, view);\r\n    };\r\n    ViewSlot.prototype.remove = function (view, returnToCache, skipAnimation) {\r\n        return this.removeAt(this.children.indexOf(view), returnToCache, skipAnimation);\r\n    };\r\n    ViewSlot.prototype.removeMany = function (viewsToRemove, returnToCache, skipAnimation) {\r\n        var _this = this;\r\n        var children = this.children;\r\n        var ii = viewsToRemove.length;\r\n        var i;\r\n        var rmPromises = [];\r\n        viewsToRemove.forEach(function (child) {\r\n            if (skipAnimation) {\r\n                child.removeNodes();\r\n                return;\r\n            }\r\n            var animation = _this.animateView(child, 'leave');\r\n            if (animation) {\r\n                rmPromises.push(animation.then(function () { return child.removeNodes(); }));\r\n            }\r\n            else {\r\n                child.removeNodes();\r\n            }\r\n        });\r\n        var removeAction = function () {\r\n            if (_this.isAttached) {\r\n                for (i = 0; i < ii; ++i) {\r\n                    viewsToRemove[i].detached();\r\n                }\r\n            }\r\n            if (returnToCache) {\r\n                for (i = 0; i < ii; ++i) {\r\n                    viewsToRemove[i].returnToCache();\r\n                }\r\n            }\r\n            for (i = 0; i < ii; ++i) {\r\n                var index = children.indexOf(viewsToRemove[i]);\r\n                if (index >= 0) {\r\n                    children.splice(index, 1);\r\n                }\r\n            }\r\n        };\r\n        if (rmPromises.length > 0) {\r\n            return Promise.all(rmPromises).then(function () { return removeAction(); });\r\n        }\r\n        return removeAction();\r\n    };\r\n    ViewSlot.prototype.removeAt = function (index, returnToCache, skipAnimation) {\r\n        var _this = this;\r\n        var view = this.children[index];\r\n        var removeAction = function () {\r\n            index = _this.children.indexOf(view);\r\n            view.removeNodes();\r\n            _this.children.splice(index, 1);\r\n            if (_this.isAttached) {\r\n                view.detached();\r\n            }\r\n            if (returnToCache) {\r\n                view.returnToCache();\r\n            }\r\n            return view;\r\n        };\r\n        if (!skipAnimation) {\r\n            var animation = this.animateView(view, 'leave');\r\n            if (animation) {\r\n                return animation.then(function () { return removeAction(); });\r\n            }\r\n        }\r\n        return removeAction();\r\n    };\r\n    ViewSlot.prototype.removeAll = function (returnToCache, skipAnimation) {\r\n        var _this = this;\r\n        var children = this.children;\r\n        var ii = children.length;\r\n        var i;\r\n        var rmPromises = [];\r\n        children.forEach(function (child) {\r\n            if (skipAnimation) {\r\n                child.removeNodes();\r\n                return;\r\n            }\r\n            var animation = _this.animateView(child, 'leave');\r\n            if (animation) {\r\n                rmPromises.push(animation.then(function () { return child.removeNodes(); }));\r\n            }\r\n            else {\r\n                child.removeNodes();\r\n            }\r\n        });\r\n        var removeAction = function () {\r\n            if (_this.isAttached) {\r\n                for (i = 0; i < ii; ++i) {\r\n                    children[i].detached();\r\n                }\r\n            }\r\n            if (returnToCache) {\r\n                for (i = 0; i < ii; ++i) {\r\n                    var child = children[i];\r\n                    if (child) {\r\n                        child.returnToCache();\r\n                    }\r\n                }\r\n            }\r\n            _this.children = [];\r\n        };\r\n        if (rmPromises.length > 0) {\r\n            return Promise.all(rmPromises).then(function () { return removeAction(); });\r\n        }\r\n        return removeAction();\r\n    };\r\n    ViewSlot.prototype.attached = function () {\r\n        var i;\r\n        var ii;\r\n        var children;\r\n        var child;\r\n        if (this.isAttached) {\r\n            return;\r\n        }\r\n        this.isAttached = true;\r\n        children = this.children;\r\n        for (i = 0, ii = children.length; i < ii; ++i) {\r\n            child = children[i];\r\n            child.attached();\r\n            this.animateView(child, 'enter');\r\n        }\r\n    };\r\n    ViewSlot.prototype.detached = function () {\r\n        var i;\r\n        var ii;\r\n        var children;\r\n        if (this.isAttached) {\r\n            this.isAttached = false;\r\n            children = this.children;\r\n            for (i = 0, ii = children.length; i < ii; ++i) {\r\n                children[i].detached();\r\n            }\r\n        }\r\n    };\r\n    ViewSlot.prototype.projectTo = function (slots) {\r\n        var _this = this;\r\n        this.projectToSlots = slots;\r\n        this.add = this._projectionAdd;\r\n        this.insert = this._projectionInsert;\r\n        this.move = this._projectionMove;\r\n        this.remove = this._projectionRemove;\r\n        this.removeAt = this._projectionRemoveAt;\r\n        this.removeMany = this._projectionRemoveMany;\r\n        this.removeAll = this._projectionRemoveAll;\r\n        this.children.forEach(function (view) { return ShadowDOM.distributeView(view, slots, _this); });\r\n    };\r\n    ViewSlot.prototype._projectionAdd = function (view) {\r\n        ShadowDOM.distributeView(view, this.projectToSlots, this);\r\n        this.children.push(view);\r\n        if (this.isAttached) {\r\n            view.attached();\r\n        }\r\n    };\r\n    ViewSlot.prototype._projectionInsert = function (index, view) {\r\n        if ((index === 0 && !this.children.length) || index >= this.children.length) {\r\n            this.add(view);\r\n        }\r\n        else {\r\n            ShadowDOM.distributeView(view, this.projectToSlots, this, index);\r\n            this.children.splice(index, 0, view);\r\n            if (this.isAttached) {\r\n                view.attached();\r\n            }\r\n        }\r\n    };\r\n    ViewSlot.prototype._projectionMove = function (sourceIndex, targetIndex) {\r\n        if (sourceIndex === targetIndex) {\r\n            return;\r\n        }\r\n        var children = this.children;\r\n        var view = children[sourceIndex];\r\n        ShadowDOM.undistributeView(view, this.projectToSlots, this);\r\n        ShadowDOM.distributeView(view, this.projectToSlots, this, targetIndex);\r\n        children.splice(sourceIndex, 1);\r\n        children.splice(targetIndex, 0, view);\r\n    };\r\n    ViewSlot.prototype._projectionRemove = function (view, returnToCache) {\r\n        ShadowDOM.undistributeView(view, this.projectToSlots, this);\r\n        this.children.splice(this.children.indexOf(view), 1);\r\n        if (this.isAttached) {\r\n            view.detached();\r\n        }\r\n        if (returnToCache) {\r\n            view.returnToCache();\r\n        }\r\n    };\r\n    ViewSlot.prototype._projectionRemoveAt = function (index, returnToCache) {\r\n        var view = this.children[index];\r\n        ShadowDOM.undistributeView(view, this.projectToSlots, this);\r\n        this.children.splice(index, 1);\r\n        if (this.isAttached) {\r\n            view.detached();\r\n        }\r\n        if (returnToCache) {\r\n            view.returnToCache();\r\n        }\r\n    };\r\n    ViewSlot.prototype._projectionRemoveMany = function (viewsToRemove, returnToCache) {\r\n        var _this = this;\r\n        viewsToRemove.forEach(function (view) { return _this.remove(view, returnToCache); });\r\n    };\r\n    ViewSlot.prototype._projectionRemoveAll = function (returnToCache) {\r\n        ShadowDOM.undistributeAll(this.projectToSlots, this);\r\n        var children = this.children;\r\n        var ii = children.length;\r\n        for (var i = 0; i < ii; ++i) {\r\n            if (returnToCache) {\r\n                children[i].returnToCache();\r\n            }\r\n            else if (this.isAttached) {\r\n                children[i].detached();\r\n            }\r\n        }\r\n        this.children = [];\r\n    };\r\n    return ViewSlot;\r\n}());\n\nvar $resolver = aurelia_dependency_injection__WEBPACK_IMPORTED_MODULE_6__[\"resolver\"];\r\nvar ProviderResolver = (function () {\r\n    function ProviderResolver() {\r\n    }\r\n    ProviderResolver.prototype.get = function (container, key) {\r\n        var id = key.__providerId__;\r\n        return id in container ? container[id] : (container[id] = container.invoke(key));\r\n    };\r\n    ProviderResolver = __decorate([\r\n        $resolver\r\n    ], ProviderResolver);\r\n    return ProviderResolver;\r\n}());\r\nvar providerResolverInstance = new ProviderResolver();\r\nfunction elementContainerGet(key) {\r\n    if (key === aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].Element) {\r\n        return this.element;\r\n    }\r\n    if (key === BoundViewFactory) {\r\n        if (this.boundViewFactory) {\r\n            return this.boundViewFactory;\r\n        }\r\n        var factory = this.instruction.viewFactory;\r\n        var partReplacements = this.partReplacements;\r\n        if (partReplacements) {\r\n            factory = partReplacements[factory.part] || factory;\r\n        }\r\n        this.boundViewFactory = new BoundViewFactory(this, factory, partReplacements);\r\n        return this.boundViewFactory;\r\n    }\r\n    if (key === ViewSlot) {\r\n        if (this.viewSlot === undefined) {\r\n            this.viewSlot = new ViewSlot(this.element, this.instruction.anchorIsContainer);\r\n            this.element.isContentProjectionSource = this.instruction.lifting;\r\n            this.children.push(this.viewSlot);\r\n        }\r\n        return this.viewSlot;\r\n    }\r\n    if (key === ElementEvents) {\r\n        return this.elementEvents || (this.elementEvents = new ElementEvents(this.element));\r\n    }\r\n    if (key === CompositionTransaction) {\r\n        return this.compositionTransaction || (this.compositionTransaction = this.parent.get(key));\r\n    }\r\n    if (key === ViewResources) {\r\n        return this.viewResources;\r\n    }\r\n    if (key === TargetInstruction) {\r\n        return this.instruction;\r\n    }\r\n    return this.superGet(key);\r\n}\r\nfunction createElementContainer(parent, element, instruction, children, partReplacements, resources) {\r\n    var container = parent.createChild();\r\n    var providers;\r\n    var i;\r\n    container.element = element;\r\n    container.instruction = instruction;\r\n    container.children = children;\r\n    container.viewResources = resources;\r\n    container.partReplacements = partReplacements;\r\n    providers = instruction.providers;\r\n    i = providers.length;\r\n    while (i--) {\r\n        container._resolvers.set(providers[i], providerResolverInstance);\r\n    }\r\n    container.superGet = container.get;\r\n    container.get = elementContainerGet;\r\n    return container;\r\n}\r\nfunction hasAttribute(name) {\r\n    return this._element.hasAttribute(name);\r\n}\r\nfunction getAttribute(name) {\r\n    return this._element.getAttribute(name);\r\n}\r\nfunction setAttribute(name, value) {\r\n    this._element.setAttribute(name, value);\r\n}\r\nfunction makeElementIntoAnchor(element, elementInstruction) {\r\n    var anchor = aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].createComment('anchor');\r\n    if (elementInstruction) {\r\n        var firstChild = element.firstChild;\r\n        if (firstChild && firstChild.tagName === 'AU-CONTENT') {\r\n            anchor.contentElement = firstChild;\r\n        }\r\n        anchor._element = element;\r\n        anchor.hasAttribute = hasAttribute;\r\n        anchor.getAttribute = getAttribute;\r\n        anchor.setAttribute = setAttribute;\r\n    }\r\n    aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].replaceNode(anchor, element);\r\n    return anchor;\r\n}\r\nfunction applyInstructions(containers, element, instruction, controllers, bindings, children, shadowSlots, partReplacements, resources) {\r\n    var behaviorInstructions = instruction.behaviorInstructions;\r\n    var expressions = instruction.expressions;\r\n    var elementContainer;\r\n    var i;\r\n    var ii;\r\n    var current;\r\n    var instance;\r\n    if (instruction.contentExpression) {\r\n        bindings.push(instruction.contentExpression.createBinding(element.nextSibling));\r\n        element.nextSibling.auInterpolationTarget = true;\r\n        element.parentNode.removeChild(element);\r\n        return;\r\n    }\r\n    if (instruction.shadowSlot) {\r\n        var commentAnchor = aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].createComment('slot');\r\n        var slot = void 0;\r\n        if (instruction.slotDestination) {\r\n            slot = new PassThroughSlot(commentAnchor, instruction.slotName, instruction.slotDestination, instruction.slotFallbackFactory);\r\n        }\r\n        else {\r\n            slot = new ShadowSlot(commentAnchor, instruction.slotName, instruction.slotFallbackFactory);\r\n        }\r\n        aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].replaceNode(commentAnchor, element);\r\n        shadowSlots[instruction.slotName] = slot;\r\n        controllers.push(slot);\r\n        return;\r\n    }\r\n    if (instruction.letElement) {\r\n        for (i = 0, ii = expressions.length; i < ii; ++i) {\r\n            bindings.push(expressions[i].createBinding());\r\n        }\r\n        element.parentNode.removeChild(element);\r\n        return;\r\n    }\r\n    if (behaviorInstructions.length) {\r\n        if (!instruction.anchorIsContainer) {\r\n            element = makeElementIntoAnchor(element, instruction.elementInstruction);\r\n        }\r\n        containers[instruction.injectorId] = elementContainer =\r\n            createElementContainer(containers[instruction.parentInjectorId], element, instruction, children, partReplacements, resources);\r\n        for (i = 0, ii = behaviorInstructions.length; i < ii; ++i) {\r\n            current = behaviorInstructions[i];\r\n            instance = current.type.create(elementContainer, current, element, bindings);\r\n            controllers.push(instance);\r\n        }\r\n    }\r\n    for (i = 0, ii = expressions.length; i < ii; ++i) {\r\n        bindings.push(expressions[i].createBinding(element));\r\n    }\r\n}\r\nfunction styleStringToObject(style, target) {\r\n    var attributes = style.split(';');\r\n    var firstIndexOfColon;\r\n    var i;\r\n    var current;\r\n    var key;\r\n    var value;\r\n    target = target || {};\r\n    for (i = 0; i < attributes.length; i++) {\r\n        current = attributes[i];\r\n        firstIndexOfColon = current.indexOf(':');\r\n        key = current.substring(0, firstIndexOfColon).trim();\r\n        value = current.substring(firstIndexOfColon + 1).trim();\r\n        target[key] = value;\r\n    }\r\n    return target;\r\n}\r\nfunction styleObjectToString(obj) {\r\n    var result = '';\r\n    for (var key in obj) {\r\n        result += key + ':' + obj[key] + ';';\r\n    }\r\n    return result;\r\n}\r\nfunction applySurrogateInstruction(container, element, instruction, controllers, bindings, children) {\r\n    var behaviorInstructions = instruction.behaviorInstructions;\r\n    var expressions = instruction.expressions;\r\n    var providers = instruction.providers;\r\n    var values = instruction.values;\r\n    var i;\r\n    var ii;\r\n    var current;\r\n    var instance;\r\n    var currentAttributeValue;\r\n    i = providers.length;\r\n    while (i--) {\r\n        container._resolvers.set(providers[i], providerResolverInstance);\r\n    }\r\n    for (var key in values) {\r\n        currentAttributeValue = element.getAttribute(key);\r\n        if (currentAttributeValue) {\r\n            if (key === 'class') {\r\n                element.setAttribute('class', currentAttributeValue + ' ' + values[key]);\r\n            }\r\n            else if (key === 'style') {\r\n                var styleObject = styleStringToObject(values[key]);\r\n                styleStringToObject(currentAttributeValue, styleObject);\r\n                element.setAttribute('style', styleObjectToString(styleObject));\r\n            }\r\n        }\r\n        else {\r\n            element.setAttribute(key, values[key]);\r\n        }\r\n    }\r\n    if (behaviorInstructions.length) {\r\n        for (i = 0, ii = behaviorInstructions.length; i < ii; ++i) {\r\n            current = behaviorInstructions[i];\r\n            instance = current.type.create(container, current, element, bindings);\r\n            if (instance.contentView) {\r\n                children.push(instance.contentView);\r\n            }\r\n            controllers.push(instance);\r\n        }\r\n    }\r\n    for (i = 0, ii = expressions.length; i < ii; ++i) {\r\n        bindings.push(expressions[i].createBinding(element));\r\n    }\r\n}\r\nvar BoundViewFactory = (function () {\r\n    function BoundViewFactory(parentContainer, viewFactory, partReplacements) {\r\n        this.parentContainer = parentContainer;\r\n        this.viewFactory = viewFactory;\r\n        this.factoryCreateInstruction = { partReplacements: partReplacements };\r\n    }\r\n    BoundViewFactory.prototype.create = function () {\r\n        var view = this.viewFactory.create(this.parentContainer.createChild(), this.factoryCreateInstruction);\r\n        view._isUserControlled = true;\r\n        return view;\r\n    };\r\n    Object.defineProperty(BoundViewFactory.prototype, \"isCaching\", {\r\n        get: function () {\r\n            return this.viewFactory.isCaching;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    BoundViewFactory.prototype.setCacheSize = function (size, doNotOverrideIfAlreadySet) {\r\n        this.viewFactory.setCacheSize(size, doNotOverrideIfAlreadySet);\r\n    };\r\n    BoundViewFactory.prototype.getCachedView = function () {\r\n        return this.viewFactory.getCachedView();\r\n    };\r\n    BoundViewFactory.prototype.returnViewToCache = function (view) {\r\n        this.viewFactory.returnViewToCache(view);\r\n    };\r\n    return BoundViewFactory;\r\n}());\r\nvar ViewFactory = (function () {\r\n    function ViewFactory(template, instructions, resources) {\r\n        this.isCaching = false;\r\n        this.template = template;\r\n        this.instructions = instructions;\r\n        this.resources = resources;\r\n        this.cacheSize = -1;\r\n        this.cache = null;\r\n    }\r\n    ViewFactory.prototype.setCacheSize = function (size, doNotOverrideIfAlreadySet) {\r\n        if (size) {\r\n            if (size === '*') {\r\n                size = Number.MAX_VALUE;\r\n            }\r\n            else if (typeof size === 'string') {\r\n                size = parseInt(size, 10);\r\n            }\r\n        }\r\n        if (this.cacheSize === -1 || !doNotOverrideIfAlreadySet) {\r\n            this.cacheSize = Number(size);\r\n        }\r\n        if (this.cacheSize > 0) {\r\n            this.cache = [];\r\n        }\r\n        else {\r\n            this.cache = null;\r\n        }\r\n        this.isCaching = this.cacheSize > 0;\r\n    };\r\n    ViewFactory.prototype.getCachedView = function () {\r\n        return this.cache !== null ? (this.cache.pop() || null) : null;\r\n    };\r\n    ViewFactory.prototype.returnViewToCache = function (view) {\r\n        if (view.isAttached) {\r\n            view.detached();\r\n        }\r\n        if (view.isBound) {\r\n            view.unbind();\r\n        }\r\n        if (this.cache !== null && this.cache.length < this.cacheSize) {\r\n            view.fromCache = true;\r\n            this.cache.push(view);\r\n        }\r\n    };\r\n    ViewFactory.prototype.create = function (container, createInstruction, element) {\r\n        createInstruction = createInstruction || BehaviorInstruction.normal;\r\n        var cachedView = this.getCachedView();\r\n        if (cachedView !== null) {\r\n            return cachedView;\r\n        }\r\n        var fragment = createInstruction.enhance ? this.template : this.template.cloneNode(true);\r\n        var instructables = fragment.querySelectorAll('.au-target');\r\n        var instructions = this.instructions;\r\n        var resources = this.resources;\r\n        var controllers = [];\r\n        var bindings = [];\r\n        var children = [];\r\n        var shadowSlots = Object.create(null);\r\n        var containers = { root: container };\r\n        var partReplacements = createInstruction.partReplacements;\r\n        var i;\r\n        var ii;\r\n        var view;\r\n        var instructable;\r\n        var instruction;\r\n        this.resources._invokeHook('beforeCreate', this, container, fragment, createInstruction);\r\n        if (element && this.surrogateInstruction !== null) {\r\n            applySurrogateInstruction(container, element, this.surrogateInstruction, controllers, bindings, children);\r\n        }\r\n        if (createInstruction.enhance && fragment.hasAttribute('au-target-id')) {\r\n            instructable = fragment;\r\n            instruction = instructions[instructable.getAttribute('au-target-id')];\r\n            applyInstructions(containers, instructable, instruction, controllers, bindings, children, shadowSlots, partReplacements, resources);\r\n        }\r\n        for (i = 0, ii = instructables.length; i < ii; ++i) {\r\n            instructable = instructables[i];\r\n            instruction = instructions[instructable.getAttribute('au-target-id')];\r\n            applyInstructions(containers, instructable, instruction, controllers, bindings, children, shadowSlots, partReplacements, resources);\r\n        }\r\n        view = new View(container, this, fragment, controllers, bindings, children, shadowSlots);\r\n        if (!createInstruction.initiatedByBehavior) {\r\n            view.created();\r\n        }\r\n        this.resources._invokeHook('afterCreate', view);\r\n        return view;\r\n    };\r\n    return ViewFactory;\r\n}());\n\nvar nextInjectorId = 0;\r\nfunction getNextInjectorId() {\r\n    return ++nextInjectorId;\r\n}\r\nvar lastAUTargetID = 0;\r\nfunction getNextAUTargetID() {\r\n    return (++lastAUTargetID).toString();\r\n}\r\nfunction makeIntoInstructionTarget(element) {\r\n    var value = element.getAttribute('class');\r\n    var auTargetID = getNextAUTargetID();\r\n    element.setAttribute('class', (value ? value + ' au-target' : 'au-target'));\r\n    element.setAttribute('au-target-id', auTargetID);\r\n    return auTargetID;\r\n}\r\nfunction makeShadowSlot(compiler, resources, node, instructions, parentInjectorId) {\r\n    var auShadowSlot = aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].createElement('au-shadow-slot');\r\n    aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].replaceNode(auShadowSlot, node);\r\n    var auTargetID = makeIntoInstructionTarget(auShadowSlot);\r\n    var instruction = TargetInstruction.shadowSlot(parentInjectorId);\r\n    instruction.slotName = node.getAttribute('name') || ShadowDOM.defaultSlotKey;\r\n    instruction.slotDestination = node.getAttribute('slot');\r\n    if (node.innerHTML.trim()) {\r\n        var fragment = aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].createDocumentFragment();\r\n        var child = void 0;\r\n        while (child = node.firstChild) {\r\n            fragment.appendChild(child);\r\n        }\r\n        instruction.slotFallbackFactory = compiler.compile(fragment, resources);\r\n    }\r\n    instructions[auTargetID] = instruction;\r\n    return auShadowSlot;\r\n}\r\nvar defaultLetHandler = BindingLanguage.prototype.createLetExpressions;\r\nvar ViewCompiler = (function () {\r\n    function ViewCompiler(bindingLanguage, resources) {\r\n        this.bindingLanguage = bindingLanguage;\r\n        this.resources = resources;\r\n    }\r\n    ViewCompiler.inject = function () {\r\n        return [BindingLanguage, ViewResources];\r\n    };\r\n    ViewCompiler.prototype.compile = function (source, resources, compileInstruction) {\r\n        resources = resources || this.resources;\r\n        compileInstruction = compileInstruction || ViewCompileInstruction.normal;\r\n        source = typeof source === 'string' ? aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].createTemplateFromMarkup(source) : source;\r\n        var content;\r\n        var part;\r\n        var cacheSize;\r\n        if (source.content) {\r\n            part = source.getAttribute('part');\r\n            cacheSize = source.getAttribute('view-cache');\r\n            content = aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].adoptNode(source.content);\r\n        }\r\n        else {\r\n            content = source;\r\n        }\r\n        compileInstruction.targetShadowDOM = compileInstruction.targetShadowDOM && aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"FEATURE\"].shadowDOM;\r\n        resources._invokeHook('beforeCompile', content, resources, compileInstruction);\r\n        var instructions = {};\r\n        this._compileNode(content, resources, instructions, source, 'root', !compileInstruction.targetShadowDOM);\r\n        var firstChild = content.firstChild;\r\n        if (firstChild && firstChild.nodeType === 1) {\r\n            var targetId = firstChild.getAttribute('au-target-id');\r\n            if (targetId) {\r\n                var ins = instructions[targetId];\r\n                if (ins.shadowSlot || ins.lifting || (ins.elementInstruction && !ins.elementInstruction.anchorIsContainer)) {\r\n                    content.insertBefore(aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].createComment('view'), firstChild);\r\n                }\r\n            }\r\n        }\r\n        var factory = new ViewFactory(content, instructions, resources);\r\n        factory.surrogateInstruction = compileInstruction.compileSurrogate ? this._compileSurrogate(source, resources) : null;\r\n        factory.part = part;\r\n        if (cacheSize) {\r\n            factory.setCacheSize(cacheSize);\r\n        }\r\n        resources._invokeHook('afterCompile', factory);\r\n        return factory;\r\n    };\r\n    ViewCompiler.prototype._compileNode = function (node, resources, instructions, parentNode, parentInjectorId, targetLightDOM) {\r\n        switch (node.nodeType) {\r\n            case 1:\r\n                return this._compileElement(node, resources, instructions, parentNode, parentInjectorId, targetLightDOM);\r\n            case 3:\r\n                var expression = resources.getBindingLanguage(this.bindingLanguage).inspectTextContent(resources, node.wholeText);\r\n                if (expression) {\r\n                    var marker = aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].createElement('au-marker');\r\n                    var auTargetID = makeIntoInstructionTarget(marker);\r\n                    (node.parentNode || parentNode).insertBefore(marker, node);\r\n                    node.textContent = ' ';\r\n                    instructions[auTargetID] = TargetInstruction.contentExpression(expression);\r\n                    while (node.nextSibling && node.nextSibling.nodeType === 3) {\r\n                        (node.parentNode || parentNode).removeChild(node.nextSibling);\r\n                    }\r\n                }\r\n                else {\r\n                    while (node.nextSibling && node.nextSibling.nodeType === 3) {\r\n                        node = node.nextSibling;\r\n                    }\r\n                }\r\n                return node.nextSibling;\r\n            case 11:\r\n                var currentChild = node.firstChild;\r\n                while (currentChild) {\r\n                    currentChild = this._compileNode(currentChild, resources, instructions, node, parentInjectorId, targetLightDOM);\r\n                }\r\n                break;\r\n        }\r\n        return node.nextSibling;\r\n    };\r\n    ViewCompiler.prototype._compileSurrogate = function (node, resources) {\r\n        var tagName = node.tagName.toLowerCase();\r\n        var attributes = node.attributes;\r\n        var bindingLanguage = resources.getBindingLanguage(this.bindingLanguage);\r\n        var knownAttribute;\r\n        var property;\r\n        var instruction;\r\n        var i;\r\n        var ii;\r\n        var attr;\r\n        var attrName;\r\n        var attrValue;\r\n        var info;\r\n        var type;\r\n        var expressions = [];\r\n        var expression;\r\n        var behaviorInstructions = [];\r\n        var values = {};\r\n        var hasValues = false;\r\n        var providers = [];\r\n        for (i = 0, ii = attributes.length; i < ii; ++i) {\r\n            attr = attributes[i];\r\n            attrName = attr.name;\r\n            attrValue = attr.value;\r\n            info = bindingLanguage.inspectAttribute(resources, tagName, attrName, attrValue);\r\n            type = resources.getAttribute(info.attrName);\r\n            if (type) {\r\n                knownAttribute = resources.mapAttribute(info.attrName);\r\n                if (knownAttribute) {\r\n                    property = type.attributes[knownAttribute];\r\n                    if (property) {\r\n                        info.defaultBindingMode = property.defaultBindingMode;\r\n                        if (!info.command && !info.expression) {\r\n                            info.command = property.hasOptions ? 'options' : null;\r\n                        }\r\n                        if (info.command && (info.command !== 'options') && type.primaryProperty) {\r\n                            var primaryProperty = type.primaryProperty;\r\n                            attrName = info.attrName = primaryProperty.attribute;\r\n                            info.defaultBindingMode = primaryProperty.defaultBindingMode;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            instruction = bindingLanguage.createAttributeInstruction(resources, node, info, undefined, type);\r\n            if (instruction) {\r\n                if (instruction.alteredAttr) {\r\n                    type = resources.getAttribute(instruction.attrName);\r\n                }\r\n                if (instruction.discrete) {\r\n                    expressions.push(instruction);\r\n                }\r\n                else {\r\n                    if (type) {\r\n                        instruction.type = type;\r\n                        this._configureProperties(instruction, resources);\r\n                        if (type.liftsContent) {\r\n                            throw new Error('You cannot place a template controller on a surrogate element.');\r\n                        }\r\n                        else {\r\n                            behaviorInstructions.push(instruction);\r\n                        }\r\n                    }\r\n                    else {\r\n                        expressions.push(instruction.attributes[instruction.attrName]);\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                if (type) {\r\n                    instruction = BehaviorInstruction.attribute(attrName, type);\r\n                    instruction.attributes[resources.mapAttribute(attrName)] = attrValue;\r\n                    if (type.liftsContent) {\r\n                        throw new Error('You cannot place a template controller on a surrogate element.');\r\n                    }\r\n                    else {\r\n                        behaviorInstructions.push(instruction);\r\n                    }\r\n                }\r\n                else if (attrName !== 'id' && attrName !== 'part' && attrName !== 'replace-part') {\r\n                    hasValues = true;\r\n                    values[attrName] = attrValue;\r\n                }\r\n            }\r\n        }\r\n        if (expressions.length || behaviorInstructions.length || hasValues) {\r\n            for (i = 0, ii = behaviorInstructions.length; i < ii; ++i) {\r\n                instruction = behaviorInstructions[i];\r\n                instruction.type.compile(this, resources, node, instruction);\r\n                providers.push(instruction.type.target);\r\n            }\r\n            for (i = 0, ii = expressions.length; i < ii; ++i) {\r\n                expression = expressions[i];\r\n                if (expression.attrToRemove !== undefined) {\r\n                    node.removeAttribute(expression.attrToRemove);\r\n                }\r\n            }\r\n            return TargetInstruction.surrogate(providers, behaviorInstructions, expressions, values);\r\n        }\r\n        return null;\r\n    };\r\n    ViewCompiler.prototype._compileElement = function (node, resources, instructions, parentNode, parentInjectorId, targetLightDOM) {\r\n        var tagName = node.tagName.toLowerCase();\r\n        var attributes = node.attributes;\r\n        var expressions = [];\r\n        var expression;\r\n        var behaviorInstructions = [];\r\n        var providers = [];\r\n        var bindingLanguage = resources.getBindingLanguage(this.bindingLanguage);\r\n        var liftingInstruction;\r\n        var viewFactory;\r\n        var type;\r\n        var elementInstruction;\r\n        var elementProperty;\r\n        var i;\r\n        var ii;\r\n        var attr;\r\n        var attrName;\r\n        var attrValue;\r\n        var originalAttrName;\r\n        var instruction;\r\n        var info;\r\n        var property;\r\n        var knownAttribute;\r\n        var auTargetID;\r\n        var injectorId;\r\n        if (tagName === 'slot') {\r\n            if (targetLightDOM) {\r\n                node = makeShadowSlot(this, resources, node, instructions, parentInjectorId);\r\n            }\r\n            return node.nextSibling;\r\n        }\r\n        else if (tagName === 'template') {\r\n            if (!('content' in node)) {\r\n                throw new Error('You cannot place a template element within ' + node.namespaceURI + ' namespace');\r\n            }\r\n            viewFactory = this.compile(node, resources);\r\n            viewFactory.part = node.getAttribute('part');\r\n        }\r\n        else {\r\n            type = resources.getElement(node.getAttribute('as-element') || tagName);\r\n            if (tagName === 'let' && !type && bindingLanguage.createLetExpressions !== defaultLetHandler) {\r\n                expressions = bindingLanguage.createLetExpressions(resources, node);\r\n                auTargetID = makeIntoInstructionTarget(node);\r\n                instructions[auTargetID] = TargetInstruction.letElement(expressions);\r\n                return node.nextSibling;\r\n            }\r\n            if (type) {\r\n                elementInstruction = BehaviorInstruction.element(node, type);\r\n                type.processAttributes(this, resources, node, attributes, elementInstruction);\r\n                behaviorInstructions.push(elementInstruction);\r\n            }\r\n        }\r\n        for (i = 0, ii = attributes.length; i < ii; ++i) {\r\n            attr = attributes[i];\r\n            originalAttrName = attrName = attr.name;\r\n            attrValue = attr.value;\r\n            info = bindingLanguage.inspectAttribute(resources, tagName, attrName, attrValue);\r\n            if (targetLightDOM && info.attrName === 'slot') {\r\n                info.attrName = attrName = 'au-slot';\r\n            }\r\n            type = resources.getAttribute(info.attrName);\r\n            elementProperty = null;\r\n            if (type) {\r\n                knownAttribute = resources.mapAttribute(info.attrName);\r\n                if (knownAttribute) {\r\n                    property = type.attributes[knownAttribute];\r\n                    if (property) {\r\n                        info.defaultBindingMode = property.defaultBindingMode;\r\n                        if (!info.command && !info.expression) {\r\n                            info.command = property.hasOptions ? 'options' : null;\r\n                        }\r\n                        if (info.command && (info.command !== 'options') && type.primaryProperty) {\r\n                            var primaryProperty = type.primaryProperty;\r\n                            attrName = info.attrName = primaryProperty.attribute;\r\n                            info.defaultBindingMode = primaryProperty.defaultBindingMode;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            else if (elementInstruction) {\r\n                elementProperty = elementInstruction.type.attributes[info.attrName];\r\n                if (elementProperty) {\r\n                    info.defaultBindingMode = elementProperty.defaultBindingMode;\r\n                }\r\n            }\r\n            if (elementProperty) {\r\n                instruction = bindingLanguage.createAttributeInstruction(resources, node, info, elementInstruction);\r\n            }\r\n            else {\r\n                instruction = bindingLanguage.createAttributeInstruction(resources, node, info, undefined, type);\r\n            }\r\n            if (instruction) {\r\n                if (instruction.alteredAttr) {\r\n                    type = resources.getAttribute(instruction.attrName);\r\n                }\r\n                if (instruction.discrete) {\r\n                    expressions.push(instruction);\r\n                }\r\n                else {\r\n                    if (type) {\r\n                        instruction.type = type;\r\n                        this._configureProperties(instruction, resources);\r\n                        if (type.liftsContent) {\r\n                            instruction.originalAttrName = originalAttrName;\r\n                            liftingInstruction = instruction;\r\n                            break;\r\n                        }\r\n                        else {\r\n                            behaviorInstructions.push(instruction);\r\n                        }\r\n                    }\r\n                    else if (elementProperty) {\r\n                        elementInstruction.attributes[info.attrName].targetProperty = elementProperty.name;\r\n                    }\r\n                    else {\r\n                        expressions.push(instruction.attributes[instruction.attrName]);\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                if (type) {\r\n                    instruction = BehaviorInstruction.attribute(attrName, type);\r\n                    instruction.attributes[resources.mapAttribute(attrName)] = attrValue;\r\n                    if (type.liftsContent) {\r\n                        instruction.originalAttrName = originalAttrName;\r\n                        liftingInstruction = instruction;\r\n                        break;\r\n                    }\r\n                    else {\r\n                        behaviorInstructions.push(instruction);\r\n                    }\r\n                }\r\n                else if (elementProperty) {\r\n                    elementInstruction.attributes[attrName] = attrValue;\r\n                }\r\n            }\r\n        }\r\n        if (liftingInstruction) {\r\n            liftingInstruction.viewFactory = viewFactory;\r\n            node = liftingInstruction.type.compile(this, resources, node, liftingInstruction, parentNode);\r\n            auTargetID = makeIntoInstructionTarget(node);\r\n            instructions[auTargetID] = TargetInstruction.lifting(parentInjectorId, liftingInstruction);\r\n        }\r\n        else {\r\n            var skipContentProcessing = false;\r\n            if (expressions.length || behaviorInstructions.length) {\r\n                injectorId = behaviorInstructions.length ? getNextInjectorId() : false;\r\n                for (i = 0, ii = behaviorInstructions.length; i < ii; ++i) {\r\n                    instruction = behaviorInstructions[i];\r\n                    instruction.type.compile(this, resources, node, instruction, parentNode);\r\n                    providers.push(instruction.type.target);\r\n                    skipContentProcessing = skipContentProcessing || instruction.skipContentProcessing;\r\n                }\r\n                for (i = 0, ii = expressions.length; i < ii; ++i) {\r\n                    expression = expressions[i];\r\n                    if (expression.attrToRemove !== undefined) {\r\n                        node.removeAttribute(expression.attrToRemove);\r\n                    }\r\n                }\r\n                auTargetID = makeIntoInstructionTarget(node);\r\n                instructions[auTargetID] = TargetInstruction.normal(injectorId, parentInjectorId, providers, behaviorInstructions, expressions, elementInstruction);\r\n            }\r\n            if (skipContentProcessing) {\r\n                return node.nextSibling;\r\n            }\r\n            var currentChild = node.firstChild;\r\n            while (currentChild) {\r\n                currentChild = this._compileNode(currentChild, resources, instructions, node, injectorId || parentInjectorId, targetLightDOM);\r\n            }\r\n        }\r\n        return node.nextSibling;\r\n    };\r\n    ViewCompiler.prototype._configureProperties = function (instruction, resources) {\r\n        var type = instruction.type;\r\n        var attrName = instruction.attrName;\r\n        var attributes = instruction.attributes;\r\n        var property;\r\n        var key;\r\n        var value;\r\n        var knownAttribute = resources.mapAttribute(attrName);\r\n        if (knownAttribute && attrName in attributes && knownAttribute !== attrName) {\r\n            attributes[knownAttribute] = attributes[attrName];\r\n            delete attributes[attrName];\r\n        }\r\n        for (key in attributes) {\r\n            value = attributes[key];\r\n            if (value !== null && typeof value === 'object') {\r\n                property = type.attributes[key];\r\n                if (property !== undefined) {\r\n                    value.targetProperty = property.name;\r\n                }\r\n                else {\r\n                    value.targetProperty = key;\r\n                }\r\n            }\r\n        }\r\n    };\r\n    return ViewCompiler;\r\n}());\n\nvar ViewEngineHooksResource = (function () {\r\n    function ViewEngineHooksResource() {\r\n    }\r\n    ViewEngineHooksResource.prototype.initialize = function (container, target) {\r\n        this.instance = container.get(target);\r\n    };\r\n    ViewEngineHooksResource.prototype.register = function (registry, name) {\r\n        registry.registerViewEngineHooks(this.instance);\r\n    };\r\n    ViewEngineHooksResource.prototype.load = function (container, target) { };\r\n    ViewEngineHooksResource.convention = function (name) {\r\n        if (name.endsWith('ViewEngineHooks')) {\r\n            return new ViewEngineHooksResource();\r\n        }\r\n    };\r\n    return ViewEngineHooksResource;\r\n}());\r\nfunction viewEngineHooks(target) {\r\n    var deco = function (t) {\r\n        aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].define(aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].resource, new ViewEngineHooksResource(), t);\r\n    };\r\n    return target ? deco(target) : deco;\r\n}\n\nvar ResourceModule = (function () {\r\n    function ResourceModule(moduleId) {\r\n        this.id = moduleId;\r\n        this.moduleInstance = null;\r\n        this.mainResource = null;\r\n        this.resources = null;\r\n        this.viewStrategy = null;\r\n        this.isInitialized = false;\r\n        this.onLoaded = null;\r\n        this.loadContext = null;\r\n    }\r\n    ResourceModule.prototype.initialize = function (container) {\r\n        var current = this.mainResource;\r\n        var resources = this.resources;\r\n        var vs = this.viewStrategy;\r\n        if (this.isInitialized) {\r\n            return;\r\n        }\r\n        this.isInitialized = true;\r\n        if (current !== undefined) {\r\n            current.metadata.viewStrategy = vs;\r\n            current.initialize(container);\r\n        }\r\n        for (var i = 0, ii = resources.length; i < ii; ++i) {\r\n            current = resources[i];\r\n            current.metadata.viewStrategy = vs;\r\n            current.initialize(container);\r\n        }\r\n    };\r\n    ResourceModule.prototype.register = function (registry, name) {\r\n        var main = this.mainResource;\r\n        var resources = this.resources;\r\n        if (main !== undefined) {\r\n            main.register(registry, name);\r\n            name = null;\r\n        }\r\n        for (var i = 0, ii = resources.length; i < ii; ++i) {\r\n            resources[i].register(registry, name);\r\n            name = null;\r\n        }\r\n    };\r\n    ResourceModule.prototype.load = function (container, loadContext) {\r\n        if (this.onLoaded !== null) {\r\n            return this.loadContext === loadContext ? Promise.resolve() : this.onLoaded;\r\n        }\r\n        var main = this.mainResource;\r\n        var resources = this.resources;\r\n        var loads;\r\n        if (main !== undefined) {\r\n            loads = new Array(resources.length + 1);\r\n            loads[0] = main.load(container, loadContext);\r\n            for (var i = 0, ii = resources.length; i < ii; ++i) {\r\n                loads[i + 1] = resources[i].load(container, loadContext);\r\n            }\r\n        }\r\n        else {\r\n            loads = new Array(resources.length);\r\n            for (var i = 0, ii = resources.length; i < ii; ++i) {\r\n                loads[i] = resources[i].load(container, loadContext);\r\n            }\r\n        }\r\n        this.loadContext = loadContext;\r\n        this.onLoaded = Promise.all(loads);\r\n        return this.onLoaded;\r\n    };\r\n    return ResourceModule;\r\n}());\r\nvar ResourceDescription = (function () {\r\n    function ResourceDescription(key, exportedValue, resourceTypeMeta) {\r\n        if (!resourceTypeMeta) {\r\n            resourceTypeMeta = aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].get(aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].resource, exportedValue);\r\n            if (!resourceTypeMeta) {\r\n                resourceTypeMeta = new HtmlBehaviorResource();\r\n                resourceTypeMeta.elementName = _hyphenate(key);\r\n                aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].define(aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].resource, resourceTypeMeta, exportedValue);\r\n            }\r\n        }\r\n        if (resourceTypeMeta instanceof HtmlBehaviorResource) {\r\n            if (resourceTypeMeta.elementName === undefined) {\r\n                resourceTypeMeta.elementName = _hyphenate(key);\r\n            }\r\n            else if (resourceTypeMeta.attributeName === undefined) {\r\n                resourceTypeMeta.attributeName = _hyphenate(key);\r\n            }\r\n            else if (resourceTypeMeta.attributeName === null && resourceTypeMeta.elementName === null) {\r\n                HtmlBehaviorResource.convention(key, resourceTypeMeta);\r\n            }\r\n        }\r\n        else if (!resourceTypeMeta.name) {\r\n            resourceTypeMeta.name = _hyphenate(key);\r\n        }\r\n        this.metadata = resourceTypeMeta;\r\n        this.value = exportedValue;\r\n    }\r\n    ResourceDescription.prototype.initialize = function (container) {\r\n        this.metadata.initialize(container, this.value);\r\n    };\r\n    ResourceDescription.prototype.register = function (registry, name) {\r\n        this.metadata.register(registry, name);\r\n    };\r\n    ResourceDescription.prototype.load = function (container, loadContext) {\r\n        return this.metadata.load(container, this.value, loadContext);\r\n    };\r\n    return ResourceDescription;\r\n}());\r\nvar ModuleAnalyzer = (function () {\r\n    function ModuleAnalyzer() {\r\n        this.cache = Object.create(null);\r\n    }\r\n    ModuleAnalyzer.prototype.getAnalysis = function (moduleId) {\r\n        return this.cache[moduleId];\r\n    };\r\n    ModuleAnalyzer.prototype.analyze = function (moduleId, moduleInstance, mainResourceKey) {\r\n        var mainResource;\r\n        var fallbackValue;\r\n        var fallbackKey;\r\n        var resourceTypeMeta;\r\n        var key;\r\n        var exportedValue;\r\n        var resources = [];\r\n        var conventional;\r\n        var vs;\r\n        var resourceModule;\r\n        resourceModule = this.cache[moduleId];\r\n        if (resourceModule) {\r\n            return resourceModule;\r\n        }\r\n        resourceModule = new ResourceModule(moduleId);\r\n        this.cache[moduleId] = resourceModule;\r\n        if (typeof moduleInstance === 'function') {\r\n            moduleInstance = { 'default': moduleInstance };\r\n        }\r\n        if (mainResourceKey) {\r\n            mainResource = new ResourceDescription(mainResourceKey, moduleInstance[mainResourceKey]);\r\n        }\r\n        for (key in moduleInstance) {\r\n            exportedValue = moduleInstance[key];\r\n            if (key === mainResourceKey || typeof exportedValue !== 'function') {\r\n                continue;\r\n            }\r\n            resourceTypeMeta = aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].get(aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].resource, exportedValue);\r\n            if (resourceTypeMeta) {\r\n                if (resourceTypeMeta instanceof HtmlBehaviorResource) {\r\n                    ViewResources.convention(exportedValue, resourceTypeMeta);\r\n                    if (resourceTypeMeta.attributeName === null && resourceTypeMeta.elementName === null) {\r\n                        HtmlBehaviorResource.convention(key, resourceTypeMeta);\r\n                    }\r\n                    if (resourceTypeMeta.attributeName === null && resourceTypeMeta.elementName === null) {\r\n                        resourceTypeMeta.elementName = _hyphenate(key);\r\n                    }\r\n                }\r\n                if (!mainResource && resourceTypeMeta instanceof HtmlBehaviorResource && resourceTypeMeta.elementName !== null) {\r\n                    mainResource = new ResourceDescription(key, exportedValue, resourceTypeMeta);\r\n                }\r\n                else {\r\n                    resources.push(new ResourceDescription(key, exportedValue, resourceTypeMeta));\r\n                }\r\n            }\r\n            else if (viewStrategy.decorates(exportedValue)) {\r\n                vs = exportedValue;\r\n            }\r\n            else if (exportedValue instanceof aurelia_loader__WEBPACK_IMPORTED_MODULE_1__[\"TemplateRegistryEntry\"]) {\r\n                vs = new TemplateRegistryViewStrategy(moduleId, exportedValue);\r\n            }\r\n            else {\r\n                if (conventional = ViewResources.convention(exportedValue)) {\r\n                    if (conventional.elementName !== null && !mainResource) {\r\n                        mainResource = new ResourceDescription(key, exportedValue, conventional);\r\n                    }\r\n                    else {\r\n                        resources.push(new ResourceDescription(key, exportedValue, conventional));\r\n                    }\r\n                    aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].define(aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].resource, conventional, exportedValue);\r\n                }\r\n                else if (conventional = HtmlBehaviorResource.convention(key)) {\r\n                    if (conventional.elementName !== null && !mainResource) {\r\n                        mainResource = new ResourceDescription(key, exportedValue, conventional);\r\n                    }\r\n                    else {\r\n                        resources.push(new ResourceDescription(key, exportedValue, conventional));\r\n                    }\r\n                    aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].define(aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].resource, conventional, exportedValue);\r\n                }\r\n                else if (conventional = aurelia_binding__WEBPACK_IMPORTED_MODULE_5__[\"ValueConverterResource\"].convention(key)\r\n                    || aurelia_binding__WEBPACK_IMPORTED_MODULE_5__[\"BindingBehaviorResource\"].convention(key)\r\n                    || ViewEngineHooksResource.convention(key)) {\r\n                    resources.push(new ResourceDescription(key, exportedValue, conventional));\r\n                    aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].define(aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].resource, conventional, exportedValue);\r\n                }\r\n                else if (!fallbackValue) {\r\n                    fallbackValue = exportedValue;\r\n                    fallbackKey = key;\r\n                }\r\n            }\r\n        }\r\n        if (!mainResource && fallbackValue) {\r\n            mainResource = new ResourceDescription(fallbackKey, fallbackValue);\r\n        }\r\n        resourceModule.moduleInstance = moduleInstance;\r\n        resourceModule.mainResource = mainResource;\r\n        resourceModule.resources = resources;\r\n        resourceModule.viewStrategy = vs;\r\n        return resourceModule;\r\n    };\r\n    return ModuleAnalyzer;\r\n}());\n\nvar logger = aurelia_logging__WEBPACK_IMPORTED_MODULE_4__[\"getLogger\"]('templating');\r\nfunction ensureRegistryEntry(loader, urlOrRegistryEntry) {\r\n    if (urlOrRegistryEntry instanceof aurelia_loader__WEBPACK_IMPORTED_MODULE_1__[\"TemplateRegistryEntry\"]) {\r\n        return Promise.resolve(urlOrRegistryEntry);\r\n    }\r\n    return loader.loadTemplate(urlOrRegistryEntry);\r\n}\r\nvar ProxyViewFactory = (function () {\r\n    function ProxyViewFactory(promise) {\r\n        var _this = this;\r\n        promise.then(function (x) { return _this.viewFactory = x; });\r\n    }\r\n    ProxyViewFactory.prototype.create = function (container, bindingContext, createInstruction, element) {\r\n        return this.viewFactory.create(container, bindingContext, createInstruction, element);\r\n    };\r\n    Object.defineProperty(ProxyViewFactory.prototype, \"isCaching\", {\r\n        get: function () {\r\n            return this.viewFactory.isCaching;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    ProxyViewFactory.prototype.setCacheSize = function (size, doNotOverrideIfAlreadySet) {\r\n        this.viewFactory.setCacheSize(size, doNotOverrideIfAlreadySet);\r\n    };\r\n    ProxyViewFactory.prototype.getCachedView = function () {\r\n        return this.viewFactory.getCachedView();\r\n    };\r\n    ProxyViewFactory.prototype.returnViewToCache = function (view) {\r\n        this.viewFactory.returnViewToCache(view);\r\n    };\r\n    return ProxyViewFactory;\r\n}());\r\nvar auSlotBehavior = null;\r\nvar ViewEngine = (function () {\r\n    function ViewEngine(loader, container, viewCompiler, moduleAnalyzer, appResources) {\r\n        this.loader = loader;\r\n        this.container = container;\r\n        this.viewCompiler = viewCompiler;\r\n        this.moduleAnalyzer = moduleAnalyzer;\r\n        this.appResources = appResources;\r\n        this._pluginMap = {};\r\n        if (auSlotBehavior === null) {\r\n            auSlotBehavior = new HtmlBehaviorResource();\r\n            auSlotBehavior.attributeName = 'au-slot';\r\n            aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].define(aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].resource, auSlotBehavior, SlotCustomAttribute);\r\n        }\r\n        auSlotBehavior.initialize(container, SlotCustomAttribute);\r\n        auSlotBehavior.register(appResources);\r\n    }\r\n    ViewEngine.inject = function () {\r\n        return [aurelia_loader__WEBPACK_IMPORTED_MODULE_1__[\"Loader\"], aurelia_dependency_injection__WEBPACK_IMPORTED_MODULE_6__[\"Container\"], ViewCompiler, ModuleAnalyzer, ViewResources];\r\n    };\r\n    ViewEngine.prototype.addResourcePlugin = function (extension, implementation) {\r\n        var name = extension.replace('.', '') + '-resource-plugin';\r\n        this._pluginMap[extension] = name;\r\n        this.loader.addPlugin(name, implementation);\r\n    };\r\n    ViewEngine.prototype.loadViewFactory = function (urlOrRegistryEntry, compileInstruction, loadContext, target) {\r\n        var _this = this;\r\n        loadContext = loadContext || new ResourceLoadContext();\r\n        return ensureRegistryEntry(this.loader, urlOrRegistryEntry).then(function (registryEntry) {\r\n            var url = registryEntry.address;\r\n            if (registryEntry.onReady) {\r\n                if (!loadContext.hasDependency(url)) {\r\n                    loadContext.addDependency(url);\r\n                    return registryEntry.onReady;\r\n                }\r\n                if (registryEntry.template === null) {\r\n                    return registryEntry.onReady;\r\n                }\r\n                return Promise.resolve(new ProxyViewFactory(registryEntry.onReady));\r\n            }\r\n            loadContext.addDependency(url);\r\n            registryEntry.onReady = _this.loadTemplateResources(registryEntry, compileInstruction, loadContext, target).then(function (resources) {\r\n                registryEntry.resources = resources;\r\n                if (registryEntry.template === null) {\r\n                    return registryEntry.factory = null;\r\n                }\r\n                var viewFactory = _this.viewCompiler.compile(registryEntry.template, resources, compileInstruction);\r\n                return registryEntry.factory = viewFactory;\r\n            });\r\n            return registryEntry.onReady;\r\n        });\r\n    };\r\n    ViewEngine.prototype.loadTemplateResources = function (registryEntry, compileInstruction, loadContext, target) {\r\n        var resources = new ViewResources(this.appResources, registryEntry.address);\r\n        var dependencies = registryEntry.dependencies;\r\n        var importIds;\r\n        var names;\r\n        compileInstruction = compileInstruction || ViewCompileInstruction.normal;\r\n        if (dependencies.length === 0 && !compileInstruction.associatedModuleId) {\r\n            return Promise.resolve(resources);\r\n        }\r\n        importIds = dependencies.map(function (x) { return x.src; });\r\n        names = dependencies.map(function (x) { return x.name; });\r\n        logger.debug(\"importing resources for \".concat(registryEntry.address), importIds);\r\n        if (target) {\r\n            var viewModelRequires = aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].get(ViewEngine.viewModelRequireMetadataKey, target);\r\n            if (viewModelRequires) {\r\n                var templateImportCount = importIds.length;\r\n                for (var i = 0, ii = viewModelRequires.length; i < ii; ++i) {\r\n                    var req = viewModelRequires[i];\r\n                    var importId = typeof req === 'function'\r\n                        ? aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"Origin\"].get(req).moduleId\r\n                        : Object(aurelia_path__WEBPACK_IMPORTED_MODULE_3__[\"relativeToFile\"])(req.src || req, registryEntry.address);\r\n                    if (importIds.indexOf(importId) === -1) {\r\n                        importIds.push(importId);\r\n                        names.push(req.as);\r\n                    }\r\n                }\r\n                logger.debug(\"importing ViewModel resources for \".concat(compileInstruction.associatedModuleId), importIds.slice(templateImportCount));\r\n            }\r\n        }\r\n        return this.importViewResources(importIds, names, resources, compileInstruction, loadContext);\r\n    };\r\n    ViewEngine.prototype.importViewModelResource = function (moduleImport, moduleMember) {\r\n        var _this = this;\r\n        return this.loader.loadModule(moduleImport).then(function (viewModelModule) {\r\n            var normalizedId = aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"Origin\"].get(viewModelModule).moduleId;\r\n            var resourceModule = _this.moduleAnalyzer.analyze(normalizedId, viewModelModule, moduleMember);\r\n            if (!resourceModule.mainResource) {\r\n                throw new Error(\"No view model found in module \\\"\".concat(moduleImport, \"\\\".\"));\r\n            }\r\n            resourceModule.initialize(_this.container);\r\n            return resourceModule.mainResource;\r\n        });\r\n    };\r\n    ViewEngine.prototype.importViewResources = function (moduleIds, names, resources, compileInstruction, loadContext) {\r\n        var _this = this;\r\n        loadContext = loadContext || new ResourceLoadContext();\r\n        compileInstruction = compileInstruction || ViewCompileInstruction.normal;\r\n        moduleIds = moduleIds.map(function (x) { return _this._applyLoaderPlugin(x); });\r\n        return this.loader.loadAllModules(moduleIds).then(function (imports) {\r\n            var i;\r\n            var ii;\r\n            var analysis;\r\n            var normalizedId;\r\n            var current;\r\n            var associatedModule;\r\n            var container = _this.container;\r\n            var moduleAnalyzer = _this.moduleAnalyzer;\r\n            var allAnalysis = new Array(imports.length);\r\n            for (i = 0, ii = imports.length; i < ii; ++i) {\r\n                current = imports[i];\r\n                normalizedId = aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"Origin\"].get(current).moduleId;\r\n                analysis = moduleAnalyzer.analyze(normalizedId, current);\r\n                analysis.initialize(container);\r\n                analysis.register(resources, names[i]);\r\n                allAnalysis[i] = analysis;\r\n            }\r\n            if (compileInstruction.associatedModuleId) {\r\n                associatedModule = moduleAnalyzer.getAnalysis(compileInstruction.associatedModuleId);\r\n                if (associatedModule) {\r\n                    associatedModule.register(resources);\r\n                }\r\n            }\r\n            for (i = 0, ii = allAnalysis.length; i < ii; ++i) {\r\n                allAnalysis[i] = allAnalysis[i].load(container, loadContext);\r\n            }\r\n            return Promise.all(allAnalysis).then(function () { return resources; });\r\n        });\r\n    };\r\n    ViewEngine.prototype._applyLoaderPlugin = function (id) {\r\n        var index = id.lastIndexOf('.');\r\n        if (index !== -1) {\r\n            var ext = id.substring(index);\r\n            var pluginName = this._pluginMap[ext];\r\n            if (pluginName === undefined) {\r\n                return id;\r\n            }\r\n            return this.loader.applyPluginToUrl(id, pluginName);\r\n        }\r\n        return id;\r\n    };\r\n    ViewEngine.viewModelRequireMetadataKey = 'aurelia:view-model-require';\r\n    return ViewEngine;\r\n}());\n\nvar Controller = (function () {\r\n    function Controller(behavior, instruction, viewModel, container) {\r\n        this.behavior = behavior;\r\n        this.instruction = instruction;\r\n        this.viewModel = viewModel;\r\n        this.isAttached = false;\r\n        this.view = null;\r\n        this.isBound = false;\r\n        this.scope = null;\r\n        this.container = container;\r\n        this.elementEvents = container.elementEvents || null;\r\n        var observerLookup = behavior.observerLocator.getOrCreateObserversLookup(viewModel);\r\n        var handlesBind = behavior.handlesBind;\r\n        var attributes = instruction.attributes;\r\n        var boundProperties = this.boundProperties = [];\r\n        var properties = behavior.properties;\r\n        var i;\r\n        var ii;\r\n        behavior._ensurePropertiesDefined(viewModel, observerLookup);\r\n        for (i = 0, ii = properties.length; i < ii; ++i) {\r\n            properties[i]._initialize(viewModel, observerLookup, attributes, handlesBind, boundProperties);\r\n        }\r\n    }\r\n    Controller.prototype.created = function (owningView) {\r\n        if (this.behavior.handlesCreated) {\r\n            this.viewModel.created(owningView, this.view);\r\n        }\r\n    };\r\n    Controller.prototype.automate = function (overrideContext, owningView) {\r\n        this.view.bindingContext = this.viewModel;\r\n        this.view.overrideContext = overrideContext || Object(aurelia_binding__WEBPACK_IMPORTED_MODULE_5__[\"createOverrideContext\"])(this.viewModel);\r\n        this.view._isUserControlled = true;\r\n        if (this.behavior.handlesCreated) {\r\n            this.viewModel.created(owningView || null, this.view);\r\n        }\r\n        this.bind(this.view);\r\n    };\r\n    Controller.prototype.bind = function (scope) {\r\n        var skipSelfSubscriber = this.behavior.handlesBind;\r\n        var boundProperties = this.boundProperties;\r\n        var i;\r\n        var ii;\r\n        var x;\r\n        var observer;\r\n        var selfSubscriber;\r\n        if (this.isBound) {\r\n            if (this.scope === scope) {\r\n                return;\r\n            }\r\n            this.unbind();\r\n        }\r\n        this.isBound = true;\r\n        this.scope = scope;\r\n        for (i = 0, ii = boundProperties.length; i < ii; ++i) {\r\n            x = boundProperties[i];\r\n            observer = x.observer;\r\n            selfSubscriber = observer.selfSubscriber;\r\n            observer.publishing = false;\r\n            if (skipSelfSubscriber) {\r\n                observer.selfSubscriber = null;\r\n            }\r\n            x.binding.bind(scope);\r\n            observer.call();\r\n            observer.publishing = true;\r\n            observer.selfSubscriber = selfSubscriber;\r\n        }\r\n        var overrideContext;\r\n        if (this.view !== null) {\r\n            if (skipSelfSubscriber) {\r\n                this.view.viewModelScope = scope;\r\n            }\r\n            if (this.viewModel === scope.overrideContext.bindingContext) {\r\n                overrideContext = scope.overrideContext;\r\n            }\r\n            else if (this.instruction.inheritBindingContext) {\r\n                overrideContext = Object(aurelia_binding__WEBPACK_IMPORTED_MODULE_5__[\"createOverrideContext\"])(this.viewModel, scope.overrideContext);\r\n            }\r\n            else {\r\n                overrideContext = Object(aurelia_binding__WEBPACK_IMPORTED_MODULE_5__[\"createOverrideContext\"])(this.viewModel);\r\n                overrideContext.__parentOverrideContext = scope.overrideContext;\r\n            }\r\n            this.view.bind(this.viewModel, overrideContext);\r\n        }\r\n        else if (skipSelfSubscriber) {\r\n            overrideContext = scope.overrideContext;\r\n            if (scope.overrideContext.__parentOverrideContext !== undefined\r\n                && this.viewModel.viewFactory && this.viewModel.viewFactory.factoryCreateInstruction.partReplacements) {\r\n                overrideContext = Object.assign({}, scope.overrideContext);\r\n                overrideContext.parentOverrideContext = scope.overrideContext.__parentOverrideContext;\r\n            }\r\n            this.viewModel.bind(scope.bindingContext, overrideContext);\r\n        }\r\n    };\r\n    Controller.prototype.unbind = function () {\r\n        if (this.isBound) {\r\n            var boundProperties = this.boundProperties;\r\n            var i = void 0;\r\n            var ii = void 0;\r\n            this.isBound = false;\r\n            this.scope = null;\r\n            if (this.view !== null) {\r\n                this.view.unbind();\r\n            }\r\n            if (this.behavior.handlesUnbind) {\r\n                this.viewModel.unbind();\r\n            }\r\n            if (this.elementEvents !== null) {\r\n                this.elementEvents.disposeAll();\r\n            }\r\n            for (i = 0, ii = boundProperties.length; i < ii; ++i) {\r\n                boundProperties[i].binding.unbind();\r\n            }\r\n        }\r\n    };\r\n    Controller.prototype.attached = function () {\r\n        if (this.isAttached) {\r\n            return;\r\n        }\r\n        this.isAttached = true;\r\n        if (this.behavior.handlesAttached) {\r\n            this.viewModel.attached();\r\n        }\r\n        if (this.view !== null) {\r\n            this.view.attached();\r\n        }\r\n    };\r\n    Controller.prototype.detached = function () {\r\n        if (this.isAttached) {\r\n            this.isAttached = false;\r\n            if (this.view !== null) {\r\n                this.view.detached();\r\n            }\r\n            if (this.behavior.handlesDetached) {\r\n                this.viewModel.detached();\r\n            }\r\n        }\r\n    };\r\n    return Controller;\r\n}());\n\nvar lastProviderId = 0;\r\nfunction nextProviderId() {\r\n    return ++lastProviderId;\r\n}\r\nfunction doProcessContent() { return true; }\r\nfunction doProcessAttributes() { }\r\nvar HtmlBehaviorResource = (function () {\r\n    function HtmlBehaviorResource() {\r\n        this.elementName = null;\r\n        this.attributeName = null;\r\n        this.attributeDefaultBindingMode = undefined;\r\n        this.liftsContent = false;\r\n        this.targetShadowDOM = false;\r\n        this.shadowDOMOptions = null;\r\n        this.processAttributes = doProcessAttributes;\r\n        this.processContent = doProcessContent;\r\n        this.usesShadowDOM = false;\r\n        this.childBindings = null;\r\n        this.hasDynamicOptions = false;\r\n        this.containerless = false;\r\n        this.properties = [];\r\n        this.attributes = {};\r\n        this.isInitialized = false;\r\n        this.primaryProperty = null;\r\n    }\r\n    HtmlBehaviorResource.convention = function (name, existing) {\r\n        var behavior;\r\n        if (name.endsWith('CustomAttribute')) {\r\n            behavior = existing || new HtmlBehaviorResource();\r\n            behavior.attributeName = _hyphenate(name.substring(0, name.length - 15));\r\n        }\r\n        if (name.endsWith('CustomElement')) {\r\n            behavior = existing || new HtmlBehaviorResource();\r\n            behavior.elementName = _hyphenate(name.substring(0, name.length - 13));\r\n        }\r\n        return behavior;\r\n    };\r\n    HtmlBehaviorResource.prototype.addChildBinding = function (behavior) {\r\n        if (this.childBindings === null) {\r\n            this.childBindings = [];\r\n        }\r\n        this.childBindings.push(behavior);\r\n    };\r\n    HtmlBehaviorResource.prototype.initialize = function (container, target) {\r\n        var proto = target.prototype;\r\n        var properties = this.properties;\r\n        var attributeName = this.attributeName;\r\n        var attributeDefaultBindingMode = this.attributeDefaultBindingMode;\r\n        var i;\r\n        var ii;\r\n        var current;\r\n        if (this.isInitialized) {\r\n            return;\r\n        }\r\n        this.isInitialized = true;\r\n        target.__providerId__ = nextProviderId();\r\n        this.observerLocator = container.get(aurelia_binding__WEBPACK_IMPORTED_MODULE_5__[\"ObserverLocator\"]);\r\n        this.taskQueue = container.get(aurelia_task_queue__WEBPACK_IMPORTED_MODULE_7__[\"TaskQueue\"]);\r\n        this.target = target;\r\n        this.usesShadowDOM = this.targetShadowDOM && aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"FEATURE\"].shadowDOM;\r\n        this.handlesCreated = ('created' in proto);\r\n        this.handlesBind = ('bind' in proto);\r\n        this.handlesUnbind = ('unbind' in proto);\r\n        this.handlesAttached = ('attached' in proto);\r\n        this.handlesDetached = ('detached' in proto);\r\n        this.htmlName = this.elementName || this.attributeName;\r\n        if (attributeName !== null) {\r\n            if (properties.length === 0) {\r\n                new BindableProperty({\r\n                    name: 'value',\r\n                    changeHandler: 'valueChanged' in proto ? 'valueChanged' : null,\r\n                    attribute: attributeName,\r\n                    defaultBindingMode: attributeDefaultBindingMode\r\n                }).registerWith(target, this);\r\n            }\r\n            current = properties[0];\r\n            if (properties.length === 1 && current.name === 'value') {\r\n                current.isDynamic = current.hasOptions = this.hasDynamicOptions;\r\n                current.defineOn(target, this);\r\n            }\r\n            else {\r\n                for (i = 0, ii = properties.length; i < ii; ++i) {\r\n                    properties[i].defineOn(target, this);\r\n                    if (properties[i].primaryProperty) {\r\n                        if (this.primaryProperty) {\r\n                            throw new Error('Only one bindable property on a custom element can be defined as the default');\r\n                        }\r\n                        this.primaryProperty = properties[i];\r\n                    }\r\n                }\r\n                current = new BindableProperty({\r\n                    name: 'value',\r\n                    changeHandler: 'valueChanged' in proto ? 'valueChanged' : null,\r\n                    attribute: attributeName,\r\n                    defaultBindingMode: attributeDefaultBindingMode\r\n                });\r\n                current.hasOptions = true;\r\n                current.registerWith(target, this);\r\n            }\r\n        }\r\n        else {\r\n            for (i = 0, ii = properties.length; i < ii; ++i) {\r\n                properties[i].defineOn(target, this);\r\n            }\r\n            this._copyInheritedProperties(container, target);\r\n        }\r\n    };\r\n    HtmlBehaviorResource.prototype.register = function (registry, name) {\r\n        var _this = this;\r\n        if (this.attributeName !== null) {\r\n            registry.registerAttribute(name || this.attributeName, this, this.attributeName);\r\n            if (Array.isArray(this.aliases)) {\r\n                this.aliases\r\n                    .forEach(function (alias) {\r\n                    registry.registerAttribute(alias, _this, _this.attributeName);\r\n                });\r\n            }\r\n        }\r\n        if (this.elementName !== null) {\r\n            registry.registerElement(name || this.elementName, this);\r\n        }\r\n    };\r\n    HtmlBehaviorResource.prototype.aliases = function (aliases) {\r\n        throw new Error('Method not implemented.');\r\n    };\r\n    HtmlBehaviorResource.prototype.load = function (container, target, loadContext, viewStrategy, transientView) {\r\n        var _this = this;\r\n        var options;\r\n        if (this.elementName !== null) {\r\n            viewStrategy = container.get(ViewLocator).getViewStrategy(viewStrategy || this.viewStrategy || target);\r\n            options = new ViewCompileInstruction(this.targetShadowDOM, true);\r\n            if (!viewStrategy.moduleId) {\r\n                viewStrategy.moduleId = aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"Origin\"].get(target).moduleId;\r\n            }\r\n            return viewStrategy\r\n                .loadViewFactory(container.get(ViewEngine), options, loadContext, target)\r\n                .then(function (viewFactory) {\r\n                if (!transientView || !_this.viewFactory) {\r\n                    _this.viewFactory = viewFactory;\r\n                }\r\n                return viewFactory;\r\n            });\r\n        }\r\n        return Promise.resolve(this);\r\n    };\r\n    HtmlBehaviorResource.prototype.compile = function (compiler, resources, node, instruction, parentNode) {\r\n        if (this.liftsContent) {\r\n            if (!instruction.viewFactory) {\r\n                var template = aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].createElement('template');\r\n                var fragment = aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].createDocumentFragment();\r\n                var cacheSize = node.getAttribute('view-cache');\r\n                var part = node.getAttribute('part');\r\n                node.removeAttribute(instruction.originalAttrName);\r\n                aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].replaceNode(template, node, parentNode);\r\n                fragment.appendChild(node);\r\n                instruction.viewFactory = compiler.compile(fragment, resources);\r\n                if (part) {\r\n                    instruction.viewFactory.part = part;\r\n                    node.removeAttribute('part');\r\n                }\r\n                if (cacheSize) {\r\n                    instruction.viewFactory.setCacheSize(cacheSize);\r\n                    node.removeAttribute('view-cache');\r\n                }\r\n                node = template;\r\n            }\r\n        }\r\n        else if (this.elementName !== null) {\r\n            var partReplacements = {};\r\n            if (this.processContent(compiler, resources, node, instruction) && node.hasChildNodes()) {\r\n                var currentChild = node.firstChild;\r\n                var contentElement = this.usesShadowDOM ? null : aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].createElement('au-content');\r\n                var nextSibling = void 0;\r\n                var toReplace = void 0;\r\n                while (currentChild) {\r\n                    nextSibling = currentChild.nextSibling;\r\n                    if (currentChild.tagName === 'TEMPLATE' && (toReplace = currentChild.getAttribute('replace-part'))) {\r\n                        partReplacements[toReplace] = compiler.compile(currentChild, resources);\r\n                        aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].removeNode(currentChild, parentNode);\r\n                        instruction.partReplacements = partReplacements;\r\n                    }\r\n                    else if (contentElement !== null) {\r\n                        if (currentChild.nodeType === 3 && _isAllWhitespace(currentChild)) {\r\n                            aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].removeNode(currentChild, parentNode);\r\n                        }\r\n                        else {\r\n                            contentElement.appendChild(currentChild);\r\n                        }\r\n                    }\r\n                    currentChild = nextSibling;\r\n                }\r\n                if (contentElement !== null && contentElement.hasChildNodes()) {\r\n                    node.appendChild(contentElement);\r\n                }\r\n                instruction.skipContentProcessing = false;\r\n            }\r\n            else {\r\n                instruction.skipContentProcessing = true;\r\n            }\r\n        }\r\n        else if (!this.processContent(compiler, resources, node, instruction)) {\r\n            instruction.skipContentProcessing = true;\r\n        }\r\n        return node;\r\n    };\r\n    HtmlBehaviorResource.prototype.create = function (container, instruction, element, bindings) {\r\n        var viewHost;\r\n        var au = null;\r\n        instruction = instruction || BehaviorInstruction.normal;\r\n        element = element || null;\r\n        bindings = bindings || null;\r\n        if (this.elementName !== null && element) {\r\n            if (this.usesShadowDOM) {\r\n                viewHost = element.attachShadow(this.shadowDOMOptions);\r\n                container.registerInstance(aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].boundary, viewHost);\r\n            }\r\n            else {\r\n                viewHost = element;\r\n                if (this.targetShadowDOM) {\r\n                    container.registerInstance(aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].boundary, viewHost);\r\n                }\r\n            }\r\n        }\r\n        if (element !== null) {\r\n            element.au = au = element.au || {};\r\n        }\r\n        var viewModel = instruction.viewModel || container.get(this.target);\r\n        var controller = new Controller(this, instruction, viewModel, container);\r\n        var childBindings = this.childBindings;\r\n        var viewFactory;\r\n        if (this.liftsContent) {\r\n            au.controller = controller;\r\n        }\r\n        else if (this.elementName !== null) {\r\n            viewFactory = instruction.viewFactory || this.viewFactory;\r\n            container.viewModel = viewModel;\r\n            if (viewFactory) {\r\n                controller.view = viewFactory.create(container, instruction, element);\r\n            }\r\n            if (element !== null) {\r\n                au.controller = controller;\r\n                if (controller.view) {\r\n                    if (!this.usesShadowDOM && (element.childNodes.length === 1 || element.contentElement)) {\r\n                        var contentElement = element.childNodes[0] || element.contentElement;\r\n                        controller.view.contentView = { fragment: contentElement };\r\n                        contentElement.parentNode && aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].removeNode(contentElement);\r\n                    }\r\n                    if (instruction.anchorIsContainer) {\r\n                        if (childBindings !== null) {\r\n                            for (var i = 0, ii = childBindings.length; i < ii; ++i) {\r\n                                controller.view.addBinding(childBindings[i].create(element, viewModel, controller));\r\n                            }\r\n                        }\r\n                        controller.view.appendNodesTo(viewHost);\r\n                    }\r\n                    else {\r\n                        controller.view.insertNodesBefore(viewHost);\r\n                    }\r\n                }\r\n                else if (childBindings !== null) {\r\n                    for (var i = 0, ii = childBindings.length; i < ii; ++i) {\r\n                        bindings.push(childBindings[i].create(element, viewModel, controller));\r\n                    }\r\n                }\r\n            }\r\n            else if (controller.view) {\r\n                controller.view.controller = controller;\r\n                if (childBindings !== null) {\r\n                    for (var i = 0, ii = childBindings.length; i < ii; ++i) {\r\n                        controller.view.addBinding(childBindings[i].create(instruction.host, viewModel, controller));\r\n                    }\r\n                }\r\n            }\r\n            else if (childBindings !== null) {\r\n                for (var i = 0, ii = childBindings.length; i < ii; ++i) {\r\n                    bindings.push(childBindings[i].create(instruction.host, viewModel, controller));\r\n                }\r\n            }\r\n        }\r\n        else if (childBindings !== null) {\r\n            for (var i = 0, ii = childBindings.length; i < ii; ++i) {\r\n                bindings.push(childBindings[i].create(element, viewModel, controller));\r\n            }\r\n        }\r\n        if (au !== null) {\r\n            au[this.htmlName] = controller;\r\n        }\r\n        if (instruction.initiatedByBehavior && viewFactory) {\r\n            controller.view.created();\r\n        }\r\n        return controller;\r\n    };\r\n    HtmlBehaviorResource.prototype._ensurePropertiesDefined = function (instance, lookup) {\r\n        var properties;\r\n        var i;\r\n        var ii;\r\n        var observer;\r\n        if ('__propertiesDefined__' in lookup) {\r\n            return;\r\n        }\r\n        lookup.__propertiesDefined__ = true;\r\n        properties = this.properties;\r\n        for (i = 0, ii = properties.length; i < ii; ++i) {\r\n            observer = properties[i].createObserver(instance);\r\n            if (observer !== undefined) {\r\n                lookup[observer.propertyName] = observer;\r\n            }\r\n        }\r\n    };\r\n    HtmlBehaviorResource.prototype._copyInheritedProperties = function (container, target) {\r\n        var behavior;\r\n        var derived = target;\r\n        while (true) {\r\n            var proto = Object.getPrototypeOf(target.prototype);\r\n            target = proto && proto.constructor;\r\n            if (!target) {\r\n                return;\r\n            }\r\n            behavior = aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].getOwn(aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].resource, target);\r\n            if (behavior) {\r\n                break;\r\n            }\r\n        }\r\n        behavior.initialize(container, target);\r\n        var _loop_1 = function (i, ii) {\r\n            var prop = behavior.properties[i];\r\n            if (this_1.properties.some(function (p) { return p.name === prop.name; })) {\r\n                return \"continue\";\r\n            }\r\n            new BindableProperty(prop).registerWith(derived, this_1);\r\n        };\r\n        var this_1 = this;\r\n        for (var i = 0, ii = behavior.properties.length; i < ii; ++i) {\r\n            _loop_1(i);\r\n        }\r\n    };\r\n    return HtmlBehaviorResource;\r\n}());\n\nfunction register(lookup, name, resource, type) {\r\n    if (!name) {\r\n        return;\r\n    }\r\n    var existing = lookup[name];\r\n    if (existing) {\r\n        if (existing !== resource) {\r\n            throw new Error(\"Attempted to register \".concat(type, \" when one with the same name already exists. Name: \").concat(name, \".\"));\r\n        }\r\n        return;\r\n    }\r\n    lookup[name] = resource;\r\n}\r\nfunction validateBehaviorName(name, type) {\r\n    if (/[A-Z]/.test(name)) {\r\n        var newName = _hyphenate(name);\r\n        aurelia_logging__WEBPACK_IMPORTED_MODULE_4__[\"getLogger\"]('templating')\r\n            .warn(\"'\".concat(name, \"' is not a valid \").concat(type, \" name and has been converted to '\").concat(newName, \"'. Upper-case letters are not allowed because the DOM is not case-sensitive.\"));\r\n        return newName;\r\n    }\r\n    return name;\r\n}\r\nvar conventionMark = '__au_resource__';\r\nvar ViewResources = (function () {\r\n    function ViewResources(parent, viewUrl) {\r\n        this.bindingLanguage = null;\r\n        this.parent = parent || null;\r\n        this.hasParent = this.parent !== null;\r\n        this.viewUrl = viewUrl || '';\r\n        this.lookupFunctions = {\r\n            valueConverters: this.getValueConverter.bind(this),\r\n            bindingBehaviors: this.getBindingBehavior.bind(this)\r\n        };\r\n        this.attributes = Object.create(null);\r\n        this.elements = Object.create(null);\r\n        this.valueConverters = Object.create(null);\r\n        this.bindingBehaviors = Object.create(null);\r\n        this.attributeMap = Object.create(null);\r\n        this.values = Object.create(null);\r\n        this.beforeCompile = this.afterCompile = this.beforeCreate = this.afterCreate = this.beforeBind = this.beforeUnbind = false;\r\n    }\r\n    ViewResources.convention = function (target, existing) {\r\n        var resource;\r\n        if (existing && conventionMark in existing) {\r\n            return existing;\r\n        }\r\n        if ('$resource' in target) {\r\n            var config = target.$resource;\r\n            if (typeof config === 'string') {\r\n                resource = existing || new HtmlBehaviorResource();\r\n                resource[conventionMark] = true;\r\n                if (!resource.elementName) {\r\n                    resource.elementName = validateBehaviorName(config, 'custom element');\r\n                }\r\n            }\r\n            else {\r\n                if (typeof config === 'function') {\r\n                    config = config.call(target);\r\n                }\r\n                if (typeof config === 'string') {\r\n                    config = { name: config };\r\n                }\r\n                config = Object.assign({}, config);\r\n                var resourceType = config.type || 'element';\r\n                var name_1 = config.name;\r\n                switch (resourceType) {\r\n                    case 'element':\r\n                    case 'attribute':\r\n                        resource = existing || new HtmlBehaviorResource();\r\n                        resource[conventionMark] = true;\r\n                        if (resourceType === 'element') {\r\n                            if (!resource.elementName) {\r\n                                resource.elementName = name_1\r\n                                    ? validateBehaviorName(name_1, 'custom element')\r\n                                    : _hyphenate(target.name);\r\n                            }\r\n                        }\r\n                        else {\r\n                            if (!resource.attributeName) {\r\n                                resource.attributeName = name_1\r\n                                    ? validateBehaviorName(name_1, 'custom attribute')\r\n                                    : _hyphenate(target.name);\r\n                            }\r\n                        }\r\n                        if ('templateController' in config) {\r\n                            config.liftsContent = config.templateController;\r\n                            delete config.templateController;\r\n                        }\r\n                        if ('defaultBindingMode' in config && resource.attributeDefaultBindingMode !== undefined) {\r\n                            config.attributeDefaultBindingMode = config.defaultBindingMode;\r\n                            delete config.defaultBindingMode;\r\n                        }\r\n                        delete config.name;\r\n                        Object.assign(resource, config);\r\n                        break;\r\n                    case 'valueConverter':\r\n                        resource = new aurelia_binding__WEBPACK_IMPORTED_MODULE_5__[\"ValueConverterResource\"](Object(aurelia_binding__WEBPACK_IMPORTED_MODULE_5__[\"camelCase\"])(name_1 || target.name));\r\n                        break;\r\n                    case 'bindingBehavior':\r\n                        resource = new aurelia_binding__WEBPACK_IMPORTED_MODULE_5__[\"BindingBehaviorResource\"](Object(aurelia_binding__WEBPACK_IMPORTED_MODULE_5__[\"camelCase\"])(name_1 || target.name));\r\n                        break;\r\n                    case 'viewEngineHooks':\r\n                        resource = new ViewEngineHooksResource();\r\n                        break;\r\n                }\r\n            }\r\n            if (resource instanceof HtmlBehaviorResource) {\r\n                var bindables = typeof config === 'string' ? undefined : config.bindables;\r\n                var currentProps = resource.properties;\r\n                if (Array.isArray(bindables)) {\r\n                    for (var i = 0, ii = bindables.length; ii > i; ++i) {\r\n                        var prop = bindables[i];\r\n                        if (!prop || (typeof prop !== 'string' && !prop.name)) {\r\n                            throw new Error(\"Invalid bindable property at \\\"\".concat(i, \"\\\" for class \\\"\").concat(target.name, \"\\\". Expected either a string or an object with \\\"name\\\" property.\"));\r\n                        }\r\n                        var newProp = new BindableProperty(prop);\r\n                        var existed = false;\r\n                        for (var j = 0, jj = currentProps.length; jj > j; ++j) {\r\n                            if (currentProps[j].name === newProp.name) {\r\n                                existed = true;\r\n                                break;\r\n                            }\r\n                        }\r\n                        if (existed) {\r\n                            continue;\r\n                        }\r\n                        newProp.registerWith(target, resource);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return resource;\r\n    };\r\n    ViewResources.prototype._tryAddHook = function (obj, name) {\r\n        if (typeof obj[name] === 'function') {\r\n            var func = obj[name].bind(obj);\r\n            var counter = 1;\r\n            var callbackName = void 0;\r\n            while (this[callbackName = name + counter.toString()] !== undefined) {\r\n                counter++;\r\n            }\r\n            this[name] = true;\r\n            this[callbackName] = func;\r\n        }\r\n    };\r\n    ViewResources.prototype._invokeHook = function (name, one, two, three, four) {\r\n        if (this.hasParent) {\r\n            this.parent._invokeHook(name, one, two, three, four);\r\n        }\r\n        if (this[name]) {\r\n            this[name + '1'](one, two, three, four);\r\n            var callbackName = name + '2';\r\n            if (this[callbackName]) {\r\n                this[callbackName](one, two, three, four);\r\n                callbackName = name + '3';\r\n                if (this[callbackName]) {\r\n                    this[callbackName](one, two, three, four);\r\n                    var counter = 4;\r\n                    while (this[callbackName = name + counter.toString()] !== undefined) {\r\n                        this[callbackName](one, two, three, four);\r\n                        counter++;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    };\r\n    ViewResources.prototype.registerViewEngineHooks = function (hooks) {\r\n        this._tryAddHook(hooks, 'beforeCompile');\r\n        this._tryAddHook(hooks, 'afterCompile');\r\n        this._tryAddHook(hooks, 'beforeCreate');\r\n        this._tryAddHook(hooks, 'afterCreate');\r\n        this._tryAddHook(hooks, 'beforeBind');\r\n        this._tryAddHook(hooks, 'beforeUnbind');\r\n    };\r\n    ViewResources.prototype.getBindingLanguage = function (bindingLanguageFallback) {\r\n        return this.bindingLanguage || (this.bindingLanguage = bindingLanguageFallback);\r\n    };\r\n    ViewResources.prototype.patchInParent = function (newParent) {\r\n        var originalParent = this.parent;\r\n        this.parent = newParent || null;\r\n        this.hasParent = this.parent !== null;\r\n        if (newParent.parent === null) {\r\n            newParent.parent = originalParent;\r\n            newParent.hasParent = originalParent !== null;\r\n        }\r\n    };\r\n    ViewResources.prototype.relativeToView = function (path) {\r\n        return Object(aurelia_path__WEBPACK_IMPORTED_MODULE_3__[\"relativeToFile\"])(path, this.viewUrl);\r\n    };\r\n    ViewResources.prototype.registerElement = function (tagName, behavior) {\r\n        register(this.elements, tagName, behavior, 'an Element');\r\n    };\r\n    ViewResources.prototype.getElement = function (tagName) {\r\n        return this.elements[tagName] || (this.hasParent ? this.parent.getElement(tagName) : null);\r\n    };\r\n    ViewResources.prototype.mapAttribute = function (attribute) {\r\n        return this.attributeMap[attribute] || (this.hasParent ? this.parent.mapAttribute(attribute) : null);\r\n    };\r\n    ViewResources.prototype.registerAttribute = function (attribute, behavior, knownAttribute) {\r\n        this.attributeMap[attribute] = knownAttribute;\r\n        register(this.attributes, attribute, behavior, 'an Attribute');\r\n    };\r\n    ViewResources.prototype.getAttribute = function (attribute) {\r\n        return this.attributes[attribute] || (this.hasParent ? this.parent.getAttribute(attribute) : null);\r\n    };\r\n    ViewResources.prototype.registerValueConverter = function (name, valueConverter) {\r\n        register(this.valueConverters, name, valueConverter, 'a ValueConverter');\r\n    };\r\n    ViewResources.prototype.getValueConverter = function (name) {\r\n        return this.valueConverters[name] || (this.hasParent ? this.parent.getValueConverter(name) : null);\r\n    };\r\n    ViewResources.prototype.registerBindingBehavior = function (name, bindingBehavior) {\r\n        register(this.bindingBehaviors, name, bindingBehavior, 'a BindingBehavior');\r\n    };\r\n    ViewResources.prototype.getBindingBehavior = function (name) {\r\n        return this.bindingBehaviors[name] || (this.hasParent ? this.parent.getBindingBehavior(name) : null);\r\n    };\r\n    ViewResources.prototype.registerValue = function (name, value) {\r\n        register(this.values, name, value, 'a value');\r\n    };\r\n    ViewResources.prototype.getValue = function (name) {\r\n        return this.values[name] || (this.hasParent ? this.parent.getValue(name) : null);\r\n    };\r\n    ViewResources.prototype.autoRegister = function (container, impl) {\r\n        var resourceTypeMeta = aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].getOwn(aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].resource, impl);\r\n        if (resourceTypeMeta) {\r\n            if (resourceTypeMeta instanceof HtmlBehaviorResource) {\r\n                ViewResources.convention(impl, resourceTypeMeta);\r\n                if (resourceTypeMeta.attributeName === null && resourceTypeMeta.elementName === null) {\r\n                    HtmlBehaviorResource.convention(impl.name, resourceTypeMeta);\r\n                }\r\n                if (resourceTypeMeta.attributeName === null && resourceTypeMeta.elementName === null) {\r\n                    resourceTypeMeta.elementName = _hyphenate(impl.name);\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            resourceTypeMeta = ViewResources.convention(impl)\r\n                || HtmlBehaviorResource.convention(impl.name)\r\n                || aurelia_binding__WEBPACK_IMPORTED_MODULE_5__[\"ValueConverterResource\"].convention(impl.name)\r\n                || aurelia_binding__WEBPACK_IMPORTED_MODULE_5__[\"BindingBehaviorResource\"].convention(impl.name)\r\n                || ViewEngineHooksResource.convention(impl.name);\r\n            if (!resourceTypeMeta) {\r\n                resourceTypeMeta = new HtmlBehaviorResource();\r\n                resourceTypeMeta.elementName = _hyphenate(impl.name);\r\n            }\r\n            aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].define(aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].resource, resourceTypeMeta, impl);\r\n        }\r\n        resourceTypeMeta.initialize(container, impl);\r\n        resourceTypeMeta.register(this, undefined);\r\n        return resourceTypeMeta;\r\n    };\r\n    return ViewResources;\r\n}());\n\nvar viewStrategy = aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"protocol\"].create('aurelia:view-strategy', {\r\n    validate: function (target) {\r\n        if (!(typeof target.loadViewFactory === 'function')) {\r\n            return 'View strategies must implement: loadViewFactory(viewEngine: ViewEngine, compileInstruction: ViewCompileInstruction, loadContext?: ResourceLoadContext): Promise<ViewFactory>';\r\n        }\r\n        return true;\r\n    },\r\n    compose: function (target) {\r\n        if (!(typeof target.makeRelativeTo === 'function')) {\r\n            target.makeRelativeTo = aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"PLATFORM\"].noop;\r\n        }\r\n    }\r\n});\r\nvar RelativeViewStrategy = (function () {\r\n    function RelativeViewStrategy(path) {\r\n        this.path = path;\r\n        this.absolutePath = null;\r\n    }\r\n    RelativeViewStrategy.prototype.loadViewFactory = function (viewEngine, compileInstruction, loadContext, target) {\r\n        if (this.absolutePath === null && this.moduleId) {\r\n            this.absolutePath = Object(aurelia_path__WEBPACK_IMPORTED_MODULE_3__[\"relativeToFile\"])(this.path, this.moduleId);\r\n        }\r\n        compileInstruction.associatedModuleId = this.moduleId;\r\n        return viewEngine.loadViewFactory(this.absolutePath || this.path, compileInstruction, loadContext, target);\r\n    };\r\n    RelativeViewStrategy.prototype.makeRelativeTo = function (file) {\r\n        if (this.absolutePath === null) {\r\n            this.absolutePath = Object(aurelia_path__WEBPACK_IMPORTED_MODULE_3__[\"relativeToFile\"])(this.path, file);\r\n        }\r\n    };\r\n    RelativeViewStrategy = __decorate([\r\n        viewStrategy()\r\n    ], RelativeViewStrategy);\r\n    return RelativeViewStrategy;\r\n}());\r\nvar ConventionalViewStrategy = (function () {\r\n    function ConventionalViewStrategy(viewLocator, origin) {\r\n        this.moduleId = origin.moduleId;\r\n        this.viewUrl = viewLocator.convertOriginToViewUrl(origin);\r\n    }\r\n    ConventionalViewStrategy.prototype.loadViewFactory = function (viewEngine, compileInstruction, loadContext, target) {\r\n        compileInstruction.associatedModuleId = this.moduleId;\r\n        return viewEngine.loadViewFactory(this.viewUrl, compileInstruction, loadContext, target);\r\n    };\r\n    ConventionalViewStrategy = __decorate([\r\n        viewStrategy()\r\n    ], ConventionalViewStrategy);\r\n    return ConventionalViewStrategy;\r\n}());\r\nvar NoViewStrategy = (function () {\r\n    function NoViewStrategy(dependencies, dependencyBaseUrl) {\r\n        this.dependencies = dependencies || null;\r\n        this.dependencyBaseUrl = dependencyBaseUrl || '';\r\n    }\r\n    NoViewStrategy.prototype.loadViewFactory = function (viewEngine, compileInstruction, loadContext, target) {\r\n        var entry = this.entry;\r\n        var dependencies = this.dependencies;\r\n        if (entry && entry.factoryIsReady) {\r\n            return Promise.resolve(null);\r\n        }\r\n        this.entry = entry = new aurelia_loader__WEBPACK_IMPORTED_MODULE_1__[\"TemplateRegistryEntry\"](this.moduleId || this.dependencyBaseUrl);\r\n        entry.dependencies = [];\r\n        entry.templateIsLoaded = true;\r\n        if (dependencies !== null) {\r\n            for (var i = 0, ii = dependencies.length; i < ii; ++i) {\r\n                var current = dependencies[i];\r\n                if (typeof current === 'string' || typeof current === 'function') {\r\n                    entry.addDependency(current);\r\n                }\r\n                else {\r\n                    entry.addDependency(current.from, current.as);\r\n                }\r\n            }\r\n        }\r\n        compileInstruction.associatedModuleId = this.moduleId;\r\n        return viewEngine.loadViewFactory(entry, compileInstruction, loadContext, target);\r\n    };\r\n    NoViewStrategy = __decorate([\r\n        viewStrategy()\r\n    ], NoViewStrategy);\r\n    return NoViewStrategy;\r\n}());\r\nvar TemplateRegistryViewStrategy = (function () {\r\n    function TemplateRegistryViewStrategy(moduleId, entry) {\r\n        this.moduleId = moduleId;\r\n        this.entry = entry;\r\n    }\r\n    TemplateRegistryViewStrategy.prototype.loadViewFactory = function (viewEngine, compileInstruction, loadContext, target) {\r\n        var entry = this.entry;\r\n        if (entry.factoryIsReady) {\r\n            return Promise.resolve(entry.factory);\r\n        }\r\n        compileInstruction.associatedModuleId = this.moduleId;\r\n        return viewEngine.loadViewFactory(entry, compileInstruction, loadContext, target);\r\n    };\r\n    TemplateRegistryViewStrategy = __decorate([\r\n        viewStrategy()\r\n    ], TemplateRegistryViewStrategy);\r\n    return TemplateRegistryViewStrategy;\r\n}());\r\nvar InlineViewStrategy = (function () {\r\n    function InlineViewStrategy(markup, dependencies, dependencyBaseUrl) {\r\n        this.markup = markup;\r\n        this.dependencies = dependencies || null;\r\n        this.dependencyBaseUrl = dependencyBaseUrl || '';\r\n    }\r\n    InlineViewStrategy.prototype.loadViewFactory = function (viewEngine, compileInstruction, loadContext, target) {\r\n        var entry = this.entry;\r\n        var dependencies = this.dependencies;\r\n        if (entry && entry.factoryIsReady) {\r\n            return Promise.resolve(entry.factory);\r\n        }\r\n        this.entry = entry = new aurelia_loader__WEBPACK_IMPORTED_MODULE_1__[\"TemplateRegistryEntry\"](this.moduleId || this.dependencyBaseUrl);\r\n        entry.template = aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].createTemplateFromMarkup(this.markup);\r\n        if (dependencies !== null) {\r\n            for (var i = 0, ii = dependencies.length; i < ii; ++i) {\r\n                var current = dependencies[i];\r\n                if (typeof current === 'string' || typeof current === 'function') {\r\n                    entry.addDependency(current);\r\n                }\r\n                else {\r\n                    entry.addDependency(current.from, current.as);\r\n                }\r\n            }\r\n        }\r\n        compileInstruction.associatedModuleId = this.moduleId;\r\n        return viewEngine.loadViewFactory(entry, compileInstruction, loadContext, target);\r\n    };\r\n    InlineViewStrategy = __decorate([\r\n        viewStrategy()\r\n    ], InlineViewStrategy);\r\n    return InlineViewStrategy;\r\n}());\r\nvar StaticViewStrategy = (function () {\r\n    function StaticViewStrategy(config) {\r\n        if (typeof config === 'string' || (config instanceof aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].Element && config.tagName === 'TEMPLATE')) {\r\n            config = {\r\n                template: config\r\n            };\r\n        }\r\n        this.template = config.template;\r\n        this.dependencies = config.dependencies || [];\r\n        this.factoryIsReady = false;\r\n        this.onReady = null;\r\n        this.moduleId = 'undefined';\r\n    }\r\n    StaticViewStrategy.prototype.loadViewFactory = function (viewEngine, compileInstruction, loadContext, target) {\r\n        var _this = this;\r\n        if (this.factoryIsReady) {\r\n            return Promise.resolve(this.factory);\r\n        }\r\n        var $deps = this.dependencies;\r\n        var deps = typeof $deps === 'function' ? $deps() : $deps;\r\n        deps = deps ? deps : [];\r\n        deps = Array.isArray(deps) ? deps : [deps];\r\n        return Promise.all(deps).then(function (dependencies) {\r\n            var container = viewEngine.container;\r\n            var appResources = viewEngine.appResources;\r\n            var viewCompiler = viewEngine.viewCompiler;\r\n            var viewResources = new ViewResources(appResources);\r\n            var resource;\r\n            var elDeps = [];\r\n            if (target) {\r\n                viewResources.autoRegister(container, target);\r\n            }\r\n            for (var _i = 0, dependencies_1 = dependencies; _i < dependencies_1.length; _i++) {\r\n                var dep = dependencies_1[_i];\r\n                if (typeof dep === 'function') {\r\n                    resource = viewResources.autoRegister(container, dep);\r\n                    if (resource.elementName !== null) {\r\n                        elDeps.push(resource);\r\n                    }\r\n                }\r\n                else if (dep && typeof dep === 'object') {\r\n                    for (var key in dep) {\r\n                        var exported = dep[key];\r\n                        if (typeof exported === 'function') {\r\n                            resource = viewResources.autoRegister(container, exported);\r\n                            if (resource.elementName !== null) {\r\n                                elDeps.push(resource);\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                else {\r\n                    throw new Error(\"dependency neither function nor object. Received: \\\"\".concat(typeof dep, \"\\\"\"));\r\n                }\r\n            }\r\n            return Promise.all(elDeps.map(function (el) { return el.load(container, el.target); })).then(function () {\r\n                var factory = _this.template !== null\r\n                    ? viewCompiler.compile(_this.template, viewResources, compileInstruction)\r\n                    : null;\r\n                _this.factoryIsReady = true;\r\n                _this.factory = factory;\r\n                return factory;\r\n            });\r\n        });\r\n    };\r\n    StaticViewStrategy = __decorate([\r\n        viewStrategy()\r\n    ], StaticViewStrategy);\r\n    return StaticViewStrategy;\r\n}());\n\nfunction remove(viewSlot, previous) {\r\n    return Array.isArray(previous)\r\n        ? viewSlot.removeMany(previous, true)\r\n        : viewSlot.remove(previous, true);\r\n}\r\nvar SwapStrategies = {\r\n    before: function (viewSlot, previous, callback) {\r\n        return (previous === undefined)\r\n            ? callback()\r\n            : callback().then(function () { return remove(viewSlot, previous); });\r\n    },\r\n    with: function (viewSlot, previous, callback) {\r\n        return (previous === undefined)\r\n            ? callback()\r\n            : Promise.all([remove(viewSlot, previous), callback()]);\r\n    },\r\n    after: function (viewSlot, previous, callback) {\r\n        return Promise.resolve(viewSlot.removeAll(true)).then(callback);\r\n    }\r\n};\n\nfunction tryActivateViewModel(context) {\r\n    if (context.skipActivation || typeof context.viewModel.activate !== 'function') {\r\n        return Promise.resolve();\r\n    }\r\n    return context.viewModel.activate(context.model) || Promise.resolve();\r\n}\r\nvar CompositionEngine = (function () {\r\n    function CompositionEngine(viewEngine, viewLocator) {\r\n        this.viewEngine = viewEngine;\r\n        this.viewLocator = viewLocator;\r\n    }\r\n    CompositionEngine.prototype._swap = function (context, view) {\r\n        var swapStrategy = SwapStrategies[context.swapOrder] || SwapStrategies.after;\r\n        var previousViews = context.viewSlot.children.slice();\r\n        return swapStrategy(context.viewSlot, previousViews, function () {\r\n            return Promise.resolve(context.viewSlot.add(view)).then(function () {\r\n                if (context.currentController) {\r\n                    context.currentController.unbind();\r\n                }\r\n            });\r\n        }).then(function () {\r\n            if (context.compositionTransactionNotifier) {\r\n                context.compositionTransactionNotifier.done();\r\n            }\r\n        });\r\n    };\r\n    CompositionEngine.prototype._createControllerAndSwap = function (context) {\r\n        var _this = this;\r\n        return this.createController(context).then(function (controller) {\r\n            if (context.compositionTransactionOwnershipToken) {\r\n                return context.compositionTransactionOwnershipToken\r\n                    .waitForCompositionComplete()\r\n                    .then(function () {\r\n                    controller.automate(context.overrideContext, context.owningView);\r\n                    return _this._swap(context, controller.view);\r\n                })\r\n                    .then(function () { return controller; });\r\n            }\r\n            controller.automate(context.overrideContext, context.owningView);\r\n            return _this._swap(context, controller.view).then(function () { return controller; });\r\n        });\r\n    };\r\n    CompositionEngine.prototype.createController = function (context) {\r\n        var _this = this;\r\n        var childContainer;\r\n        var viewModel;\r\n        var viewModelResource;\r\n        var m;\r\n        return this\r\n            .ensureViewModel(context)\r\n            .then(tryActivateViewModel)\r\n            .then(function () {\r\n            childContainer = context.childContainer;\r\n            viewModel = context.viewModel;\r\n            viewModelResource = context.viewModelResource;\r\n            m = viewModelResource.metadata;\r\n            var viewStrategy = _this.viewLocator.getViewStrategy(context.view || viewModel);\r\n            if (context.viewResources) {\r\n                viewStrategy.makeRelativeTo(context.viewResources.viewUrl);\r\n            }\r\n            return m.load(childContainer, viewModelResource.value, null, viewStrategy, true);\r\n        }).then(function (viewFactory) { return m.create(childContainer, BehaviorInstruction.dynamic(context.host, viewModel, viewFactory)); });\r\n    };\r\n    CompositionEngine.prototype.ensureViewModel = function (context) {\r\n        var childContainer = context.childContainer = (context.childContainer || context.container.createChild());\r\n        if (typeof context.viewModel === 'string') {\r\n            context.viewModel = context.viewResources\r\n                ? context.viewResources.relativeToView(context.viewModel)\r\n                : context.viewModel;\r\n            return this.viewEngine.importViewModelResource(context.viewModel).then(function (viewModelResource) {\r\n                childContainer.autoRegister(viewModelResource.value);\r\n                if (context.host) {\r\n                    childContainer.registerInstance(aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].Element, context.host);\r\n                }\r\n                context.viewModel = childContainer.viewModel = childContainer.get(viewModelResource.value);\r\n                context.viewModelResource = viewModelResource;\r\n                return context;\r\n            });\r\n        }\r\n        var ctor = context.viewModel.constructor;\r\n        var isClass = typeof context.viewModel === 'function';\r\n        if (isClass) {\r\n            ctor = context.viewModel;\r\n            childContainer.autoRegister(ctor);\r\n        }\r\n        var m = aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].getOrCreateOwn(aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].resource, HtmlBehaviorResource, ctor);\r\n        m.elementName = m.elementName || 'dynamic-element';\r\n        m.initialize(isClass ? childContainer : (context.container || childContainer), ctor);\r\n        context.viewModelResource = { metadata: m, value: ctor };\r\n        if (context.host) {\r\n            childContainer.registerInstance(aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].Element, context.host);\r\n        }\r\n        childContainer.viewModel = context.viewModel = isClass ? childContainer.get(ctor) : context.viewModel;\r\n        return Promise.resolve(context);\r\n    };\r\n    CompositionEngine.prototype.compose = function (context) {\r\n        var _this = this;\r\n        context.childContainer = context.childContainer || context.container.createChild();\r\n        context.view = this.viewLocator.getViewStrategy(context.view);\r\n        var transaction = context.childContainer.get(CompositionTransaction);\r\n        var compositionTransactionOwnershipToken = transaction.tryCapture();\r\n        if (compositionTransactionOwnershipToken) {\r\n            context.compositionTransactionOwnershipToken = compositionTransactionOwnershipToken;\r\n        }\r\n        else {\r\n            context.compositionTransactionNotifier = transaction.enlist();\r\n        }\r\n        if (context.viewModel) {\r\n            return this._createControllerAndSwap(context);\r\n        }\r\n        else if (context.view) {\r\n            if (context.viewResources) {\r\n                context.view.makeRelativeTo(context.viewResources.viewUrl);\r\n            }\r\n            return context.view.loadViewFactory(this.viewEngine, new ViewCompileInstruction()).then(function (viewFactory) {\r\n                var result = viewFactory.create(context.childContainer);\r\n                result.bind(context.bindingContext, context.overrideContext);\r\n                if (context.compositionTransactionOwnershipToken) {\r\n                    return context.compositionTransactionOwnershipToken.waitForCompositionComplete()\r\n                        .then(function () { return _this._swap(context, result); })\r\n                        .then(function () { return result; });\r\n                }\r\n                return _this._swap(context, result).then(function () { return result; });\r\n            });\r\n        }\r\n        else if (context.viewSlot) {\r\n            context.viewSlot.removeAll();\r\n            if (context.compositionTransactionNotifier) {\r\n                context.compositionTransactionNotifier.done();\r\n            }\r\n            return Promise.resolve(null);\r\n        }\r\n        return Promise.resolve(null);\r\n    };\r\n    CompositionEngine = __decorate([\r\n        Object(aurelia_dependency_injection__WEBPACK_IMPORTED_MODULE_6__[\"inject\"])(ViewEngine, ViewLocator)\r\n    ], CompositionEngine);\r\n    return CompositionEngine;\r\n}());\n\nvar animationEvent = {\r\n    enterBegin: 'animation:enter:begin',\r\n    enterActive: 'animation:enter:active',\r\n    enterDone: 'animation:enter:done',\r\n    enterTimeout: 'animation:enter:timeout',\r\n    leaveBegin: 'animation:leave:begin',\r\n    leaveActive: 'animation:leave:active',\r\n    leaveDone: 'animation:leave:done',\r\n    leaveTimeout: 'animation:leave:timeout',\r\n    staggerNext: 'animation:stagger:next',\r\n    removeClassBegin: 'animation:remove-class:begin',\r\n    removeClassActive: 'animation:remove-class:active',\r\n    removeClassDone: 'animation:remove-class:done',\r\n    removeClassTimeout: 'animation:remove-class:timeout',\r\n    addClassBegin: 'animation:add-class:begin',\r\n    addClassActive: 'animation:add-class:active',\r\n    addClassDone: 'animation:add-class:done',\r\n    addClassTimeout: 'animation:add-class:timeout',\r\n    animateBegin: 'animation:animate:begin',\r\n    animateActive: 'animation:animate:active',\r\n    animateDone: 'animation:animate:done',\r\n    animateTimeout: 'animation:animate:timeout',\r\n    sequenceBegin: 'animation:sequence:begin',\r\n    sequenceDone: 'animation:sequence:done'\r\n};\n\nfunction createChildObserverDecorator(selectorOrConfig, all) {\r\n    return function (target, key, descriptor) {\r\n        var actualTarget = typeof key === 'string' ? target.constructor : target;\r\n        var r = aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].getOrCreateOwn(aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].resource, HtmlBehaviorResource, actualTarget);\r\n        if (typeof selectorOrConfig === 'string') {\r\n            selectorOrConfig = {\r\n                selector: selectorOrConfig,\r\n                name: key\r\n            };\r\n        }\r\n        if (descriptor) {\r\n            descriptor.writable = true;\r\n            descriptor.configurable = true;\r\n        }\r\n        selectorOrConfig.all = all;\r\n        r.addChildBinding(new ChildObserver(selectorOrConfig));\r\n    };\r\n}\r\nfunction children(selectorOrConfig) {\r\n    return createChildObserverDecorator(selectorOrConfig, true);\r\n}\r\nfunction child(selectorOrConfig) {\r\n    return createChildObserverDecorator(selectorOrConfig, false);\r\n}\r\nvar ChildObserver = (function () {\r\n    function ChildObserver(config) {\r\n        this.name = config.name;\r\n        this.changeHandler = config.changeHandler || this.name + 'Changed';\r\n        this.selector = config.selector;\r\n        this.all = config.all;\r\n    }\r\n    ChildObserver.prototype.create = function (viewHost, viewModel, controller) {\r\n        return new ChildObserverBinder(this.selector, viewHost, this.name, viewModel, controller, this.changeHandler, this.all);\r\n    };\r\n    return ChildObserver;\r\n}());\r\nvar noMutations = [];\r\nfunction trackMutation(groupedMutations, binder, record) {\r\n    var mutations = groupedMutations.get(binder);\r\n    if (!mutations) {\r\n        mutations = [];\r\n        groupedMutations.set(binder, mutations);\r\n    }\r\n    mutations.push(record);\r\n}\r\nfunction onChildChange(mutations, observer) {\r\n    var binders = observer.binders;\r\n    var bindersLength = binders.length;\r\n    var groupedMutations = new Map();\r\n    for (var i = 0, ii = mutations.length; i < ii; ++i) {\r\n        var record = mutations[i];\r\n        var added = record.addedNodes;\r\n        var removed = record.removedNodes;\r\n        for (var j = 0, jj = removed.length; j < jj; ++j) {\r\n            var node = removed[j];\r\n            if (node.nodeType === 1) {\r\n                for (var k = 0; k < bindersLength; ++k) {\r\n                    var binder = binders[k];\r\n                    if (binder.onRemove(node)) {\r\n                        trackMutation(groupedMutations, binder, record);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        for (var j = 0, jj = added.length; j < jj; ++j) {\r\n            var node = added[j];\r\n            if (node.nodeType === 1) {\r\n                for (var k = 0; k < bindersLength; ++k) {\r\n                    var binder = binders[k];\r\n                    if (binder.onAdd(node)) {\r\n                        trackMutation(groupedMutations, binder, record);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n    groupedMutations.forEach(function (mutationRecords, binder) {\r\n        if (binder.isBound && binder.changeHandler !== null) {\r\n            binder.viewModel[binder.changeHandler](mutationRecords);\r\n        }\r\n    });\r\n}\r\nvar ChildObserverBinder = (function () {\r\n    function ChildObserverBinder(selector, viewHost, property, viewModel, controller, changeHandler, all) {\r\n        this.selector = selector;\r\n        this.viewHost = viewHost;\r\n        this.property = property;\r\n        this.viewModel = viewModel;\r\n        this.controller = controller;\r\n        this.changeHandler = changeHandler in viewModel ? changeHandler : null;\r\n        this.usesShadowDOM = controller.behavior.usesShadowDOM;\r\n        this.all = all;\r\n        if (!this.usesShadowDOM && controller.view && controller.view.contentView) {\r\n            this.contentView = controller.view.contentView;\r\n        }\r\n        else {\r\n            this.contentView = null;\r\n        }\r\n        this.source = null;\r\n        this.isBound = false;\r\n    }\r\n    ChildObserverBinder.prototype.matches = function (element) {\r\n        if (element.matches(this.selector)) {\r\n            if (this.contentView === null) {\r\n                return true;\r\n            }\r\n            var contentView = this.contentView;\r\n            var assignedSlot = element.auAssignedSlot;\r\n            if (assignedSlot && assignedSlot.projectFromAnchors) {\r\n                var anchors = assignedSlot.projectFromAnchors;\r\n                for (var i = 0, ii = anchors.length; i < ii; ++i) {\r\n                    if (anchors[i].auOwnerView === contentView) {\r\n                        return true;\r\n                    }\r\n                }\r\n                return false;\r\n            }\r\n            return element.auOwnerView === contentView;\r\n        }\r\n        return false;\r\n    };\r\n    ChildObserverBinder.prototype.bind = function (source) {\r\n        if (this.isBound) {\r\n            if (this.source === source) {\r\n                return;\r\n            }\r\n            this.source = source;\r\n        }\r\n        this.isBound = true;\r\n        var viewHost = this.viewHost;\r\n        var viewModel = this.viewModel;\r\n        var observer = viewHost.__childObserver__;\r\n        if (!observer) {\r\n            observer = viewHost.__childObserver__ = aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].createMutationObserver(onChildChange);\r\n            var options = {\r\n                childList: true,\r\n                subtree: !this.usesShadowDOM\r\n            };\r\n            observer.observe(viewHost, options);\r\n            observer.binders = [];\r\n        }\r\n        observer.binders.push(this);\r\n        if (this.usesShadowDOM) {\r\n            var current = viewHost.firstElementChild;\r\n            if (this.all) {\r\n                var items = viewModel[this.property];\r\n                if (!items) {\r\n                    items = viewModel[this.property] = [];\r\n                }\r\n                else {\r\n                    items.splice(0);\r\n                }\r\n                while (current) {\r\n                    if (this.matches(current)) {\r\n                        items.push(current.au && current.au.controller ? current.au.controller.viewModel : current);\r\n                    }\r\n                    current = current.nextElementSibling;\r\n                }\r\n                if (this.changeHandler !== null) {\r\n                    this.viewModel[this.changeHandler](noMutations);\r\n                }\r\n            }\r\n            else {\r\n                while (current) {\r\n                    if (this.matches(current)) {\r\n                        var value = current.au && current.au.controller ? current.au.controller.viewModel : current;\r\n                        this.viewModel[this.property] = value;\r\n                        if (this.changeHandler !== null) {\r\n                            this.viewModel[this.changeHandler](value);\r\n                        }\r\n                        break;\r\n                    }\r\n                    current = current.nextElementSibling;\r\n                }\r\n            }\r\n        }\r\n    };\r\n    ChildObserverBinder.prototype.onRemove = function (element) {\r\n        if (this.matches(element)) {\r\n            var value = element.au && element.au.controller ? element.au.controller.viewModel : element;\r\n            if (this.all) {\r\n                var items = (this.viewModel[this.property] || (this.viewModel[this.property] = []));\r\n                var index = items.indexOf(value);\r\n                if (index !== -1) {\r\n                    items.splice(index, 1);\r\n                }\r\n                return true;\r\n            }\r\n            var currentValue = this.viewModel[this.property];\r\n            if (currentValue === value) {\r\n                this.viewModel[this.property] = null;\r\n                if (this.isBound && this.changeHandler !== null) {\r\n                    this.viewModel[this.changeHandler](value);\r\n                }\r\n            }\r\n        }\r\n        return false;\r\n    };\r\n    ChildObserverBinder.prototype.onAdd = function (element) {\r\n        if (this.matches(element)) {\r\n            var value = element.au && element.au.controller ? element.au.controller.viewModel : element;\r\n            if (this.all) {\r\n                var items = (this.viewModel[this.property] || (this.viewModel[this.property] = []));\r\n                if (this.selector === '*') {\r\n                    items.push(value);\r\n                    return true;\r\n                }\r\n                var index = 0;\r\n                var prev = element.previousElementSibling;\r\n                while (prev) {\r\n                    if (this.matches(prev)) {\r\n                        index++;\r\n                    }\r\n                    prev = prev.previousElementSibling;\r\n                }\r\n                items.splice(index, 0, value);\r\n                return true;\r\n            }\r\n            this.viewModel[this.property] = value;\r\n            if (this.isBound && this.changeHandler !== null) {\r\n                this.viewModel[this.changeHandler](value);\r\n            }\r\n        }\r\n        return false;\r\n    };\r\n    ChildObserverBinder.prototype.unbind = function () {\r\n        if (!this.isBound) {\r\n            return;\r\n        }\r\n        this.isBound = false;\r\n        this.source = null;\r\n        var childObserver = this.viewHost.__childObserver__;\r\n        if (childObserver) {\r\n            var binders = childObserver.binders;\r\n            if (binders && binders.length) {\r\n                var idx = binders.indexOf(this);\r\n                if (idx !== -1) {\r\n                    binders.splice(idx, 1);\r\n                }\r\n                if (binders.length === 0) {\r\n                    childObserver.disconnect();\r\n                    this.viewHost.__childObserver__ = null;\r\n                }\r\n            }\r\n            if (this.usesShadowDOM) {\r\n                this.viewModel[this.property] = null;\r\n            }\r\n        }\r\n    };\r\n    return ChildObserverBinder;\r\n}());\n\nvar ElementConfigResource = (function () {\r\n    function ElementConfigResource() {\r\n    }\r\n    ElementConfigResource.prototype.initialize = function (container, target) { };\r\n    ElementConfigResource.prototype.register = function (registry, name) { };\r\n    ElementConfigResource.prototype.load = function (container, target) {\r\n        var config = new target();\r\n        var eventManager = container.get(aurelia_binding__WEBPACK_IMPORTED_MODULE_5__[\"EventManager\"]);\r\n        eventManager.registerElementConfig(config);\r\n    };\r\n    return ElementConfigResource;\r\n}());\n\nfunction resource(instanceOrConfig) {\r\n    return function (target) {\r\n        var isConfig = typeof instanceOrConfig === 'string' || Object.getPrototypeOf(instanceOrConfig) === Object.prototype;\r\n        if (isConfig) {\r\n            target.$resource = instanceOrConfig;\r\n        }\r\n        else {\r\n            aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].define(aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].resource, instanceOrConfig, target);\r\n        }\r\n    };\r\n}\r\nfunction behavior(override) {\r\n    return function (target) {\r\n        if (override instanceof HtmlBehaviorResource) {\r\n            aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].define(aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].resource, override, target);\r\n        }\r\n        else {\r\n            var r = aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].getOrCreateOwn(aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].resource, HtmlBehaviorResource, target);\r\n            Object.assign(r, override);\r\n        }\r\n    };\r\n}\r\nfunction customElement(name) {\r\n    return function (target) {\r\n        var r = aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].getOrCreateOwn(aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].resource, HtmlBehaviorResource, target);\r\n        r.elementName = validateBehaviorName(name, 'custom element');\r\n    };\r\n}\r\nfunction customAttribute(name, defaultBindingMode, aliases) {\r\n    return function (target) {\r\n        var r = aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].getOrCreateOwn(aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].resource, HtmlBehaviorResource, target);\r\n        r.attributeName = validateBehaviorName(name, 'custom attribute');\r\n        r.attributeDefaultBindingMode = defaultBindingMode;\r\n        r.aliases = aliases;\r\n    };\r\n}\r\nfunction templateController(target) {\r\n    var deco = function (t) {\r\n        var r = aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].getOrCreateOwn(aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].resource, HtmlBehaviorResource, t);\r\n        r.liftsContent = true;\r\n    };\r\n    return target ? deco(target) : deco;\r\n}\r\nfunction bindable(nameOrConfigOrTarget, key, descriptor) {\r\n    var deco = function (target, key2, descriptor2) {\r\n        var actualTarget = key2 ? target.constructor : target;\r\n        var r = aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].getOrCreateOwn(aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].resource, HtmlBehaviorResource, actualTarget);\r\n        var prop;\r\n        if (key2) {\r\n            nameOrConfigOrTarget = nameOrConfigOrTarget || {};\r\n            nameOrConfigOrTarget.name = key2;\r\n        }\r\n        prop = new BindableProperty(nameOrConfigOrTarget);\r\n        return prop.registerWith(actualTarget, r, descriptor2);\r\n    };\r\n    if (!nameOrConfigOrTarget) {\r\n        return deco;\r\n    }\r\n    if (key) {\r\n        var target = nameOrConfigOrTarget;\r\n        nameOrConfigOrTarget = null;\r\n        return deco(target, key, descriptor);\r\n    }\r\n    return deco;\r\n}\r\nfunction dynamicOptions(target) {\r\n    var deco = function (t) {\r\n        var r = aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].getOrCreateOwn(aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].resource, HtmlBehaviorResource, t);\r\n        r.hasDynamicOptions = true;\r\n    };\r\n    return target ? deco(target) : deco;\r\n}\r\nvar defaultShadowDOMOptions = { mode: 'open' };\r\nfunction useShadowDOM(targetOrOptions) {\r\n    var options = typeof targetOrOptions === 'function' || !targetOrOptions\r\n        ? defaultShadowDOMOptions\r\n        : targetOrOptions;\r\n    var deco = function (t) {\r\n        var r = aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].getOrCreateOwn(aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].resource, HtmlBehaviorResource, t);\r\n        r.targetShadowDOM = true;\r\n        r.shadowDOMOptions = options;\r\n    };\r\n    return typeof targetOrOptions === 'function' ? deco(targetOrOptions) : deco;\r\n}\r\nfunction processAttributes(processor) {\r\n    return function (t) {\r\n        var r = aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].getOrCreateOwn(aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].resource, HtmlBehaviorResource, t);\r\n        r.processAttributes = function (compiler, resources, node, attributes, elementInstruction) {\r\n            try {\r\n                processor(compiler, resources, node, attributes, elementInstruction);\r\n            }\r\n            catch (error) {\r\n                aurelia_logging__WEBPACK_IMPORTED_MODULE_4__[\"getLogger\"]('templating').error(error);\r\n            }\r\n        };\r\n    };\r\n}\r\nfunction doNotProcessContent() { return false; }\r\nfunction processContent(processor) {\r\n    return function (t) {\r\n        var r = aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].getOrCreateOwn(aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].resource, HtmlBehaviorResource, t);\r\n        r.processContent = processor ? function (compiler, resources, node, instruction) {\r\n            try {\r\n                return processor(compiler, resources, node, instruction);\r\n            }\r\n            catch (error) {\r\n                aurelia_logging__WEBPACK_IMPORTED_MODULE_4__[\"getLogger\"]('templating').error(error);\r\n                return false;\r\n            }\r\n        } : doNotProcessContent;\r\n    };\r\n}\r\nfunction containerless(target) {\r\n    var deco = function (t) {\r\n        var r = aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].getOrCreateOwn(aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].resource, HtmlBehaviorResource, t);\r\n        r.containerless = true;\r\n    };\r\n    return target ? deco(target) : deco;\r\n}\r\nfunction useViewStrategy(strategy) {\r\n    return function (target) {\r\n        aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].define(ViewLocator.viewStrategyMetadataKey, strategy, target);\r\n    };\r\n}\r\nfunction useView(path) {\r\n    return useViewStrategy(new RelativeViewStrategy(path));\r\n}\r\nfunction inlineView(markup, dependencies, dependencyBaseUrl) {\r\n    return useViewStrategy(new InlineViewStrategy(markup, dependencies, dependencyBaseUrl));\r\n}\r\nfunction noView(targetOrDependencies, dependencyBaseUrl) {\r\n    var target;\r\n    var dependencies;\r\n    if (typeof targetOrDependencies === 'function') {\r\n        target = targetOrDependencies;\r\n    }\r\n    else {\r\n        dependencies = targetOrDependencies;\r\n        target = undefined;\r\n    }\r\n    var deco = function (t) {\r\n        aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].define(ViewLocator.viewStrategyMetadataKey, new NoViewStrategy(dependencies, dependencyBaseUrl), t);\r\n    };\r\n    return target ? deco(target) : deco;\r\n}\r\nfunction view(templateOrConfig) {\r\n    return function (target) {\r\n        target.$view = templateOrConfig;\r\n    };\r\n}\r\nfunction elementConfig(target) {\r\n    var deco = function (t) {\r\n        aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].define(aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].resource, new ElementConfigResource(), t);\r\n    };\r\n    return target ? deco(target) : deco;\r\n}\r\nfunction viewResources() {\r\n    var resources = [];\r\n    for (var _i = 0; _i < arguments.length; _i++) {\r\n        resources[_i] = arguments[_i];\r\n    }\r\n    return function (target) {\r\n        aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].define(ViewEngine.viewModelRequireMetadataKey, resources, target);\r\n    };\r\n}\n\nvar TemplatingEngine = (function () {\r\n    function TemplatingEngine(container, moduleAnalyzer, viewCompiler, compositionEngine) {\r\n        this._container = container;\r\n        this._moduleAnalyzer = moduleAnalyzer;\r\n        this._viewCompiler = viewCompiler;\r\n        this._compositionEngine = compositionEngine;\r\n        container.registerInstance(Animator, Animator.instance = new Animator());\r\n    }\r\n    TemplatingEngine.prototype.configureAnimator = function (animator) {\r\n        this._container.unregister(Animator);\r\n        this._container.registerInstance(Animator, Animator.instance = animator);\r\n    };\r\n    TemplatingEngine.prototype.compose = function (context) {\r\n        return this._compositionEngine.compose(context);\r\n    };\r\n    TemplatingEngine.prototype.enhance = function (instruction) {\r\n        if (instruction instanceof aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].Element) {\r\n            instruction = { element: instruction };\r\n        }\r\n        var compilerInstructions = { letExpressions: [] };\r\n        var resources = instruction.resources || this._container.get(ViewResources);\r\n        this._viewCompiler._compileNode(instruction.element, resources, compilerInstructions, instruction.element.parentNode, 'root', true);\r\n        var factory = new ViewFactory(instruction.element, compilerInstructions, resources);\r\n        var container = instruction.container || this._container.createChild();\r\n        var view = factory.create(container, BehaviorInstruction.enhance());\r\n        view.bind(instruction.bindingContext || {}, instruction.overrideContext);\r\n        view.firstChild = view.lastChild = view.fragment;\r\n        view.fragment = aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].createDocumentFragment();\r\n        view.attached();\r\n        return view;\r\n    };\r\n    TemplatingEngine.inject = [aurelia_dependency_injection__WEBPACK_IMPORTED_MODULE_6__[\"Container\"], ModuleAnalyzer, ViewCompiler, CompositionEngine];\r\n    return TemplatingEngine;\r\n}());\n\n\n//# sourceMappingURL=aurelia-templating.js.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGlqOC5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy9hdXJlbGlhLXRlbXBsYXRpbmcvZGlzdC9uYXRpdmUtbW9kdWxlcy9hdXJlbGlhLXRlbXBsYXRpbmcuanM/ODYyOCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBET00sIEZFQVRVUkUsIFBMQVRGT1JNIH0gZnJvbSAnYXVyZWxpYS1wYWwnO1xuaW1wb3J0IHsgVGVtcGxhdGVSZWdpc3RyeUVudHJ5LCBMb2FkZXIgfSBmcm9tICdhdXJlbGlhLWxvYWRlcic7XG5pbXBvcnQgeyBtZXRhZGF0YSwgT3JpZ2luLCBwcm90b2NvbCB9IGZyb20gJ2F1cmVsaWEtbWV0YWRhdGEnO1xuaW1wb3J0IHsgcmVsYXRpdmVUb0ZpbGUgfSBmcm9tICdhdXJlbGlhLXBhdGgnO1xuaW1wb3J0ICogYXMgTG9nTWFuYWdlciBmcm9tICdhdXJlbGlhLWxvZ2dpbmcnO1xuaW1wb3J0IHsgc3Vic2NyaWJlckNvbGxlY3Rpb24sIGJpbmRpbmdNb2RlLCBjcmVhdGVPdmVycmlkZUNvbnRleHQsIFZhbHVlQ29udmVydGVyUmVzb3VyY2UsIEJpbmRpbmdCZWhhdmlvclJlc291cmNlLCBPYnNlcnZlckxvY2F0b3IsIGNhbWVsQ2FzZSwgRXZlbnRNYW5hZ2VyIH0gZnJvbSAnYXVyZWxpYS1iaW5kaW5nJztcbmltcG9ydCB7IENvbnRhaW5lciwgcmVzb2x2ZXIsIGluamVjdCB9IGZyb20gJ2F1cmVsaWEtZGVwZW5kZW5jeS1pbmplY3Rpb24nO1xuaW1wb3J0IHsgVGFza1F1ZXVlIH0gZnJvbSAnYXVyZWxpYS10YXNrLXF1ZXVlJztcblxudmFyIEVsZW1lbnRFdmVudHMgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gRWxlbWVudEV2ZW50cyhlbGVtZW50KSB7XHJcbiAgICAgICAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDtcclxuICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbnMgPSB7fTtcclxuICAgIH1cclxuICAgIEVsZW1lbnRFdmVudHMucHJvdG90eXBlLl9lbnF1ZXVlSGFuZGxlciA9IGZ1bmN0aW9uIChoYW5kbGVyKSB7XHJcbiAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25zW2hhbmRsZXIuZXZlbnROYW1lXSA9IHRoaXMuc3Vic2NyaXB0aW9uc1toYW5kbGVyLmV2ZW50TmFtZV0gfHwgW107XHJcbiAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25zW2hhbmRsZXIuZXZlbnROYW1lXS5wdXNoKGhhbmRsZXIpO1xyXG4gICAgfTtcclxuICAgIEVsZW1lbnRFdmVudHMucHJvdG90eXBlLl9kZXF1ZXVlSGFuZGxlciA9IGZ1bmN0aW9uIChoYW5kbGVyKSB7XHJcbiAgICAgICAgdmFyIGluZGV4O1xyXG4gICAgICAgIHZhciBzdWJzY3JpcHRpb25zID0gdGhpcy5zdWJzY3JpcHRpb25zW2hhbmRsZXIuZXZlbnROYW1lXTtcclxuICAgICAgICBpZiAoc3Vic2NyaXB0aW9ucykge1xyXG4gICAgICAgICAgICBpbmRleCA9IHN1YnNjcmlwdGlvbnMuaW5kZXhPZihoYW5kbGVyKTtcclxuICAgICAgICAgICAgaWYgKGluZGV4ID4gLTEpIHtcclxuICAgICAgICAgICAgICAgIHN1YnNjcmlwdGlvbnMuc3BsaWNlKGluZGV4LCAxKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gaGFuZGxlcjtcclxuICAgIH07XHJcbiAgICBFbGVtZW50RXZlbnRzLnByb3RvdHlwZS5wdWJsaXNoID0gZnVuY3Rpb24gKGV2ZW50TmFtZSwgZGV0YWlsLCBidWJibGVzLCBjYW5jZWxhYmxlKSB7XHJcbiAgICAgICAgaWYgKGRldGFpbCA9PT0gdm9pZCAwKSB7IGRldGFpbCA9IHt9OyB9XHJcbiAgICAgICAgaWYgKGJ1YmJsZXMgPT09IHZvaWQgMCkgeyBidWJibGVzID0gdHJ1ZTsgfVxyXG4gICAgICAgIGlmIChjYW5jZWxhYmxlID09PSB2b2lkIDApIHsgY2FuY2VsYWJsZSA9IHRydWU7IH1cclxuICAgICAgICB2YXIgZXZlbnQgPSBET00uY3JlYXRlQ3VzdG9tRXZlbnQoZXZlbnROYW1lLCB7IGNhbmNlbGFibGU6IGNhbmNlbGFibGUsIGJ1YmJsZXM6IGJ1YmJsZXMsIGRldGFpbDogZGV0YWlsIH0pO1xyXG4gICAgICAgIHRoaXMuZWxlbWVudC5kaXNwYXRjaEV2ZW50KGV2ZW50KTtcclxuICAgIH07XHJcbiAgICBFbGVtZW50RXZlbnRzLnByb3RvdHlwZS5zdWJzY3JpYmUgPSBmdW5jdGlvbiAoZXZlbnROYW1lLCBoYW5kbGVyLCBjYXB0dXJlT3JPcHRpb25zKSB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBoYW5kbGVyID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgIGlmIChjYXB0dXJlT3JPcHRpb25zID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIGNhcHR1cmVPck9wdGlvbnMgPSBFbGVtZW50RXZlbnRzLmRlZmF1bHRMaXN0ZW5lck9wdGlvbnM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIGV2ZW50SGFuZGxlciA9IG5ldyBFdmVudEhhbmRsZXJJbXBsKHRoaXMsIGV2ZW50TmFtZSwgaGFuZGxlciwgY2FwdHVyZU9yT3B0aW9ucywgZmFsc2UpO1xyXG4gICAgICAgICAgICByZXR1cm4gZXZlbnRIYW5kbGVyO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgfTtcclxuICAgIEVsZW1lbnRFdmVudHMucHJvdG90eXBlLnN1YnNjcmliZU9uY2UgPSBmdW5jdGlvbiAoZXZlbnROYW1lLCBoYW5kbGVyLCBjYXB0dXJlT3JPcHRpb25zKSB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBoYW5kbGVyID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgIGlmIChjYXB0dXJlT3JPcHRpb25zID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIGNhcHR1cmVPck9wdGlvbnMgPSBFbGVtZW50RXZlbnRzLmRlZmF1bHRMaXN0ZW5lck9wdGlvbnM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIGV2ZW50SGFuZGxlciA9IG5ldyBFdmVudEhhbmRsZXJJbXBsKHRoaXMsIGV2ZW50TmFtZSwgaGFuZGxlciwgY2FwdHVyZU9yT3B0aW9ucywgdHJ1ZSk7XHJcbiAgICAgICAgICAgIHJldHVybiBldmVudEhhbmRsZXI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbiAgICB9O1xyXG4gICAgRWxlbWVudEV2ZW50cy5wcm90b3R5cGUuZGlzcG9zZSA9IGZ1bmN0aW9uIChldmVudE5hbWUpIHtcclxuICAgICAgICBpZiAoZXZlbnROYW1lICYmIHR5cGVvZiBldmVudE5hbWUgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgIHZhciBzdWJzY3JpcHRpb25zID0gdGhpcy5zdWJzY3JpcHRpb25zW2V2ZW50TmFtZV07XHJcbiAgICAgICAgICAgIGlmIChzdWJzY3JpcHRpb25zKSB7XHJcbiAgICAgICAgICAgICAgICB3aGlsZSAoc3Vic2NyaXB0aW9ucy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc3Vic2NyaXB0aW9uID0gc3Vic2NyaXB0aW9ucy5wb3AoKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc3Vic2NyaXB0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN1YnNjcmlwdGlvbi5kaXNwb3NlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmRpc3Bvc2VBbGwoKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgRWxlbWVudEV2ZW50cy5wcm90b3R5cGUuZGlzcG9zZUFsbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBmb3IgKHZhciBrZXkgaW4gdGhpcy5zdWJzY3JpcHRpb25zKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGlzcG9zZShrZXkpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBFbGVtZW50RXZlbnRzLmRlZmF1bHRMaXN0ZW5lck9wdGlvbnMgPSB0cnVlO1xyXG4gICAgcmV0dXJuIEVsZW1lbnRFdmVudHM7XHJcbn0oKSk7XHJcbnZhciBFdmVudEhhbmRsZXJJbXBsID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIEV2ZW50SGFuZGxlckltcGwob3duZXIsIGV2ZW50TmFtZSwgaGFuZGxlciwgY2FwdHVyZU9yT3B0aW9ucywgb25jZSkge1xyXG4gICAgICAgIHRoaXMub3duZXIgPSBvd25lcjtcclxuICAgICAgICB0aGlzLmV2ZW50TmFtZSA9IGV2ZW50TmFtZTtcclxuICAgICAgICB0aGlzLmhhbmRsZXIgPSBoYW5kbGVyO1xyXG4gICAgICAgIHRoaXMuY2FwdHVyZSA9IHR5cGVvZiBjYXB0dXJlT3JPcHRpb25zID09PSAnYm9vbGVhbicgPyBjYXB0dXJlT3JPcHRpb25zIDogY2FwdHVyZU9yT3B0aW9ucy5jYXB0dXJlO1xyXG4gICAgICAgIHRoaXMuYnViYmxlcyA9ICF0aGlzLmNhcHR1cmU7XHJcbiAgICAgICAgdGhpcy5jYXB0dXJlT3JPcHRpb25zID0gY2FwdHVyZU9yT3B0aW9ucztcclxuICAgICAgICB0aGlzLm9uY2UgPSBvbmNlO1xyXG4gICAgICAgIG93bmVyLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIHRoaXMsIGNhcHR1cmVPck9wdGlvbnMpO1xyXG4gICAgICAgIG93bmVyLl9lbnF1ZXVlSGFuZGxlcih0aGlzKTtcclxuICAgIH1cclxuICAgIEV2ZW50SGFuZGxlckltcGwucHJvdG90eXBlLmhhbmRsZUV2ZW50ID0gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICB2YXIgZm4gPSB0aGlzLmhhbmRsZXI7XHJcbiAgICAgICAgZm4oZSk7XHJcbiAgICAgICAgaWYgKHRoaXMub25jZSkge1xyXG4gICAgICAgICAgICB0aGlzLmRpc3Bvc2UoKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgRXZlbnRIYW5kbGVySW1wbC5wcm90b3R5cGUuZGlzcG9zZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLm93bmVyLmVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcih0aGlzLmV2ZW50TmFtZSwgdGhpcywgdGhpcy5jYXB0dXJlT3JPcHRpb25zKTtcclxuICAgICAgICB0aGlzLm93bmVyLl9kZXF1ZXVlSGFuZGxlcih0aGlzKTtcclxuICAgICAgICB0aGlzLm93bmVyID0gdGhpcy5oYW5kbGVyID0gbnVsbDtcclxuICAgIH07XHJcbiAgICByZXR1cm4gRXZlbnRIYW5kbGVySW1wbDtcclxufSgpKTtcblxudmFyIFJlc291cmNlTG9hZENvbnRleHQgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gUmVzb3VyY2VMb2FkQ29udGV4dCgpIHtcclxuICAgICAgICB0aGlzLmRlcGVuZGVuY2llcyA9IHt9O1xyXG4gICAgfVxyXG4gICAgUmVzb3VyY2VMb2FkQ29udGV4dC5wcm90b3R5cGUuYWRkRGVwZW5kZW5jeSA9IGZ1bmN0aW9uICh1cmwpIHtcclxuICAgICAgICB0aGlzLmRlcGVuZGVuY2llc1t1cmxdID0gdHJ1ZTtcclxuICAgIH07XHJcbiAgICBSZXNvdXJjZUxvYWRDb250ZXh0LnByb3RvdHlwZS5oYXNEZXBlbmRlbmN5ID0gZnVuY3Rpb24gKHVybCkge1xyXG4gICAgICAgIHJldHVybiB1cmwgaW4gdGhpcy5kZXBlbmRlbmNpZXM7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIFJlc291cmNlTG9hZENvbnRleHQ7XHJcbn0oKSk7XHJcbnZhciBWaWV3Q29tcGlsZUluc3RydWN0aW9uID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIFZpZXdDb21waWxlSW5zdHJ1Y3Rpb24odGFyZ2V0U2hhZG93RE9NLCBjb21waWxlU3Vycm9nYXRlKSB7XHJcbiAgICAgICAgaWYgKHRhcmdldFNoYWRvd0RPTSA9PT0gdm9pZCAwKSB7IHRhcmdldFNoYWRvd0RPTSA9IGZhbHNlOyB9XHJcbiAgICAgICAgaWYgKGNvbXBpbGVTdXJyb2dhdGUgPT09IHZvaWQgMCkgeyBjb21waWxlU3Vycm9nYXRlID0gZmFsc2U7IH1cclxuICAgICAgICB0aGlzLnRhcmdldFNoYWRvd0RPTSA9IHRhcmdldFNoYWRvd0RPTTtcclxuICAgICAgICB0aGlzLmNvbXBpbGVTdXJyb2dhdGUgPSBjb21waWxlU3Vycm9nYXRlO1xyXG4gICAgICAgIHRoaXMuYXNzb2NpYXRlZE1vZHVsZUlkID0gbnVsbDtcclxuICAgIH1cclxuICAgIFZpZXdDb21waWxlSW5zdHJ1Y3Rpb24ubm9ybWFsID0gbmV3IFZpZXdDb21waWxlSW5zdHJ1Y3Rpb24oKTtcclxuICAgIHJldHVybiBWaWV3Q29tcGlsZUluc3RydWN0aW9uO1xyXG59KCkpO1xyXG52YXIgQmVoYXZpb3JJbnN0cnVjdGlvbiA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBCZWhhdmlvckluc3RydWN0aW9uKCkge1xyXG4gICAgfVxyXG4gICAgQmVoYXZpb3JJbnN0cnVjdGlvbi5lbmhhbmNlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBpbnN0cnVjdGlvbiA9IG5ldyBCZWhhdmlvckluc3RydWN0aW9uKCk7XHJcbiAgICAgICAgaW5zdHJ1Y3Rpb24uZW5oYW5jZSA9IHRydWU7XHJcbiAgICAgICAgcmV0dXJuIGluc3RydWN0aW9uO1xyXG4gICAgfTtcclxuICAgIEJlaGF2aW9ySW5zdHJ1Y3Rpb24udW5pdFRlc3QgPSBmdW5jdGlvbiAodHlwZSwgYXR0cmlidXRlcykge1xyXG4gICAgICAgIHZhciBpbnN0cnVjdGlvbiA9IG5ldyBCZWhhdmlvckluc3RydWN0aW9uKCk7XHJcbiAgICAgICAgaW5zdHJ1Y3Rpb24udHlwZSA9IHR5cGU7XHJcbiAgICAgICAgaW5zdHJ1Y3Rpb24uYXR0cmlidXRlcyA9IGF0dHJpYnV0ZXMgfHwge307XHJcbiAgICAgICAgcmV0dXJuIGluc3RydWN0aW9uO1xyXG4gICAgfTtcclxuICAgIEJlaGF2aW9ySW5zdHJ1Y3Rpb24uZWxlbWVudCA9IGZ1bmN0aW9uIChub2RlLCB0eXBlKSB7XHJcbiAgICAgICAgdmFyIGluc3RydWN0aW9uID0gbmV3IEJlaGF2aW9ySW5zdHJ1Y3Rpb24oKTtcclxuICAgICAgICBpbnN0cnVjdGlvbi50eXBlID0gdHlwZTtcclxuICAgICAgICBpbnN0cnVjdGlvbi5hdHRyaWJ1dGVzID0ge307XHJcbiAgICAgICAgaW5zdHJ1Y3Rpb24uYW5jaG9ySXNDb250YWluZXIgPSAhKG5vZGUuaGFzQXR0cmlidXRlKCdjb250YWluZXJsZXNzJykgfHwgdHlwZS5jb250YWluZXJsZXNzKTtcclxuICAgICAgICBpbnN0cnVjdGlvbi5pbml0aWF0ZWRCeUJlaGF2aW9yID0gdHJ1ZTtcclxuICAgICAgICByZXR1cm4gaW5zdHJ1Y3Rpb247XHJcbiAgICB9O1xyXG4gICAgQmVoYXZpb3JJbnN0cnVjdGlvbi5hdHRyaWJ1dGUgPSBmdW5jdGlvbiAoYXR0ck5hbWUsIHR5cGUpIHtcclxuICAgICAgICB2YXIgaW5zdHJ1Y3Rpb24gPSBuZXcgQmVoYXZpb3JJbnN0cnVjdGlvbigpO1xyXG4gICAgICAgIGluc3RydWN0aW9uLmF0dHJOYW1lID0gYXR0ck5hbWU7XHJcbiAgICAgICAgaW5zdHJ1Y3Rpb24udHlwZSA9IHR5cGUgfHwgbnVsbDtcclxuICAgICAgICBpbnN0cnVjdGlvbi5hdHRyaWJ1dGVzID0ge307XHJcbiAgICAgICAgcmV0dXJuIGluc3RydWN0aW9uO1xyXG4gICAgfTtcclxuICAgIEJlaGF2aW9ySW5zdHJ1Y3Rpb24uZHluYW1pYyA9IGZ1bmN0aW9uIChob3N0LCB2aWV3TW9kZWwsIHZpZXdGYWN0b3J5KSB7XHJcbiAgICAgICAgdmFyIGluc3RydWN0aW9uID0gbmV3IEJlaGF2aW9ySW5zdHJ1Y3Rpb24oKTtcclxuICAgICAgICBpbnN0cnVjdGlvbi5ob3N0ID0gaG9zdDtcclxuICAgICAgICBpbnN0cnVjdGlvbi52aWV3TW9kZWwgPSB2aWV3TW9kZWw7XHJcbiAgICAgICAgaW5zdHJ1Y3Rpb24udmlld0ZhY3RvcnkgPSB2aWV3RmFjdG9yeTtcclxuICAgICAgICBpbnN0cnVjdGlvbi5pbmhlcml0QmluZGluZ0NvbnRleHQgPSB0cnVlO1xyXG4gICAgICAgIHJldHVybiBpbnN0cnVjdGlvbjtcclxuICAgIH07XHJcbiAgICBCZWhhdmlvckluc3RydWN0aW9uLm5vcm1hbCA9IG5ldyBCZWhhdmlvckluc3RydWN0aW9uKCk7XHJcbiAgICByZXR1cm4gQmVoYXZpb3JJbnN0cnVjdGlvbjtcclxufSgpKTtcclxudmFyIGJpUHJvdG8gPSBCZWhhdmlvckluc3RydWN0aW9uLnByb3RvdHlwZTtcclxuYmlQcm90by5pbml0aWF0ZWRCeUJlaGF2aW9yID0gZmFsc2U7XHJcbmJpUHJvdG8uZW5oYW5jZSA9IGZhbHNlO1xyXG5iaVByb3RvLnBhcnRSZXBsYWNlbWVudHMgPSBudWxsO1xyXG5iaVByb3RvLnZpZXdGYWN0b3J5ID0gbnVsbDtcclxuYmlQcm90by5vcmlnaW5hbEF0dHJOYW1lID0gbnVsbDtcclxuYmlQcm90by5za2lwQ29udGVudFByb2Nlc3NpbmcgPSBmYWxzZTtcclxuYmlQcm90by5jb250ZW50RmFjdG9yeSA9IG51bGw7XHJcbmJpUHJvdG8udmlld01vZGVsID0gbnVsbDtcclxuYmlQcm90by5hbmNob3JJc0NvbnRhaW5lciA9IGZhbHNlO1xyXG5iaVByb3RvLmhvc3QgPSBudWxsO1xyXG5iaVByb3RvLmF0dHJpYnV0ZXMgPSBudWxsO1xyXG5iaVByb3RvLnR5cGUgPSBudWxsO1xyXG5iaVByb3RvLmF0dHJOYW1lID0gbnVsbDtcclxuYmlQcm90by5pbmhlcml0QmluZGluZ0NvbnRleHQgPSBmYWxzZTtcclxudmFyIFRhcmdldEluc3RydWN0aW9uID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIFRhcmdldEluc3RydWN0aW9uKCkge1xyXG4gICAgfVxyXG4gICAgVGFyZ2V0SW5zdHJ1Y3Rpb24uc2hhZG93U2xvdCA9IGZ1bmN0aW9uIChwYXJlbnRJbmplY3RvcklkKSB7XHJcbiAgICAgICAgdmFyIGluc3RydWN0aW9uID0gbmV3IFRhcmdldEluc3RydWN0aW9uKCk7XHJcbiAgICAgICAgaW5zdHJ1Y3Rpb24ucGFyZW50SW5qZWN0b3JJZCA9IHBhcmVudEluamVjdG9ySWQ7XHJcbiAgICAgICAgaW5zdHJ1Y3Rpb24uc2hhZG93U2xvdCA9IHRydWU7XHJcbiAgICAgICAgcmV0dXJuIGluc3RydWN0aW9uO1xyXG4gICAgfTtcclxuICAgIFRhcmdldEluc3RydWN0aW9uLmNvbnRlbnRFeHByZXNzaW9uID0gZnVuY3Rpb24gKGV4cHJlc3Npb24pIHtcclxuICAgICAgICB2YXIgaW5zdHJ1Y3Rpb24gPSBuZXcgVGFyZ2V0SW5zdHJ1Y3Rpb24oKTtcclxuICAgICAgICBpbnN0cnVjdGlvbi5jb250ZW50RXhwcmVzc2lvbiA9IGV4cHJlc3Npb247XHJcbiAgICAgICAgcmV0dXJuIGluc3RydWN0aW9uO1xyXG4gICAgfTtcclxuICAgIFRhcmdldEluc3RydWN0aW9uLmxldEVsZW1lbnQgPSBmdW5jdGlvbiAoZXhwcmVzc2lvbnMpIHtcclxuICAgICAgICB2YXIgaW5zdHJ1Y3Rpb24gPSBuZXcgVGFyZ2V0SW5zdHJ1Y3Rpb24oKTtcclxuICAgICAgICBpbnN0cnVjdGlvbi5leHByZXNzaW9ucyA9IGV4cHJlc3Npb25zO1xyXG4gICAgICAgIGluc3RydWN0aW9uLmxldEVsZW1lbnQgPSB0cnVlO1xyXG4gICAgICAgIHJldHVybiBpbnN0cnVjdGlvbjtcclxuICAgIH07XHJcbiAgICBUYXJnZXRJbnN0cnVjdGlvbi5saWZ0aW5nID0gZnVuY3Rpb24gKHBhcmVudEluamVjdG9ySWQsIGxpZnRpbmdJbnN0cnVjdGlvbikge1xyXG4gICAgICAgIHZhciBpbnN0cnVjdGlvbiA9IG5ldyBUYXJnZXRJbnN0cnVjdGlvbigpO1xyXG4gICAgICAgIGluc3RydWN0aW9uLnBhcmVudEluamVjdG9ySWQgPSBwYXJlbnRJbmplY3RvcklkO1xyXG4gICAgICAgIGluc3RydWN0aW9uLmV4cHJlc3Npb25zID0gVGFyZ2V0SW5zdHJ1Y3Rpb24ubm9FeHByZXNzaW9ucztcclxuICAgICAgICBpbnN0cnVjdGlvbi5iZWhhdmlvckluc3RydWN0aW9ucyA9IFtsaWZ0aW5nSW5zdHJ1Y3Rpb25dO1xyXG4gICAgICAgIGluc3RydWN0aW9uLnZpZXdGYWN0b3J5ID0gbGlmdGluZ0luc3RydWN0aW9uLnZpZXdGYWN0b3J5O1xyXG4gICAgICAgIGluc3RydWN0aW9uLnByb3ZpZGVycyA9IFtsaWZ0aW5nSW5zdHJ1Y3Rpb24udHlwZS50YXJnZXRdO1xyXG4gICAgICAgIGluc3RydWN0aW9uLmxpZnRpbmcgPSB0cnVlO1xyXG4gICAgICAgIHJldHVybiBpbnN0cnVjdGlvbjtcclxuICAgIH07XHJcbiAgICBUYXJnZXRJbnN0cnVjdGlvbi5ub3JtYWwgPSBmdW5jdGlvbiAoaW5qZWN0b3JJZCwgcGFyZW50SW5qZWN0b3JJZCwgcHJvdmlkZXJzLCBiZWhhdmlvckluc3RydWN0aW9ucywgZXhwcmVzc2lvbnMsIGVsZW1lbnRJbnN0cnVjdGlvbikge1xyXG4gICAgICAgIHZhciBpbnN0cnVjdGlvbiA9IG5ldyBUYXJnZXRJbnN0cnVjdGlvbigpO1xyXG4gICAgICAgIGluc3RydWN0aW9uLmluamVjdG9ySWQgPSBpbmplY3RvcklkO1xyXG4gICAgICAgIGluc3RydWN0aW9uLnBhcmVudEluamVjdG9ySWQgPSBwYXJlbnRJbmplY3RvcklkO1xyXG4gICAgICAgIGluc3RydWN0aW9uLnByb3ZpZGVycyA9IHByb3ZpZGVycztcclxuICAgICAgICBpbnN0cnVjdGlvbi5iZWhhdmlvckluc3RydWN0aW9ucyA9IGJlaGF2aW9ySW5zdHJ1Y3Rpb25zO1xyXG4gICAgICAgIGluc3RydWN0aW9uLmV4cHJlc3Npb25zID0gZXhwcmVzc2lvbnM7XHJcbiAgICAgICAgaW5zdHJ1Y3Rpb24uYW5jaG9ySXNDb250YWluZXIgPSBlbGVtZW50SW5zdHJ1Y3Rpb24gPyBlbGVtZW50SW5zdHJ1Y3Rpb24uYW5jaG9ySXNDb250YWluZXIgOiB0cnVlO1xyXG4gICAgICAgIGluc3RydWN0aW9uLmVsZW1lbnRJbnN0cnVjdGlvbiA9IGVsZW1lbnRJbnN0cnVjdGlvbjtcclxuICAgICAgICByZXR1cm4gaW5zdHJ1Y3Rpb247XHJcbiAgICB9O1xyXG4gICAgVGFyZ2V0SW5zdHJ1Y3Rpb24uc3Vycm9nYXRlID0gZnVuY3Rpb24gKHByb3ZpZGVycywgYmVoYXZpb3JJbnN0cnVjdGlvbnMsIGV4cHJlc3Npb25zLCB2YWx1ZXMpIHtcclxuICAgICAgICB2YXIgaW5zdHJ1Y3Rpb24gPSBuZXcgVGFyZ2V0SW5zdHJ1Y3Rpb24oKTtcclxuICAgICAgICBpbnN0cnVjdGlvbi5leHByZXNzaW9ucyA9IGV4cHJlc3Npb25zO1xyXG4gICAgICAgIGluc3RydWN0aW9uLmJlaGF2aW9ySW5zdHJ1Y3Rpb25zID0gYmVoYXZpb3JJbnN0cnVjdGlvbnM7XHJcbiAgICAgICAgaW5zdHJ1Y3Rpb24ucHJvdmlkZXJzID0gcHJvdmlkZXJzO1xyXG4gICAgICAgIGluc3RydWN0aW9uLnZhbHVlcyA9IHZhbHVlcztcclxuICAgICAgICByZXR1cm4gaW5zdHJ1Y3Rpb247XHJcbiAgICB9O1xyXG4gICAgVGFyZ2V0SW5zdHJ1Y3Rpb24ubm9FeHByZXNzaW9ucyA9IE9iamVjdC5mcmVlemUoW10pO1xyXG4gICAgcmV0dXJuIFRhcmdldEluc3RydWN0aW9uO1xyXG59KCkpO1xyXG52YXIgdGlQcm90byA9IFRhcmdldEluc3RydWN0aW9uLnByb3RvdHlwZTtcclxudGlQcm90by5pbmplY3RvcklkID0gbnVsbDtcclxudGlQcm90by5wYXJlbnRJbmplY3RvcklkID0gbnVsbDtcclxudGlQcm90by5zaGFkb3dTbG90ID0gZmFsc2U7XHJcbnRpUHJvdG8uc2xvdE5hbWUgPSBudWxsO1xyXG50aVByb3RvLnNsb3RGYWxsYmFja0ZhY3RvcnkgPSBudWxsO1xyXG50aVByb3RvLmNvbnRlbnRFeHByZXNzaW9uID0gbnVsbDtcclxudGlQcm90by5sZXRFbGVtZW50ID0gZmFsc2U7XHJcbnRpUHJvdG8uZXhwcmVzc2lvbnMgPSBudWxsO1xyXG50aVByb3RvLmV4cHJlc3Npb25zID0gbnVsbDtcclxudGlQcm90by5wcm92aWRlcnMgPSBudWxsO1xyXG50aVByb3RvLnZpZXdGYWN0b3J5ID0gbnVsbDtcclxudGlQcm90by5hbmNob3JJc0NvbnRhaW5lciA9IGZhbHNlO1xyXG50aVByb3RvLmVsZW1lbnRJbnN0cnVjdGlvbiA9IG51bGw7XHJcbnRpUHJvdG8ubGlmdGluZyA9IGZhbHNlO1xyXG50aVByb3RvLnZhbHVlcyA9IG51bGw7XG5cbi8qISAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG5Db3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi5cclxuXHJcblBlcm1pc3Npb24gdG8gdXNlLCBjb3B5LCBtb2RpZnksIGFuZC9vciBkaXN0cmlidXRlIHRoaXMgc29mdHdhcmUgZm9yIGFueVxyXG5wdXJwb3NlIHdpdGggb3Igd2l0aG91dCBmZWUgaXMgaGVyZWJ5IGdyYW50ZWQuXHJcblxyXG5USEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiIEFORCBUSEUgQVVUSE9SIERJU0NMQUlNUyBBTEwgV0FSUkFOVElFUyBXSVRIXHJcblJFR0FSRCBUTyBUSElTIFNPRlRXQVJFIElOQ0xVRElORyBBTEwgSU1QTElFRCBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWVxyXG5BTkQgRklUTkVTUy4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUiBCRSBMSUFCTEUgRk9SIEFOWSBTUEVDSUFMLCBESVJFQ1QsXHJcbklORElSRUNULCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVMgT1IgQU5ZIERBTUFHRVMgV0hBVFNPRVZFUiBSRVNVTFRJTkcgRlJPTVxyXG5MT1NTIE9GIFVTRSwgREFUQSBPUiBQUk9GSVRTLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgTkVHTElHRU5DRSBPUlxyXG5PVEhFUiBUT1JUSU9VUyBBQ1RJT04sIEFSSVNJTkcgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgVVNFIE9SXHJcblBFUkZPUk1BTkNFIE9GIFRISVMgU09GVFdBUkUuXHJcbioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqICovXHJcblxyXG5mdW5jdGlvbiBfX2RlY29yYXRlKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKSB7XHJcbiAgICB2YXIgYyA9IGFyZ3VtZW50cy5sZW5ndGgsIHIgPSBjIDwgMyA/IHRhcmdldCA6IGRlc2MgPT09IG51bGwgPyBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih0YXJnZXQsIGtleSkgOiBkZXNjLCBkO1xyXG4gICAgaWYgKHR5cGVvZiBSZWZsZWN0ID09PSBcIm9iamVjdFwiICYmIHR5cGVvZiBSZWZsZWN0LmRlY29yYXRlID09PSBcImZ1bmN0aW9uXCIpIHIgPSBSZWZsZWN0LmRlY29yYXRlKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKTtcclxuICAgIGVsc2UgZm9yICh2YXIgaSA9IGRlY29yYXRvcnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIGlmIChkID0gZGVjb3JhdG9yc1tpXSkgciA9IChjIDwgMyA/IGQocikgOiBjID4gMyA/IGQodGFyZ2V0LCBrZXksIHIpIDogZCh0YXJnZXQsIGtleSkpIHx8IHI7XHJcbiAgICByZXR1cm4gYyA+IDMgJiYgciAmJiBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHIpLCByO1xyXG59XG5cbnZhciBjYXBpdGFsTWF0Y2hlciA9IC8oW0EtWl0pL2c7XHJcbmZ1bmN0aW9uIGFkZEh5cGhlbkFuZExvd2VyKGNoYXIpIHtcclxuICAgIHJldHVybiAnLScgKyBjaGFyLnRvTG93ZXJDYXNlKCk7XHJcbn1cclxuZnVuY3Rpb24gX2h5cGhlbmF0ZShuYW1lKSB7XHJcbiAgICByZXR1cm4gKG5hbWUuY2hhckF0KDApLnRvTG93ZXJDYXNlKCkgKyBuYW1lLnNsaWNlKDEpKS5yZXBsYWNlKGNhcGl0YWxNYXRjaGVyLCBhZGRIeXBoZW5BbmRMb3dlcik7XHJcbn1cclxuZnVuY3Rpb24gX2lzQWxsV2hpdGVzcGFjZShub2RlKSB7XHJcbiAgICByZXR1cm4gIShub2RlLmF1SW50ZXJwb2xhdGlvblRhcmdldCB8fCAoL1teXFx0XFxuXFxyIF0vLnRlc3Qobm9kZS50ZXh0Q29udGVudCkpKTtcclxufVxuXG52YXIgQmVoYXZpb3JQcm9wZXJ0eU9ic2VydmVyID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIEJlaGF2aW9yUHJvcGVydHlPYnNlcnZlcih0YXNrUXVldWUsIG9iaiwgcHJvcGVydHlOYW1lLCBzZWxmU3Vic2NyaWJlciwgaW5pdGlhbFZhbHVlKSB7XHJcbiAgICAgICAgdGhpcy50YXNrUXVldWUgPSB0YXNrUXVldWU7XHJcbiAgICAgICAgdGhpcy5vYmogPSBvYmo7XHJcbiAgICAgICAgdGhpcy5wcm9wZXJ0eU5hbWUgPSBwcm9wZXJ0eU5hbWU7XHJcbiAgICAgICAgdGhpcy5ub3RxdWV1ZWQgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMucHVibGlzaGluZyA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuc2VsZlN1YnNjcmliZXIgPSBzZWxmU3Vic2NyaWJlcjtcclxuICAgICAgICB0aGlzLmN1cnJlbnRWYWx1ZSA9IHRoaXMub2xkVmFsdWUgPSBpbml0aWFsVmFsdWU7XHJcbiAgICB9XHJcbiAgICBCZWhhdmlvclByb3BlcnR5T2JzZXJ2ZXIucHJvdG90eXBlLmdldFZhbHVlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRWYWx1ZTtcclxuICAgIH07XHJcbiAgICBCZWhhdmlvclByb3BlcnR5T2JzZXJ2ZXIucHJvdG90eXBlLnNldFZhbHVlID0gZnVuY3Rpb24gKG5ld1ZhbHVlKSB7XHJcbiAgICAgICAgdmFyIG9sZFZhbHVlID0gdGhpcy5jdXJyZW50VmFsdWU7XHJcbiAgICAgICAgaWYgKCFPYmplY3QuaXMobmV3VmFsdWUsIG9sZFZhbHVlKSkge1xyXG4gICAgICAgICAgICB0aGlzLm9sZFZhbHVlID0gb2xkVmFsdWU7XHJcbiAgICAgICAgICAgIHRoaXMuY3VycmVudFZhbHVlID0gbmV3VmFsdWU7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnB1Ymxpc2hpbmcgJiYgdGhpcy5ub3RxdWV1ZWQpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnRhc2tRdWV1ZS5mbHVzaGluZykge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2FsbCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ub3RxdWV1ZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnRhc2tRdWV1ZS5xdWV1ZU1pY3JvVGFzayh0aGlzKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBCZWhhdmlvclByb3BlcnR5T2JzZXJ2ZXIucHJvdG90eXBlLmNhbGwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIG9sZFZhbHVlID0gdGhpcy5vbGRWYWx1ZTtcclxuICAgICAgICB2YXIgbmV3VmFsdWUgPSB0aGlzLmN1cnJlbnRWYWx1ZTtcclxuICAgICAgICB0aGlzLm5vdHF1ZXVlZCA9IHRydWU7XHJcbiAgICAgICAgaWYgKE9iamVjdC5pcyhuZXdWYWx1ZSwgb2xkVmFsdWUpKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuc2VsZlN1YnNjcmliZXIpIHtcclxuICAgICAgICAgICAgdGhpcy5zZWxmU3Vic2NyaWJlcihuZXdWYWx1ZSwgb2xkVmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmNhbGxTdWJzY3JpYmVycyhuZXdWYWx1ZSwgb2xkVmFsdWUpO1xyXG4gICAgICAgIHRoaXMub2xkVmFsdWUgPSBuZXdWYWx1ZTtcclxuICAgIH07XHJcbiAgICBCZWhhdmlvclByb3BlcnR5T2JzZXJ2ZXIucHJvdG90eXBlLmNhbGxTdWJzY3JpYmVycyA9IGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ01ldGhvZCBub3QgaW1wbGVtZW50ZWQuJyk7XHJcbiAgICB9O1xyXG4gICAgQmVoYXZpb3JQcm9wZXJ0eU9ic2VydmVyLnByb3RvdHlwZS5zdWJzY3JpYmUgPSBmdW5jdGlvbiAoY29udGV4dCwgY2FsbGFibGUpIHtcclxuICAgICAgICB0aGlzLmFkZFN1YnNjcmliZXIoY29udGV4dCwgY2FsbGFibGUpO1xyXG4gICAgfTtcclxuICAgIEJlaGF2aW9yUHJvcGVydHlPYnNlcnZlci5wcm90b3R5cGUuYWRkU3Vic2NyaWJlciA9IGZ1bmN0aW9uIChjb250ZXh0LCBjYWxsYWJsZSkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignTWV0aG9kIG5vdCBpbXBsZW1lbnRlZC4nKTtcclxuICAgIH07XHJcbiAgICBCZWhhdmlvclByb3BlcnR5T2JzZXJ2ZXIucHJvdG90eXBlLnVuc3Vic2NyaWJlID0gZnVuY3Rpb24gKGNvbnRleHQsIGNhbGxhYmxlKSB7XHJcbiAgICAgICAgdGhpcy5yZW1vdmVTdWJzY3JpYmVyKGNvbnRleHQsIGNhbGxhYmxlKTtcclxuICAgIH07XHJcbiAgICBCZWhhdmlvclByb3BlcnR5T2JzZXJ2ZXIucHJvdG90eXBlLnJlbW92ZVN1YnNjcmliZXIgPSBmdW5jdGlvbiAoY29udGV4dCwgY2FsbGFibGUpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ01ldGhvZCBub3QgaW1wbGVtZW50ZWQuJyk7XHJcbiAgICB9O1xyXG4gICAgQmVoYXZpb3JQcm9wZXJ0eU9ic2VydmVyID0gX19kZWNvcmF0ZShbXHJcbiAgICAgICAgc3Vic2NyaWJlckNvbGxlY3Rpb24oKVxyXG4gICAgXSwgQmVoYXZpb3JQcm9wZXJ0eU9ic2VydmVyKTtcclxuICAgIHJldHVybiBCZWhhdmlvclByb3BlcnR5T2JzZXJ2ZXI7XHJcbn0oKSk7XG5cbmZ1bmN0aW9uIGdldE9ic2VydmVyKGluc3RhbmNlLCBuYW1lKSB7XHJcbiAgICB2YXIgbG9va3VwID0gaW5zdGFuY2UuX19vYnNlcnZlcnNfXztcclxuICAgIGlmIChsb29rdXAgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgIHZhciBjdG9yID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKGluc3RhbmNlKS5jb25zdHJ1Y3RvcjtcclxuICAgICAgICB2YXIgYmVoYXZpb3IgPSBtZXRhZGF0YS5nZXQobWV0YWRhdGEucmVzb3VyY2UsIGN0b3IpO1xyXG4gICAgICAgIGlmICghYmVoYXZpb3IuaXNJbml0aWFsaXplZCkge1xyXG4gICAgICAgICAgICBiZWhhdmlvci5pbml0aWFsaXplKENvbnRhaW5lci5pbnN0YW5jZSB8fCBuZXcgQ29udGFpbmVyKCksIGluc3RhbmNlLmNvbnN0cnVjdG9yKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgbG9va3VwID0gYmVoYXZpb3Iub2JzZXJ2ZXJMb2NhdG9yLmdldE9yQ3JlYXRlT2JzZXJ2ZXJzTG9va3VwKGluc3RhbmNlKTtcclxuICAgICAgICBiZWhhdmlvci5fZW5zdXJlUHJvcGVydGllc0RlZmluZWQoaW5zdGFuY2UsIGxvb2t1cCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbG9va3VwW25hbWVdO1xyXG59XHJcbnZhciBCaW5kYWJsZVByb3BlcnR5ID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIEJpbmRhYmxlUHJvcGVydHkobmFtZU9yQ29uZmlnKSB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBuYW1lT3JDb25maWcgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgIHRoaXMubmFtZSA9IG5hbWVPckNvbmZpZztcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24odGhpcywgbmFtZU9yQ29uZmlnKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5hdHRyaWJ1dGUgPSB0aGlzLmF0dHJpYnV0ZSB8fCBfaHlwaGVuYXRlKHRoaXMubmFtZSk7XHJcbiAgICAgICAgdmFyIGRlZmF1bHRCaW5kaW5nTW9kZSA9IHRoaXMuZGVmYXVsdEJpbmRpbmdNb2RlO1xyXG4gICAgICAgIGlmIChkZWZhdWx0QmluZGluZ01vZGUgPT09IG51bGwgfHwgZGVmYXVsdEJpbmRpbmdNb2RlID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgdGhpcy5kZWZhdWx0QmluZGluZ01vZGUgPSBiaW5kaW5nTW9kZS5vbmVXYXk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKHR5cGVvZiBkZWZhdWx0QmluZGluZ01vZGUgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGVmYXVsdEJpbmRpbmdNb2RlID0gYmluZGluZ01vZGVbZGVmYXVsdEJpbmRpbmdNb2RlXSB8fCBiaW5kaW5nTW9kZS5vbmVXYXk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuY2hhbmdlSGFuZGxlciA9IHRoaXMuY2hhbmdlSGFuZGxlciB8fCBudWxsO1xyXG4gICAgICAgIHRoaXMub3duZXIgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuZGVzY3JpcHRvciA9IG51bGw7XHJcbiAgICB9XHJcbiAgICBCaW5kYWJsZVByb3BlcnR5LnByb3RvdHlwZS5yZWdpc3RlcldpdGggPSBmdW5jdGlvbiAodGFyZ2V0LCBiZWhhdmlvciwgZGVzY3JpcHRvcikge1xyXG4gICAgICAgIGJlaGF2aW9yLnByb3BlcnRpZXMucHVzaCh0aGlzKTtcclxuICAgICAgICBiZWhhdmlvci5hdHRyaWJ1dGVzW3RoaXMuYXR0cmlidXRlXSA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy5vd25lciA9IGJlaGF2aW9yO1xyXG4gICAgICAgIGlmIChkZXNjcmlwdG9yKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGVzY3JpcHRvciA9IGRlc2NyaXB0b3I7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jb25maWd1cmVEZXNjcmlwdG9yKGRlc2NyaXB0b3IpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgfTtcclxuICAgIEJpbmRhYmxlUHJvcGVydHkucHJvdG90eXBlLl9jb25maWd1cmVEZXNjcmlwdG9yID0gZnVuY3Rpb24gKGRlc2NyaXB0b3IpIHtcclxuICAgICAgICB2YXIgbmFtZSA9IHRoaXMubmFtZTtcclxuICAgICAgICBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7XHJcbiAgICAgICAgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gdHJ1ZTtcclxuICAgICAgICBpZiAoJ2luaXRpYWxpemVyJyBpbiBkZXNjcmlwdG9yKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGVmYXVsdFZhbHVlID0gZGVzY3JpcHRvci5pbml0aWFsaXplcjtcclxuICAgICAgICAgICAgZGVsZXRlIGRlc2NyaXB0b3IuaW5pdGlhbGl6ZXI7XHJcbiAgICAgICAgICAgIGRlbGV0ZSBkZXNjcmlwdG9yLndyaXRhYmxlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoJ3ZhbHVlJyBpbiBkZXNjcmlwdG9yKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGVmYXVsdFZhbHVlID0gZGVzY3JpcHRvci52YWx1ZTtcclxuICAgICAgICAgICAgZGVsZXRlIGRlc2NyaXB0b3IudmFsdWU7XHJcbiAgICAgICAgICAgIGRlbGV0ZSBkZXNjcmlwdG9yLndyaXRhYmxlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBkZXNjcmlwdG9yLmdldCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGdldE9ic2VydmVyKHRoaXMsIG5hbWUpLmdldFZhbHVlKCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBkZXNjcmlwdG9yLnNldCA9IGZ1bmN0aW9uICh2YWx1ZSkge1xyXG4gICAgICAgICAgICBnZXRPYnNlcnZlcih0aGlzLCBuYW1lKS5zZXRWYWx1ZSh2YWx1ZSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBkZXNjcmlwdG9yLmdldC5nZXRPYnNlcnZlciA9IGZ1bmN0aW9uIChvYmopIHtcclxuICAgICAgICAgICAgcmV0dXJuIGdldE9ic2VydmVyKG9iaiwgbmFtZSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gZGVzY3JpcHRvcjtcclxuICAgIH07XHJcbiAgICBCaW5kYWJsZVByb3BlcnR5LnByb3RvdHlwZS5kZWZpbmVPbiA9IGZ1bmN0aW9uICh0YXJnZXQsIGJlaGF2aW9yKSB7XHJcbiAgICAgICAgdmFyIG5hbWUgPSB0aGlzLm5hbWU7XHJcbiAgICAgICAgdmFyIGhhbmRsZXJOYW1lO1xyXG4gICAgICAgIGlmICh0aGlzLmNoYW5nZUhhbmRsZXIgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgaGFuZGxlck5hbWUgPSBuYW1lICsgJ0NoYW5nZWQnO1xyXG4gICAgICAgICAgICBpZiAoaGFuZGxlck5hbWUgaW4gdGFyZ2V0LnByb3RvdHlwZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jaGFuZ2VIYW5kbGVyID0gaGFuZGxlck5hbWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuZGVzY3JpcHRvciA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LnByb3RvdHlwZSwgbmFtZSwgdGhpcy5fY29uZmlndXJlRGVzY3JpcHRvcih7fSkpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBCaW5kYWJsZVByb3BlcnR5LnByb3RvdHlwZS5jcmVhdGVPYnNlcnZlciA9IGZ1bmN0aW9uICh2aWV3TW9kZWwpIHtcclxuICAgICAgICB2YXIgc2VsZlN1YnNjcmliZXIgPSBudWxsO1xyXG4gICAgICAgIHZhciBkZWZhdWx0VmFsdWUgPSB0aGlzLmRlZmF1bHRWYWx1ZTtcclxuICAgICAgICB2YXIgY2hhbmdlSGFuZGxlck5hbWUgPSB0aGlzLmNoYW5nZUhhbmRsZXI7XHJcbiAgICAgICAgdmFyIG5hbWUgPSB0aGlzLm5hbWU7XHJcbiAgICAgICAgdmFyIGluaXRpYWxWYWx1ZTtcclxuICAgICAgICBpZiAodGhpcy5oYXNPcHRpb25zKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChjaGFuZ2VIYW5kbGVyTmFtZSBpbiB2aWV3TW9kZWwpIHtcclxuICAgICAgICAgICAgaWYgKCdwcm9wZXJ0eUNoYW5nZWQnIGluIHZpZXdNb2RlbCkge1xyXG4gICAgICAgICAgICAgICAgc2VsZlN1YnNjcmliZXIgPSBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmlld01vZGVsW2NoYW5nZUhhbmRsZXJOYW1lXShuZXdWYWx1ZSwgb2xkVmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZpZXdNb2RlbC5wcm9wZXJ0eUNoYW5nZWQobmFtZSwgbmV3VmFsdWUsIG9sZFZhbHVlKTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBzZWxmU3Vic2NyaWJlciA9IGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHsgcmV0dXJuIHZpZXdNb2RlbFtjaGFuZ2VIYW5kbGVyTmFtZV0obmV3VmFsdWUsIG9sZFZhbHVlKTsgfTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmICgncHJvcGVydHlDaGFuZ2VkJyBpbiB2aWV3TW9kZWwpIHtcclxuICAgICAgICAgICAgc2VsZlN1YnNjcmliZXIgPSBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7IHJldHVybiB2aWV3TW9kZWwucHJvcGVydHlDaGFuZ2VkKG5hbWUsIG5ld1ZhbHVlLCBvbGRWYWx1ZSk7IH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKGNoYW5nZUhhbmRsZXJOYW1lICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkNoYW5nZSBoYW5kbGVyIFwiLmNvbmNhdChjaGFuZ2VIYW5kbGVyTmFtZSwgXCIgd2FzIHNwZWNpZmllZCBidXQgbm90IGRlY2xhcmVkIG9uIHRoZSBjbGFzcy5cIikpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoZGVmYXVsdFZhbHVlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgaW5pdGlhbFZhbHVlID0gdHlwZW9mIGRlZmF1bHRWYWx1ZSA9PT0gJ2Z1bmN0aW9uJyA/IGRlZmF1bHRWYWx1ZS5jYWxsKHZpZXdNb2RlbCkgOiBkZWZhdWx0VmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBuZXcgQmVoYXZpb3JQcm9wZXJ0eU9ic2VydmVyKHRoaXMub3duZXIudGFza1F1ZXVlLCB2aWV3TW9kZWwsIHRoaXMubmFtZSwgc2VsZlN1YnNjcmliZXIsIGluaXRpYWxWYWx1ZSk7XHJcbiAgICB9O1xyXG4gICAgQmluZGFibGVQcm9wZXJ0eS5wcm90b3R5cGUuX2luaXRpYWxpemUgPSBmdW5jdGlvbiAodmlld01vZGVsLCBvYnNlcnZlckxvb2t1cCwgYXR0cmlidXRlcywgYmVoYXZpb3JIYW5kbGVzQmluZCwgYm91bmRQcm9wZXJ0aWVzKSB7XHJcbiAgICAgICAgdmFyIHNlbGZTdWJzY3JpYmVyO1xyXG4gICAgICAgIHZhciBvYnNlcnZlcjtcclxuICAgICAgICB2YXIgYXR0cmlidXRlO1xyXG4gICAgICAgIHZhciBkZWZhdWx0VmFsdWUgPSB0aGlzLmRlZmF1bHRWYWx1ZTtcclxuICAgICAgICBpZiAodGhpcy5pc0R5bmFtaWMpIHtcclxuICAgICAgICAgICAgZm9yICh2YXIga2V5IGluIGF0dHJpYnV0ZXMpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2NyZWF0ZUR5bmFtaWNQcm9wZXJ0eSh2aWV3TW9kZWwsIG9ic2VydmVyTG9va3VwLCBiZWhhdmlvckhhbmRsZXNCaW5kLCBrZXksIGF0dHJpYnV0ZXNba2V5XSwgYm91bmRQcm9wZXJ0aWVzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmICghdGhpcy5oYXNPcHRpb25zKSB7XHJcbiAgICAgICAgICAgIG9ic2VydmVyID0gb2JzZXJ2ZXJMb29rdXBbdGhpcy5uYW1lXTtcclxuICAgICAgICAgICAgaWYgKGF0dHJpYnV0ZXMgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHNlbGZTdWJzY3JpYmVyID0gb2JzZXJ2ZXIuc2VsZlN1YnNjcmliZXI7XHJcbiAgICAgICAgICAgICAgICBhdHRyaWJ1dGUgPSBhdHRyaWJ1dGVzW3RoaXMuYXR0cmlidXRlXTtcclxuICAgICAgICAgICAgICAgIGlmIChiZWhhdmlvckhhbmRsZXNCaW5kKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIuc2VsZlN1YnNjcmliZXIgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBhdHRyaWJ1dGUgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmlld01vZGVsW3RoaXMubmFtZV0gPSBhdHRyaWJ1dGU7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIuY2FsbCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoYXR0cmlidXRlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYm91bmRQcm9wZXJ0aWVzLnB1c2goeyBvYnNlcnZlcjogb2JzZXJ2ZXIsIGJpbmRpbmc6IGF0dHJpYnV0ZS5jcmVhdGVCaW5kaW5nKHZpZXdNb2RlbCkgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChkZWZhdWx0VmFsdWUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLmNhbGwoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIG9ic2VydmVyLnNlbGZTdWJzY3JpYmVyID0gc2VsZlN1YnNjcmliZXI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgb2JzZXJ2ZXIucHVibGlzaGluZyA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIEJpbmRhYmxlUHJvcGVydHkucHJvdG90eXBlLl9jcmVhdGVEeW5hbWljUHJvcGVydHkgPSBmdW5jdGlvbiAodmlld01vZGVsLCBvYnNlcnZlckxvb2t1cCwgYmVoYXZpb3JIYW5kbGVzQmluZCwgbmFtZSwgYXR0cmlidXRlLCBib3VuZFByb3BlcnRpZXMpIHtcclxuICAgICAgICB2YXIgY2hhbmdlSGFuZGxlck5hbWUgPSBuYW1lICsgJ0NoYW5nZWQnO1xyXG4gICAgICAgIHZhciBzZWxmU3Vic2NyaWJlciA9IG51bGw7XHJcbiAgICAgICAgdmFyIG9ic2VydmVyO1xyXG4gICAgICAgIHZhciBpbmZvO1xyXG4gICAgICAgIGlmIChjaGFuZ2VIYW5kbGVyTmFtZSBpbiB2aWV3TW9kZWwpIHtcclxuICAgICAgICAgICAgaWYgKCdwcm9wZXJ0eUNoYW5nZWQnIGluIHZpZXdNb2RlbCkge1xyXG4gICAgICAgICAgICAgICAgc2VsZlN1YnNjcmliZXIgPSBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmlld01vZGVsW2NoYW5nZUhhbmRsZXJOYW1lXShuZXdWYWx1ZSwgb2xkVmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZpZXdNb2RlbC5wcm9wZXJ0eUNoYW5nZWQobmFtZSwgbmV3VmFsdWUsIG9sZFZhbHVlKTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBzZWxmU3Vic2NyaWJlciA9IGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHsgcmV0dXJuIHZpZXdNb2RlbFtjaGFuZ2VIYW5kbGVyTmFtZV0obmV3VmFsdWUsIG9sZFZhbHVlKTsgfTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmICgncHJvcGVydHlDaGFuZ2VkJyBpbiB2aWV3TW9kZWwpIHtcclxuICAgICAgICAgICAgc2VsZlN1YnNjcmliZXIgPSBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7IHJldHVybiB2aWV3TW9kZWwucHJvcGVydHlDaGFuZ2VkKG5hbWUsIG5ld1ZhbHVlLCBvbGRWYWx1ZSk7IH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIG9ic2VydmVyID0gb2JzZXJ2ZXJMb29rdXBbbmFtZV0gPSBuZXcgQmVoYXZpb3JQcm9wZXJ0eU9ic2VydmVyKHRoaXMub3duZXIudGFza1F1ZXVlLCB2aWV3TW9kZWwsIG5hbWUsIHNlbGZTdWJzY3JpYmVyKTtcclxuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodmlld01vZGVsLCBuYW1lLCB7XHJcbiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcclxuICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICAgICAgZ2V0OiBvYnNlcnZlci5nZXRWYWx1ZS5iaW5kKG9ic2VydmVyKSxcclxuICAgICAgICAgICAgc2V0OiBvYnNlcnZlci5zZXRWYWx1ZS5iaW5kKG9ic2VydmVyKVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGlmIChiZWhhdmlvckhhbmRsZXNCaW5kKSB7XHJcbiAgICAgICAgICAgIG9ic2VydmVyLnNlbGZTdWJzY3JpYmVyID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHR5cGVvZiBhdHRyaWJ1dGUgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgIHZpZXdNb2RlbFtuYW1lXSA9IGF0dHJpYnV0ZTtcclxuICAgICAgICAgICAgb2JzZXJ2ZXIuY2FsbCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChhdHRyaWJ1dGUpIHtcclxuICAgICAgICAgICAgaW5mbyA9IHsgb2JzZXJ2ZXI6IG9ic2VydmVyLCBiaW5kaW5nOiBhdHRyaWJ1dGUuY3JlYXRlQmluZGluZyh2aWV3TW9kZWwpIH07XHJcbiAgICAgICAgICAgIGJvdW5kUHJvcGVydGllcy5wdXNoKGluZm8pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBvYnNlcnZlci5wdWJsaXNoaW5nID0gdHJ1ZTtcclxuICAgICAgICBvYnNlcnZlci5zZWxmU3Vic2NyaWJlciA9IHNlbGZTdWJzY3JpYmVyO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBCaW5kYWJsZVByb3BlcnR5O1xyXG59KCkpO1xuXG52YXIgVmlld0xvY2F0b3IgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gVmlld0xvY2F0b3IoKSB7XHJcbiAgICB9XHJcbiAgICBWaWV3TG9jYXRvci5wcm90b3R5cGUuZ2V0Vmlld1N0cmF0ZWd5ID0gZnVuY3Rpb24gKHZhbHVlKSB7XHJcbiAgICAgICAgaWYgKCF2YWx1ZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgJ2dldFZpZXdTdHJhdGVneScgaW4gdmFsdWUpIHtcclxuICAgICAgICAgICAgdmFyIG9yaWdpbl8xID0gT3JpZ2luLmdldCh2YWx1ZS5jb25zdHJ1Y3Rvcik7XHJcbiAgICAgICAgICAgIHZhbHVlID0gdmFsdWUuZ2V0Vmlld1N0cmF0ZWd5KCk7XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgICAgICB2YWx1ZSA9IG5ldyBSZWxhdGl2ZVZpZXdTdHJhdGVneSh2YWx1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmlld1N0cmF0ZWd5LmFzc2VydCh2YWx1ZSk7XHJcbiAgICAgICAgICAgIGlmIChvcmlnaW5fMS5tb2R1bGVJZCkge1xyXG4gICAgICAgICAgICAgICAgdmFsdWUubWFrZVJlbGF0aXZlVG8ob3JpZ2luXzEubW9kdWxlSWQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgdmFsdWUgPSBuZXcgUmVsYXRpdmVWaWV3U3RyYXRlZ3kodmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodmlld1N0cmF0ZWd5LnZhbGlkYXRlKHZhbHVlKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0eXBlb2YgdmFsdWUgIT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZS5jb25zdHJ1Y3RvcjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCckdmlldycgaW4gdmFsdWUpIHtcclxuICAgICAgICAgICAgdmFyIGMgPSB2YWx1ZS4kdmlldztcclxuICAgICAgICAgICAgdmFyIHZpZXcgPSB2b2lkIDA7XHJcbiAgICAgICAgICAgIGMgPSB0eXBlb2YgYyA9PT0gJ2Z1bmN0aW9uJyA/IGMuY2FsbCh2YWx1ZSkgOiBjO1xyXG4gICAgICAgICAgICBpZiAoYyA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgdmlldyA9IG5ldyBOb1ZpZXdTdHJhdGVneSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdmlldyA9IGMgaW5zdGFuY2VvZiBTdGF0aWNWaWV3U3RyYXRlZ3kgPyBjIDogbmV3IFN0YXRpY1ZpZXdTdHJhdGVneShjKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBtZXRhZGF0YS5kZWZpbmUoVmlld0xvY2F0b3Iudmlld1N0cmF0ZWd5TWV0YWRhdGFLZXksIHZpZXcsIHZhbHVlKTtcclxuICAgICAgICAgICAgcmV0dXJuIHZpZXc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBvcmlnaW4gPSBPcmlnaW4uZ2V0KHZhbHVlKTtcclxuICAgICAgICB2YXIgc3RyYXRlZ3kgPSBtZXRhZGF0YS5nZXQoVmlld0xvY2F0b3Iudmlld1N0cmF0ZWd5TWV0YWRhdGFLZXksIHZhbHVlKTtcclxuICAgICAgICBpZiAoIXN0cmF0ZWd5KSB7XHJcbiAgICAgICAgICAgIGlmICghb3JpZ2luLm1vZHVsZUlkKSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCBkZXRlcm1pbmUgZGVmYXVsdCB2aWV3IHN0cmF0ZWd5IGZvciBvYmplY3QuXFxuJyArIHZhbHVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzdHJhdGVneSA9IHRoaXMuY3JlYXRlRmFsbGJhY2tWaWV3U3RyYXRlZ3kob3JpZ2luKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAob3JpZ2luLm1vZHVsZUlkKSB7XHJcbiAgICAgICAgICAgIHN0cmF0ZWd5Lm1vZHVsZUlkID0gb3JpZ2luLm1vZHVsZUlkO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gc3RyYXRlZ3k7XHJcbiAgICB9O1xyXG4gICAgVmlld0xvY2F0b3IucHJvdG90eXBlLmNyZWF0ZUZhbGxiYWNrVmlld1N0cmF0ZWd5ID0gZnVuY3Rpb24gKG9yaWdpbikge1xyXG4gICAgICAgIHJldHVybiBuZXcgQ29udmVudGlvbmFsVmlld1N0cmF0ZWd5KHRoaXMsIG9yaWdpbik7XHJcbiAgICB9O1xyXG4gICAgVmlld0xvY2F0b3IucHJvdG90eXBlLmNvbnZlcnRPcmlnaW5Ub1ZpZXdVcmwgPSBmdW5jdGlvbiAob3JpZ2luKSB7XHJcbiAgICAgICAgdmFyIG1vZHVsZUlkID0gb3JpZ2luLm1vZHVsZUlkO1xyXG4gICAgICAgIHZhciBpZCA9IChtb2R1bGVJZC5lbmRzV2l0aCgnLmpzJykgfHwgbW9kdWxlSWQuZW5kc1dpdGgoJy50cycpKSA/IG1vZHVsZUlkLnN1YnN0cmluZygwLCBtb2R1bGVJZC5sZW5ndGggLSAzKSA6IG1vZHVsZUlkO1xyXG4gICAgICAgIHJldHVybiBpZCArICcuaHRtbCc7XHJcbiAgICB9O1xyXG4gICAgVmlld0xvY2F0b3Iudmlld1N0cmF0ZWd5TWV0YWRhdGFLZXkgPSAnYXVyZWxpYTp2aWV3LXN0cmF0ZWd5JztcclxuICAgIHJldHVybiBWaWV3TG9jYXRvcjtcclxufSgpKTtcblxuZnVuY3Rpb24gbWkobmFtZSkge1xyXG4gICAgdGhyb3cgbmV3IEVycm9yKFwiQmluZGluZ0xhbmd1YWdlIG11c3QgaW1wbGVtZW50IFwiLmNvbmNhdChuYW1lLCBcIigpLlwiKSk7XHJcbn1cclxudmFyIEJpbmRpbmdMYW5ndWFnZSA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBCaW5kaW5nTGFuZ3VhZ2UoKSB7XHJcbiAgICB9XHJcbiAgICBCaW5kaW5nTGFuZ3VhZ2UucHJvdG90eXBlLmluc3BlY3RBdHRyaWJ1dGUgPSBmdW5jdGlvbiAocmVzb3VyY2VzLCBlbGVtZW50TmFtZSwgYXR0ck5hbWUsIGF0dHJWYWx1ZSkge1xyXG4gICAgICAgIG1pKCdpbnNwZWN0QXR0cmlidXRlJyk7XHJcbiAgICB9O1xyXG4gICAgQmluZGluZ0xhbmd1YWdlLnByb3RvdHlwZS5jcmVhdGVBdHRyaWJ1dGVJbnN0cnVjdGlvbiA9IGZ1bmN0aW9uIChyZXNvdXJjZXMsIGVsZW1lbnQsIGluZm8sIGV4aXN0aW5nSW5zdHJ1Y3Rpb24sIGNvbnRleHQpIHtcclxuICAgICAgICBtaSgnY3JlYXRlQXR0cmlidXRlSW5zdHJ1Y3Rpb24nKTtcclxuICAgIH07XHJcbiAgICBCaW5kaW5nTGFuZ3VhZ2UucHJvdG90eXBlLmNyZWF0ZUxldEV4cHJlc3Npb25zID0gZnVuY3Rpb24gKHJlc291cmNlcywgZWxlbWVudCkge1xyXG4gICAgICAgIG1pKCdjcmVhdGVMZXRFeHByZXNzaW9ucycpO1xyXG4gICAgfTtcclxuICAgIEJpbmRpbmdMYW5ndWFnZS5wcm90b3R5cGUuaW5zcGVjdFRleHRDb250ZW50ID0gZnVuY3Rpb24gKHJlc291cmNlcywgdmFsdWUpIHtcclxuICAgICAgICBtaSgnaW5zcGVjdFRleHRDb250ZW50Jyk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIEJpbmRpbmdMYW5ndWFnZTtcclxufSgpKTtcblxudmFyIG5vTm9kZXMgPSBPYmplY3QuZnJlZXplKFtdKTtcclxudmFyIFNsb3RDdXN0b21BdHRyaWJ1dGUgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gU2xvdEN1c3RvbUF0dHJpYnV0ZShlbGVtZW50KSB7XHJcbiAgICAgICAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDtcclxuICAgICAgICB0aGlzLmVsZW1lbnQuYXVTbG90QXR0cmlidXRlID0gdGhpcztcclxuICAgIH1cclxuICAgIFNsb3RDdXN0b21BdHRyaWJ1dGUuaW5qZWN0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBbRE9NLkVsZW1lbnRdO1xyXG4gICAgfTtcclxuICAgIFNsb3RDdXN0b21BdHRyaWJ1dGUucHJvdG90eXBlLnZhbHVlQ2hhbmdlZCA9IGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHsgfTtcclxuICAgIHJldHVybiBTbG90Q3VzdG9tQXR0cmlidXRlO1xyXG59KCkpO1xyXG52YXIgUGFzc1Rocm91Z2hTbG90ID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIFBhc3NUaHJvdWdoU2xvdChhbmNob3IsIG5hbWUsIGRlc3RpbmF0aW9uTmFtZSwgZmFsbGJhY2tGYWN0b3J5KSB7XHJcbiAgICAgICAgdGhpcy5hbmNob3IgPSBhbmNob3I7XHJcbiAgICAgICAgdGhpcy5hbmNob3Iudmlld1Nsb3QgPSB0aGlzO1xyXG4gICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XHJcbiAgICAgICAgdGhpcy5kZXN0aW5hdGlvbk5hbWUgPSBkZXN0aW5hdGlvbk5hbWU7XHJcbiAgICAgICAgdGhpcy5mYWxsYmFja0ZhY3RvcnkgPSBmYWxsYmFja0ZhY3Rvcnk7XHJcbiAgICAgICAgdGhpcy5kZXN0aW5hdGlvblNsb3QgPSBudWxsO1xyXG4gICAgICAgIHRoaXMucHJvamVjdGlvbnMgPSAwO1xyXG4gICAgICAgIHRoaXMuY29udGVudFZpZXcgPSBudWxsO1xyXG4gICAgICAgIHZhciBhdHRyID0gbmV3IFNsb3RDdXN0b21BdHRyaWJ1dGUodGhpcy5hbmNob3IpO1xyXG4gICAgICAgIGF0dHIudmFsdWUgPSB0aGlzLmRlc3RpbmF0aW9uTmFtZTtcclxuICAgIH1cclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShQYXNzVGhyb3VnaFNsb3QucHJvdG90eXBlLCBcIm5lZWRzRmFsbGJhY2tSZW5kZXJpbmdcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5mYWxsYmFja0ZhY3RvcnkgJiYgdGhpcy5wcm9qZWN0aW9ucyA9PT0gMDtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBQYXNzVGhyb3VnaFNsb3QucHJvdG90eXBlLnJlbmRlckZhbGxiYWNrQ29udGVudCA9IGZ1bmN0aW9uICh2aWV3LCBub2RlcywgcHJvamVjdGlvblNvdXJjZSwgaW5kZXgpIHtcclxuICAgICAgICBpZiAodGhpcy5jb250ZW50VmlldyA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRlbnRWaWV3ID0gdGhpcy5mYWxsYmFja0ZhY3RvcnkuY3JlYXRlKHRoaXMub3duZXJWaWV3LmNvbnRhaW5lcik7XHJcbiAgICAgICAgICAgIHRoaXMuY29udGVudFZpZXcuYmluZCh0aGlzLm93bmVyVmlldy5iaW5kaW5nQ29udGV4dCwgdGhpcy5vd25lclZpZXcub3ZlcnJpZGVDb250ZXh0KTtcclxuICAgICAgICAgICAgdmFyIHNsb3RzID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcclxuICAgICAgICAgICAgc2xvdHNbdGhpcy5kZXN0aW5hdGlvblNsb3QubmFtZV0gPSB0aGlzLmRlc3RpbmF0aW9uU2xvdDtcclxuICAgICAgICAgICAgU2hhZG93RE9NLmRpc3RyaWJ1dGVWaWV3KHRoaXMuY29udGVudFZpZXcsIHNsb3RzLCBwcm9qZWN0aW9uU291cmNlLCBpbmRleCwgdGhpcy5kZXN0aW5hdGlvblNsb3QubmFtZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFBhc3NUaHJvdWdoU2xvdC5wcm90b3R5cGUucGFzc1Rocm91Z2hUbyA9IGZ1bmN0aW9uIChkZXN0aW5hdGlvblNsb3QpIHtcclxuICAgICAgICB0aGlzLmRlc3RpbmF0aW9uU2xvdCA9IGRlc3RpbmF0aW9uU2xvdDtcclxuICAgIH07XHJcbiAgICBQYXNzVGhyb3VnaFNsb3QucHJvdG90eXBlLmFkZE5vZGUgPSBmdW5jdGlvbiAodmlldywgbm9kZSwgcHJvamVjdGlvblNvdXJjZSwgaW5kZXgpIHtcclxuICAgICAgICBpZiAodGhpcy5jb250ZW50VmlldyAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRlbnRWaWV3LnJlbW92ZU5vZGVzKCk7XHJcbiAgICAgICAgICAgIHRoaXMuY29udGVudFZpZXcuZGV0YWNoZWQoKTtcclxuICAgICAgICAgICAgdGhpcy5jb250ZW50Vmlldy51bmJpbmQoKTtcclxuICAgICAgICAgICAgdGhpcy5jb250ZW50VmlldyA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChub2RlLnZpZXdTbG90IGluc3RhbmNlb2YgUGFzc1Rocm91Z2hTbG90KSB7XHJcbiAgICAgICAgICAgIG5vZGUudmlld1Nsb3QucGFzc1Rocm91Z2hUbyh0aGlzKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnByb2plY3Rpb25zKys7XHJcbiAgICAgICAgdGhpcy5kZXN0aW5hdGlvblNsb3QuYWRkTm9kZSh2aWV3LCBub2RlLCBwcm9qZWN0aW9uU291cmNlLCBpbmRleCk7XHJcbiAgICB9O1xyXG4gICAgUGFzc1Rocm91Z2hTbG90LnByb3RvdHlwZS5yZW1vdmVWaWV3ID0gZnVuY3Rpb24gKHZpZXcsIHByb2plY3Rpb25Tb3VyY2UpIHtcclxuICAgICAgICB0aGlzLnByb2plY3Rpb25zLS07XHJcbiAgICAgICAgdGhpcy5kZXN0aW5hdGlvblNsb3QucmVtb3ZlVmlldyh2aWV3LCBwcm9qZWN0aW9uU291cmNlKTtcclxuICAgICAgICBpZiAodGhpcy5uZWVkc0ZhbGxiYWNrUmVuZGVyaW5nKSB7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyRmFsbGJhY2tDb250ZW50KG51bGwsIG5vTm9kZXMsIHByb2plY3Rpb25Tb3VyY2UpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBQYXNzVGhyb3VnaFNsb3QucHJvdG90eXBlLnJlbW92ZUFsbCA9IGZ1bmN0aW9uIChwcm9qZWN0aW9uU291cmNlKSB7XHJcbiAgICAgICAgdGhpcy5wcm9qZWN0aW9ucyA9IDA7XHJcbiAgICAgICAgdGhpcy5kZXN0aW5hdGlvblNsb3QucmVtb3ZlQWxsKHByb2plY3Rpb25Tb3VyY2UpO1xyXG4gICAgICAgIGlmICh0aGlzLm5lZWRzRmFsbGJhY2tSZW5kZXJpbmcpIHtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXJGYWxsYmFja0NvbnRlbnQobnVsbCwgbm9Ob2RlcywgcHJvamVjdGlvblNvdXJjZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFBhc3NUaHJvdWdoU2xvdC5wcm90b3R5cGUucHJvamVjdEZyb20gPSBmdW5jdGlvbiAodmlldywgcHJvamVjdGlvblNvdXJjZSkge1xyXG4gICAgICAgIHRoaXMuZGVzdGluYXRpb25TbG90LnByb2plY3RGcm9tKHZpZXcsIHByb2plY3Rpb25Tb3VyY2UpO1xyXG4gICAgfTtcclxuICAgIFBhc3NUaHJvdWdoU2xvdC5wcm90b3R5cGUuY3JlYXRlZCA9IGZ1bmN0aW9uIChvd25lclZpZXcpIHtcclxuICAgICAgICB0aGlzLm93bmVyVmlldyA9IG93bmVyVmlldztcclxuICAgIH07XHJcbiAgICBQYXNzVGhyb3VnaFNsb3QucHJvdG90eXBlLmJpbmQgPSBmdW5jdGlvbiAodmlldykge1xyXG4gICAgICAgIGlmICh0aGlzLmNvbnRlbnRWaWV3KSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29udGVudFZpZXcuYmluZCh2aWV3LmJpbmRpbmdDb250ZXh0LCB2aWV3Lm92ZXJyaWRlQ29udGV4dCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFBhc3NUaHJvdWdoU2xvdC5wcm90b3R5cGUuYXR0YWNoZWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuY29udGVudFZpZXcpIHtcclxuICAgICAgICAgICAgdGhpcy5jb250ZW50Vmlldy5hdHRhY2hlZCgpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBQYXNzVGhyb3VnaFNsb3QucHJvdG90eXBlLmRldGFjaGVkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmNvbnRlbnRWaWV3KSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29udGVudFZpZXcuZGV0YWNoZWQoKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgUGFzc1Rocm91Z2hTbG90LnByb3RvdHlwZS51bmJpbmQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuY29udGVudFZpZXcpIHtcclxuICAgICAgICAgICAgdGhpcy5jb250ZW50Vmlldy51bmJpbmQoKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIFBhc3NUaHJvdWdoU2xvdDtcclxufSgpKTtcclxudmFyIFNoYWRvd1Nsb3QgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gU2hhZG93U2xvdChhbmNob3IsIG5hbWUsIGZhbGxiYWNrRmFjdG9yeSkge1xyXG4gICAgICAgIHRoaXMuYW5jaG9yID0gYW5jaG9yO1xyXG4gICAgICAgIHRoaXMuYW5jaG9yLmlzQ29udGVudFByb2plY3Rpb25Tb3VyY2UgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMuYW5jaG9yLnZpZXdTbG90ID0gdGhpcztcclxuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xyXG4gICAgICAgIHRoaXMuZmFsbGJhY2tGYWN0b3J5ID0gZmFsbGJhY2tGYWN0b3J5O1xyXG4gICAgICAgIHRoaXMuY29udGVudFZpZXcgPSBudWxsO1xyXG4gICAgICAgIHRoaXMucHJvamVjdGlvbnMgPSAwO1xyXG4gICAgICAgIHRoaXMuY2hpbGRyZW4gPSBbXTtcclxuICAgICAgICB0aGlzLnByb2plY3RGcm9tQW5jaG9ycyA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5kZXN0aW5hdGlvblNsb3RzID0gbnVsbDtcclxuICAgIH1cclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShTaGFkb3dTbG90LnByb3RvdHlwZSwgXCJuZWVkc0ZhbGxiYWNrUmVuZGVyaW5nXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmFsbGJhY2tGYWN0b3J5ICYmIHRoaXMucHJvamVjdGlvbnMgPT09IDA7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgU2hhZG93U2xvdC5wcm90b3R5cGUuYWRkTm9kZSA9IGZ1bmN0aW9uICh2aWV3LCBub2RlLCBwcm9qZWN0aW9uU291cmNlLCBpbmRleCwgZGVzdGluYXRpb24pIHtcclxuICAgICAgICB2YXIgJG5vZGUgPSBub2RlO1xyXG4gICAgICAgIGlmICh0aGlzLmNvbnRlbnRWaWV3ICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29udGVudFZpZXcucmVtb3ZlTm9kZXMoKTtcclxuICAgICAgICAgICAgdGhpcy5jb250ZW50Vmlldy5kZXRhY2hlZCgpO1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRlbnRWaWV3LnVuYmluZCgpO1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRlbnRWaWV3ID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCRub2RlLnZpZXdTbG90IGluc3RhbmNlb2YgUGFzc1Rocm91Z2hTbG90KSB7XHJcbiAgICAgICAgICAgICRub2RlLnZpZXdTbG90LnBhc3NUaHJvdWdoVG8odGhpcyk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuZGVzdGluYXRpb25TbG90cyAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICBTaGFkb3dET00uZGlzdHJpYnV0ZU5vZGVzKHZpZXcsIFskbm9kZV0sIHRoaXMuZGVzdGluYXRpb25TbG90cywgdGhpcywgaW5kZXgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgJG5vZGUuYXVPd25lclZpZXcgPSB2aWV3O1xyXG4gICAgICAgICAgICAkbm9kZS5hdVByb2plY3Rpb25Tb3VyY2UgPSBwcm9qZWN0aW9uU291cmNlO1xyXG4gICAgICAgICAgICAkbm9kZS5hdUFzc2lnbmVkU2xvdCA9IHRoaXM7XHJcbiAgICAgICAgICAgIHZhciBhbmNob3IgPSB0aGlzLl9maW5kQW5jaG9yKHZpZXcsICRub2RlLCBwcm9qZWN0aW9uU291cmNlLCBpbmRleCk7XHJcbiAgICAgICAgICAgIHZhciBwYXJlbnRfMSA9IGFuY2hvci5wYXJlbnROb2RlO1xyXG4gICAgICAgICAgICBwYXJlbnRfMS5pbnNlcnRCZWZvcmUoJG5vZGUsIGFuY2hvcik7XHJcbiAgICAgICAgICAgIHRoaXMuY2hpbGRyZW4ucHVzaCgkbm9kZSk7XHJcbiAgICAgICAgICAgIHRoaXMucHJvamVjdGlvbnMrKztcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgU2hhZG93U2xvdC5wcm90b3R5cGUucmVtb3ZlVmlldyA9IGZ1bmN0aW9uICh2aWV3LCBwcm9qZWN0aW9uU291cmNlKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZGVzdGluYXRpb25TbG90cyAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICBTaGFkb3dET00udW5kaXN0cmlidXRlVmlldyh2aWV3LCB0aGlzLmRlc3RpbmF0aW9uU2xvdHMsIHRoaXMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmICh0aGlzLmNvbnRlbnRWaWV3ICYmIHRoaXMuY29udGVudFZpZXcuaGFzU2xvdHMpIHtcclxuICAgICAgICAgICAgU2hhZG93RE9NLnVuZGlzdHJpYnV0ZVZpZXcodmlldywgdGhpcy5jb250ZW50Vmlldy5zbG90cywgcHJvamVjdGlvblNvdXJjZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB2YXIgZm91bmQgPSB0aGlzLmNoaWxkcmVuLmZpbmQoZnVuY3Rpb24gKHgpIHsgcmV0dXJuIHguYXVTbG90UHJvamVjdEZyb20gPT09IHByb2plY3Rpb25Tb3VyY2U7IH0pO1xyXG4gICAgICAgICAgICBpZiAoZm91bmQpIHtcclxuICAgICAgICAgICAgICAgIHZhciBjaGlsZHJlbiA9IGZvdW5kLmF1UHJvamVjdGlvbkNoaWxkcmVuO1xyXG4gICAgICAgICAgICAgICAgdmFyIG93bkNoaWxkcmVuID0gdGhpcy5jaGlsZHJlbjtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IGNoaWxkcmVuLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY2hpbGQgPSBjaGlsZHJlbltpXTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY2hpbGQuYXVPd25lclZpZXcgPT09IHZpZXcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW4uc3BsaWNlKGksIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2aWV3LmZyYWdtZW50LmFwcGVuZENoaWxkKGNoaWxkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaS0tO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpaS0tO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnByb2plY3Rpb25zLS07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpZHggPSBvd25DaGlsZHJlbi5pbmRleE9mKGNoaWxkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlkeCA+IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvd25DaGlsZHJlbi5zcGxpY2UoaWR4LCAxKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLm5lZWRzRmFsbGJhY2tSZW5kZXJpbmcpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbmRlckZhbGxiYWNrQ29udGVudCh2aWV3LCBub05vZGVzLCBwcm9qZWN0aW9uU291cmNlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBTaGFkb3dTbG90LnByb3RvdHlwZS5yZW1vdmVBbGwgPSBmdW5jdGlvbiAocHJvamVjdGlvblNvdXJjZSkge1xyXG4gICAgICAgIGlmICh0aGlzLmRlc3RpbmF0aW9uU2xvdHMgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgU2hhZG93RE9NLnVuZGlzdHJpYnV0ZUFsbCh0aGlzLmRlc3RpbmF0aW9uU2xvdHMsIHRoaXMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmICh0aGlzLmNvbnRlbnRWaWV3ICYmIHRoaXMuY29udGVudFZpZXcuaGFzU2xvdHMpIHtcclxuICAgICAgICAgICAgU2hhZG93RE9NLnVuZGlzdHJpYnV0ZUFsbCh0aGlzLmNvbnRlbnRWaWV3LnNsb3RzLCBwcm9qZWN0aW9uU291cmNlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHZhciBmb3VuZCA9IHRoaXMuY2hpbGRyZW4uZmluZChmdW5jdGlvbiAoeCkgeyByZXR1cm4geC5hdVNsb3RQcm9qZWN0RnJvbSA9PT0gcHJvamVjdGlvblNvdXJjZTsgfSk7XHJcbiAgICAgICAgICAgIGlmIChmb3VuZCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGNoaWxkcmVuID0gZm91bmQuYXVQcm9qZWN0aW9uQ2hpbGRyZW47XHJcbiAgICAgICAgICAgICAgICB2YXIgb3duQ2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuO1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gY2hpbGRyZW4ubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjaGlsZCA9IGNoaWxkcmVuW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgIGNoaWxkLmF1T3duZXJWaWV3LmZyYWdtZW50LmFwcGVuZENoaWxkKGNoaWxkKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnByb2plY3Rpb25zLS07XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGlkeCA9IG93bkNoaWxkcmVuLmluZGV4T2YoY2hpbGQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpZHggPiAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvd25DaGlsZHJlbi5zcGxpY2UoaWR4LCAxKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBmb3VuZC5hdVByb2plY3Rpb25DaGlsZHJlbiA9IFtdO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubmVlZHNGYWxsYmFja1JlbmRlcmluZykge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyRmFsbGJhY2tDb250ZW50KG51bGwsIG5vTm9kZXMsIHByb2plY3Rpb25Tb3VyY2UpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFNoYWRvd1Nsb3QucHJvdG90eXBlLl9maW5kQW5jaG9yID0gZnVuY3Rpb24gKHZpZXcsIG5vZGUsIHByb2plY3Rpb25Tb3VyY2UsIGluZGV4KSB7XHJcbiAgICAgICAgaWYgKHByb2plY3Rpb25Tb3VyY2UpIHtcclxuICAgICAgICAgICAgdmFyIGZvdW5kID0gdGhpcy5jaGlsZHJlbi5maW5kKGZ1bmN0aW9uICh4KSB7IHJldHVybiB4LmF1U2xvdFByb2plY3RGcm9tID09PSBwcm9qZWN0aW9uU291cmNlOyB9KTtcclxuICAgICAgICAgICAgaWYgKGZvdW5kKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaW5kZXggIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjaGlsZHJlbiA9IGZvdW5kLmF1UHJvamVjdGlvbkNoaWxkcmVuO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB2aWV3SW5kZXggPSAtMTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgbGFzdFZpZXcgPSB2b2lkIDA7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gY2hpbGRyZW4ubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY3VycmVudCA9IGNoaWxkcmVuW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudC5hdU93bmVyVmlldyAhPT0gbGFzdFZpZXcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpZXdJbmRleCsrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdFZpZXcgPSBjdXJyZW50LmF1T3duZXJWaWV3O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZpZXdJbmRleCA+PSBpbmRleCAmJiBsYXN0VmlldyAhPT0gdmlldykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkcmVuLnNwbGljZShpLCAwLCBub2RlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3VycmVudDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGZvdW5kLmF1UHJvamVjdGlvbkNoaWxkcmVuLnB1c2gobm9kZSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZm91bmQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuYW5jaG9yO1xyXG4gICAgfTtcclxuICAgIFNoYWRvd1Nsb3QucHJvdG90eXBlLnByb2plY3RUbyA9IGZ1bmN0aW9uIChzbG90cykge1xyXG4gICAgICAgIHRoaXMuZGVzdGluYXRpb25TbG90cyA9IHNsb3RzO1xyXG4gICAgfTtcclxuICAgIFNoYWRvd1Nsb3QucHJvdG90eXBlLnByb2plY3RGcm9tID0gZnVuY3Rpb24gKHZpZXcsIHByb2plY3Rpb25Tb3VyY2UpIHtcclxuICAgICAgICB2YXIgYW5jaG9yID0gRE9NLmNyZWF0ZUNvbW1lbnQoJ2FuY2hvcicpO1xyXG4gICAgICAgIHZhciBwYXJlbnQgPSB0aGlzLmFuY2hvci5wYXJlbnROb2RlO1xyXG4gICAgICAgIGFuY2hvci5hdVNsb3RQcm9qZWN0RnJvbSA9IHByb2plY3Rpb25Tb3VyY2U7XHJcbiAgICAgICAgYW5jaG9yLmF1T3duZXJWaWV3ID0gdmlldztcclxuICAgICAgICBhbmNob3IuYXVQcm9qZWN0aW9uQ2hpbGRyZW4gPSBbXTtcclxuICAgICAgICBwYXJlbnQuaW5zZXJ0QmVmb3JlKGFuY2hvciwgdGhpcy5hbmNob3IpO1xyXG4gICAgICAgIHRoaXMuY2hpbGRyZW4ucHVzaChhbmNob3IpO1xyXG4gICAgICAgIGlmICh0aGlzLnByb2plY3RGcm9tQW5jaG9ycyA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aGlzLnByb2plY3RGcm9tQW5jaG9ycyA9IFtdO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnByb2plY3RGcm9tQW5jaG9ycy5wdXNoKGFuY2hvcik7XHJcbiAgICB9O1xyXG4gICAgU2hhZG93U2xvdC5wcm90b3R5cGUucmVuZGVyRmFsbGJhY2tDb250ZW50ID0gZnVuY3Rpb24gKHZpZXcsIG5vZGVzLCBwcm9qZWN0aW9uU291cmNlLCBpbmRleCkge1xyXG4gICAgICAgIGlmICh0aGlzLmNvbnRlbnRWaWV3ID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29udGVudFZpZXcgPSB0aGlzLmZhbGxiYWNrRmFjdG9yeS5jcmVhdGUodGhpcy5vd25lclZpZXcuY29udGFpbmVyKTtcclxuICAgICAgICAgICAgdGhpcy5jb250ZW50Vmlldy5iaW5kKHRoaXMub3duZXJWaWV3LmJpbmRpbmdDb250ZXh0LCB0aGlzLm93bmVyVmlldy5vdmVycmlkZUNvbnRleHQpO1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRlbnRWaWV3Lmluc2VydE5vZGVzQmVmb3JlKHRoaXMuYW5jaG9yKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuY29udGVudFZpZXcuaGFzU2xvdHMpIHtcclxuICAgICAgICAgICAgdmFyIHNsb3RzID0gdGhpcy5jb250ZW50Vmlldy5zbG90cztcclxuICAgICAgICAgICAgdmFyIHByb2plY3RGcm9tQW5jaG9ycyA9IHRoaXMucHJvamVjdEZyb21BbmNob3JzO1xyXG4gICAgICAgICAgICBpZiAocHJvamVjdEZyb21BbmNob3JzICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBzbG90TmFtZSBpbiBzbG90cykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzbG90ID0gc2xvdHNbc2xvdE5hbWVdO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IHByb2plY3RGcm9tQW5jaG9ycy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhbmNob3IgPSBwcm9qZWN0RnJvbUFuY2hvcnNbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNsb3QucHJvamVjdEZyb20oYW5jaG9yLmF1T3duZXJWaWV3LCBhbmNob3IuYXVTbG90UHJvamVjdEZyb20pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmZhbGxiYWNrU2xvdHMgPSBzbG90cztcclxuICAgICAgICAgICAgU2hhZG93RE9NLmRpc3RyaWJ1dGVOb2Rlcyh2aWV3LCBub2Rlcywgc2xvdHMsIHByb2plY3Rpb25Tb3VyY2UsIGluZGV4KTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgU2hhZG93U2xvdC5wcm90b3R5cGUuY3JlYXRlZCA9IGZ1bmN0aW9uIChvd25lclZpZXcpIHtcclxuICAgICAgICB0aGlzLm93bmVyVmlldyA9IG93bmVyVmlldztcclxuICAgIH07XHJcbiAgICBTaGFkb3dTbG90LnByb3RvdHlwZS5iaW5kID0gZnVuY3Rpb24gKHZpZXcpIHtcclxuICAgICAgICBpZiAodGhpcy5jb250ZW50Vmlldykge1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRlbnRWaWV3LmJpbmQodmlldy5iaW5kaW5nQ29udGV4dCwgdmlldy5vdmVycmlkZUNvbnRleHQpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBTaGFkb3dTbG90LnByb3RvdHlwZS5hdHRhY2hlZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAodGhpcy5jb250ZW50Vmlldykge1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRlbnRWaWV3LmF0dGFjaGVkKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFNoYWRvd1Nsb3QucHJvdG90eXBlLmRldGFjaGVkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmNvbnRlbnRWaWV3KSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29udGVudFZpZXcuZGV0YWNoZWQoKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgU2hhZG93U2xvdC5wcm90b3R5cGUudW5iaW5kID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmNvbnRlbnRWaWV3KSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29udGVudFZpZXcudW5iaW5kKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIHJldHVybiBTaGFkb3dTbG90O1xyXG59KCkpO1xyXG52YXIgU2hhZG93RE9NID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIFNoYWRvd0RPTSgpIHtcclxuICAgIH1cclxuICAgIFNoYWRvd0RPTS5nZXRTbG90TmFtZSA9IGZ1bmN0aW9uIChub2RlKSB7XHJcbiAgICAgICAgaWYgKG5vZGUuYXVTbG90QXR0cmlidXRlID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFNoYWRvd0RPTS5kZWZhdWx0U2xvdEtleTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG5vZGUuYXVTbG90QXR0cmlidXRlLnZhbHVlO1xyXG4gICAgfTtcclxuICAgIFNoYWRvd0RPTS5kaXN0cmlidXRlVmlldyA9IGZ1bmN0aW9uICh2aWV3LCBzbG90cywgcHJvamVjdGlvblNvdXJjZSwgaW5kZXgsIGRlc3RpbmF0aW9uT3ZlcnJpZGUpIHtcclxuICAgICAgICB2YXIgbm9kZXM7XHJcbiAgICAgICAgaWYgKHZpZXcgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgbm9kZXMgPSBub05vZGVzO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdmFyIGNoaWxkTm9kZXMgPSB2aWV3LmZyYWdtZW50LmNoaWxkTm9kZXM7XHJcbiAgICAgICAgICAgIHZhciBpaSA9IGNoaWxkTm9kZXMubGVuZ3RoO1xyXG4gICAgICAgICAgICBub2RlcyA9IG5ldyBBcnJheShpaSk7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICAgICAgbm9kZXNbaV0gPSBjaGlsZE5vZGVzW2ldO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFNoYWRvd0RPTS5kaXN0cmlidXRlTm9kZXModmlldywgbm9kZXMsIHNsb3RzLCBwcm9qZWN0aW9uU291cmNlLCBpbmRleCwgZGVzdGluYXRpb25PdmVycmlkZSk7XHJcbiAgICB9O1xyXG4gICAgU2hhZG93RE9NLnVuZGlzdHJpYnV0ZVZpZXcgPSBmdW5jdGlvbiAodmlldywgc2xvdHMsIHByb2plY3Rpb25Tb3VyY2UpIHtcclxuICAgICAgICBmb3IgKHZhciBzbG90TmFtZSBpbiBzbG90cykge1xyXG4gICAgICAgICAgICBzbG90c1tzbG90TmFtZV0ucmVtb3ZlVmlldyh2aWV3LCBwcm9qZWN0aW9uU291cmNlKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgU2hhZG93RE9NLnVuZGlzdHJpYnV0ZUFsbCA9IGZ1bmN0aW9uIChzbG90cywgcHJvamVjdGlvblNvdXJjZSkge1xyXG4gICAgICAgIGZvciAodmFyIHNsb3ROYW1lIGluIHNsb3RzKSB7XHJcbiAgICAgICAgICAgIHNsb3RzW3Nsb3ROYW1lXS5yZW1vdmVBbGwocHJvamVjdGlvblNvdXJjZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFNoYWRvd0RPTS5kaXN0cmlidXRlTm9kZXMgPSBmdW5jdGlvbiAodmlldywgbm9kZXMsIHNsb3RzLCBwcm9qZWN0aW9uU291cmNlLCBpbmRleCwgZGVzdGluYXRpb25PdmVycmlkZSkge1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IG5vZGVzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgdmFyIGN1cnJlbnROb2RlID0gbm9kZXNbaV07XHJcbiAgICAgICAgICAgIHZhciBub2RlVHlwZSA9IGN1cnJlbnROb2RlLm5vZGVUeXBlO1xyXG4gICAgICAgICAgICBpZiAoY3VycmVudE5vZGUuaXNDb250ZW50UHJvamVjdGlvblNvdXJjZSkge1xyXG4gICAgICAgICAgICAgICAgY3VycmVudE5vZGUudmlld1Nsb3QucHJvamVjdFRvKHNsb3RzKTtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIHNsb3ROYW1lIGluIHNsb3RzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2xvdHNbc2xvdE5hbWVdLnByb2plY3RGcm9tKHZpZXcsIGN1cnJlbnROb2RlLnZpZXdTbG90KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIG5vZGVzLnNwbGljZShpLCAxKTtcclxuICAgICAgICAgICAgICAgIGlpLS07XHJcbiAgICAgICAgICAgICAgICBpLS07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAobm9kZVR5cGUgPT09IDEgfHwgbm9kZVR5cGUgPT09IDMgfHwgY3VycmVudE5vZGUudmlld1Nsb3QgaW5zdGFuY2VvZiBQYXNzVGhyb3VnaFNsb3QpIHtcclxuICAgICAgICAgICAgICAgIGlmIChub2RlVHlwZSA9PT0gMyAmJiBfaXNBbGxXaGl0ZXNwYWNlKGN1cnJlbnROb2RlKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG5vZGVzLnNwbGljZShpLCAxKTtcclxuICAgICAgICAgICAgICAgICAgICBpaS0tO1xyXG4gICAgICAgICAgICAgICAgICAgIGktLTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBmb3VuZCA9IHNsb3RzW2Rlc3RpbmF0aW9uT3ZlcnJpZGUgfHwgU2hhZG93RE9NLmdldFNsb3ROYW1lKGN1cnJlbnROb2RlKV07XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZvdW5kKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvdW5kLmFkZE5vZGUodmlldywgY3VycmVudE5vZGUsIHByb2plY3Rpb25Tb3VyY2UsIGluZGV4KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbm9kZXMuc3BsaWNlKGksIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpaS0tO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpLS07XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgbm9kZXMuc3BsaWNlKGksIDEpO1xyXG4gICAgICAgICAgICAgICAgaWktLTtcclxuICAgICAgICAgICAgICAgIGktLTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBmb3IgKHZhciBzbG90TmFtZSBpbiBzbG90cykge1xyXG4gICAgICAgICAgICB2YXIgc2xvdCA9IHNsb3RzW3Nsb3ROYW1lXTtcclxuICAgICAgICAgICAgaWYgKHNsb3QubmVlZHNGYWxsYmFja1JlbmRlcmluZykge1xyXG4gICAgICAgICAgICAgICAgc2xvdC5yZW5kZXJGYWxsYmFja0NvbnRlbnQodmlldywgbm9kZXMsIHByb2plY3Rpb25Tb3VyY2UsIGluZGV4KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBTaGFkb3dET00uZGVmYXVsdFNsb3RLZXkgPSAnX19hdS1kZWZhdWx0LXNsb3Qta2V5X18nO1xyXG4gICAgcmV0dXJuIFNoYWRvd0RPTTtcclxufSgpKTtcblxudmFyIENvbXBvc2l0aW9uVHJhbnNhY3Rpb25Ob3RpZmllciA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBDb21wb3NpdGlvblRyYW5zYWN0aW9uTm90aWZpZXIob3duZXIpIHtcclxuICAgICAgICB0aGlzLm93bmVyID0gb3duZXI7XHJcbiAgICAgICAgdGhpcy5vd25lci5fY29tcG9zaXRpb25Db3VudCsrO1xyXG4gICAgfVxyXG4gICAgQ29tcG9zaXRpb25UcmFuc2FjdGlvbk5vdGlmaWVyLnByb3RvdHlwZS5kb25lID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRoaXMub3duZXIuX2NvbXBvc2l0aW9uQ291bnQtLTtcclxuICAgICAgICB0aGlzLm93bmVyLl90cnlDb21wbGV0ZVRyYW5zYWN0aW9uKCk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIENvbXBvc2l0aW9uVHJhbnNhY3Rpb25Ob3RpZmllcjtcclxufSgpKTtcclxudmFyIENvbXBvc2l0aW9uVHJhbnNhY3Rpb25Pd25lcnNoaXBUb2tlbiA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBDb21wb3NpdGlvblRyYW5zYWN0aW9uT3duZXJzaGlwVG9rZW4ob3duZXIpIHtcclxuICAgICAgICB0aGlzLm93bmVyID0gb3duZXI7XHJcbiAgICAgICAgdGhpcy5vd25lci5fb3duZXJzaGlwVG9rZW4gPSB0aGlzO1xyXG4gICAgICAgIHRoaXMudGhlbmFibGUgPSB0aGlzLl9jcmVhdGVUaGVuYWJsZSgpO1xyXG4gICAgfVxyXG4gICAgQ29tcG9zaXRpb25UcmFuc2FjdGlvbk93bmVyc2hpcFRva2VuLnByb3RvdHlwZS53YWl0Rm9yQ29tcG9zaXRpb25Db21wbGV0ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLm93bmVyLl90cnlDb21wbGV0ZVRyYW5zYWN0aW9uKCk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudGhlbmFibGU7XHJcbiAgICB9O1xyXG4gICAgQ29tcG9zaXRpb25UcmFuc2FjdGlvbk93bmVyc2hpcFRva2VuLnByb3RvdHlwZS5yZXNvbHZlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRoaXMuX3Jlc29sdmVDYWxsYmFjaygpO1xyXG4gICAgfTtcclxuICAgIENvbXBvc2l0aW9uVHJhbnNhY3Rpb25Pd25lcnNoaXBUb2tlbi5wcm90b3R5cGUuX3Jlc29sdmVDYWxsYmFjayA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJNZXRob2Qgbm90IGltcGxlbWVudGVkLlwiKTtcclxuICAgIH07XHJcbiAgICBDb21wb3NpdGlvblRyYW5zYWN0aW9uT3duZXJzaGlwVG9rZW4ucHJvdG90eXBlLl9jcmVhdGVUaGVuYWJsZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkge1xyXG4gICAgICAgICAgICBfdGhpcy5fcmVzb2x2ZUNhbGxiYWNrID0gcmVzb2x2ZTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gQ29tcG9zaXRpb25UcmFuc2FjdGlvbk93bmVyc2hpcFRva2VuO1xyXG59KCkpO1xyXG52YXIgQ29tcG9zaXRpb25UcmFuc2FjdGlvbiA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBDb21wb3NpdGlvblRyYW5zYWN0aW9uKCkge1xyXG4gICAgICAgIHRoaXMuX293bmVyc2hpcFRva2VuID0gbnVsbDtcclxuICAgICAgICB0aGlzLl9jb21wb3NpdGlvbkNvdW50ID0gMDtcclxuICAgIH1cclxuICAgIENvbXBvc2l0aW9uVHJhbnNhY3Rpb24ucHJvdG90eXBlLnRyeUNhcHR1cmUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX293bmVyc2hpcFRva2VuID09PSBudWxsXHJcbiAgICAgICAgICAgID8gbmV3IENvbXBvc2l0aW9uVHJhbnNhY3Rpb25Pd25lcnNoaXBUb2tlbih0aGlzKVxyXG4gICAgICAgICAgICA6IG51bGw7XHJcbiAgICB9O1xyXG4gICAgQ29tcG9zaXRpb25UcmFuc2FjdGlvbi5wcm90b3R5cGUuZW5saXN0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBuZXcgQ29tcG9zaXRpb25UcmFuc2FjdGlvbk5vdGlmaWVyKHRoaXMpO1xyXG4gICAgfTtcclxuICAgIENvbXBvc2l0aW9uVHJhbnNhY3Rpb24ucHJvdG90eXBlLl90cnlDb21wbGV0ZVRyYW5zYWN0aW9uID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmICh0aGlzLl9jb21wb3NpdGlvbkNvdW50IDw9IDApIHtcclxuICAgICAgICAgICAgdGhpcy5fY29tcG9zaXRpb25Db3VudCA9IDA7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLl9vd25lcnNoaXBUb2tlbiAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHRva2VuID0gdGhpcy5fb3duZXJzaGlwVG9rZW47XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9vd25lcnNoaXBUb2tlbiA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICB0b2tlbi5yZXNvbHZlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIENvbXBvc2l0aW9uVHJhbnNhY3Rpb247XHJcbn0oKSk7XG5cbnZhciBWaWV3ID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIFZpZXcoY29udGFpbmVyLCB2aWV3RmFjdG9yeSwgZnJhZ21lbnQsIGNvbnRyb2xsZXJzLCBiaW5kaW5ncywgY2hpbGRyZW4sIHNsb3RzKSB7XHJcbiAgICAgICAgdGhpcy5jb250YWluZXIgPSBjb250YWluZXI7XHJcbiAgICAgICAgdGhpcy52aWV3RmFjdG9yeSA9IHZpZXdGYWN0b3J5O1xyXG4gICAgICAgIHRoaXMucmVzb3VyY2VzID0gdmlld0ZhY3RvcnkucmVzb3VyY2VzO1xyXG4gICAgICAgIHRoaXMuZnJhZ21lbnQgPSBmcmFnbWVudDtcclxuICAgICAgICB0aGlzLmZpcnN0Q2hpbGQgPSBmcmFnbWVudC5maXJzdENoaWxkO1xyXG4gICAgICAgIHRoaXMubGFzdENoaWxkID0gZnJhZ21lbnQubGFzdENoaWxkO1xyXG4gICAgICAgIHRoaXMuY29udHJvbGxlcnMgPSBjb250cm9sbGVycztcclxuICAgICAgICB0aGlzLmJpbmRpbmdzID0gYmluZGluZ3M7XHJcbiAgICAgICAgdGhpcy5jaGlsZHJlbiA9IGNoaWxkcmVuO1xyXG4gICAgICAgIHRoaXMuc2xvdHMgPSBzbG90cztcclxuICAgICAgICB0aGlzLmhhc1Nsb3RzID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5mcm9tQ2FjaGUgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmlzQm91bmQgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmlzQXR0YWNoZWQgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmJpbmRpbmdDb250ZXh0ID0gbnVsbDtcclxuICAgICAgICB0aGlzLm92ZXJyaWRlQ29udGV4dCA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5jb250cm9sbGVyID0gbnVsbDtcclxuICAgICAgICB0aGlzLnZpZXdNb2RlbFNjb3BlID0gbnVsbDtcclxuICAgICAgICB0aGlzLmFuaW1hdGFibGVFbGVtZW50ID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIHRoaXMuX2lzVXNlckNvbnRyb2xsZWQgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmNvbnRlbnRWaWV3ID0gbnVsbDtcclxuICAgICAgICBmb3IgKHZhciBfIGluIHNsb3RzKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaGFzU2xvdHMgPSB0cnVlO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBWaWV3LnByb3RvdHlwZS5yZXR1cm5Ub0NhY2hlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRoaXMudmlld0ZhY3RvcnkucmV0dXJuVmlld1RvQ2FjaGUodGhpcyk7XHJcbiAgICB9O1xyXG4gICAgVmlldy5wcm90b3R5cGUuY3JlYXRlZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgaTtcclxuICAgICAgICB2YXIgaWk7XHJcbiAgICAgICAgdmFyIGNvbnRyb2xsZXJzID0gdGhpcy5jb250cm9sbGVycztcclxuICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IGNvbnRyb2xsZXJzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgY29udHJvbGxlcnNbaV0uY3JlYXRlZCh0aGlzKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgVmlldy5wcm90b3R5cGUuYmluZCA9IGZ1bmN0aW9uIChiaW5kaW5nQ29udGV4dCwgb3ZlcnJpZGVDb250ZXh0LCBfc3lzdGVtVXBkYXRlKSB7XHJcbiAgICAgICAgdmFyIGNvbnRyb2xsZXJzO1xyXG4gICAgICAgIHZhciBiaW5kaW5ncztcclxuICAgICAgICB2YXIgY2hpbGRyZW47XHJcbiAgICAgICAgdmFyIGk7XHJcbiAgICAgICAgdmFyIGlpO1xyXG4gICAgICAgIGlmIChfc3lzdGVtVXBkYXRlICYmIHRoaXMuX2lzVXNlckNvbnRyb2xsZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5pc0JvdW5kKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmJpbmRpbmdDb250ZXh0ID09PSBiaW5kaW5nQ29udGV4dCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMudW5iaW5kKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaXNCb3VuZCA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5iaW5kaW5nQ29udGV4dCA9IGJpbmRpbmdDb250ZXh0O1xyXG4gICAgICAgIHRoaXMub3ZlcnJpZGVDb250ZXh0ID0gb3ZlcnJpZGVDb250ZXh0IHx8IGNyZWF0ZU92ZXJyaWRlQ29udGV4dChiaW5kaW5nQ29udGV4dCk7XHJcbiAgICAgICAgdGhpcy5yZXNvdXJjZXMuX2ludm9rZUhvb2soJ2JlZm9yZUJpbmQnLCB0aGlzKTtcclxuICAgICAgICBiaW5kaW5ncyA9IHRoaXMuYmluZGluZ3M7XHJcbiAgICAgICAgZm9yIChpID0gMCwgaWkgPSBiaW5kaW5ncy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgIGJpbmRpbmdzW2ldLmJpbmQodGhpcyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLnZpZXdNb2RlbFNjb3BlICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIGJpbmRpbmdDb250ZXh0LmJpbmQodGhpcy52aWV3TW9kZWxTY29wZS5iaW5kaW5nQ29udGV4dCwgdGhpcy52aWV3TW9kZWxTY29wZS5vdmVycmlkZUNvbnRleHQpO1xyXG4gICAgICAgICAgICB0aGlzLnZpZXdNb2RlbFNjb3BlID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29udHJvbGxlcnMgPSB0aGlzLmNvbnRyb2xsZXJzO1xyXG4gICAgICAgIGZvciAoaSA9IDAsIGlpID0gY29udHJvbGxlcnMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICBjb250cm9sbGVyc1tpXS5iaW5kKHRoaXMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47XHJcbiAgICAgICAgZm9yIChpID0gMCwgaWkgPSBjaGlsZHJlbi5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgIGNoaWxkcmVuW2ldLmJpbmQoYmluZGluZ0NvbnRleHQsIG92ZXJyaWRlQ29udGV4dCwgdHJ1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmhhc1Nsb3RzKSB7XHJcbiAgICAgICAgICAgIFNoYWRvd0RPTS5kaXN0cmlidXRlVmlldyh0aGlzLmNvbnRlbnRWaWV3LCB0aGlzLnNsb3RzKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgVmlldy5wcm90b3R5cGUuYWRkQmluZGluZyA9IGZ1bmN0aW9uIChiaW5kaW5nKSB7XHJcbiAgICAgICAgdGhpcy5iaW5kaW5ncy5wdXNoKGJpbmRpbmcpO1xyXG4gICAgICAgIGlmICh0aGlzLmlzQm91bmQpIHtcclxuICAgICAgICAgICAgYmluZGluZy5iaW5kKHRoaXMpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBWaWV3LnByb3RvdHlwZS51bmJpbmQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGNvbnRyb2xsZXJzO1xyXG4gICAgICAgIHZhciBiaW5kaW5ncztcclxuICAgICAgICB2YXIgY2hpbGRyZW47XHJcbiAgICAgICAgdmFyIGk7XHJcbiAgICAgICAgdmFyIGlpO1xyXG4gICAgICAgIGlmICh0aGlzLmlzQm91bmQpIHtcclxuICAgICAgICAgICAgdGhpcy5pc0JvdW5kID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHRoaXMucmVzb3VyY2VzLl9pbnZva2VIb29rKCdiZWZvcmVVbmJpbmQnLCB0aGlzKTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuY29udHJvbGxlciAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jb250cm9sbGVyLnVuYmluZCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGJpbmRpbmdzID0gdGhpcy5iaW5kaW5ncztcclxuICAgICAgICAgICAgZm9yIChpID0gMCwgaWkgPSBiaW5kaW5ncy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgICAgICBiaW5kaW5nc1tpXS51bmJpbmQoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb250cm9sbGVycyA9IHRoaXMuY29udHJvbGxlcnM7XHJcbiAgICAgICAgICAgIGZvciAoaSA9IDAsIGlpID0gY29udHJvbGxlcnMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcnNbaV0udW5iaW5kKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuO1xyXG4gICAgICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IGNoaWxkcmVuLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgICAgIGNoaWxkcmVuW2ldLnVuYmluZCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuYmluZGluZ0NvbnRleHQgPSBudWxsO1xyXG4gICAgICAgICAgICB0aGlzLm92ZXJyaWRlQ29udGV4dCA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFZpZXcucHJvdG90eXBlLmluc2VydE5vZGVzQmVmb3JlID0gZnVuY3Rpb24gKHJlZk5vZGUpIHtcclxuICAgICAgICByZWZOb2RlLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHRoaXMuZnJhZ21lbnQsIHJlZk5vZGUpO1xyXG4gICAgfTtcclxuICAgIFZpZXcucHJvdG90eXBlLmFwcGVuZE5vZGVzVG8gPSBmdW5jdGlvbiAocGFyZW50KSB7XHJcbiAgICAgICAgcGFyZW50LmFwcGVuZENoaWxkKHRoaXMuZnJhZ21lbnQpO1xyXG4gICAgfTtcclxuICAgIFZpZXcucHJvdG90eXBlLnJlbW92ZU5vZGVzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBmcmFnbWVudCA9IHRoaXMuZnJhZ21lbnQ7XHJcbiAgICAgICAgdmFyIGN1cnJlbnQgPSB0aGlzLmZpcnN0Q2hpbGQ7XHJcbiAgICAgICAgdmFyIGVuZCA9IHRoaXMubGFzdENoaWxkO1xyXG4gICAgICAgIHZhciBuZXh0O1xyXG4gICAgICAgIHdoaWxlIChjdXJyZW50KSB7XHJcbiAgICAgICAgICAgIG5leHQgPSBjdXJyZW50Lm5leHRTaWJsaW5nO1xyXG4gICAgICAgICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZChjdXJyZW50KTtcclxuICAgICAgICAgICAgaWYgKGN1cnJlbnQgPT09IGVuZCkge1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY3VycmVudCA9IG5leHQ7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFZpZXcucHJvdG90eXBlLmF0dGFjaGVkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBjb250cm9sbGVycztcclxuICAgICAgICB2YXIgY2hpbGRyZW47XHJcbiAgICAgICAgdmFyIGk7XHJcbiAgICAgICAgdmFyIGlpO1xyXG4gICAgICAgIGlmICh0aGlzLmlzQXR0YWNoZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmlzQXR0YWNoZWQgPSB0cnVlO1xyXG4gICAgICAgIGlmICh0aGlzLmNvbnRyb2xsZXIgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgdGhpcy5jb250cm9sbGVyLmF0dGFjaGVkKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnRyb2xsZXJzID0gdGhpcy5jb250cm9sbGVycztcclxuICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IGNvbnRyb2xsZXJzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgY29udHJvbGxlcnNbaV0uYXR0YWNoZWQoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuO1xyXG4gICAgICAgIGZvciAoaSA9IDAsIGlpID0gY2hpbGRyZW4ubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICBjaGlsZHJlbltpXS5hdHRhY2hlZCgpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBWaWV3LnByb3RvdHlwZS5kZXRhY2hlZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgY29udHJvbGxlcnM7XHJcbiAgICAgICAgdmFyIGNoaWxkcmVuO1xyXG4gICAgICAgIHZhciBpO1xyXG4gICAgICAgIHZhciBpaTtcclxuICAgICAgICBpZiAodGhpcy5pc0F0dGFjaGVkKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaXNBdHRhY2hlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5jb250cm9sbGVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNvbnRyb2xsZXIuZGV0YWNoZWQoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb250cm9sbGVycyA9IHRoaXMuY29udHJvbGxlcnM7XHJcbiAgICAgICAgICAgIGZvciAoaSA9IDAsIGlpID0gY29udHJvbGxlcnMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcnNbaV0uZGV0YWNoZWQoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47XHJcbiAgICAgICAgICAgIGZvciAoaSA9IDAsIGlpID0gY2hpbGRyZW4ubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICAgICAgY2hpbGRyZW5baV0uZGV0YWNoZWQoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICByZXR1cm4gVmlldztcclxufSgpKTtcblxudmFyIEFuaW1hdG9yID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIEFuaW1hdG9yKCkge1xyXG4gICAgfVxyXG4gICAgQW5pbWF0b3IucHJvdG90eXBlLmVudGVyID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGZhbHNlKTtcclxuICAgIH07XHJcbiAgICBBbmltYXRvci5wcm90b3R5cGUubGVhdmUgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoZmFsc2UpO1xyXG4gICAgfTtcclxuICAgIEFuaW1hdG9yLnByb3RvdHlwZS5yZW1vdmVDbGFzcyA9IGZ1bmN0aW9uIChlbGVtZW50LCBjbGFzc05hbWUpIHtcclxuICAgICAgICBlbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoY2xhc3NOYW1lKTtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGZhbHNlKTtcclxuICAgIH07XHJcbiAgICBBbmltYXRvci5wcm90b3R5cGUuYWRkQ2xhc3MgPSBmdW5jdGlvbiAoZWxlbWVudCwgY2xhc3NOYW1lKSB7XHJcbiAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKGNsYXNzTmFtZSk7XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShmYWxzZSk7XHJcbiAgICB9O1xyXG4gICAgQW5pbWF0b3IucHJvdG90eXBlLmFuaW1hdGUgPSBmdW5jdGlvbiAoZWxlbWVudCwgY2xhc3NOYW1lKSB7XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShmYWxzZSk7XHJcbiAgICB9O1xyXG4gICAgQW5pbWF0b3IucHJvdG90eXBlLnJ1blNlcXVlbmNlID0gZnVuY3Rpb24gKGFuaW1hdGlvbnMpIHtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGZhbHNlKTtcclxuICAgIH07XHJcbiAgICBBbmltYXRvci5wcm90b3R5cGUucmVnaXN0ZXJFZmZlY3QgPSBmdW5jdGlvbiAoZWZmZWN0TmFtZSwgcHJvcGVydGllcykgeyB9O1xyXG4gICAgQW5pbWF0b3IucHJvdG90eXBlLnVucmVnaXN0ZXJFZmZlY3QgPSBmdW5jdGlvbiAoZWZmZWN0TmFtZSkgeyB9O1xyXG4gICAgcmV0dXJuIEFuaW1hdG9yO1xyXG59KCkpO1xuXG5mdW5jdGlvbiBnZXRBbmltYXRhYmxlRWxlbWVudCh2aWV3KSB7XHJcbiAgICBpZiAodmlldy5hbmltYXRhYmxlRWxlbWVudCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgcmV0dXJuIHZpZXcuYW5pbWF0YWJsZUVsZW1lbnQ7XHJcbiAgICB9XHJcbiAgICB2YXIgY3VycmVudCA9IHZpZXcuZmlyc3RDaGlsZDtcclxuICAgIHdoaWxlIChjdXJyZW50ICYmIGN1cnJlbnQubm9kZVR5cGUgIT09IDEpIHtcclxuICAgICAgICBjdXJyZW50ID0gY3VycmVudC5uZXh0U2libGluZztcclxuICAgIH1cclxuICAgIGlmIChjdXJyZW50ICYmIGN1cnJlbnQubm9kZVR5cGUgPT09IDEpIHtcclxuICAgICAgICByZXR1cm4gKHZpZXcuYW5pbWF0YWJsZUVsZW1lbnQgPSBjdXJyZW50LmNsYXNzTGlzdC5jb250YWlucygnYXUtYW5pbWF0ZScpID8gY3VycmVudCA6IG51bGwpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuICh2aWV3LmFuaW1hdGFibGVFbGVtZW50ID0gbnVsbCk7XHJcbn1cclxudmFyIFZpZXdTbG90ID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIFZpZXdTbG90KGFuY2hvciwgYW5jaG9ySXNDb250YWluZXIsIGFuaW1hdG9yKSB7XHJcbiAgICAgICAgaWYgKGFuaW1hdG9yID09PSB2b2lkIDApIHsgYW5pbWF0b3IgPSBBbmltYXRvci5pbnN0YW5jZTsgfVxyXG4gICAgICAgIHRoaXMuYW5jaG9yID0gYW5jaG9yO1xyXG4gICAgICAgIHRoaXMuYW5jaG9ySXNDb250YWluZXIgPSBhbmNob3JJc0NvbnRhaW5lcjtcclxuICAgICAgICB0aGlzLmJpbmRpbmdDb250ZXh0ID0gbnVsbDtcclxuICAgICAgICB0aGlzLm92ZXJyaWRlQ29udGV4dCA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5hbmltYXRvciA9IGFuaW1hdG9yO1xyXG4gICAgICAgIHRoaXMuY2hpbGRyZW4gPSBbXTtcclxuICAgICAgICB0aGlzLmlzQm91bmQgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmlzQXR0YWNoZWQgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmNvbnRlbnRTZWxlY3RvcnMgPSBudWxsO1xyXG4gICAgICAgIGFuY2hvci52aWV3U2xvdCA9IHRoaXM7XHJcbiAgICAgICAgYW5jaG9yLmlzQ29udGVudFByb2plY3Rpb25Tb3VyY2UgPSBmYWxzZTtcclxuICAgIH1cclxuICAgIFZpZXdTbG90LnByb3RvdHlwZS5hbmltYXRlVmlldyA9IGZ1bmN0aW9uICh2aWV3LCBkaXJlY3Rpb24pIHtcclxuICAgICAgICBpZiAoZGlyZWN0aW9uID09PSB2b2lkIDApIHsgZGlyZWN0aW9uID0gJ2VudGVyJzsgfVxyXG4gICAgICAgIHZhciBhbmltYXRhYmxlRWxlbWVudCA9IGdldEFuaW1hdGFibGVFbGVtZW50KHZpZXcpO1xyXG4gICAgICAgIGlmIChhbmltYXRhYmxlRWxlbWVudCAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICBzd2l0Y2ggKGRpcmVjdGlvbikge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnZW50ZXInOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmFuaW1hdG9yLmVudGVyKGFuaW1hdGFibGVFbGVtZW50KTtcclxuICAgICAgICAgICAgICAgIGNhc2UgJ2xlYXZlJzpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5hbmltYXRvci5sZWF2ZShhbmltYXRhYmxlRWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBhbmltYXRpb24gZGlyZWN0aW9uOiAnICsgZGlyZWN0aW9uKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBWaWV3U2xvdC5wcm90b3R5cGUudHJhbnNmb3JtQ2hpbGROb2Rlc0ludG9WaWV3ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBwYXJlbnQgPSB0aGlzLmFuY2hvcjtcclxuICAgICAgICB0aGlzLmNoaWxkcmVuLnB1c2goe1xyXG4gICAgICAgICAgICBmcmFnbWVudDogcGFyZW50LFxyXG4gICAgICAgICAgICBmaXJzdENoaWxkOiBwYXJlbnQuZmlyc3RDaGlsZCxcclxuICAgICAgICAgICAgbGFzdENoaWxkOiBwYXJlbnQubGFzdENoaWxkLFxyXG4gICAgICAgICAgICByZXR1cm5Ub0NhY2hlOiBmdW5jdGlvbiAoKSB7IH0sXHJcbiAgICAgICAgICAgIHJlbW92ZU5vZGVzOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbGFzdDtcclxuICAgICAgICAgICAgICAgIHdoaWxlIChsYXN0ID0gcGFyZW50Lmxhc3RDaGlsZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHBhcmVudC5yZW1vdmVDaGlsZChsYXN0KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgY3JlYXRlZDogZnVuY3Rpb24gKCkgeyB9LFxyXG4gICAgICAgICAgICBiaW5kOiBmdW5jdGlvbiAoKSB7IH0sXHJcbiAgICAgICAgICAgIHVuYmluZDogZnVuY3Rpb24gKCkgeyB9LFxyXG4gICAgICAgICAgICBhdHRhY2hlZDogZnVuY3Rpb24gKCkgeyB9LFxyXG4gICAgICAgICAgICBkZXRhY2hlZDogZnVuY3Rpb24gKCkgeyB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgVmlld1Nsb3QucHJvdG90eXBlLmJpbmQgPSBmdW5jdGlvbiAoYmluZGluZ0NvbnRleHQsIG92ZXJyaWRlQ29udGV4dCkge1xyXG4gICAgICAgIHZhciBpO1xyXG4gICAgICAgIHZhciBpaTtcclxuICAgICAgICB2YXIgY2hpbGRyZW47XHJcbiAgICAgICAgaWYgKHRoaXMuaXNCb3VuZCkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5iaW5kaW5nQ29udGV4dCA9PT0gYmluZGluZ0NvbnRleHQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLnVuYmluZCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmlzQm91bmQgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMuYmluZGluZ0NvbnRleHQgPSBiaW5kaW5nQ29udGV4dCA9IGJpbmRpbmdDb250ZXh0IHx8IHRoaXMuYmluZGluZ0NvbnRleHQ7XHJcbiAgICAgICAgdGhpcy5vdmVycmlkZUNvbnRleHQgPSBvdmVycmlkZUNvbnRleHQgPSBvdmVycmlkZUNvbnRleHQgfHwgdGhpcy5vdmVycmlkZUNvbnRleHQ7XHJcbiAgICAgICAgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuO1xyXG4gICAgICAgIGZvciAoaSA9IDAsIGlpID0gY2hpbGRyZW4ubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICBjaGlsZHJlbltpXS5iaW5kKGJpbmRpbmdDb250ZXh0LCBvdmVycmlkZUNvbnRleHQsIHRydWUpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBWaWV3U2xvdC5wcm90b3R5cGUudW5iaW5kID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmlzQm91bmQpIHtcclxuICAgICAgICAgICAgdmFyIGkgPSB2b2lkIDA7XHJcbiAgICAgICAgICAgIHZhciBpaSA9IHZvaWQgMDtcclxuICAgICAgICAgICAgdmFyIGNoaWxkcmVuID0gdGhpcy5jaGlsZHJlbjtcclxuICAgICAgICAgICAgdGhpcy5pc0JvdW5kID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHRoaXMuYmluZGluZ0NvbnRleHQgPSBudWxsO1xyXG4gICAgICAgICAgICB0aGlzLm92ZXJyaWRlQ29udGV4dCA9IG51bGw7XHJcbiAgICAgICAgICAgIGZvciAoaSA9IDAsIGlpID0gY2hpbGRyZW4ubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICAgICAgY2hpbGRyZW5baV0udW5iaW5kKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgVmlld1Nsb3QucHJvdG90eXBlLmFkZCA9IGZ1bmN0aW9uICh2aWV3KSB7XHJcbiAgICAgICAgaWYgKHRoaXMuYW5jaG9ySXNDb250YWluZXIpIHtcclxuICAgICAgICAgICAgdmlldy5hcHBlbmROb2Rlc1RvKHRoaXMuYW5jaG9yKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHZpZXcuaW5zZXJ0Tm9kZXNCZWZvcmUodGhpcy5hbmNob3IpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmNoaWxkcmVuLnB1c2godmlldyk7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNBdHRhY2hlZCkge1xyXG4gICAgICAgICAgICB2aWV3LmF0dGFjaGVkKCk7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmFuaW1hdGVWaWV3KHZpZXcsICdlbnRlcicpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBWaWV3U2xvdC5wcm90b3R5cGUuaW5zZXJ0ID0gZnVuY3Rpb24gKGluZGV4LCB2aWV3KSB7XHJcbiAgICAgICAgdmFyIGNoaWxkcmVuID0gdGhpcy5jaGlsZHJlbjtcclxuICAgICAgICB2YXIgbGVuZ3RoID0gY2hpbGRyZW4ubGVuZ3RoO1xyXG4gICAgICAgIGlmICgoaW5kZXggPT09IDAgJiYgbGVuZ3RoID09PSAwKSB8fCBpbmRleCA+PSBsZW5ndGgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuYWRkKHZpZXcpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2aWV3Lmluc2VydE5vZGVzQmVmb3JlKGNoaWxkcmVuW2luZGV4XS5maXJzdENoaWxkKTtcclxuICAgICAgICBjaGlsZHJlbi5zcGxpY2UoaW5kZXgsIDAsIHZpZXcpO1xyXG4gICAgICAgIGlmICh0aGlzLmlzQXR0YWNoZWQpIHtcclxuICAgICAgICAgICAgdmlldy5hdHRhY2hlZCgpO1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5hbmltYXRlVmlldyh2aWV3LCAnZW50ZXInKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgVmlld1Nsb3QucHJvdG90eXBlLm1vdmUgPSBmdW5jdGlvbiAoc291cmNlSW5kZXgsIHRhcmdldEluZGV4KSB7XHJcbiAgICAgICAgaWYgKHNvdXJjZUluZGV4ID09PSB0YXJnZXRJbmRleCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47XHJcbiAgICAgICAgdmFyIHZpZXcgPSBjaGlsZHJlbltzb3VyY2VJbmRleF07XHJcbiAgICAgICAgdmlldy5yZW1vdmVOb2RlcygpO1xyXG4gICAgICAgIHZpZXcuaW5zZXJ0Tm9kZXNCZWZvcmUoY2hpbGRyZW5bdGFyZ2V0SW5kZXhdLmZpcnN0Q2hpbGQpO1xyXG4gICAgICAgIGNoaWxkcmVuLnNwbGljZShzb3VyY2VJbmRleCwgMSk7XHJcbiAgICAgICAgY2hpbGRyZW4uc3BsaWNlKHRhcmdldEluZGV4LCAwLCB2aWV3KTtcclxuICAgIH07XHJcbiAgICBWaWV3U2xvdC5wcm90b3R5cGUucmVtb3ZlID0gZnVuY3Rpb24gKHZpZXcsIHJldHVyblRvQ2FjaGUsIHNraXBBbmltYXRpb24pIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5yZW1vdmVBdCh0aGlzLmNoaWxkcmVuLmluZGV4T2YodmlldyksIHJldHVyblRvQ2FjaGUsIHNraXBBbmltYXRpb24pO1xyXG4gICAgfTtcclxuICAgIFZpZXdTbG90LnByb3RvdHlwZS5yZW1vdmVNYW55ID0gZnVuY3Rpb24gKHZpZXdzVG9SZW1vdmUsIHJldHVyblRvQ2FjaGUsIHNraXBBbmltYXRpb24pIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHZhciBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47XHJcbiAgICAgICAgdmFyIGlpID0gdmlld3NUb1JlbW92ZS5sZW5ndGg7XHJcbiAgICAgICAgdmFyIGk7XHJcbiAgICAgICAgdmFyIHJtUHJvbWlzZXMgPSBbXTtcclxuICAgICAgICB2aWV3c1RvUmVtb3ZlLmZvckVhY2goZnVuY3Rpb24gKGNoaWxkKSB7XHJcbiAgICAgICAgICAgIGlmIChza2lwQW5pbWF0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICBjaGlsZC5yZW1vdmVOb2RlcygpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBhbmltYXRpb24gPSBfdGhpcy5hbmltYXRlVmlldyhjaGlsZCwgJ2xlYXZlJyk7XHJcbiAgICAgICAgICAgIGlmIChhbmltYXRpb24pIHtcclxuICAgICAgICAgICAgICAgIHJtUHJvbWlzZXMucHVzaChhbmltYXRpb24udGhlbihmdW5jdGlvbiAoKSB7IHJldHVybiBjaGlsZC5yZW1vdmVOb2RlcygpOyB9KSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjaGlsZC5yZW1vdmVOb2RlcygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdmFyIHJlbW92ZUFjdGlvbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKF90aGlzLmlzQXR0YWNoZWQpIHtcclxuICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmlld3NUb1JlbW92ZVtpXS5kZXRhY2hlZCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChyZXR1cm5Ub0NhY2hlKSB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZpZXdzVG9SZW1vdmVbaV0ucmV0dXJuVG9DYWNoZSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSBjaGlsZHJlbi5pbmRleE9mKHZpZXdzVG9SZW1vdmVbaV0pO1xyXG4gICAgICAgICAgICAgICAgaWYgKGluZGV4ID49IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBjaGlsZHJlbi5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICBpZiAocm1Qcm9taXNlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLmFsbChybVByb21pc2VzKS50aGVuKGZ1bmN0aW9uICgpIHsgcmV0dXJuIHJlbW92ZUFjdGlvbigpOyB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlbW92ZUFjdGlvbigpO1xyXG4gICAgfTtcclxuICAgIFZpZXdTbG90LnByb3RvdHlwZS5yZW1vdmVBdCA9IGZ1bmN0aW9uIChpbmRleCwgcmV0dXJuVG9DYWNoZSwgc2tpcEFuaW1hdGlvbikge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdmFyIHZpZXcgPSB0aGlzLmNoaWxkcmVuW2luZGV4XTtcclxuICAgICAgICB2YXIgcmVtb3ZlQWN0aW9uID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpbmRleCA9IF90aGlzLmNoaWxkcmVuLmluZGV4T2Yodmlldyk7XHJcbiAgICAgICAgICAgIHZpZXcucmVtb3ZlTm9kZXMoKTtcclxuICAgICAgICAgICAgX3RoaXMuY2hpbGRyZW4uc3BsaWNlKGluZGV4LCAxKTtcclxuICAgICAgICAgICAgaWYgKF90aGlzLmlzQXR0YWNoZWQpIHtcclxuICAgICAgICAgICAgICAgIHZpZXcuZGV0YWNoZWQoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAocmV0dXJuVG9DYWNoZSkge1xyXG4gICAgICAgICAgICAgICAgdmlldy5yZXR1cm5Ub0NhY2hlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHZpZXc7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBpZiAoIXNraXBBbmltYXRpb24pIHtcclxuICAgICAgICAgICAgdmFyIGFuaW1hdGlvbiA9IHRoaXMuYW5pbWF0ZVZpZXcodmlldywgJ2xlYXZlJyk7XHJcbiAgICAgICAgICAgIGlmIChhbmltYXRpb24pIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBhbmltYXRpb24udGhlbihmdW5jdGlvbiAoKSB7IHJldHVybiByZW1vdmVBY3Rpb24oKTsgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlbW92ZUFjdGlvbigpO1xyXG4gICAgfTtcclxuICAgIFZpZXdTbG90LnByb3RvdHlwZS5yZW1vdmVBbGwgPSBmdW5jdGlvbiAocmV0dXJuVG9DYWNoZSwgc2tpcEFuaW1hdGlvbikge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdmFyIGNoaWxkcmVuID0gdGhpcy5jaGlsZHJlbjtcclxuICAgICAgICB2YXIgaWkgPSBjaGlsZHJlbi5sZW5ndGg7XHJcbiAgICAgICAgdmFyIGk7XHJcbiAgICAgICAgdmFyIHJtUHJvbWlzZXMgPSBbXTtcclxuICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjaGlsZCkge1xyXG4gICAgICAgICAgICBpZiAoc2tpcEFuaW1hdGlvbikge1xyXG4gICAgICAgICAgICAgICAgY2hpbGQucmVtb3ZlTm9kZXMoKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgYW5pbWF0aW9uID0gX3RoaXMuYW5pbWF0ZVZpZXcoY2hpbGQsICdsZWF2ZScpO1xyXG4gICAgICAgICAgICBpZiAoYW5pbWF0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICBybVByb21pc2VzLnB1c2goYW5pbWF0aW9uLnRoZW4oZnVuY3Rpb24gKCkgeyByZXR1cm4gY2hpbGQucmVtb3ZlTm9kZXMoKTsgfSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY2hpbGQucmVtb3ZlTm9kZXMoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHZhciByZW1vdmVBY3Rpb24gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmIChfdGhpcy5pc0F0dGFjaGVkKSB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNoaWxkcmVuW2ldLmRldGFjaGVkKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHJldHVyblRvQ2FjaGUpIHtcclxuICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNoaWxkID0gY2hpbGRyZW5baV07XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNoaWxkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkLnJldHVyblRvQ2FjaGUoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgX3RoaXMuY2hpbGRyZW4gPSBbXTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIGlmIChybVByb21pc2VzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UuYWxsKHJtUHJvbWlzZXMpLnRoZW4oZnVuY3Rpb24gKCkgeyByZXR1cm4gcmVtb3ZlQWN0aW9uKCk7IH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVtb3ZlQWN0aW9uKCk7XHJcbiAgICB9O1xyXG4gICAgVmlld1Nsb3QucHJvdG90eXBlLmF0dGFjaGVkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBpO1xyXG4gICAgICAgIHZhciBpaTtcclxuICAgICAgICB2YXIgY2hpbGRyZW47XHJcbiAgICAgICAgdmFyIGNoaWxkO1xyXG4gICAgICAgIGlmICh0aGlzLmlzQXR0YWNoZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmlzQXR0YWNoZWQgPSB0cnVlO1xyXG4gICAgICAgIGNoaWxkcmVuID0gdGhpcy5jaGlsZHJlbjtcclxuICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IGNoaWxkcmVuLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgY2hpbGQgPSBjaGlsZHJlbltpXTtcclxuICAgICAgICAgICAgY2hpbGQuYXR0YWNoZWQoKTtcclxuICAgICAgICAgICAgdGhpcy5hbmltYXRlVmlldyhjaGlsZCwgJ2VudGVyJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFZpZXdTbG90LnByb3RvdHlwZS5kZXRhY2hlZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgaTtcclxuICAgICAgICB2YXIgaWk7XHJcbiAgICAgICAgdmFyIGNoaWxkcmVuO1xyXG4gICAgICAgIGlmICh0aGlzLmlzQXR0YWNoZWQpIHtcclxuICAgICAgICAgICAgdGhpcy5pc0F0dGFjaGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGNoaWxkcmVuID0gdGhpcy5jaGlsZHJlbjtcclxuICAgICAgICAgICAgZm9yIChpID0gMCwgaWkgPSBjaGlsZHJlbi5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgICAgICBjaGlsZHJlbltpXS5kZXRhY2hlZCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFZpZXdTbG90LnByb3RvdHlwZS5wcm9qZWN0VG8gPSBmdW5jdGlvbiAoc2xvdHMpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHRoaXMucHJvamVjdFRvU2xvdHMgPSBzbG90cztcclxuICAgICAgICB0aGlzLmFkZCA9IHRoaXMuX3Byb2plY3Rpb25BZGQ7XHJcbiAgICAgICAgdGhpcy5pbnNlcnQgPSB0aGlzLl9wcm9qZWN0aW9uSW5zZXJ0O1xyXG4gICAgICAgIHRoaXMubW92ZSA9IHRoaXMuX3Byb2plY3Rpb25Nb3ZlO1xyXG4gICAgICAgIHRoaXMucmVtb3ZlID0gdGhpcy5fcHJvamVjdGlvblJlbW92ZTtcclxuICAgICAgICB0aGlzLnJlbW92ZUF0ID0gdGhpcy5fcHJvamVjdGlvblJlbW92ZUF0O1xyXG4gICAgICAgIHRoaXMucmVtb3ZlTWFueSA9IHRoaXMuX3Byb2plY3Rpb25SZW1vdmVNYW55O1xyXG4gICAgICAgIHRoaXMucmVtb3ZlQWxsID0gdGhpcy5fcHJvamVjdGlvblJlbW92ZUFsbDtcclxuICAgICAgICB0aGlzLmNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKHZpZXcpIHsgcmV0dXJuIFNoYWRvd0RPTS5kaXN0cmlidXRlVmlldyh2aWV3LCBzbG90cywgX3RoaXMpOyB9KTtcclxuICAgIH07XHJcbiAgICBWaWV3U2xvdC5wcm90b3R5cGUuX3Byb2plY3Rpb25BZGQgPSBmdW5jdGlvbiAodmlldykge1xyXG4gICAgICAgIFNoYWRvd0RPTS5kaXN0cmlidXRlVmlldyh2aWV3LCB0aGlzLnByb2plY3RUb1Nsb3RzLCB0aGlzKTtcclxuICAgICAgICB0aGlzLmNoaWxkcmVuLnB1c2godmlldyk7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNBdHRhY2hlZCkge1xyXG4gICAgICAgICAgICB2aWV3LmF0dGFjaGVkKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFZpZXdTbG90LnByb3RvdHlwZS5fcHJvamVjdGlvbkluc2VydCA9IGZ1bmN0aW9uIChpbmRleCwgdmlldykge1xyXG4gICAgICAgIGlmICgoaW5kZXggPT09IDAgJiYgIXRoaXMuY2hpbGRyZW4ubGVuZ3RoKSB8fCBpbmRleCA+PSB0aGlzLmNoaWxkcmVuLmxlbmd0aCkge1xyXG4gICAgICAgICAgICB0aGlzLmFkZCh2aWV3KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIFNoYWRvd0RPTS5kaXN0cmlidXRlVmlldyh2aWV3LCB0aGlzLnByb2plY3RUb1Nsb3RzLCB0aGlzLCBpbmRleCk7XHJcbiAgICAgICAgICAgIHRoaXMuY2hpbGRyZW4uc3BsaWNlKGluZGV4LCAwLCB2aWV3KTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuaXNBdHRhY2hlZCkge1xyXG4gICAgICAgICAgICAgICAgdmlldy5hdHRhY2hlZCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFZpZXdTbG90LnByb3RvdHlwZS5fcHJvamVjdGlvbk1vdmUgPSBmdW5jdGlvbiAoc291cmNlSW5kZXgsIHRhcmdldEluZGV4KSB7XHJcbiAgICAgICAgaWYgKHNvdXJjZUluZGV4ID09PSB0YXJnZXRJbmRleCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47XHJcbiAgICAgICAgdmFyIHZpZXcgPSBjaGlsZHJlbltzb3VyY2VJbmRleF07XHJcbiAgICAgICAgU2hhZG93RE9NLnVuZGlzdHJpYnV0ZVZpZXcodmlldywgdGhpcy5wcm9qZWN0VG9TbG90cywgdGhpcyk7XHJcbiAgICAgICAgU2hhZG93RE9NLmRpc3RyaWJ1dGVWaWV3KHZpZXcsIHRoaXMucHJvamVjdFRvU2xvdHMsIHRoaXMsIHRhcmdldEluZGV4KTtcclxuICAgICAgICBjaGlsZHJlbi5zcGxpY2Uoc291cmNlSW5kZXgsIDEpO1xyXG4gICAgICAgIGNoaWxkcmVuLnNwbGljZSh0YXJnZXRJbmRleCwgMCwgdmlldyk7XHJcbiAgICB9O1xyXG4gICAgVmlld1Nsb3QucHJvdG90eXBlLl9wcm9qZWN0aW9uUmVtb3ZlID0gZnVuY3Rpb24gKHZpZXcsIHJldHVyblRvQ2FjaGUpIHtcclxuICAgICAgICBTaGFkb3dET00udW5kaXN0cmlidXRlVmlldyh2aWV3LCB0aGlzLnByb2plY3RUb1Nsb3RzLCB0aGlzKTtcclxuICAgICAgICB0aGlzLmNoaWxkcmVuLnNwbGljZSh0aGlzLmNoaWxkcmVuLmluZGV4T2YodmlldyksIDEpO1xyXG4gICAgICAgIGlmICh0aGlzLmlzQXR0YWNoZWQpIHtcclxuICAgICAgICAgICAgdmlldy5kZXRhY2hlZCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAocmV0dXJuVG9DYWNoZSkge1xyXG4gICAgICAgICAgICB2aWV3LnJldHVyblRvQ2FjaGUoKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgVmlld1Nsb3QucHJvdG90eXBlLl9wcm9qZWN0aW9uUmVtb3ZlQXQgPSBmdW5jdGlvbiAoaW5kZXgsIHJldHVyblRvQ2FjaGUpIHtcclxuICAgICAgICB2YXIgdmlldyA9IHRoaXMuY2hpbGRyZW5baW5kZXhdO1xyXG4gICAgICAgIFNoYWRvd0RPTS51bmRpc3RyaWJ1dGVWaWV3KHZpZXcsIHRoaXMucHJvamVjdFRvU2xvdHMsIHRoaXMpO1xyXG4gICAgICAgIHRoaXMuY2hpbGRyZW4uc3BsaWNlKGluZGV4LCAxKTtcclxuICAgICAgICBpZiAodGhpcy5pc0F0dGFjaGVkKSB7XHJcbiAgICAgICAgICAgIHZpZXcuZGV0YWNoZWQoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHJldHVyblRvQ2FjaGUpIHtcclxuICAgICAgICAgICAgdmlldy5yZXR1cm5Ub0NhY2hlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFZpZXdTbG90LnByb3RvdHlwZS5fcHJvamVjdGlvblJlbW92ZU1hbnkgPSBmdW5jdGlvbiAodmlld3NUb1JlbW92ZSwgcmV0dXJuVG9DYWNoZSkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdmlld3NUb1JlbW92ZS5mb3JFYWNoKGZ1bmN0aW9uICh2aWV3KSB7IHJldHVybiBfdGhpcy5yZW1vdmUodmlldywgcmV0dXJuVG9DYWNoZSk7IH0pO1xyXG4gICAgfTtcclxuICAgIFZpZXdTbG90LnByb3RvdHlwZS5fcHJvamVjdGlvblJlbW92ZUFsbCA9IGZ1bmN0aW9uIChyZXR1cm5Ub0NhY2hlKSB7XHJcbiAgICAgICAgU2hhZG93RE9NLnVuZGlzdHJpYnV0ZUFsbCh0aGlzLnByb2plY3RUb1Nsb3RzLCB0aGlzKTtcclxuICAgICAgICB2YXIgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuO1xyXG4gICAgICAgIHZhciBpaSA9IGNoaWxkcmVuLmxlbmd0aDtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgaWYgKHJldHVyblRvQ2FjaGUpIHtcclxuICAgICAgICAgICAgICAgIGNoaWxkcmVuW2ldLnJldHVyblRvQ2FjaGUoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmICh0aGlzLmlzQXR0YWNoZWQpIHtcclxuICAgICAgICAgICAgICAgIGNoaWxkcmVuW2ldLmRldGFjaGVkKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5jaGlsZHJlbiA9IFtdO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBWaWV3U2xvdDtcclxufSgpKTtcblxudmFyICRyZXNvbHZlciA9IHJlc29sdmVyO1xyXG52YXIgUHJvdmlkZXJSZXNvbHZlciA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBQcm92aWRlclJlc29sdmVyKCkge1xyXG4gICAgfVxyXG4gICAgUHJvdmlkZXJSZXNvbHZlci5wcm90b3R5cGUuZ2V0ID0gZnVuY3Rpb24gKGNvbnRhaW5lciwga2V5KSB7XHJcbiAgICAgICAgdmFyIGlkID0ga2V5Ll9fcHJvdmlkZXJJZF9fO1xyXG4gICAgICAgIHJldHVybiBpZCBpbiBjb250YWluZXIgPyBjb250YWluZXJbaWRdIDogKGNvbnRhaW5lcltpZF0gPSBjb250YWluZXIuaW52b2tlKGtleSkpO1xyXG4gICAgfTtcclxuICAgIFByb3ZpZGVyUmVzb2x2ZXIgPSBfX2RlY29yYXRlKFtcclxuICAgICAgICAkcmVzb2x2ZXJcclxuICAgIF0sIFByb3ZpZGVyUmVzb2x2ZXIpO1xyXG4gICAgcmV0dXJuIFByb3ZpZGVyUmVzb2x2ZXI7XHJcbn0oKSk7XHJcbnZhciBwcm92aWRlclJlc29sdmVySW5zdGFuY2UgPSBuZXcgUHJvdmlkZXJSZXNvbHZlcigpO1xyXG5mdW5jdGlvbiBlbGVtZW50Q29udGFpbmVyR2V0KGtleSkge1xyXG4gICAgaWYgKGtleSA9PT0gRE9NLkVsZW1lbnQpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5lbGVtZW50O1xyXG4gICAgfVxyXG4gICAgaWYgKGtleSA9PT0gQm91bmRWaWV3RmFjdG9yeSkge1xyXG4gICAgICAgIGlmICh0aGlzLmJvdW5kVmlld0ZhY3RvcnkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuYm91bmRWaWV3RmFjdG9yeTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIGZhY3RvcnkgPSB0aGlzLmluc3RydWN0aW9uLnZpZXdGYWN0b3J5O1xyXG4gICAgICAgIHZhciBwYXJ0UmVwbGFjZW1lbnRzID0gdGhpcy5wYXJ0UmVwbGFjZW1lbnRzO1xyXG4gICAgICAgIGlmIChwYXJ0UmVwbGFjZW1lbnRzKSB7XHJcbiAgICAgICAgICAgIGZhY3RvcnkgPSBwYXJ0UmVwbGFjZW1lbnRzW2ZhY3RvcnkucGFydF0gfHwgZmFjdG9yeTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5ib3VuZFZpZXdGYWN0b3J5ID0gbmV3IEJvdW5kVmlld0ZhY3RvcnkodGhpcywgZmFjdG9yeSwgcGFydFJlcGxhY2VtZW50cyk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuYm91bmRWaWV3RmFjdG9yeTtcclxuICAgIH1cclxuICAgIGlmIChrZXkgPT09IFZpZXdTbG90KSB7XHJcbiAgICAgICAgaWYgKHRoaXMudmlld1Nsb3QgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICB0aGlzLnZpZXdTbG90ID0gbmV3IFZpZXdTbG90KHRoaXMuZWxlbWVudCwgdGhpcy5pbnN0cnVjdGlvbi5hbmNob3JJc0NvbnRhaW5lcik7XHJcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5pc0NvbnRlbnRQcm9qZWN0aW9uU291cmNlID0gdGhpcy5pbnN0cnVjdGlvbi5saWZ0aW5nO1xyXG4gICAgICAgICAgICB0aGlzLmNoaWxkcmVuLnB1c2godGhpcy52aWV3U2xvdCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdTbG90O1xyXG4gICAgfVxyXG4gICAgaWYgKGtleSA9PT0gRWxlbWVudEV2ZW50cykge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmVsZW1lbnRFdmVudHMgfHwgKHRoaXMuZWxlbWVudEV2ZW50cyA9IG5ldyBFbGVtZW50RXZlbnRzKHRoaXMuZWxlbWVudCkpO1xyXG4gICAgfVxyXG4gICAgaWYgKGtleSA9PT0gQ29tcG9zaXRpb25UcmFuc2FjdGlvbikge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNvbXBvc2l0aW9uVHJhbnNhY3Rpb24gfHwgKHRoaXMuY29tcG9zaXRpb25UcmFuc2FjdGlvbiA9IHRoaXMucGFyZW50LmdldChrZXkpKTtcclxuICAgIH1cclxuICAgIGlmIChrZXkgPT09IFZpZXdSZXNvdXJjZXMpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy52aWV3UmVzb3VyY2VzO1xyXG4gICAgfVxyXG4gICAgaWYgKGtleSA9PT0gVGFyZ2V0SW5zdHJ1Y3Rpb24pIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5pbnN0cnVjdGlvbjtcclxuICAgIH1cclxuICAgIHJldHVybiB0aGlzLnN1cGVyR2V0KGtleSk7XHJcbn1cclxuZnVuY3Rpb24gY3JlYXRlRWxlbWVudENvbnRhaW5lcihwYXJlbnQsIGVsZW1lbnQsIGluc3RydWN0aW9uLCBjaGlsZHJlbiwgcGFydFJlcGxhY2VtZW50cywgcmVzb3VyY2VzKSB7XHJcbiAgICB2YXIgY29udGFpbmVyID0gcGFyZW50LmNyZWF0ZUNoaWxkKCk7XHJcbiAgICB2YXIgcHJvdmlkZXJzO1xyXG4gICAgdmFyIGk7XHJcbiAgICBjb250YWluZXIuZWxlbWVudCA9IGVsZW1lbnQ7XHJcbiAgICBjb250YWluZXIuaW5zdHJ1Y3Rpb24gPSBpbnN0cnVjdGlvbjtcclxuICAgIGNvbnRhaW5lci5jaGlsZHJlbiA9IGNoaWxkcmVuO1xyXG4gICAgY29udGFpbmVyLnZpZXdSZXNvdXJjZXMgPSByZXNvdXJjZXM7XHJcbiAgICBjb250YWluZXIucGFydFJlcGxhY2VtZW50cyA9IHBhcnRSZXBsYWNlbWVudHM7XHJcbiAgICBwcm92aWRlcnMgPSBpbnN0cnVjdGlvbi5wcm92aWRlcnM7XHJcbiAgICBpID0gcHJvdmlkZXJzLmxlbmd0aDtcclxuICAgIHdoaWxlIChpLS0pIHtcclxuICAgICAgICBjb250YWluZXIuX3Jlc29sdmVycy5zZXQocHJvdmlkZXJzW2ldLCBwcm92aWRlclJlc29sdmVySW5zdGFuY2UpO1xyXG4gICAgfVxyXG4gICAgY29udGFpbmVyLnN1cGVyR2V0ID0gY29udGFpbmVyLmdldDtcclxuICAgIGNvbnRhaW5lci5nZXQgPSBlbGVtZW50Q29udGFpbmVyR2V0O1xyXG4gICAgcmV0dXJuIGNvbnRhaW5lcjtcclxufVxyXG5mdW5jdGlvbiBoYXNBdHRyaWJ1dGUobmFtZSkge1xyXG4gICAgcmV0dXJuIHRoaXMuX2VsZW1lbnQuaGFzQXR0cmlidXRlKG5hbWUpO1xyXG59XHJcbmZ1bmN0aW9uIGdldEF0dHJpYnV0ZShuYW1lKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fZWxlbWVudC5nZXRBdHRyaWJ1dGUobmFtZSk7XHJcbn1cclxuZnVuY3Rpb24gc2V0QXR0cmlidXRlKG5hbWUsIHZhbHVlKSB7XHJcbiAgICB0aGlzLl9lbGVtZW50LnNldEF0dHJpYnV0ZShuYW1lLCB2YWx1ZSk7XHJcbn1cclxuZnVuY3Rpb24gbWFrZUVsZW1lbnRJbnRvQW5jaG9yKGVsZW1lbnQsIGVsZW1lbnRJbnN0cnVjdGlvbikge1xyXG4gICAgdmFyIGFuY2hvciA9IERPTS5jcmVhdGVDb21tZW50KCdhbmNob3InKTtcclxuICAgIGlmIChlbGVtZW50SW5zdHJ1Y3Rpb24pIHtcclxuICAgICAgICB2YXIgZmlyc3RDaGlsZCA9IGVsZW1lbnQuZmlyc3RDaGlsZDtcclxuICAgICAgICBpZiAoZmlyc3RDaGlsZCAmJiBmaXJzdENoaWxkLnRhZ05hbWUgPT09ICdBVS1DT05URU5UJykge1xyXG4gICAgICAgICAgICBhbmNob3IuY29udGVudEVsZW1lbnQgPSBmaXJzdENoaWxkO1xyXG4gICAgICAgIH1cclxuICAgICAgICBhbmNob3IuX2VsZW1lbnQgPSBlbGVtZW50O1xyXG4gICAgICAgIGFuY2hvci5oYXNBdHRyaWJ1dGUgPSBoYXNBdHRyaWJ1dGU7XHJcbiAgICAgICAgYW5jaG9yLmdldEF0dHJpYnV0ZSA9IGdldEF0dHJpYnV0ZTtcclxuICAgICAgICBhbmNob3Iuc2V0QXR0cmlidXRlID0gc2V0QXR0cmlidXRlO1xyXG4gICAgfVxyXG4gICAgRE9NLnJlcGxhY2VOb2RlKGFuY2hvciwgZWxlbWVudCk7XHJcbiAgICByZXR1cm4gYW5jaG9yO1xyXG59XHJcbmZ1bmN0aW9uIGFwcGx5SW5zdHJ1Y3Rpb25zKGNvbnRhaW5lcnMsIGVsZW1lbnQsIGluc3RydWN0aW9uLCBjb250cm9sbGVycywgYmluZGluZ3MsIGNoaWxkcmVuLCBzaGFkb3dTbG90cywgcGFydFJlcGxhY2VtZW50cywgcmVzb3VyY2VzKSB7XHJcbiAgICB2YXIgYmVoYXZpb3JJbnN0cnVjdGlvbnMgPSBpbnN0cnVjdGlvbi5iZWhhdmlvckluc3RydWN0aW9ucztcclxuICAgIHZhciBleHByZXNzaW9ucyA9IGluc3RydWN0aW9uLmV4cHJlc3Npb25zO1xyXG4gICAgdmFyIGVsZW1lbnRDb250YWluZXI7XHJcbiAgICB2YXIgaTtcclxuICAgIHZhciBpaTtcclxuICAgIHZhciBjdXJyZW50O1xyXG4gICAgdmFyIGluc3RhbmNlO1xyXG4gICAgaWYgKGluc3RydWN0aW9uLmNvbnRlbnRFeHByZXNzaW9uKSB7XHJcbiAgICAgICAgYmluZGluZ3MucHVzaChpbnN0cnVjdGlvbi5jb250ZW50RXhwcmVzc2lvbi5jcmVhdGVCaW5kaW5nKGVsZW1lbnQubmV4dFNpYmxpbmcpKTtcclxuICAgICAgICBlbGVtZW50Lm5leHRTaWJsaW5nLmF1SW50ZXJwb2xhdGlvblRhcmdldCA9IHRydWU7XHJcbiAgICAgICAgZWxlbWVudC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGVsZW1lbnQpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmIChpbnN0cnVjdGlvbi5zaGFkb3dTbG90KSB7XHJcbiAgICAgICAgdmFyIGNvbW1lbnRBbmNob3IgPSBET00uY3JlYXRlQ29tbWVudCgnc2xvdCcpO1xyXG4gICAgICAgIHZhciBzbG90ID0gdm9pZCAwO1xyXG4gICAgICAgIGlmIChpbnN0cnVjdGlvbi5zbG90RGVzdGluYXRpb24pIHtcclxuICAgICAgICAgICAgc2xvdCA9IG5ldyBQYXNzVGhyb3VnaFNsb3QoY29tbWVudEFuY2hvciwgaW5zdHJ1Y3Rpb24uc2xvdE5hbWUsIGluc3RydWN0aW9uLnNsb3REZXN0aW5hdGlvbiwgaW5zdHJ1Y3Rpb24uc2xvdEZhbGxiYWNrRmFjdG9yeSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBzbG90ID0gbmV3IFNoYWRvd1Nsb3QoY29tbWVudEFuY2hvciwgaW5zdHJ1Y3Rpb24uc2xvdE5hbWUsIGluc3RydWN0aW9uLnNsb3RGYWxsYmFja0ZhY3RvcnkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBET00ucmVwbGFjZU5vZGUoY29tbWVudEFuY2hvciwgZWxlbWVudCk7XHJcbiAgICAgICAgc2hhZG93U2xvdHNbaW5zdHJ1Y3Rpb24uc2xvdE5hbWVdID0gc2xvdDtcclxuICAgICAgICBjb250cm9sbGVycy5wdXNoKHNsb3QpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmIChpbnN0cnVjdGlvbi5sZXRFbGVtZW50KSB7XHJcbiAgICAgICAgZm9yIChpID0gMCwgaWkgPSBleHByZXNzaW9ucy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgIGJpbmRpbmdzLnB1c2goZXhwcmVzc2lvbnNbaV0uY3JlYXRlQmluZGluZygpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxlbWVudC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGVsZW1lbnQpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmIChiZWhhdmlvckluc3RydWN0aW9ucy5sZW5ndGgpIHtcclxuICAgICAgICBpZiAoIWluc3RydWN0aW9uLmFuY2hvcklzQ29udGFpbmVyKSB7XHJcbiAgICAgICAgICAgIGVsZW1lbnQgPSBtYWtlRWxlbWVudEludG9BbmNob3IoZWxlbWVudCwgaW5zdHJ1Y3Rpb24uZWxlbWVudEluc3RydWN0aW9uKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29udGFpbmVyc1tpbnN0cnVjdGlvbi5pbmplY3RvcklkXSA9IGVsZW1lbnRDb250YWluZXIgPVxyXG4gICAgICAgICAgICBjcmVhdGVFbGVtZW50Q29udGFpbmVyKGNvbnRhaW5lcnNbaW5zdHJ1Y3Rpb24ucGFyZW50SW5qZWN0b3JJZF0sIGVsZW1lbnQsIGluc3RydWN0aW9uLCBjaGlsZHJlbiwgcGFydFJlcGxhY2VtZW50cywgcmVzb3VyY2VzKTtcclxuICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IGJlaGF2aW9ySW5zdHJ1Y3Rpb25zLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgY3VycmVudCA9IGJlaGF2aW9ySW5zdHJ1Y3Rpb25zW2ldO1xyXG4gICAgICAgICAgICBpbnN0YW5jZSA9IGN1cnJlbnQudHlwZS5jcmVhdGUoZWxlbWVudENvbnRhaW5lciwgY3VycmVudCwgZWxlbWVudCwgYmluZGluZ3MpO1xyXG4gICAgICAgICAgICBjb250cm9sbGVycy5wdXNoKGluc3RhbmNlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBmb3IgKGkgPSAwLCBpaSA9IGV4cHJlc3Npb25zLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICBiaW5kaW5ncy5wdXNoKGV4cHJlc3Npb25zW2ldLmNyZWF0ZUJpbmRpbmcoZWxlbWVudCkpO1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIHN0eWxlU3RyaW5nVG9PYmplY3Qoc3R5bGUsIHRhcmdldCkge1xyXG4gICAgdmFyIGF0dHJpYnV0ZXMgPSBzdHlsZS5zcGxpdCgnOycpO1xyXG4gICAgdmFyIGZpcnN0SW5kZXhPZkNvbG9uO1xyXG4gICAgdmFyIGk7XHJcbiAgICB2YXIgY3VycmVudDtcclxuICAgIHZhciBrZXk7XHJcbiAgICB2YXIgdmFsdWU7XHJcbiAgICB0YXJnZXQgPSB0YXJnZXQgfHwge307XHJcbiAgICBmb3IgKGkgPSAwOyBpIDwgYXR0cmlidXRlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIGN1cnJlbnQgPSBhdHRyaWJ1dGVzW2ldO1xyXG4gICAgICAgIGZpcnN0SW5kZXhPZkNvbG9uID0gY3VycmVudC5pbmRleE9mKCc6Jyk7XHJcbiAgICAgICAga2V5ID0gY3VycmVudC5zdWJzdHJpbmcoMCwgZmlyc3RJbmRleE9mQ29sb24pLnRyaW0oKTtcclxuICAgICAgICB2YWx1ZSA9IGN1cnJlbnQuc3Vic3RyaW5nKGZpcnN0SW5kZXhPZkNvbG9uICsgMSkudHJpbSgpO1xyXG4gICAgICAgIHRhcmdldFtrZXldID0gdmFsdWU7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGFyZ2V0O1xyXG59XHJcbmZ1bmN0aW9uIHN0eWxlT2JqZWN0VG9TdHJpbmcob2JqKSB7XHJcbiAgICB2YXIgcmVzdWx0ID0gJyc7XHJcbiAgICBmb3IgKHZhciBrZXkgaW4gb2JqKSB7XHJcbiAgICAgICAgcmVzdWx0ICs9IGtleSArICc6JyArIG9ialtrZXldICsgJzsnO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxufVxyXG5mdW5jdGlvbiBhcHBseVN1cnJvZ2F0ZUluc3RydWN0aW9uKGNvbnRhaW5lciwgZWxlbWVudCwgaW5zdHJ1Y3Rpb24sIGNvbnRyb2xsZXJzLCBiaW5kaW5ncywgY2hpbGRyZW4pIHtcclxuICAgIHZhciBiZWhhdmlvckluc3RydWN0aW9ucyA9IGluc3RydWN0aW9uLmJlaGF2aW9ySW5zdHJ1Y3Rpb25zO1xyXG4gICAgdmFyIGV4cHJlc3Npb25zID0gaW5zdHJ1Y3Rpb24uZXhwcmVzc2lvbnM7XHJcbiAgICB2YXIgcHJvdmlkZXJzID0gaW5zdHJ1Y3Rpb24ucHJvdmlkZXJzO1xyXG4gICAgdmFyIHZhbHVlcyA9IGluc3RydWN0aW9uLnZhbHVlcztcclxuICAgIHZhciBpO1xyXG4gICAgdmFyIGlpO1xyXG4gICAgdmFyIGN1cnJlbnQ7XHJcbiAgICB2YXIgaW5zdGFuY2U7XHJcbiAgICB2YXIgY3VycmVudEF0dHJpYnV0ZVZhbHVlO1xyXG4gICAgaSA9IHByb3ZpZGVycy5sZW5ndGg7XHJcbiAgICB3aGlsZSAoaS0tKSB7XHJcbiAgICAgICAgY29udGFpbmVyLl9yZXNvbHZlcnMuc2V0KHByb3ZpZGVyc1tpXSwgcHJvdmlkZXJSZXNvbHZlckluc3RhbmNlKTtcclxuICAgIH1cclxuICAgIGZvciAodmFyIGtleSBpbiB2YWx1ZXMpIHtcclxuICAgICAgICBjdXJyZW50QXR0cmlidXRlVmFsdWUgPSBlbGVtZW50LmdldEF0dHJpYnV0ZShrZXkpO1xyXG4gICAgICAgIGlmIChjdXJyZW50QXR0cmlidXRlVmFsdWUpIHtcclxuICAgICAgICAgICAgaWYgKGtleSA9PT0gJ2NsYXNzJykge1xyXG4gICAgICAgICAgICAgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgY3VycmVudEF0dHJpYnV0ZVZhbHVlICsgJyAnICsgdmFsdWVzW2tleV0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKGtleSA9PT0gJ3N0eWxlJykge1xyXG4gICAgICAgICAgICAgICAgdmFyIHN0eWxlT2JqZWN0ID0gc3R5bGVTdHJpbmdUb09iamVjdCh2YWx1ZXNba2V5XSk7XHJcbiAgICAgICAgICAgICAgICBzdHlsZVN0cmluZ1RvT2JqZWN0KGN1cnJlbnRBdHRyaWJ1dGVWYWx1ZSwgc3R5bGVPYmplY3QpO1xyXG4gICAgICAgICAgICAgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ3N0eWxlJywgc3R5bGVPYmplY3RUb1N0cmluZyhzdHlsZU9iamVjdCkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBlbGVtZW50LnNldEF0dHJpYnV0ZShrZXksIHZhbHVlc1trZXldKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAoYmVoYXZpb3JJbnN0cnVjdGlvbnMubGVuZ3RoKSB7XHJcbiAgICAgICAgZm9yIChpID0gMCwgaWkgPSBiZWhhdmlvckluc3RydWN0aW9ucy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgIGN1cnJlbnQgPSBiZWhhdmlvckluc3RydWN0aW9uc1tpXTtcclxuICAgICAgICAgICAgaW5zdGFuY2UgPSBjdXJyZW50LnR5cGUuY3JlYXRlKGNvbnRhaW5lciwgY3VycmVudCwgZWxlbWVudCwgYmluZGluZ3MpO1xyXG4gICAgICAgICAgICBpZiAoaW5zdGFuY2UuY29udGVudFZpZXcpIHtcclxuICAgICAgICAgICAgICAgIGNoaWxkcmVuLnB1c2goaW5zdGFuY2UuY29udGVudFZpZXcpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXJzLnB1c2goaW5zdGFuY2UpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGZvciAoaSA9IDAsIGlpID0gZXhwcmVzc2lvbnMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgIGJpbmRpbmdzLnB1c2goZXhwcmVzc2lvbnNbaV0uY3JlYXRlQmluZGluZyhlbGVtZW50KSk7XHJcbiAgICB9XHJcbn1cclxudmFyIEJvdW5kVmlld0ZhY3RvcnkgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gQm91bmRWaWV3RmFjdG9yeShwYXJlbnRDb250YWluZXIsIHZpZXdGYWN0b3J5LCBwYXJ0UmVwbGFjZW1lbnRzKSB7XHJcbiAgICAgICAgdGhpcy5wYXJlbnRDb250YWluZXIgPSBwYXJlbnRDb250YWluZXI7XHJcbiAgICAgICAgdGhpcy52aWV3RmFjdG9yeSA9IHZpZXdGYWN0b3J5O1xyXG4gICAgICAgIHRoaXMuZmFjdG9yeUNyZWF0ZUluc3RydWN0aW9uID0geyBwYXJ0UmVwbGFjZW1lbnRzOiBwYXJ0UmVwbGFjZW1lbnRzIH07XHJcbiAgICB9XHJcbiAgICBCb3VuZFZpZXdGYWN0b3J5LnByb3RvdHlwZS5jcmVhdGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIHZpZXcgPSB0aGlzLnZpZXdGYWN0b3J5LmNyZWF0ZSh0aGlzLnBhcmVudENvbnRhaW5lci5jcmVhdGVDaGlsZCgpLCB0aGlzLmZhY3RvcnlDcmVhdGVJbnN0cnVjdGlvbik7XHJcbiAgICAgICAgdmlldy5faXNVc2VyQ29udHJvbGxlZCA9IHRydWU7XHJcbiAgICAgICAgcmV0dXJuIHZpZXc7XHJcbiAgICB9O1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEJvdW5kVmlld0ZhY3RvcnkucHJvdG90eXBlLCBcImlzQ2FjaGluZ1wiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnZpZXdGYWN0b3J5LmlzQ2FjaGluZztcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBCb3VuZFZpZXdGYWN0b3J5LnByb3RvdHlwZS5zZXRDYWNoZVNpemUgPSBmdW5jdGlvbiAoc2l6ZSwgZG9Ob3RPdmVycmlkZUlmQWxyZWFkeVNldCkge1xyXG4gICAgICAgIHRoaXMudmlld0ZhY3Rvcnkuc2V0Q2FjaGVTaXplKHNpemUsIGRvTm90T3ZlcnJpZGVJZkFscmVhZHlTZXQpO1xyXG4gICAgfTtcclxuICAgIEJvdW5kVmlld0ZhY3RvcnkucHJvdG90eXBlLmdldENhY2hlZFZpZXcgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld0ZhY3RvcnkuZ2V0Q2FjaGVkVmlldygpO1xyXG4gICAgfTtcclxuICAgIEJvdW5kVmlld0ZhY3RvcnkucHJvdG90eXBlLnJldHVyblZpZXdUb0NhY2hlID0gZnVuY3Rpb24gKHZpZXcpIHtcclxuICAgICAgICB0aGlzLnZpZXdGYWN0b3J5LnJldHVyblZpZXdUb0NhY2hlKHZpZXcpO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBCb3VuZFZpZXdGYWN0b3J5O1xyXG59KCkpO1xyXG52YXIgVmlld0ZhY3RvcnkgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gVmlld0ZhY3RvcnkodGVtcGxhdGUsIGluc3RydWN0aW9ucywgcmVzb3VyY2VzKSB7XHJcbiAgICAgICAgdGhpcy5pc0NhY2hpbmcgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLnRlbXBsYXRlID0gdGVtcGxhdGU7XHJcbiAgICAgICAgdGhpcy5pbnN0cnVjdGlvbnMgPSBpbnN0cnVjdGlvbnM7XHJcbiAgICAgICAgdGhpcy5yZXNvdXJjZXMgPSByZXNvdXJjZXM7XHJcbiAgICAgICAgdGhpcy5jYWNoZVNpemUgPSAtMTtcclxuICAgICAgICB0aGlzLmNhY2hlID0gbnVsbDtcclxuICAgIH1cclxuICAgIFZpZXdGYWN0b3J5LnByb3RvdHlwZS5zZXRDYWNoZVNpemUgPSBmdW5jdGlvbiAoc2l6ZSwgZG9Ob3RPdmVycmlkZUlmQWxyZWFkeVNldCkge1xyXG4gICAgICAgIGlmIChzaXplKSB7XHJcbiAgICAgICAgICAgIGlmIChzaXplID09PSAnKicpIHtcclxuICAgICAgICAgICAgICAgIHNpemUgPSBOdW1iZXIuTUFYX1ZBTFVFO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiBzaXplID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICAgICAgc2l6ZSA9IHBhcnNlSW50KHNpemUsIDEwKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5jYWNoZVNpemUgPT09IC0xIHx8ICFkb05vdE92ZXJyaWRlSWZBbHJlYWR5U2V0KSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2FjaGVTaXplID0gTnVtYmVyKHNpemUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5jYWNoZVNpemUgPiAwKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2FjaGUgPSBbXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2FjaGUgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmlzQ2FjaGluZyA9IHRoaXMuY2FjaGVTaXplID4gMDtcclxuICAgIH07XHJcbiAgICBWaWV3RmFjdG9yeS5wcm90b3R5cGUuZ2V0Q2FjaGVkVmlldyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jYWNoZSAhPT0gbnVsbCA/ICh0aGlzLmNhY2hlLnBvcCgpIHx8IG51bGwpIDogbnVsbDtcclxuICAgIH07XHJcbiAgICBWaWV3RmFjdG9yeS5wcm90b3R5cGUucmV0dXJuVmlld1RvQ2FjaGUgPSBmdW5jdGlvbiAodmlldykge1xyXG4gICAgICAgIGlmICh2aWV3LmlzQXR0YWNoZWQpIHtcclxuICAgICAgICAgICAgdmlldy5kZXRhY2hlZCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodmlldy5pc0JvdW5kKSB7XHJcbiAgICAgICAgICAgIHZpZXcudW5iaW5kKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmNhY2hlICE9PSBudWxsICYmIHRoaXMuY2FjaGUubGVuZ3RoIDwgdGhpcy5jYWNoZVNpemUpIHtcclxuICAgICAgICAgICAgdmlldy5mcm9tQ2FjaGUgPSB0cnVlO1xyXG4gICAgICAgICAgICB0aGlzLmNhY2hlLnB1c2godmlldyk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFZpZXdGYWN0b3J5LnByb3RvdHlwZS5jcmVhdGUgPSBmdW5jdGlvbiAoY29udGFpbmVyLCBjcmVhdGVJbnN0cnVjdGlvbiwgZWxlbWVudCkge1xyXG4gICAgICAgIGNyZWF0ZUluc3RydWN0aW9uID0gY3JlYXRlSW5zdHJ1Y3Rpb24gfHwgQmVoYXZpb3JJbnN0cnVjdGlvbi5ub3JtYWw7XHJcbiAgICAgICAgdmFyIGNhY2hlZFZpZXcgPSB0aGlzLmdldENhY2hlZFZpZXcoKTtcclxuICAgICAgICBpZiAoY2FjaGVkVmlldyAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICByZXR1cm4gY2FjaGVkVmlldztcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIGZyYWdtZW50ID0gY3JlYXRlSW5zdHJ1Y3Rpb24uZW5oYW5jZSA/IHRoaXMudGVtcGxhdGUgOiB0aGlzLnRlbXBsYXRlLmNsb25lTm9kZSh0cnVlKTtcclxuICAgICAgICB2YXIgaW5zdHJ1Y3RhYmxlcyA9IGZyYWdtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5hdS10YXJnZXQnKTtcclxuICAgICAgICB2YXIgaW5zdHJ1Y3Rpb25zID0gdGhpcy5pbnN0cnVjdGlvbnM7XHJcbiAgICAgICAgdmFyIHJlc291cmNlcyA9IHRoaXMucmVzb3VyY2VzO1xyXG4gICAgICAgIHZhciBjb250cm9sbGVycyA9IFtdO1xyXG4gICAgICAgIHZhciBiaW5kaW5ncyA9IFtdO1xyXG4gICAgICAgIHZhciBjaGlsZHJlbiA9IFtdO1xyXG4gICAgICAgIHZhciBzaGFkb3dTbG90cyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XHJcbiAgICAgICAgdmFyIGNvbnRhaW5lcnMgPSB7IHJvb3Q6IGNvbnRhaW5lciB9O1xyXG4gICAgICAgIHZhciBwYXJ0UmVwbGFjZW1lbnRzID0gY3JlYXRlSW5zdHJ1Y3Rpb24ucGFydFJlcGxhY2VtZW50cztcclxuICAgICAgICB2YXIgaTtcclxuICAgICAgICB2YXIgaWk7XHJcbiAgICAgICAgdmFyIHZpZXc7XHJcbiAgICAgICAgdmFyIGluc3RydWN0YWJsZTtcclxuICAgICAgICB2YXIgaW5zdHJ1Y3Rpb247XHJcbiAgICAgICAgdGhpcy5yZXNvdXJjZXMuX2ludm9rZUhvb2soJ2JlZm9yZUNyZWF0ZScsIHRoaXMsIGNvbnRhaW5lciwgZnJhZ21lbnQsIGNyZWF0ZUluc3RydWN0aW9uKTtcclxuICAgICAgICBpZiAoZWxlbWVudCAmJiB0aGlzLnN1cnJvZ2F0ZUluc3RydWN0aW9uICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIGFwcGx5U3Vycm9nYXRlSW5zdHJ1Y3Rpb24oY29udGFpbmVyLCBlbGVtZW50LCB0aGlzLnN1cnJvZ2F0ZUluc3RydWN0aW9uLCBjb250cm9sbGVycywgYmluZGluZ3MsIGNoaWxkcmVuKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGNyZWF0ZUluc3RydWN0aW9uLmVuaGFuY2UgJiYgZnJhZ21lbnQuaGFzQXR0cmlidXRlKCdhdS10YXJnZXQtaWQnKSkge1xyXG4gICAgICAgICAgICBpbnN0cnVjdGFibGUgPSBmcmFnbWVudDtcclxuICAgICAgICAgICAgaW5zdHJ1Y3Rpb24gPSBpbnN0cnVjdGlvbnNbaW5zdHJ1Y3RhYmxlLmdldEF0dHJpYnV0ZSgnYXUtdGFyZ2V0LWlkJyldO1xyXG4gICAgICAgICAgICBhcHBseUluc3RydWN0aW9ucyhjb250YWluZXJzLCBpbnN0cnVjdGFibGUsIGluc3RydWN0aW9uLCBjb250cm9sbGVycywgYmluZGluZ3MsIGNoaWxkcmVuLCBzaGFkb3dTbG90cywgcGFydFJlcGxhY2VtZW50cywgcmVzb3VyY2VzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZm9yIChpID0gMCwgaWkgPSBpbnN0cnVjdGFibGVzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgaW5zdHJ1Y3RhYmxlID0gaW5zdHJ1Y3RhYmxlc1tpXTtcclxuICAgICAgICAgICAgaW5zdHJ1Y3Rpb24gPSBpbnN0cnVjdGlvbnNbaW5zdHJ1Y3RhYmxlLmdldEF0dHJpYnV0ZSgnYXUtdGFyZ2V0LWlkJyldO1xyXG4gICAgICAgICAgICBhcHBseUluc3RydWN0aW9ucyhjb250YWluZXJzLCBpbnN0cnVjdGFibGUsIGluc3RydWN0aW9uLCBjb250cm9sbGVycywgYmluZGluZ3MsIGNoaWxkcmVuLCBzaGFkb3dTbG90cywgcGFydFJlcGxhY2VtZW50cywgcmVzb3VyY2VzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmlldyA9IG5ldyBWaWV3KGNvbnRhaW5lciwgdGhpcywgZnJhZ21lbnQsIGNvbnRyb2xsZXJzLCBiaW5kaW5ncywgY2hpbGRyZW4sIHNoYWRvd1Nsb3RzKTtcclxuICAgICAgICBpZiAoIWNyZWF0ZUluc3RydWN0aW9uLmluaXRpYXRlZEJ5QmVoYXZpb3IpIHtcclxuICAgICAgICAgICAgdmlldy5jcmVhdGVkKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMucmVzb3VyY2VzLl9pbnZva2VIb29rKCdhZnRlckNyZWF0ZScsIHZpZXcpO1xyXG4gICAgICAgIHJldHVybiB2aWV3O1xyXG4gICAgfTtcclxuICAgIHJldHVybiBWaWV3RmFjdG9yeTtcclxufSgpKTtcblxudmFyIG5leHRJbmplY3RvcklkID0gMDtcclxuZnVuY3Rpb24gZ2V0TmV4dEluamVjdG9ySWQoKSB7XHJcbiAgICByZXR1cm4gKytuZXh0SW5qZWN0b3JJZDtcclxufVxyXG52YXIgbGFzdEFVVGFyZ2V0SUQgPSAwO1xyXG5mdW5jdGlvbiBnZXROZXh0QVVUYXJnZXRJRCgpIHtcclxuICAgIHJldHVybiAoKytsYXN0QVVUYXJnZXRJRCkudG9TdHJpbmcoKTtcclxufVxyXG5mdW5jdGlvbiBtYWtlSW50b0luc3RydWN0aW9uVGFyZ2V0KGVsZW1lbnQpIHtcclxuICAgIHZhciB2YWx1ZSA9IGVsZW1lbnQuZ2V0QXR0cmlidXRlKCdjbGFzcycpO1xyXG4gICAgdmFyIGF1VGFyZ2V0SUQgPSBnZXROZXh0QVVUYXJnZXRJRCgpO1xyXG4gICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgKHZhbHVlID8gdmFsdWUgKyAnIGF1LXRhcmdldCcgOiAnYXUtdGFyZ2V0JykpO1xyXG4gICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2F1LXRhcmdldC1pZCcsIGF1VGFyZ2V0SUQpO1xyXG4gICAgcmV0dXJuIGF1VGFyZ2V0SUQ7XHJcbn1cclxuZnVuY3Rpb24gbWFrZVNoYWRvd1Nsb3QoY29tcGlsZXIsIHJlc291cmNlcywgbm9kZSwgaW5zdHJ1Y3Rpb25zLCBwYXJlbnRJbmplY3RvcklkKSB7XHJcbiAgICB2YXIgYXVTaGFkb3dTbG90ID0gRE9NLmNyZWF0ZUVsZW1lbnQoJ2F1LXNoYWRvdy1zbG90Jyk7XHJcbiAgICBET00ucmVwbGFjZU5vZGUoYXVTaGFkb3dTbG90LCBub2RlKTtcclxuICAgIHZhciBhdVRhcmdldElEID0gbWFrZUludG9JbnN0cnVjdGlvblRhcmdldChhdVNoYWRvd1Nsb3QpO1xyXG4gICAgdmFyIGluc3RydWN0aW9uID0gVGFyZ2V0SW5zdHJ1Y3Rpb24uc2hhZG93U2xvdChwYXJlbnRJbmplY3RvcklkKTtcclxuICAgIGluc3RydWN0aW9uLnNsb3ROYW1lID0gbm9kZS5nZXRBdHRyaWJ1dGUoJ25hbWUnKSB8fCBTaGFkb3dET00uZGVmYXVsdFNsb3RLZXk7XHJcbiAgICBpbnN0cnVjdGlvbi5zbG90RGVzdGluYXRpb24gPSBub2RlLmdldEF0dHJpYnV0ZSgnc2xvdCcpO1xyXG4gICAgaWYgKG5vZGUuaW5uZXJIVE1MLnRyaW0oKSkge1xyXG4gICAgICAgIHZhciBmcmFnbWVudCA9IERPTS5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XHJcbiAgICAgICAgdmFyIGNoaWxkID0gdm9pZCAwO1xyXG4gICAgICAgIHdoaWxlIChjaGlsZCA9IG5vZGUuZmlyc3RDaGlsZCkge1xyXG4gICAgICAgICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZChjaGlsZCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGluc3RydWN0aW9uLnNsb3RGYWxsYmFja0ZhY3RvcnkgPSBjb21waWxlci5jb21waWxlKGZyYWdtZW50LCByZXNvdXJjZXMpO1xyXG4gICAgfVxyXG4gICAgaW5zdHJ1Y3Rpb25zW2F1VGFyZ2V0SURdID0gaW5zdHJ1Y3Rpb247XHJcbiAgICByZXR1cm4gYXVTaGFkb3dTbG90O1xyXG59XHJcbnZhciBkZWZhdWx0TGV0SGFuZGxlciA9IEJpbmRpbmdMYW5ndWFnZS5wcm90b3R5cGUuY3JlYXRlTGV0RXhwcmVzc2lvbnM7XHJcbnZhciBWaWV3Q29tcGlsZXIgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gVmlld0NvbXBpbGVyKGJpbmRpbmdMYW5ndWFnZSwgcmVzb3VyY2VzKSB7XHJcbiAgICAgICAgdGhpcy5iaW5kaW5nTGFuZ3VhZ2UgPSBiaW5kaW5nTGFuZ3VhZ2U7XHJcbiAgICAgICAgdGhpcy5yZXNvdXJjZXMgPSByZXNvdXJjZXM7XHJcbiAgICB9XHJcbiAgICBWaWV3Q29tcGlsZXIuaW5qZWN0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBbQmluZGluZ0xhbmd1YWdlLCBWaWV3UmVzb3VyY2VzXTtcclxuICAgIH07XHJcbiAgICBWaWV3Q29tcGlsZXIucHJvdG90eXBlLmNvbXBpbGUgPSBmdW5jdGlvbiAoc291cmNlLCByZXNvdXJjZXMsIGNvbXBpbGVJbnN0cnVjdGlvbikge1xyXG4gICAgICAgIHJlc291cmNlcyA9IHJlc291cmNlcyB8fCB0aGlzLnJlc291cmNlcztcclxuICAgICAgICBjb21waWxlSW5zdHJ1Y3Rpb24gPSBjb21waWxlSW5zdHJ1Y3Rpb24gfHwgVmlld0NvbXBpbGVJbnN0cnVjdGlvbi5ub3JtYWw7XHJcbiAgICAgICAgc291cmNlID0gdHlwZW9mIHNvdXJjZSA9PT0gJ3N0cmluZycgPyBET00uY3JlYXRlVGVtcGxhdGVGcm9tTWFya3VwKHNvdXJjZSkgOiBzb3VyY2U7XHJcbiAgICAgICAgdmFyIGNvbnRlbnQ7XHJcbiAgICAgICAgdmFyIHBhcnQ7XHJcbiAgICAgICAgdmFyIGNhY2hlU2l6ZTtcclxuICAgICAgICBpZiAoc291cmNlLmNvbnRlbnQpIHtcclxuICAgICAgICAgICAgcGFydCA9IHNvdXJjZS5nZXRBdHRyaWJ1dGUoJ3BhcnQnKTtcclxuICAgICAgICAgICAgY2FjaGVTaXplID0gc291cmNlLmdldEF0dHJpYnV0ZSgndmlldy1jYWNoZScpO1xyXG4gICAgICAgICAgICBjb250ZW50ID0gRE9NLmFkb3B0Tm9kZShzb3VyY2UuY29udGVudCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBjb250ZW50ID0gc291cmNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb21waWxlSW5zdHJ1Y3Rpb24udGFyZ2V0U2hhZG93RE9NID0gY29tcGlsZUluc3RydWN0aW9uLnRhcmdldFNoYWRvd0RPTSAmJiBGRUFUVVJFLnNoYWRvd0RPTTtcclxuICAgICAgICByZXNvdXJjZXMuX2ludm9rZUhvb2soJ2JlZm9yZUNvbXBpbGUnLCBjb250ZW50LCByZXNvdXJjZXMsIGNvbXBpbGVJbnN0cnVjdGlvbik7XHJcbiAgICAgICAgdmFyIGluc3RydWN0aW9ucyA9IHt9O1xyXG4gICAgICAgIHRoaXMuX2NvbXBpbGVOb2RlKGNvbnRlbnQsIHJlc291cmNlcywgaW5zdHJ1Y3Rpb25zLCBzb3VyY2UsICdyb290JywgIWNvbXBpbGVJbnN0cnVjdGlvbi50YXJnZXRTaGFkb3dET00pO1xyXG4gICAgICAgIHZhciBmaXJzdENoaWxkID0gY29udGVudC5maXJzdENoaWxkO1xyXG4gICAgICAgIGlmIChmaXJzdENoaWxkICYmIGZpcnN0Q2hpbGQubm9kZVR5cGUgPT09IDEpIHtcclxuICAgICAgICAgICAgdmFyIHRhcmdldElkID0gZmlyc3RDaGlsZC5nZXRBdHRyaWJ1dGUoJ2F1LXRhcmdldC1pZCcpO1xyXG4gICAgICAgICAgICBpZiAodGFyZ2V0SWQpIHtcclxuICAgICAgICAgICAgICAgIHZhciBpbnMgPSBpbnN0cnVjdGlvbnNbdGFyZ2V0SWRdO1xyXG4gICAgICAgICAgICAgICAgaWYgKGlucy5zaGFkb3dTbG90IHx8IGlucy5saWZ0aW5nIHx8IChpbnMuZWxlbWVudEluc3RydWN0aW9uICYmICFpbnMuZWxlbWVudEluc3RydWN0aW9uLmFuY2hvcklzQ29udGFpbmVyKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlbnQuaW5zZXJ0QmVmb3JlKERPTS5jcmVhdGVDb21tZW50KCd2aWV3JyksIGZpcnN0Q2hpbGQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBmYWN0b3J5ID0gbmV3IFZpZXdGYWN0b3J5KGNvbnRlbnQsIGluc3RydWN0aW9ucywgcmVzb3VyY2VzKTtcclxuICAgICAgICBmYWN0b3J5LnN1cnJvZ2F0ZUluc3RydWN0aW9uID0gY29tcGlsZUluc3RydWN0aW9uLmNvbXBpbGVTdXJyb2dhdGUgPyB0aGlzLl9jb21waWxlU3Vycm9nYXRlKHNvdXJjZSwgcmVzb3VyY2VzKSA6IG51bGw7XHJcbiAgICAgICAgZmFjdG9yeS5wYXJ0ID0gcGFydDtcclxuICAgICAgICBpZiAoY2FjaGVTaXplKSB7XHJcbiAgICAgICAgICAgIGZhY3Rvcnkuc2V0Q2FjaGVTaXplKGNhY2hlU2l6ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJlc291cmNlcy5faW52b2tlSG9vaygnYWZ0ZXJDb21waWxlJywgZmFjdG9yeSk7XHJcbiAgICAgICAgcmV0dXJuIGZhY3Rvcnk7XHJcbiAgICB9O1xyXG4gICAgVmlld0NvbXBpbGVyLnByb3RvdHlwZS5fY29tcGlsZU5vZGUgPSBmdW5jdGlvbiAobm9kZSwgcmVzb3VyY2VzLCBpbnN0cnVjdGlvbnMsIHBhcmVudE5vZGUsIHBhcmVudEluamVjdG9ySWQsIHRhcmdldExpZ2h0RE9NKSB7XHJcbiAgICAgICAgc3dpdGNoIChub2RlLm5vZGVUeXBlKSB7XHJcbiAgICAgICAgICAgIGNhc2UgMTpcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9jb21waWxlRWxlbWVudChub2RlLCByZXNvdXJjZXMsIGluc3RydWN0aW9ucywgcGFyZW50Tm9kZSwgcGFyZW50SW5qZWN0b3JJZCwgdGFyZ2V0TGlnaHRET00pO1xyXG4gICAgICAgICAgICBjYXNlIDM6XHJcbiAgICAgICAgICAgICAgICB2YXIgZXhwcmVzc2lvbiA9IHJlc291cmNlcy5nZXRCaW5kaW5nTGFuZ3VhZ2UodGhpcy5iaW5kaW5nTGFuZ3VhZ2UpLmluc3BlY3RUZXh0Q29udGVudChyZXNvdXJjZXMsIG5vZGUud2hvbGVUZXh0KTtcclxuICAgICAgICAgICAgICAgIGlmIChleHByZXNzaW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1hcmtlciA9IERPTS5jcmVhdGVFbGVtZW50KCdhdS1tYXJrZXInKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgYXVUYXJnZXRJRCA9IG1ha2VJbnRvSW5zdHJ1Y3Rpb25UYXJnZXQobWFya2VyKTtcclxuICAgICAgICAgICAgICAgICAgICAobm9kZS5wYXJlbnROb2RlIHx8IHBhcmVudE5vZGUpLmluc2VydEJlZm9yZShtYXJrZXIsIG5vZGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIG5vZGUudGV4dENvbnRlbnQgPSAnICc7XHJcbiAgICAgICAgICAgICAgICAgICAgaW5zdHJ1Y3Rpb25zW2F1VGFyZ2V0SURdID0gVGFyZ2V0SW5zdHJ1Y3Rpb24uY29udGVudEV4cHJlc3Npb24oZXhwcmVzc2lvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKG5vZGUubmV4dFNpYmxpbmcgJiYgbm9kZS5uZXh0U2libGluZy5ub2RlVHlwZSA9PT0gMykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAobm9kZS5wYXJlbnROb2RlIHx8IHBhcmVudE5vZGUpLnJlbW92ZUNoaWxkKG5vZGUubmV4dFNpYmxpbmcpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHdoaWxlIChub2RlLm5leHRTaWJsaW5nICYmIG5vZGUubmV4dFNpYmxpbmcubm9kZVR5cGUgPT09IDMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbm9kZSA9IG5vZGUubmV4dFNpYmxpbmc7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5vZGUubmV4dFNpYmxpbmc7XHJcbiAgICAgICAgICAgIGNhc2UgMTE6XHJcbiAgICAgICAgICAgICAgICB2YXIgY3VycmVudENoaWxkID0gbm9kZS5maXJzdENoaWxkO1xyXG4gICAgICAgICAgICAgICAgd2hpbGUgKGN1cnJlbnRDaGlsZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRDaGlsZCA9IHRoaXMuX2NvbXBpbGVOb2RlKGN1cnJlbnRDaGlsZCwgcmVzb3VyY2VzLCBpbnN0cnVjdGlvbnMsIG5vZGUsIHBhcmVudEluamVjdG9ySWQsIHRhcmdldExpZ2h0RE9NKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbm9kZS5uZXh0U2libGluZztcclxuICAgIH07XHJcbiAgICBWaWV3Q29tcGlsZXIucHJvdG90eXBlLl9jb21waWxlU3Vycm9nYXRlID0gZnVuY3Rpb24gKG5vZGUsIHJlc291cmNlcykge1xyXG4gICAgICAgIHZhciB0YWdOYW1lID0gbm9kZS50YWdOYW1lLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgICAgdmFyIGF0dHJpYnV0ZXMgPSBub2RlLmF0dHJpYnV0ZXM7XHJcbiAgICAgICAgdmFyIGJpbmRpbmdMYW5ndWFnZSA9IHJlc291cmNlcy5nZXRCaW5kaW5nTGFuZ3VhZ2UodGhpcy5iaW5kaW5nTGFuZ3VhZ2UpO1xyXG4gICAgICAgIHZhciBrbm93bkF0dHJpYnV0ZTtcclxuICAgICAgICB2YXIgcHJvcGVydHk7XHJcbiAgICAgICAgdmFyIGluc3RydWN0aW9uO1xyXG4gICAgICAgIHZhciBpO1xyXG4gICAgICAgIHZhciBpaTtcclxuICAgICAgICB2YXIgYXR0cjtcclxuICAgICAgICB2YXIgYXR0ck5hbWU7XHJcbiAgICAgICAgdmFyIGF0dHJWYWx1ZTtcclxuICAgICAgICB2YXIgaW5mbztcclxuICAgICAgICB2YXIgdHlwZTtcclxuICAgICAgICB2YXIgZXhwcmVzc2lvbnMgPSBbXTtcclxuICAgICAgICB2YXIgZXhwcmVzc2lvbjtcclxuICAgICAgICB2YXIgYmVoYXZpb3JJbnN0cnVjdGlvbnMgPSBbXTtcclxuICAgICAgICB2YXIgdmFsdWVzID0ge307XHJcbiAgICAgICAgdmFyIGhhc1ZhbHVlcyA9IGZhbHNlO1xyXG4gICAgICAgIHZhciBwcm92aWRlcnMgPSBbXTtcclxuICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IGF0dHJpYnV0ZXMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICBhdHRyID0gYXR0cmlidXRlc1tpXTtcclxuICAgICAgICAgICAgYXR0ck5hbWUgPSBhdHRyLm5hbWU7XHJcbiAgICAgICAgICAgIGF0dHJWYWx1ZSA9IGF0dHIudmFsdWU7XHJcbiAgICAgICAgICAgIGluZm8gPSBiaW5kaW5nTGFuZ3VhZ2UuaW5zcGVjdEF0dHJpYnV0ZShyZXNvdXJjZXMsIHRhZ05hbWUsIGF0dHJOYW1lLCBhdHRyVmFsdWUpO1xyXG4gICAgICAgICAgICB0eXBlID0gcmVzb3VyY2VzLmdldEF0dHJpYnV0ZShpbmZvLmF0dHJOYW1lKTtcclxuICAgICAgICAgICAgaWYgKHR5cGUpIHtcclxuICAgICAgICAgICAgICAgIGtub3duQXR0cmlidXRlID0gcmVzb3VyY2VzLm1hcEF0dHJpYnV0ZShpbmZvLmF0dHJOYW1lKTtcclxuICAgICAgICAgICAgICAgIGlmIChrbm93bkF0dHJpYnV0ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHByb3BlcnR5ID0gdHlwZS5hdHRyaWJ1dGVzW2tub3duQXR0cmlidXRlXTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocHJvcGVydHkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW5mby5kZWZhdWx0QmluZGluZ01vZGUgPSBwcm9wZXJ0eS5kZWZhdWx0QmluZGluZ01vZGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaW5mby5jb21tYW5kICYmICFpbmZvLmV4cHJlc3Npb24pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZm8uY29tbWFuZCA9IHByb3BlcnR5Lmhhc09wdGlvbnMgPyAnb3B0aW9ucycgOiBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbmZvLmNvbW1hbmQgJiYgKGluZm8uY29tbWFuZCAhPT0gJ29wdGlvbnMnKSAmJiB0eXBlLnByaW1hcnlQcm9wZXJ0eSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHByaW1hcnlQcm9wZXJ0eSA9IHR5cGUucHJpbWFyeVByb3BlcnR5O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0ck5hbWUgPSBpbmZvLmF0dHJOYW1lID0gcHJpbWFyeVByb3BlcnR5LmF0dHJpYnV0ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZm8uZGVmYXVsdEJpbmRpbmdNb2RlID0gcHJpbWFyeVByb3BlcnR5LmRlZmF1bHRCaW5kaW5nTW9kZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpbnN0cnVjdGlvbiA9IGJpbmRpbmdMYW5ndWFnZS5jcmVhdGVBdHRyaWJ1dGVJbnN0cnVjdGlvbihyZXNvdXJjZXMsIG5vZGUsIGluZm8sIHVuZGVmaW5lZCwgdHlwZSk7XHJcbiAgICAgICAgICAgIGlmIChpbnN0cnVjdGlvbikge1xyXG4gICAgICAgICAgICAgICAgaWYgKGluc3RydWN0aW9uLmFsdGVyZWRBdHRyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZSA9IHJlc291cmNlcy5nZXRBdHRyaWJ1dGUoaW5zdHJ1Y3Rpb24uYXR0ck5hbWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKGluc3RydWN0aW9uLmRpc2NyZXRlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZXhwcmVzc2lvbnMucHVzaChpbnN0cnVjdGlvbik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnN0cnVjdGlvbi50eXBlID0gdHlwZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fY29uZmlndXJlUHJvcGVydGllcyhpbnN0cnVjdGlvbiwgcmVzb3VyY2VzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGUubGlmdHNDb250ZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1lvdSBjYW5ub3QgcGxhY2UgYSB0ZW1wbGF0ZSBjb250cm9sbGVyIG9uIGEgc3Vycm9nYXRlIGVsZW1lbnQuJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZWhhdmlvckluc3RydWN0aW9ucy5wdXNoKGluc3RydWN0aW9uKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZXhwcmVzc2lvbnMucHVzaChpbnN0cnVjdGlvbi5hdHRyaWJ1dGVzW2luc3RydWN0aW9uLmF0dHJOYW1lXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKHR5cGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBpbnN0cnVjdGlvbiA9IEJlaGF2aW9ySW5zdHJ1Y3Rpb24uYXR0cmlidXRlKGF0dHJOYW1lLCB0eXBlKTtcclxuICAgICAgICAgICAgICAgICAgICBpbnN0cnVjdGlvbi5hdHRyaWJ1dGVzW3Jlc291cmNlcy5tYXBBdHRyaWJ1dGUoYXR0ck5hbWUpXSA9IGF0dHJWYWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZS5saWZ0c0NvbnRlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdZb3UgY2Fubm90IHBsYWNlIGEgdGVtcGxhdGUgY29udHJvbGxlciBvbiBhIHN1cnJvZ2F0ZSBlbGVtZW50LicpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYmVoYXZpb3JJbnN0cnVjdGlvbnMucHVzaChpbnN0cnVjdGlvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoYXR0ck5hbWUgIT09ICdpZCcgJiYgYXR0ck5hbWUgIT09ICdwYXJ0JyAmJiBhdHRyTmFtZSAhPT0gJ3JlcGxhY2UtcGFydCcpIHtcclxuICAgICAgICAgICAgICAgICAgICBoYXNWYWx1ZXMgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlc1thdHRyTmFtZV0gPSBhdHRyVmFsdWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGV4cHJlc3Npb25zLmxlbmd0aCB8fCBiZWhhdmlvckluc3RydWN0aW9ucy5sZW5ndGggfHwgaGFzVmFsdWVzKSB7XHJcbiAgICAgICAgICAgIGZvciAoaSA9IDAsIGlpID0gYmVoYXZpb3JJbnN0cnVjdGlvbnMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICAgICAgaW5zdHJ1Y3Rpb24gPSBiZWhhdmlvckluc3RydWN0aW9uc1tpXTtcclxuICAgICAgICAgICAgICAgIGluc3RydWN0aW9uLnR5cGUuY29tcGlsZSh0aGlzLCByZXNvdXJjZXMsIG5vZGUsIGluc3RydWN0aW9uKTtcclxuICAgICAgICAgICAgICAgIHByb3ZpZGVycy5wdXNoKGluc3RydWN0aW9uLnR5cGUudGFyZ2V0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IGV4cHJlc3Npb25zLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgICAgIGV4cHJlc3Npb24gPSBleHByZXNzaW9uc1tpXTtcclxuICAgICAgICAgICAgICAgIGlmIChleHByZXNzaW9uLmF0dHJUb1JlbW92ZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbm9kZS5yZW1vdmVBdHRyaWJ1dGUoZXhwcmVzc2lvbi5hdHRyVG9SZW1vdmUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBUYXJnZXRJbnN0cnVjdGlvbi5zdXJyb2dhdGUocHJvdmlkZXJzLCBiZWhhdmlvckluc3RydWN0aW9ucywgZXhwcmVzc2lvbnMsIHZhbHVlcyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfTtcclxuICAgIFZpZXdDb21waWxlci5wcm90b3R5cGUuX2NvbXBpbGVFbGVtZW50ID0gZnVuY3Rpb24gKG5vZGUsIHJlc291cmNlcywgaW5zdHJ1Y3Rpb25zLCBwYXJlbnROb2RlLCBwYXJlbnRJbmplY3RvcklkLCB0YXJnZXRMaWdodERPTSkge1xyXG4gICAgICAgIHZhciB0YWdOYW1lID0gbm9kZS50YWdOYW1lLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgICAgdmFyIGF0dHJpYnV0ZXMgPSBub2RlLmF0dHJpYnV0ZXM7XHJcbiAgICAgICAgdmFyIGV4cHJlc3Npb25zID0gW107XHJcbiAgICAgICAgdmFyIGV4cHJlc3Npb247XHJcbiAgICAgICAgdmFyIGJlaGF2aW9ySW5zdHJ1Y3Rpb25zID0gW107XHJcbiAgICAgICAgdmFyIHByb3ZpZGVycyA9IFtdO1xyXG4gICAgICAgIHZhciBiaW5kaW5nTGFuZ3VhZ2UgPSByZXNvdXJjZXMuZ2V0QmluZGluZ0xhbmd1YWdlKHRoaXMuYmluZGluZ0xhbmd1YWdlKTtcclxuICAgICAgICB2YXIgbGlmdGluZ0luc3RydWN0aW9uO1xyXG4gICAgICAgIHZhciB2aWV3RmFjdG9yeTtcclxuICAgICAgICB2YXIgdHlwZTtcclxuICAgICAgICB2YXIgZWxlbWVudEluc3RydWN0aW9uO1xyXG4gICAgICAgIHZhciBlbGVtZW50UHJvcGVydHk7XHJcbiAgICAgICAgdmFyIGk7XHJcbiAgICAgICAgdmFyIGlpO1xyXG4gICAgICAgIHZhciBhdHRyO1xyXG4gICAgICAgIHZhciBhdHRyTmFtZTtcclxuICAgICAgICB2YXIgYXR0clZhbHVlO1xyXG4gICAgICAgIHZhciBvcmlnaW5hbEF0dHJOYW1lO1xyXG4gICAgICAgIHZhciBpbnN0cnVjdGlvbjtcclxuICAgICAgICB2YXIgaW5mbztcclxuICAgICAgICB2YXIgcHJvcGVydHk7XHJcbiAgICAgICAgdmFyIGtub3duQXR0cmlidXRlO1xyXG4gICAgICAgIHZhciBhdVRhcmdldElEO1xyXG4gICAgICAgIHZhciBpbmplY3RvcklkO1xyXG4gICAgICAgIGlmICh0YWdOYW1lID09PSAnc2xvdCcpIHtcclxuICAgICAgICAgICAgaWYgKHRhcmdldExpZ2h0RE9NKSB7XHJcbiAgICAgICAgICAgICAgICBub2RlID0gbWFrZVNoYWRvd1Nsb3QodGhpcywgcmVzb3VyY2VzLCBub2RlLCBpbnN0cnVjdGlvbnMsIHBhcmVudEluamVjdG9ySWQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBub2RlLm5leHRTaWJsaW5nO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmICh0YWdOYW1lID09PSAndGVtcGxhdGUnKSB7XHJcbiAgICAgICAgICAgIGlmICghKCdjb250ZW50JyBpbiBub2RlKSkge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdZb3UgY2Fubm90IHBsYWNlIGEgdGVtcGxhdGUgZWxlbWVudCB3aXRoaW4gJyArIG5vZGUubmFtZXNwYWNlVVJJICsgJyBuYW1lc3BhY2UnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2aWV3RmFjdG9yeSA9IHRoaXMuY29tcGlsZShub2RlLCByZXNvdXJjZXMpO1xyXG4gICAgICAgICAgICB2aWV3RmFjdG9yeS5wYXJ0ID0gbm9kZS5nZXRBdHRyaWJ1dGUoJ3BhcnQnKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHR5cGUgPSByZXNvdXJjZXMuZ2V0RWxlbWVudChub2RlLmdldEF0dHJpYnV0ZSgnYXMtZWxlbWVudCcpIHx8IHRhZ05hbWUpO1xyXG4gICAgICAgICAgICBpZiAodGFnTmFtZSA9PT0gJ2xldCcgJiYgIXR5cGUgJiYgYmluZGluZ0xhbmd1YWdlLmNyZWF0ZUxldEV4cHJlc3Npb25zICE9PSBkZWZhdWx0TGV0SGFuZGxlcikge1xyXG4gICAgICAgICAgICAgICAgZXhwcmVzc2lvbnMgPSBiaW5kaW5nTGFuZ3VhZ2UuY3JlYXRlTGV0RXhwcmVzc2lvbnMocmVzb3VyY2VzLCBub2RlKTtcclxuICAgICAgICAgICAgICAgIGF1VGFyZ2V0SUQgPSBtYWtlSW50b0luc3RydWN0aW9uVGFyZ2V0KG5vZGUpO1xyXG4gICAgICAgICAgICAgICAgaW5zdHJ1Y3Rpb25zW2F1VGFyZ2V0SURdID0gVGFyZ2V0SW5zdHJ1Y3Rpb24ubGV0RWxlbWVudChleHByZXNzaW9ucyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbm9kZS5uZXh0U2libGluZztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodHlwZSkge1xyXG4gICAgICAgICAgICAgICAgZWxlbWVudEluc3RydWN0aW9uID0gQmVoYXZpb3JJbnN0cnVjdGlvbi5lbGVtZW50KG5vZGUsIHR5cGUpO1xyXG4gICAgICAgICAgICAgICAgdHlwZS5wcm9jZXNzQXR0cmlidXRlcyh0aGlzLCByZXNvdXJjZXMsIG5vZGUsIGF0dHJpYnV0ZXMsIGVsZW1lbnRJbnN0cnVjdGlvbik7XHJcbiAgICAgICAgICAgICAgICBiZWhhdmlvckluc3RydWN0aW9ucy5wdXNoKGVsZW1lbnRJbnN0cnVjdGlvbik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZm9yIChpID0gMCwgaWkgPSBhdHRyaWJ1dGVzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgYXR0ciA9IGF0dHJpYnV0ZXNbaV07XHJcbiAgICAgICAgICAgIG9yaWdpbmFsQXR0ck5hbWUgPSBhdHRyTmFtZSA9IGF0dHIubmFtZTtcclxuICAgICAgICAgICAgYXR0clZhbHVlID0gYXR0ci52YWx1ZTtcclxuICAgICAgICAgICAgaW5mbyA9IGJpbmRpbmdMYW5ndWFnZS5pbnNwZWN0QXR0cmlidXRlKHJlc291cmNlcywgdGFnTmFtZSwgYXR0ck5hbWUsIGF0dHJWYWx1ZSk7XHJcbiAgICAgICAgICAgIGlmICh0YXJnZXRMaWdodERPTSAmJiBpbmZvLmF0dHJOYW1lID09PSAnc2xvdCcpIHtcclxuICAgICAgICAgICAgICAgIGluZm8uYXR0ck5hbWUgPSBhdHRyTmFtZSA9ICdhdS1zbG90JztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0eXBlID0gcmVzb3VyY2VzLmdldEF0dHJpYnV0ZShpbmZvLmF0dHJOYW1lKTtcclxuICAgICAgICAgICAgZWxlbWVudFByb3BlcnR5ID0gbnVsbDtcclxuICAgICAgICAgICAgaWYgKHR5cGUpIHtcclxuICAgICAgICAgICAgICAgIGtub3duQXR0cmlidXRlID0gcmVzb3VyY2VzLm1hcEF0dHJpYnV0ZShpbmZvLmF0dHJOYW1lKTtcclxuICAgICAgICAgICAgICAgIGlmIChrbm93bkF0dHJpYnV0ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHByb3BlcnR5ID0gdHlwZS5hdHRyaWJ1dGVzW2tub3duQXR0cmlidXRlXTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocHJvcGVydHkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW5mby5kZWZhdWx0QmluZGluZ01vZGUgPSBwcm9wZXJ0eS5kZWZhdWx0QmluZGluZ01vZGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaW5mby5jb21tYW5kICYmICFpbmZvLmV4cHJlc3Npb24pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZm8uY29tbWFuZCA9IHByb3BlcnR5Lmhhc09wdGlvbnMgPyAnb3B0aW9ucycgOiBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbmZvLmNvbW1hbmQgJiYgKGluZm8uY29tbWFuZCAhPT0gJ29wdGlvbnMnKSAmJiB0eXBlLnByaW1hcnlQcm9wZXJ0eSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHByaW1hcnlQcm9wZXJ0eSA9IHR5cGUucHJpbWFyeVByb3BlcnR5O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0ck5hbWUgPSBpbmZvLmF0dHJOYW1lID0gcHJpbWFyeVByb3BlcnR5LmF0dHJpYnV0ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZm8uZGVmYXVsdEJpbmRpbmdNb2RlID0gcHJpbWFyeVByb3BlcnR5LmRlZmF1bHRCaW5kaW5nTW9kZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmIChlbGVtZW50SW5zdHJ1Y3Rpb24pIHtcclxuICAgICAgICAgICAgICAgIGVsZW1lbnRQcm9wZXJ0eSA9IGVsZW1lbnRJbnN0cnVjdGlvbi50eXBlLmF0dHJpYnV0ZXNbaW5mby5hdHRyTmFtZV07XHJcbiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudFByb3BlcnR5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaW5mby5kZWZhdWx0QmluZGluZ01vZGUgPSBlbGVtZW50UHJvcGVydHkuZGVmYXVsdEJpbmRpbmdNb2RlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChlbGVtZW50UHJvcGVydHkpIHtcclxuICAgICAgICAgICAgICAgIGluc3RydWN0aW9uID0gYmluZGluZ0xhbmd1YWdlLmNyZWF0ZUF0dHJpYnV0ZUluc3RydWN0aW9uKHJlc291cmNlcywgbm9kZSwgaW5mbywgZWxlbWVudEluc3RydWN0aW9uKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGluc3RydWN0aW9uID0gYmluZGluZ0xhbmd1YWdlLmNyZWF0ZUF0dHJpYnV0ZUluc3RydWN0aW9uKHJlc291cmNlcywgbm9kZSwgaW5mbywgdW5kZWZpbmVkLCB0eXBlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoaW5zdHJ1Y3Rpb24pIHtcclxuICAgICAgICAgICAgICAgIGlmIChpbnN0cnVjdGlvbi5hbHRlcmVkQXR0cikge1xyXG4gICAgICAgICAgICAgICAgICAgIHR5cGUgPSByZXNvdXJjZXMuZ2V0QXR0cmlidXRlKGluc3RydWN0aW9uLmF0dHJOYW1lKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChpbnN0cnVjdGlvbi5kaXNjcmV0ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGV4cHJlc3Npb25zLnB1c2goaW5zdHJ1Y3Rpb24pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW5zdHJ1Y3Rpb24udHlwZSA9IHR5cGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2NvbmZpZ3VyZVByb3BlcnRpZXMoaW5zdHJ1Y3Rpb24sIHJlc291cmNlcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlLmxpZnRzQ29udGVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5zdHJ1Y3Rpb24ub3JpZ2luYWxBdHRyTmFtZSA9IG9yaWdpbmFsQXR0ck5hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWZ0aW5nSW5zdHJ1Y3Rpb24gPSBpbnN0cnVjdGlvbjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYmVoYXZpb3JJbnN0cnVjdGlvbnMucHVzaChpbnN0cnVjdGlvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoZWxlbWVudFByb3BlcnR5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnRJbnN0cnVjdGlvbi5hdHRyaWJ1dGVzW2luZm8uYXR0ck5hbWVdLnRhcmdldFByb3BlcnR5ID0gZWxlbWVudFByb3BlcnR5Lm5hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBleHByZXNzaW9ucy5wdXNoKGluc3RydWN0aW9uLmF0dHJpYnV0ZXNbaW5zdHJ1Y3Rpb24uYXR0ck5hbWVdKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodHlwZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGluc3RydWN0aW9uID0gQmVoYXZpb3JJbnN0cnVjdGlvbi5hdHRyaWJ1dGUoYXR0ck5hbWUsIHR5cGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGluc3RydWN0aW9uLmF0dHJpYnV0ZXNbcmVzb3VyY2VzLm1hcEF0dHJpYnV0ZShhdHRyTmFtZSldID0gYXR0clZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlLmxpZnRzQ29udGVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnN0cnVjdGlvbi5vcmlnaW5hbEF0dHJOYW1lID0gb3JpZ2luYWxBdHRyTmFtZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGlmdGluZ0luc3RydWN0aW9uID0gaW5zdHJ1Y3Rpb247XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYmVoYXZpb3JJbnN0cnVjdGlvbnMucHVzaChpbnN0cnVjdGlvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoZWxlbWVudFByb3BlcnR5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudEluc3RydWN0aW9uLmF0dHJpYnV0ZXNbYXR0ck5hbWVdID0gYXR0clZhbHVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChsaWZ0aW5nSW5zdHJ1Y3Rpb24pIHtcclxuICAgICAgICAgICAgbGlmdGluZ0luc3RydWN0aW9uLnZpZXdGYWN0b3J5ID0gdmlld0ZhY3Rvcnk7XHJcbiAgICAgICAgICAgIG5vZGUgPSBsaWZ0aW5nSW5zdHJ1Y3Rpb24udHlwZS5jb21waWxlKHRoaXMsIHJlc291cmNlcywgbm9kZSwgbGlmdGluZ0luc3RydWN0aW9uLCBwYXJlbnROb2RlKTtcclxuICAgICAgICAgICAgYXVUYXJnZXRJRCA9IG1ha2VJbnRvSW5zdHJ1Y3Rpb25UYXJnZXQobm9kZSk7XHJcbiAgICAgICAgICAgIGluc3RydWN0aW9uc1thdVRhcmdldElEXSA9IFRhcmdldEluc3RydWN0aW9uLmxpZnRpbmcocGFyZW50SW5qZWN0b3JJZCwgbGlmdGluZ0luc3RydWN0aW9uKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHZhciBza2lwQ29udGVudFByb2Nlc3NpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgaWYgKGV4cHJlc3Npb25zLmxlbmd0aCB8fCBiZWhhdmlvckluc3RydWN0aW9ucy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIGluamVjdG9ySWQgPSBiZWhhdmlvckluc3RydWN0aW9ucy5sZW5ndGggPyBnZXROZXh0SW5qZWN0b3JJZCgpIDogZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IGJlaGF2aW9ySW5zdHJ1Y3Rpb25zLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgICAgICAgICBpbnN0cnVjdGlvbiA9IGJlaGF2aW9ySW5zdHJ1Y3Rpb25zW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgIGluc3RydWN0aW9uLnR5cGUuY29tcGlsZSh0aGlzLCByZXNvdXJjZXMsIG5vZGUsIGluc3RydWN0aW9uLCBwYXJlbnROb2RlKTtcclxuICAgICAgICAgICAgICAgICAgICBwcm92aWRlcnMucHVzaChpbnN0cnVjdGlvbi50eXBlLnRhcmdldCk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2tpcENvbnRlbnRQcm9jZXNzaW5nID0gc2tpcENvbnRlbnRQcm9jZXNzaW5nIHx8IGluc3RydWN0aW9uLnNraXBDb250ZW50UHJvY2Vzc2luZztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGZvciAoaSA9IDAsIGlpID0gZXhwcmVzc2lvbnMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGV4cHJlc3Npb24gPSBleHByZXNzaW9uc1tpXTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZXhwcmVzc2lvbi5hdHRyVG9SZW1vdmUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBub2RlLnJlbW92ZUF0dHJpYnV0ZShleHByZXNzaW9uLmF0dHJUb1JlbW92ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgYXVUYXJnZXRJRCA9IG1ha2VJbnRvSW5zdHJ1Y3Rpb25UYXJnZXQobm9kZSk7XHJcbiAgICAgICAgICAgICAgICBpbnN0cnVjdGlvbnNbYXVUYXJnZXRJRF0gPSBUYXJnZXRJbnN0cnVjdGlvbi5ub3JtYWwoaW5qZWN0b3JJZCwgcGFyZW50SW5qZWN0b3JJZCwgcHJvdmlkZXJzLCBiZWhhdmlvckluc3RydWN0aW9ucywgZXhwcmVzc2lvbnMsIGVsZW1lbnRJbnN0cnVjdGlvbik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHNraXBDb250ZW50UHJvY2Vzc2luZykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5vZGUubmV4dFNpYmxpbmc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIGN1cnJlbnRDaGlsZCA9IG5vZGUuZmlyc3RDaGlsZDtcclxuICAgICAgICAgICAgd2hpbGUgKGN1cnJlbnRDaGlsZCkge1xyXG4gICAgICAgICAgICAgICAgY3VycmVudENoaWxkID0gdGhpcy5fY29tcGlsZU5vZGUoY3VycmVudENoaWxkLCByZXNvdXJjZXMsIGluc3RydWN0aW9ucywgbm9kZSwgaW5qZWN0b3JJZCB8fCBwYXJlbnRJbmplY3RvcklkLCB0YXJnZXRMaWdodERPTSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG5vZGUubmV4dFNpYmxpbmc7XHJcbiAgICB9O1xyXG4gICAgVmlld0NvbXBpbGVyLnByb3RvdHlwZS5fY29uZmlndXJlUHJvcGVydGllcyA9IGZ1bmN0aW9uIChpbnN0cnVjdGlvbiwgcmVzb3VyY2VzKSB7XHJcbiAgICAgICAgdmFyIHR5cGUgPSBpbnN0cnVjdGlvbi50eXBlO1xyXG4gICAgICAgIHZhciBhdHRyTmFtZSA9IGluc3RydWN0aW9uLmF0dHJOYW1lO1xyXG4gICAgICAgIHZhciBhdHRyaWJ1dGVzID0gaW5zdHJ1Y3Rpb24uYXR0cmlidXRlcztcclxuICAgICAgICB2YXIgcHJvcGVydHk7XHJcbiAgICAgICAgdmFyIGtleTtcclxuICAgICAgICB2YXIgdmFsdWU7XHJcbiAgICAgICAgdmFyIGtub3duQXR0cmlidXRlID0gcmVzb3VyY2VzLm1hcEF0dHJpYnV0ZShhdHRyTmFtZSk7XHJcbiAgICAgICAgaWYgKGtub3duQXR0cmlidXRlICYmIGF0dHJOYW1lIGluIGF0dHJpYnV0ZXMgJiYga25vd25BdHRyaWJ1dGUgIT09IGF0dHJOYW1lKSB7XHJcbiAgICAgICAgICAgIGF0dHJpYnV0ZXNba25vd25BdHRyaWJ1dGVdID0gYXR0cmlidXRlc1thdHRyTmFtZV07XHJcbiAgICAgICAgICAgIGRlbGV0ZSBhdHRyaWJ1dGVzW2F0dHJOYW1lXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZm9yIChrZXkgaW4gYXR0cmlidXRlcykge1xyXG4gICAgICAgICAgICB2YWx1ZSA9IGF0dHJpYnV0ZXNba2V5XTtcclxuICAgICAgICAgICAgaWYgKHZhbHVlICE9PSBudWxsICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcpIHtcclxuICAgICAgICAgICAgICAgIHByb3BlcnR5ID0gdHlwZS5hdHRyaWJ1dGVzW2tleV07XHJcbiAgICAgICAgICAgICAgICBpZiAocHJvcGVydHkgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlLnRhcmdldFByb3BlcnR5ID0gcHJvcGVydHkubmFtZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlLnRhcmdldFByb3BlcnR5ID0ga2V5O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIHJldHVybiBWaWV3Q29tcGlsZXI7XHJcbn0oKSk7XG5cbnZhciBWaWV3RW5naW5lSG9va3NSZXNvdXJjZSA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBWaWV3RW5naW5lSG9va3NSZXNvdXJjZSgpIHtcclxuICAgIH1cclxuICAgIFZpZXdFbmdpbmVIb29rc1Jlc291cmNlLnByb3RvdHlwZS5pbml0aWFsaXplID0gZnVuY3Rpb24gKGNvbnRhaW5lciwgdGFyZ2V0KSB7XHJcbiAgICAgICAgdGhpcy5pbnN0YW5jZSA9IGNvbnRhaW5lci5nZXQodGFyZ2V0KTtcclxuICAgIH07XHJcbiAgICBWaWV3RW5naW5lSG9va3NSZXNvdXJjZS5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAocmVnaXN0cnksIG5hbWUpIHtcclxuICAgICAgICByZWdpc3RyeS5yZWdpc3RlclZpZXdFbmdpbmVIb29rcyh0aGlzLmluc3RhbmNlKTtcclxuICAgIH07XHJcbiAgICBWaWV3RW5naW5lSG9va3NSZXNvdXJjZS5wcm90b3R5cGUubG9hZCA9IGZ1bmN0aW9uIChjb250YWluZXIsIHRhcmdldCkgeyB9O1xyXG4gICAgVmlld0VuZ2luZUhvb2tzUmVzb3VyY2UuY29udmVudGlvbiA9IGZ1bmN0aW9uIChuYW1lKSB7XHJcbiAgICAgICAgaWYgKG5hbWUuZW5kc1dpdGgoJ1ZpZXdFbmdpbmVIb29rcycpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgVmlld0VuZ2luZUhvb2tzUmVzb3VyY2UoKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIFZpZXdFbmdpbmVIb29rc1Jlc291cmNlO1xyXG59KCkpO1xyXG5mdW5jdGlvbiB2aWV3RW5naW5lSG9va3ModGFyZ2V0KSB7XHJcbiAgICB2YXIgZGVjbyA9IGZ1bmN0aW9uICh0KSB7XHJcbiAgICAgICAgbWV0YWRhdGEuZGVmaW5lKG1ldGFkYXRhLnJlc291cmNlLCBuZXcgVmlld0VuZ2luZUhvb2tzUmVzb3VyY2UoKSwgdCk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIHRhcmdldCA/IGRlY28odGFyZ2V0KSA6IGRlY287XHJcbn1cblxudmFyIFJlc291cmNlTW9kdWxlID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIFJlc291cmNlTW9kdWxlKG1vZHVsZUlkKSB7XHJcbiAgICAgICAgdGhpcy5pZCA9IG1vZHVsZUlkO1xyXG4gICAgICAgIHRoaXMubW9kdWxlSW5zdGFuY2UgPSBudWxsO1xyXG4gICAgICAgIHRoaXMubWFpblJlc291cmNlID0gbnVsbDtcclxuICAgICAgICB0aGlzLnJlc291cmNlcyA9IG51bGw7XHJcbiAgICAgICAgdGhpcy52aWV3U3RyYXRlZ3kgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuaXNJbml0aWFsaXplZCA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMub25Mb2FkZWQgPSBudWxsO1xyXG4gICAgICAgIHRoaXMubG9hZENvbnRleHQgPSBudWxsO1xyXG4gICAgfVxyXG4gICAgUmVzb3VyY2VNb2R1bGUucHJvdG90eXBlLmluaXRpYWxpemUgPSBmdW5jdGlvbiAoY29udGFpbmVyKSB7XHJcbiAgICAgICAgdmFyIGN1cnJlbnQgPSB0aGlzLm1haW5SZXNvdXJjZTtcclxuICAgICAgICB2YXIgcmVzb3VyY2VzID0gdGhpcy5yZXNvdXJjZXM7XHJcbiAgICAgICAgdmFyIHZzID0gdGhpcy52aWV3U3RyYXRlZ3k7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNJbml0aWFsaXplZCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaXNJbml0aWFsaXplZCA9IHRydWU7XHJcbiAgICAgICAgaWYgKGN1cnJlbnQgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICBjdXJyZW50Lm1ldGFkYXRhLnZpZXdTdHJhdGVneSA9IHZzO1xyXG4gICAgICAgICAgICBjdXJyZW50LmluaXRpYWxpemUoY29udGFpbmVyKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gcmVzb3VyY2VzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgY3VycmVudCA9IHJlc291cmNlc1tpXTtcclxuICAgICAgICAgICAgY3VycmVudC5tZXRhZGF0YS52aWV3U3RyYXRlZ3kgPSB2cztcclxuICAgICAgICAgICAgY3VycmVudC5pbml0aWFsaXplKGNvbnRhaW5lcik7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFJlc291cmNlTW9kdWxlLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChyZWdpc3RyeSwgbmFtZSkge1xyXG4gICAgICAgIHZhciBtYWluID0gdGhpcy5tYWluUmVzb3VyY2U7XHJcbiAgICAgICAgdmFyIHJlc291cmNlcyA9IHRoaXMucmVzb3VyY2VzO1xyXG4gICAgICAgIGlmIChtYWluICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgbWFpbi5yZWdpc3RlcihyZWdpc3RyeSwgbmFtZSk7XHJcbiAgICAgICAgICAgIG5hbWUgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSByZXNvdXJjZXMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICByZXNvdXJjZXNbaV0ucmVnaXN0ZXIocmVnaXN0cnksIG5hbWUpO1xyXG4gICAgICAgICAgICBuYW1lID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgUmVzb3VyY2VNb2R1bGUucHJvdG90eXBlLmxvYWQgPSBmdW5jdGlvbiAoY29udGFpbmVyLCBsb2FkQ29udGV4dCkge1xyXG4gICAgICAgIGlmICh0aGlzLm9uTG9hZGVkICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmxvYWRDb250ZXh0ID09PSBsb2FkQ29udGV4dCA/IFByb21pc2UucmVzb2x2ZSgpIDogdGhpcy5vbkxvYWRlZDtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIG1haW4gPSB0aGlzLm1haW5SZXNvdXJjZTtcclxuICAgICAgICB2YXIgcmVzb3VyY2VzID0gdGhpcy5yZXNvdXJjZXM7XHJcbiAgICAgICAgdmFyIGxvYWRzO1xyXG4gICAgICAgIGlmIChtYWluICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgbG9hZHMgPSBuZXcgQXJyYXkocmVzb3VyY2VzLmxlbmd0aCArIDEpO1xyXG4gICAgICAgICAgICBsb2Fkc1swXSA9IG1haW4ubG9hZChjb250YWluZXIsIGxvYWRDb250ZXh0KTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gcmVzb3VyY2VzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgICAgIGxvYWRzW2kgKyAxXSA9IHJlc291cmNlc1tpXS5sb2FkKGNvbnRhaW5lciwgbG9hZENvbnRleHQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBsb2FkcyA9IG5ldyBBcnJheShyZXNvdXJjZXMubGVuZ3RoKTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gcmVzb3VyY2VzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgICAgIGxvYWRzW2ldID0gcmVzb3VyY2VzW2ldLmxvYWQoY29udGFpbmVyLCBsb2FkQ29udGV4dCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5sb2FkQ29udGV4dCA9IGxvYWRDb250ZXh0O1xyXG4gICAgICAgIHRoaXMub25Mb2FkZWQgPSBQcm9taXNlLmFsbChsb2Fkcyk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMub25Mb2FkZWQ7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIFJlc291cmNlTW9kdWxlO1xyXG59KCkpO1xyXG52YXIgUmVzb3VyY2VEZXNjcmlwdGlvbiA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBSZXNvdXJjZURlc2NyaXB0aW9uKGtleSwgZXhwb3J0ZWRWYWx1ZSwgcmVzb3VyY2VUeXBlTWV0YSkge1xyXG4gICAgICAgIGlmICghcmVzb3VyY2VUeXBlTWV0YSkge1xyXG4gICAgICAgICAgICByZXNvdXJjZVR5cGVNZXRhID0gbWV0YWRhdGEuZ2V0KG1ldGFkYXRhLnJlc291cmNlLCBleHBvcnRlZFZhbHVlKTtcclxuICAgICAgICAgICAgaWYgKCFyZXNvdXJjZVR5cGVNZXRhKSB7XHJcbiAgICAgICAgICAgICAgICByZXNvdXJjZVR5cGVNZXRhID0gbmV3IEh0bWxCZWhhdmlvclJlc291cmNlKCk7XHJcbiAgICAgICAgICAgICAgICByZXNvdXJjZVR5cGVNZXRhLmVsZW1lbnROYW1lID0gX2h5cGhlbmF0ZShrZXkpO1xyXG4gICAgICAgICAgICAgICAgbWV0YWRhdGEuZGVmaW5lKG1ldGFkYXRhLnJlc291cmNlLCByZXNvdXJjZVR5cGVNZXRhLCBleHBvcnRlZFZhbHVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAocmVzb3VyY2VUeXBlTWV0YSBpbnN0YW5jZW9mIEh0bWxCZWhhdmlvclJlc291cmNlKSB7XHJcbiAgICAgICAgICAgIGlmIChyZXNvdXJjZVR5cGVNZXRhLmVsZW1lbnROYW1lID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIHJlc291cmNlVHlwZU1ldGEuZWxlbWVudE5hbWUgPSBfaHlwaGVuYXRlKGtleSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAocmVzb3VyY2VUeXBlTWV0YS5hdHRyaWJ1dGVOYW1lID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIHJlc291cmNlVHlwZU1ldGEuYXR0cmlidXRlTmFtZSA9IF9oeXBoZW5hdGUoa2V5KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmIChyZXNvdXJjZVR5cGVNZXRhLmF0dHJpYnV0ZU5hbWUgPT09IG51bGwgJiYgcmVzb3VyY2VUeXBlTWV0YS5lbGVtZW50TmFtZSA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgSHRtbEJlaGF2aW9yUmVzb3VyY2UuY29udmVudGlvbihrZXksIHJlc291cmNlVHlwZU1ldGEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKCFyZXNvdXJjZVR5cGVNZXRhLm5hbWUpIHtcclxuICAgICAgICAgICAgcmVzb3VyY2VUeXBlTWV0YS5uYW1lID0gX2h5cGhlbmF0ZShrZXkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLm1ldGFkYXRhID0gcmVzb3VyY2VUeXBlTWV0YTtcclxuICAgICAgICB0aGlzLnZhbHVlID0gZXhwb3J0ZWRWYWx1ZTtcclxuICAgIH1cclxuICAgIFJlc291cmNlRGVzY3JpcHRpb24ucHJvdG90eXBlLmluaXRpYWxpemUgPSBmdW5jdGlvbiAoY29udGFpbmVyKSB7XHJcbiAgICAgICAgdGhpcy5tZXRhZGF0YS5pbml0aWFsaXplKGNvbnRhaW5lciwgdGhpcy52YWx1ZSk7XHJcbiAgICB9O1xyXG4gICAgUmVzb3VyY2VEZXNjcmlwdGlvbi5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAocmVnaXN0cnksIG5hbWUpIHtcclxuICAgICAgICB0aGlzLm1ldGFkYXRhLnJlZ2lzdGVyKHJlZ2lzdHJ5LCBuYW1lKTtcclxuICAgIH07XHJcbiAgICBSZXNvdXJjZURlc2NyaXB0aW9uLnByb3RvdHlwZS5sb2FkID0gZnVuY3Rpb24gKGNvbnRhaW5lciwgbG9hZENvbnRleHQpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5tZXRhZGF0YS5sb2FkKGNvbnRhaW5lciwgdGhpcy52YWx1ZSwgbG9hZENvbnRleHQpO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBSZXNvdXJjZURlc2NyaXB0aW9uO1xyXG59KCkpO1xyXG52YXIgTW9kdWxlQW5hbHl6ZXIgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gTW9kdWxlQW5hbHl6ZXIoKSB7XHJcbiAgICAgICAgdGhpcy5jYWNoZSA9IE9iamVjdC5jcmVhdGUobnVsbCk7XHJcbiAgICB9XHJcbiAgICBNb2R1bGVBbmFseXplci5wcm90b3R5cGUuZ2V0QW5hbHlzaXMgPSBmdW5jdGlvbiAobW9kdWxlSWQpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jYWNoZVttb2R1bGVJZF07XHJcbiAgICB9O1xyXG4gICAgTW9kdWxlQW5hbHl6ZXIucHJvdG90eXBlLmFuYWx5emUgPSBmdW5jdGlvbiAobW9kdWxlSWQsIG1vZHVsZUluc3RhbmNlLCBtYWluUmVzb3VyY2VLZXkpIHtcclxuICAgICAgICB2YXIgbWFpblJlc291cmNlO1xyXG4gICAgICAgIHZhciBmYWxsYmFja1ZhbHVlO1xyXG4gICAgICAgIHZhciBmYWxsYmFja0tleTtcclxuICAgICAgICB2YXIgcmVzb3VyY2VUeXBlTWV0YTtcclxuICAgICAgICB2YXIga2V5O1xyXG4gICAgICAgIHZhciBleHBvcnRlZFZhbHVlO1xyXG4gICAgICAgIHZhciByZXNvdXJjZXMgPSBbXTtcclxuICAgICAgICB2YXIgY29udmVudGlvbmFsO1xyXG4gICAgICAgIHZhciB2cztcclxuICAgICAgICB2YXIgcmVzb3VyY2VNb2R1bGU7XHJcbiAgICAgICAgcmVzb3VyY2VNb2R1bGUgPSB0aGlzLmNhY2hlW21vZHVsZUlkXTtcclxuICAgICAgICBpZiAocmVzb3VyY2VNb2R1bGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc291cmNlTW9kdWxlO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXNvdXJjZU1vZHVsZSA9IG5ldyBSZXNvdXJjZU1vZHVsZShtb2R1bGVJZCk7XHJcbiAgICAgICAgdGhpcy5jYWNoZVttb2R1bGVJZF0gPSByZXNvdXJjZU1vZHVsZTtcclxuICAgICAgICBpZiAodHlwZW9mIG1vZHVsZUluc3RhbmNlID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgIG1vZHVsZUluc3RhbmNlID0geyAnZGVmYXVsdCc6IG1vZHVsZUluc3RhbmNlIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChtYWluUmVzb3VyY2VLZXkpIHtcclxuICAgICAgICAgICAgbWFpblJlc291cmNlID0gbmV3IFJlc291cmNlRGVzY3JpcHRpb24obWFpblJlc291cmNlS2V5LCBtb2R1bGVJbnN0YW5jZVttYWluUmVzb3VyY2VLZXldKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZm9yIChrZXkgaW4gbW9kdWxlSW5zdGFuY2UpIHtcclxuICAgICAgICAgICAgZXhwb3J0ZWRWYWx1ZSA9IG1vZHVsZUluc3RhbmNlW2tleV07XHJcbiAgICAgICAgICAgIGlmIChrZXkgPT09IG1haW5SZXNvdXJjZUtleSB8fCB0eXBlb2YgZXhwb3J0ZWRWYWx1ZSAhPT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmVzb3VyY2VUeXBlTWV0YSA9IG1ldGFkYXRhLmdldChtZXRhZGF0YS5yZXNvdXJjZSwgZXhwb3J0ZWRWYWx1ZSk7XHJcbiAgICAgICAgICAgIGlmIChyZXNvdXJjZVR5cGVNZXRhKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzb3VyY2VUeXBlTWV0YSBpbnN0YW5jZW9mIEh0bWxCZWhhdmlvclJlc291cmNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgVmlld1Jlc291cmNlcy5jb252ZW50aW9uKGV4cG9ydGVkVmFsdWUsIHJlc291cmNlVHlwZU1ldGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNvdXJjZVR5cGVNZXRhLmF0dHJpYnV0ZU5hbWUgPT09IG51bGwgJiYgcmVzb3VyY2VUeXBlTWV0YS5lbGVtZW50TmFtZSA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBIdG1sQmVoYXZpb3JSZXNvdXJjZS5jb252ZW50aW9uKGtleSwgcmVzb3VyY2VUeXBlTWV0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNvdXJjZVR5cGVNZXRhLmF0dHJpYnV0ZU5hbWUgPT09IG51bGwgJiYgcmVzb3VyY2VUeXBlTWV0YS5lbGVtZW50TmFtZSA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZVR5cGVNZXRhLmVsZW1lbnROYW1lID0gX2h5cGhlbmF0ZShrZXkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICghbWFpblJlc291cmNlICYmIHJlc291cmNlVHlwZU1ldGEgaW5zdGFuY2VvZiBIdG1sQmVoYXZpb3JSZXNvdXJjZSAmJiByZXNvdXJjZVR5cGVNZXRhLmVsZW1lbnROYW1lICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWFpblJlc291cmNlID0gbmV3IFJlc291cmNlRGVzY3JpcHRpb24oa2V5LCBleHBvcnRlZFZhbHVlLCByZXNvdXJjZVR5cGVNZXRhKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc291cmNlcy5wdXNoKG5ldyBSZXNvdXJjZURlc2NyaXB0aW9uKGtleSwgZXhwb3J0ZWRWYWx1ZSwgcmVzb3VyY2VUeXBlTWV0YSkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHZpZXdTdHJhdGVneS5kZWNvcmF0ZXMoZXhwb3J0ZWRWYWx1ZSkpIHtcclxuICAgICAgICAgICAgICAgIHZzID0gZXhwb3J0ZWRWYWx1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmIChleHBvcnRlZFZhbHVlIGluc3RhbmNlb2YgVGVtcGxhdGVSZWdpc3RyeUVudHJ5KSB7XHJcbiAgICAgICAgICAgICAgICB2cyA9IG5ldyBUZW1wbGF0ZVJlZ2lzdHJ5Vmlld1N0cmF0ZWd5KG1vZHVsZUlkLCBleHBvcnRlZFZhbHVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmIChjb252ZW50aW9uYWwgPSBWaWV3UmVzb3VyY2VzLmNvbnZlbnRpb24oZXhwb3J0ZWRWYWx1ZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY29udmVudGlvbmFsLmVsZW1lbnROYW1lICE9PSBudWxsICYmICFtYWluUmVzb3VyY2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWFpblJlc291cmNlID0gbmV3IFJlc291cmNlRGVzY3JpcHRpb24oa2V5LCBleHBvcnRlZFZhbHVlLCBjb252ZW50aW9uYWwpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VzLnB1c2gobmV3IFJlc291cmNlRGVzY3JpcHRpb24oa2V5LCBleHBvcnRlZFZhbHVlLCBjb252ZW50aW9uYWwpKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgbWV0YWRhdGEuZGVmaW5lKG1ldGFkYXRhLnJlc291cmNlLCBjb252ZW50aW9uYWwsIGV4cG9ydGVkVmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoY29udmVudGlvbmFsID0gSHRtbEJlaGF2aW9yUmVzb3VyY2UuY29udmVudGlvbihrZXkpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnZlbnRpb25hbC5lbGVtZW50TmFtZSAhPT0gbnVsbCAmJiAhbWFpblJlc291cmNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1haW5SZXNvdXJjZSA9IG5ldyBSZXNvdXJjZURlc2NyaXB0aW9uKGtleSwgZXhwb3J0ZWRWYWx1ZSwgY29udmVudGlvbmFsKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc291cmNlcy5wdXNoKG5ldyBSZXNvdXJjZURlc2NyaXB0aW9uKGtleSwgZXhwb3J0ZWRWYWx1ZSwgY29udmVudGlvbmFsKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIG1ldGFkYXRhLmRlZmluZShtZXRhZGF0YS5yZXNvdXJjZSwgY29udmVudGlvbmFsLCBleHBvcnRlZFZhbHVlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGNvbnZlbnRpb25hbCA9IFZhbHVlQ29udmVydGVyUmVzb3VyY2UuY29udmVudGlvbihrZXkpXHJcbiAgICAgICAgICAgICAgICAgICAgfHwgQmluZGluZ0JlaGF2aW9yUmVzb3VyY2UuY29udmVudGlvbihrZXkpXHJcbiAgICAgICAgICAgICAgICAgICAgfHwgVmlld0VuZ2luZUhvb2tzUmVzb3VyY2UuY29udmVudGlvbihrZXkpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VzLnB1c2gobmV3IFJlc291cmNlRGVzY3JpcHRpb24oa2V5LCBleHBvcnRlZFZhbHVlLCBjb252ZW50aW9uYWwpKTtcclxuICAgICAgICAgICAgICAgICAgICBtZXRhZGF0YS5kZWZpbmUobWV0YWRhdGEucmVzb3VyY2UsIGNvbnZlbnRpb25hbCwgZXhwb3J0ZWRWYWx1ZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmICghZmFsbGJhY2tWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZhbGxiYWNrVmFsdWUgPSBleHBvcnRlZFZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIGZhbGxiYWNrS2V5ID0ga2V5O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghbWFpblJlc291cmNlICYmIGZhbGxiYWNrVmFsdWUpIHtcclxuICAgICAgICAgICAgbWFpblJlc291cmNlID0gbmV3IFJlc291cmNlRGVzY3JpcHRpb24oZmFsbGJhY2tLZXksIGZhbGxiYWNrVmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXNvdXJjZU1vZHVsZS5tb2R1bGVJbnN0YW5jZSA9IG1vZHVsZUluc3RhbmNlO1xyXG4gICAgICAgIHJlc291cmNlTW9kdWxlLm1haW5SZXNvdXJjZSA9IG1haW5SZXNvdXJjZTtcclxuICAgICAgICByZXNvdXJjZU1vZHVsZS5yZXNvdXJjZXMgPSByZXNvdXJjZXM7XHJcbiAgICAgICAgcmVzb3VyY2VNb2R1bGUudmlld1N0cmF0ZWd5ID0gdnM7XHJcbiAgICAgICAgcmV0dXJuIHJlc291cmNlTW9kdWxlO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBNb2R1bGVBbmFseXplcjtcclxufSgpKTtcblxudmFyIGxvZ2dlciA9IExvZ01hbmFnZXIuZ2V0TG9nZ2VyKCd0ZW1wbGF0aW5nJyk7XHJcbmZ1bmN0aW9uIGVuc3VyZVJlZ2lzdHJ5RW50cnkobG9hZGVyLCB1cmxPclJlZ2lzdHJ5RW50cnkpIHtcclxuICAgIGlmICh1cmxPclJlZ2lzdHJ5RW50cnkgaW5zdGFuY2VvZiBUZW1wbGF0ZVJlZ2lzdHJ5RW50cnkpIHtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHVybE9yUmVnaXN0cnlFbnRyeSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbG9hZGVyLmxvYWRUZW1wbGF0ZSh1cmxPclJlZ2lzdHJ5RW50cnkpO1xyXG59XHJcbnZhciBQcm94eVZpZXdGYWN0b3J5ID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIFByb3h5Vmlld0ZhY3RvcnkocHJvbWlzZSkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgcHJvbWlzZS50aGVuKGZ1bmN0aW9uICh4KSB7IHJldHVybiBfdGhpcy52aWV3RmFjdG9yeSA9IHg7IH0pO1xyXG4gICAgfVxyXG4gICAgUHJveHlWaWV3RmFjdG9yeS5wcm90b3R5cGUuY3JlYXRlID0gZnVuY3Rpb24gKGNvbnRhaW5lciwgYmluZGluZ0NvbnRleHQsIGNyZWF0ZUluc3RydWN0aW9uLCBlbGVtZW50KSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld0ZhY3RvcnkuY3JlYXRlKGNvbnRhaW5lciwgYmluZGluZ0NvbnRleHQsIGNyZWF0ZUluc3RydWN0aW9uLCBlbGVtZW50KTtcclxuICAgIH07XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoUHJveHlWaWV3RmFjdG9yeS5wcm90b3R5cGUsIFwiaXNDYWNoaW5nXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMudmlld0ZhY3RvcnkuaXNDYWNoaW5nO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIFByb3h5Vmlld0ZhY3RvcnkucHJvdG90eXBlLnNldENhY2hlU2l6ZSA9IGZ1bmN0aW9uIChzaXplLCBkb05vdE92ZXJyaWRlSWZBbHJlYWR5U2V0KSB7XHJcbiAgICAgICAgdGhpcy52aWV3RmFjdG9yeS5zZXRDYWNoZVNpemUoc2l6ZSwgZG9Ob3RPdmVycmlkZUlmQWxyZWFkeVNldCk7XHJcbiAgICB9O1xyXG4gICAgUHJveHlWaWV3RmFjdG9yeS5wcm90b3R5cGUuZ2V0Q2FjaGVkVmlldyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy52aWV3RmFjdG9yeS5nZXRDYWNoZWRWaWV3KCk7XHJcbiAgICB9O1xyXG4gICAgUHJveHlWaWV3RmFjdG9yeS5wcm90b3R5cGUucmV0dXJuVmlld1RvQ2FjaGUgPSBmdW5jdGlvbiAodmlldykge1xyXG4gICAgICAgIHRoaXMudmlld0ZhY3RvcnkucmV0dXJuVmlld1RvQ2FjaGUodmlldyk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIFByb3h5Vmlld0ZhY3Rvcnk7XHJcbn0oKSk7XHJcbnZhciBhdVNsb3RCZWhhdmlvciA9IG51bGw7XHJcbnZhciBWaWV3RW5naW5lID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIFZpZXdFbmdpbmUobG9hZGVyLCBjb250YWluZXIsIHZpZXdDb21waWxlciwgbW9kdWxlQW5hbHl6ZXIsIGFwcFJlc291cmNlcykge1xyXG4gICAgICAgIHRoaXMubG9hZGVyID0gbG9hZGVyO1xyXG4gICAgICAgIHRoaXMuY29udGFpbmVyID0gY29udGFpbmVyO1xyXG4gICAgICAgIHRoaXMudmlld0NvbXBpbGVyID0gdmlld0NvbXBpbGVyO1xyXG4gICAgICAgIHRoaXMubW9kdWxlQW5hbHl6ZXIgPSBtb2R1bGVBbmFseXplcjtcclxuICAgICAgICB0aGlzLmFwcFJlc291cmNlcyA9IGFwcFJlc291cmNlcztcclxuICAgICAgICB0aGlzLl9wbHVnaW5NYXAgPSB7fTtcclxuICAgICAgICBpZiAoYXVTbG90QmVoYXZpb3IgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgYXVTbG90QmVoYXZpb3IgPSBuZXcgSHRtbEJlaGF2aW9yUmVzb3VyY2UoKTtcclxuICAgICAgICAgICAgYXVTbG90QmVoYXZpb3IuYXR0cmlidXRlTmFtZSA9ICdhdS1zbG90JztcclxuICAgICAgICAgICAgbWV0YWRhdGEuZGVmaW5lKG1ldGFkYXRhLnJlc291cmNlLCBhdVNsb3RCZWhhdmlvciwgU2xvdEN1c3RvbUF0dHJpYnV0ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGF1U2xvdEJlaGF2aW9yLmluaXRpYWxpemUoY29udGFpbmVyLCBTbG90Q3VzdG9tQXR0cmlidXRlKTtcclxuICAgICAgICBhdVNsb3RCZWhhdmlvci5yZWdpc3RlcihhcHBSZXNvdXJjZXMpO1xyXG4gICAgfVxyXG4gICAgVmlld0VuZ2luZS5pbmplY3QgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIFtMb2FkZXIsIENvbnRhaW5lciwgVmlld0NvbXBpbGVyLCBNb2R1bGVBbmFseXplciwgVmlld1Jlc291cmNlc107XHJcbiAgICB9O1xyXG4gICAgVmlld0VuZ2luZS5wcm90b3R5cGUuYWRkUmVzb3VyY2VQbHVnaW4gPSBmdW5jdGlvbiAoZXh0ZW5zaW9uLCBpbXBsZW1lbnRhdGlvbikge1xyXG4gICAgICAgIHZhciBuYW1lID0gZXh0ZW5zaW9uLnJlcGxhY2UoJy4nLCAnJykgKyAnLXJlc291cmNlLXBsdWdpbic7XHJcbiAgICAgICAgdGhpcy5fcGx1Z2luTWFwW2V4dGVuc2lvbl0gPSBuYW1lO1xyXG4gICAgICAgIHRoaXMubG9hZGVyLmFkZFBsdWdpbihuYW1lLCBpbXBsZW1lbnRhdGlvbik7XHJcbiAgICB9O1xyXG4gICAgVmlld0VuZ2luZS5wcm90b3R5cGUubG9hZFZpZXdGYWN0b3J5ID0gZnVuY3Rpb24gKHVybE9yUmVnaXN0cnlFbnRyeSwgY29tcGlsZUluc3RydWN0aW9uLCBsb2FkQ29udGV4dCwgdGFyZ2V0KSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICBsb2FkQ29udGV4dCA9IGxvYWRDb250ZXh0IHx8IG5ldyBSZXNvdXJjZUxvYWRDb250ZXh0KCk7XHJcbiAgICAgICAgcmV0dXJuIGVuc3VyZVJlZ2lzdHJ5RW50cnkodGhpcy5sb2FkZXIsIHVybE9yUmVnaXN0cnlFbnRyeSkudGhlbihmdW5jdGlvbiAocmVnaXN0cnlFbnRyeSkge1xyXG4gICAgICAgICAgICB2YXIgdXJsID0gcmVnaXN0cnlFbnRyeS5hZGRyZXNzO1xyXG4gICAgICAgICAgICBpZiAocmVnaXN0cnlFbnRyeS5vblJlYWR5KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIWxvYWRDb250ZXh0Lmhhc0RlcGVuZGVuY3kodXJsKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGxvYWRDb250ZXh0LmFkZERlcGVuZGVuY3kodXJsKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVnaXN0cnlFbnRyeS5vblJlYWR5O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHJlZ2lzdHJ5RW50cnkudGVtcGxhdGUgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVnaXN0cnlFbnRyeS5vblJlYWR5O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShuZXcgUHJveHlWaWV3RmFjdG9yeShyZWdpc3RyeUVudHJ5Lm9uUmVhZHkpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBsb2FkQ29udGV4dC5hZGREZXBlbmRlbmN5KHVybCk7XHJcbiAgICAgICAgICAgIHJlZ2lzdHJ5RW50cnkub25SZWFkeSA9IF90aGlzLmxvYWRUZW1wbGF0ZVJlc291cmNlcyhyZWdpc3RyeUVudHJ5LCBjb21waWxlSW5zdHJ1Y3Rpb24sIGxvYWRDb250ZXh0LCB0YXJnZXQpLnRoZW4oZnVuY3Rpb24gKHJlc291cmNlcykge1xyXG4gICAgICAgICAgICAgICAgcmVnaXN0cnlFbnRyeS5yZXNvdXJjZXMgPSByZXNvdXJjZXM7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVnaXN0cnlFbnRyeS50ZW1wbGF0ZSA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZWdpc3RyeUVudHJ5LmZhY3RvcnkgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdmFyIHZpZXdGYWN0b3J5ID0gX3RoaXMudmlld0NvbXBpbGVyLmNvbXBpbGUocmVnaXN0cnlFbnRyeS50ZW1wbGF0ZSwgcmVzb3VyY2VzLCBjb21waWxlSW5zdHJ1Y3Rpb24pO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlZ2lzdHJ5RW50cnkuZmFjdG9yeSA9IHZpZXdGYWN0b3J5O1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIHJlZ2lzdHJ5RW50cnkub25SZWFkeTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICBWaWV3RW5naW5lLnByb3RvdHlwZS5sb2FkVGVtcGxhdGVSZXNvdXJjZXMgPSBmdW5jdGlvbiAocmVnaXN0cnlFbnRyeSwgY29tcGlsZUluc3RydWN0aW9uLCBsb2FkQ29udGV4dCwgdGFyZ2V0KSB7XHJcbiAgICAgICAgdmFyIHJlc291cmNlcyA9IG5ldyBWaWV3UmVzb3VyY2VzKHRoaXMuYXBwUmVzb3VyY2VzLCByZWdpc3RyeUVudHJ5LmFkZHJlc3MpO1xyXG4gICAgICAgIHZhciBkZXBlbmRlbmNpZXMgPSByZWdpc3RyeUVudHJ5LmRlcGVuZGVuY2llcztcclxuICAgICAgICB2YXIgaW1wb3J0SWRzO1xyXG4gICAgICAgIHZhciBuYW1lcztcclxuICAgICAgICBjb21waWxlSW5zdHJ1Y3Rpb24gPSBjb21waWxlSW5zdHJ1Y3Rpb24gfHwgVmlld0NvbXBpbGVJbnN0cnVjdGlvbi5ub3JtYWw7XHJcbiAgICAgICAgaWYgKGRlcGVuZGVuY2llcy5sZW5ndGggPT09IDAgJiYgIWNvbXBpbGVJbnN0cnVjdGlvbi5hc3NvY2lhdGVkTW9kdWxlSWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShyZXNvdXJjZXMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpbXBvcnRJZHMgPSBkZXBlbmRlbmNpZXMubWFwKGZ1bmN0aW9uICh4KSB7IHJldHVybiB4LnNyYzsgfSk7XHJcbiAgICAgICAgbmFtZXMgPSBkZXBlbmRlbmNpZXMubWFwKGZ1bmN0aW9uICh4KSB7IHJldHVybiB4Lm5hbWU7IH0pO1xyXG4gICAgICAgIGxvZ2dlci5kZWJ1ZyhcImltcG9ydGluZyByZXNvdXJjZXMgZm9yIFwiLmNvbmNhdChyZWdpc3RyeUVudHJ5LmFkZHJlc3MpLCBpbXBvcnRJZHMpO1xyXG4gICAgICAgIGlmICh0YXJnZXQpIHtcclxuICAgICAgICAgICAgdmFyIHZpZXdNb2RlbFJlcXVpcmVzID0gbWV0YWRhdGEuZ2V0KFZpZXdFbmdpbmUudmlld01vZGVsUmVxdWlyZU1ldGFkYXRhS2V5LCB0YXJnZXQpO1xyXG4gICAgICAgICAgICBpZiAodmlld01vZGVsUmVxdWlyZXMpIHtcclxuICAgICAgICAgICAgICAgIHZhciB0ZW1wbGF0ZUltcG9ydENvdW50ID0gaW1wb3J0SWRzLmxlbmd0aDtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IHZpZXdNb2RlbFJlcXVpcmVzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmVxID0gdmlld01vZGVsUmVxdWlyZXNbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGltcG9ydElkID0gdHlwZW9mIHJlcSA9PT0gJ2Z1bmN0aW9uJ1xyXG4gICAgICAgICAgICAgICAgICAgICAgICA/IE9yaWdpbi5nZXQocmVxKS5tb2R1bGVJZFxyXG4gICAgICAgICAgICAgICAgICAgICAgICA6IHJlbGF0aXZlVG9GaWxlKHJlcS5zcmMgfHwgcmVxLCByZWdpc3RyeUVudHJ5LmFkZHJlc3MpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpbXBvcnRJZHMuaW5kZXhPZihpbXBvcnRJZCkgPT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGltcG9ydElkcy5wdXNoKGltcG9ydElkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZXMucHVzaChyZXEuYXMpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhcImltcG9ydGluZyBWaWV3TW9kZWwgcmVzb3VyY2VzIGZvciBcIi5jb25jYXQoY29tcGlsZUluc3RydWN0aW9uLmFzc29jaWF0ZWRNb2R1bGVJZCksIGltcG9ydElkcy5zbGljZSh0ZW1wbGF0ZUltcG9ydENvdW50KSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaW1wb3J0Vmlld1Jlc291cmNlcyhpbXBvcnRJZHMsIG5hbWVzLCByZXNvdXJjZXMsIGNvbXBpbGVJbnN0cnVjdGlvbiwgbG9hZENvbnRleHQpO1xyXG4gICAgfTtcclxuICAgIFZpZXdFbmdpbmUucHJvdG90eXBlLmltcG9ydFZpZXdNb2RlbFJlc291cmNlID0gZnVuY3Rpb24gKG1vZHVsZUltcG9ydCwgbW9kdWxlTWVtYmVyKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICByZXR1cm4gdGhpcy5sb2FkZXIubG9hZE1vZHVsZShtb2R1bGVJbXBvcnQpLnRoZW4oZnVuY3Rpb24gKHZpZXdNb2RlbE1vZHVsZSkge1xyXG4gICAgICAgICAgICB2YXIgbm9ybWFsaXplZElkID0gT3JpZ2luLmdldCh2aWV3TW9kZWxNb2R1bGUpLm1vZHVsZUlkO1xyXG4gICAgICAgICAgICB2YXIgcmVzb3VyY2VNb2R1bGUgPSBfdGhpcy5tb2R1bGVBbmFseXplci5hbmFseXplKG5vcm1hbGl6ZWRJZCwgdmlld01vZGVsTW9kdWxlLCBtb2R1bGVNZW1iZXIpO1xyXG4gICAgICAgICAgICBpZiAoIXJlc291cmNlTW9kdWxlLm1haW5SZXNvdXJjZSkge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTm8gdmlldyBtb2RlbCBmb3VuZCBpbiBtb2R1bGUgXFxcIlwiLmNvbmNhdChtb2R1bGVJbXBvcnQsIFwiXFxcIi5cIikpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJlc291cmNlTW9kdWxlLmluaXRpYWxpemUoX3RoaXMuY29udGFpbmVyKTtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc291cmNlTW9kdWxlLm1haW5SZXNvdXJjZTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICBWaWV3RW5naW5lLnByb3RvdHlwZS5pbXBvcnRWaWV3UmVzb3VyY2VzID0gZnVuY3Rpb24gKG1vZHVsZUlkcywgbmFtZXMsIHJlc291cmNlcywgY29tcGlsZUluc3RydWN0aW9uLCBsb2FkQ29udGV4dCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgbG9hZENvbnRleHQgPSBsb2FkQ29udGV4dCB8fCBuZXcgUmVzb3VyY2VMb2FkQ29udGV4dCgpO1xyXG4gICAgICAgIGNvbXBpbGVJbnN0cnVjdGlvbiA9IGNvbXBpbGVJbnN0cnVjdGlvbiB8fCBWaWV3Q29tcGlsZUluc3RydWN0aW9uLm5vcm1hbDtcclxuICAgICAgICBtb2R1bGVJZHMgPSBtb2R1bGVJZHMubWFwKGZ1bmN0aW9uICh4KSB7IHJldHVybiBfdGhpcy5fYXBwbHlMb2FkZXJQbHVnaW4oeCk7IH0pO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmxvYWRlci5sb2FkQWxsTW9kdWxlcyhtb2R1bGVJZHMpLnRoZW4oZnVuY3Rpb24gKGltcG9ydHMpIHtcclxuICAgICAgICAgICAgdmFyIGk7XHJcbiAgICAgICAgICAgIHZhciBpaTtcclxuICAgICAgICAgICAgdmFyIGFuYWx5c2lzO1xyXG4gICAgICAgICAgICB2YXIgbm9ybWFsaXplZElkO1xyXG4gICAgICAgICAgICB2YXIgY3VycmVudDtcclxuICAgICAgICAgICAgdmFyIGFzc29jaWF0ZWRNb2R1bGU7XHJcbiAgICAgICAgICAgIHZhciBjb250YWluZXIgPSBfdGhpcy5jb250YWluZXI7XHJcbiAgICAgICAgICAgIHZhciBtb2R1bGVBbmFseXplciA9IF90aGlzLm1vZHVsZUFuYWx5emVyO1xyXG4gICAgICAgICAgICB2YXIgYWxsQW5hbHlzaXMgPSBuZXcgQXJyYXkoaW1wb3J0cy5sZW5ndGgpO1xyXG4gICAgICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IGltcG9ydHMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICAgICAgY3VycmVudCA9IGltcG9ydHNbaV07XHJcbiAgICAgICAgICAgICAgICBub3JtYWxpemVkSWQgPSBPcmlnaW4uZ2V0KGN1cnJlbnQpLm1vZHVsZUlkO1xyXG4gICAgICAgICAgICAgICAgYW5hbHlzaXMgPSBtb2R1bGVBbmFseXplci5hbmFseXplKG5vcm1hbGl6ZWRJZCwgY3VycmVudCk7XHJcbiAgICAgICAgICAgICAgICBhbmFseXNpcy5pbml0aWFsaXplKGNvbnRhaW5lcik7XHJcbiAgICAgICAgICAgICAgICBhbmFseXNpcy5yZWdpc3RlcihyZXNvdXJjZXMsIG5hbWVzW2ldKTtcclxuICAgICAgICAgICAgICAgIGFsbEFuYWx5c2lzW2ldID0gYW5hbHlzaXM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGNvbXBpbGVJbnN0cnVjdGlvbi5hc3NvY2lhdGVkTW9kdWxlSWQpIHtcclxuICAgICAgICAgICAgICAgIGFzc29jaWF0ZWRNb2R1bGUgPSBtb2R1bGVBbmFseXplci5nZXRBbmFseXNpcyhjb21waWxlSW5zdHJ1Y3Rpb24uYXNzb2NpYXRlZE1vZHVsZUlkKTtcclxuICAgICAgICAgICAgICAgIGlmIChhc3NvY2lhdGVkTW9kdWxlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYXNzb2NpYXRlZE1vZHVsZS5yZWdpc3RlcihyZXNvdXJjZXMpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGZvciAoaSA9IDAsIGlpID0gYWxsQW5hbHlzaXMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICAgICAgYWxsQW5hbHlzaXNbaV0gPSBhbGxBbmFseXNpc1tpXS5sb2FkKGNvbnRhaW5lciwgbG9hZENvbnRleHQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLmFsbChhbGxBbmFseXNpcykudGhlbihmdW5jdGlvbiAoKSB7IHJldHVybiByZXNvdXJjZXM7IH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIFZpZXdFbmdpbmUucHJvdG90eXBlLl9hcHBseUxvYWRlclBsdWdpbiA9IGZ1bmN0aW9uIChpZCkge1xyXG4gICAgICAgIHZhciBpbmRleCA9IGlkLmxhc3RJbmRleE9mKCcuJyk7XHJcbiAgICAgICAgaWYgKGluZGV4ICE9PSAtMSkge1xyXG4gICAgICAgICAgICB2YXIgZXh0ID0gaWQuc3Vic3RyaW5nKGluZGV4KTtcclxuICAgICAgICAgICAgdmFyIHBsdWdpbk5hbWUgPSB0aGlzLl9wbHVnaW5NYXBbZXh0XTtcclxuICAgICAgICAgICAgaWYgKHBsdWdpbk5hbWUgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGlkO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmxvYWRlci5hcHBseVBsdWdpblRvVXJsKGlkLCBwbHVnaW5OYW1lKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGlkO1xyXG4gICAgfTtcclxuICAgIFZpZXdFbmdpbmUudmlld01vZGVsUmVxdWlyZU1ldGFkYXRhS2V5ID0gJ2F1cmVsaWE6dmlldy1tb2RlbC1yZXF1aXJlJztcclxuICAgIHJldHVybiBWaWV3RW5naW5lO1xyXG59KCkpO1xuXG52YXIgQ29udHJvbGxlciA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBDb250cm9sbGVyKGJlaGF2aW9yLCBpbnN0cnVjdGlvbiwgdmlld01vZGVsLCBjb250YWluZXIpIHtcclxuICAgICAgICB0aGlzLmJlaGF2aW9yID0gYmVoYXZpb3I7XHJcbiAgICAgICAgdGhpcy5pbnN0cnVjdGlvbiA9IGluc3RydWN0aW9uO1xyXG4gICAgICAgIHRoaXMudmlld01vZGVsID0gdmlld01vZGVsO1xyXG4gICAgICAgIHRoaXMuaXNBdHRhY2hlZCA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMudmlldyA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5pc0JvdW5kID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5zY29wZSA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5jb250YWluZXIgPSBjb250YWluZXI7XHJcbiAgICAgICAgdGhpcy5lbGVtZW50RXZlbnRzID0gY29udGFpbmVyLmVsZW1lbnRFdmVudHMgfHwgbnVsbDtcclxuICAgICAgICB2YXIgb2JzZXJ2ZXJMb29rdXAgPSBiZWhhdmlvci5vYnNlcnZlckxvY2F0b3IuZ2V0T3JDcmVhdGVPYnNlcnZlcnNMb29rdXAodmlld01vZGVsKTtcclxuICAgICAgICB2YXIgaGFuZGxlc0JpbmQgPSBiZWhhdmlvci5oYW5kbGVzQmluZDtcclxuICAgICAgICB2YXIgYXR0cmlidXRlcyA9IGluc3RydWN0aW9uLmF0dHJpYnV0ZXM7XHJcbiAgICAgICAgdmFyIGJvdW5kUHJvcGVydGllcyA9IHRoaXMuYm91bmRQcm9wZXJ0aWVzID0gW107XHJcbiAgICAgICAgdmFyIHByb3BlcnRpZXMgPSBiZWhhdmlvci5wcm9wZXJ0aWVzO1xyXG4gICAgICAgIHZhciBpO1xyXG4gICAgICAgIHZhciBpaTtcclxuICAgICAgICBiZWhhdmlvci5fZW5zdXJlUHJvcGVydGllc0RlZmluZWQodmlld01vZGVsLCBvYnNlcnZlckxvb2t1cCk7XHJcbiAgICAgICAgZm9yIChpID0gMCwgaWkgPSBwcm9wZXJ0aWVzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgcHJvcGVydGllc1tpXS5faW5pdGlhbGl6ZSh2aWV3TW9kZWwsIG9ic2VydmVyTG9va3VwLCBhdHRyaWJ1dGVzLCBoYW5kbGVzQmluZCwgYm91bmRQcm9wZXJ0aWVzKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBDb250cm9sbGVyLnByb3RvdHlwZS5jcmVhdGVkID0gZnVuY3Rpb24gKG93bmluZ1ZpZXcpIHtcclxuICAgICAgICBpZiAodGhpcy5iZWhhdmlvci5oYW5kbGVzQ3JlYXRlZCkge1xyXG4gICAgICAgICAgICB0aGlzLnZpZXdNb2RlbC5jcmVhdGVkKG93bmluZ1ZpZXcsIHRoaXMudmlldyk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIENvbnRyb2xsZXIucHJvdG90eXBlLmF1dG9tYXRlID0gZnVuY3Rpb24gKG92ZXJyaWRlQ29udGV4dCwgb3duaW5nVmlldykge1xyXG4gICAgICAgIHRoaXMudmlldy5iaW5kaW5nQ29udGV4dCA9IHRoaXMudmlld01vZGVsO1xyXG4gICAgICAgIHRoaXMudmlldy5vdmVycmlkZUNvbnRleHQgPSBvdmVycmlkZUNvbnRleHQgfHwgY3JlYXRlT3ZlcnJpZGVDb250ZXh0KHRoaXMudmlld01vZGVsKTtcclxuICAgICAgICB0aGlzLnZpZXcuX2lzVXNlckNvbnRyb2xsZWQgPSB0cnVlO1xyXG4gICAgICAgIGlmICh0aGlzLmJlaGF2aW9yLmhhbmRsZXNDcmVhdGVkKSB7XHJcbiAgICAgICAgICAgIHRoaXMudmlld01vZGVsLmNyZWF0ZWQob3duaW5nVmlldyB8fCBudWxsLCB0aGlzLnZpZXcpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmJpbmQodGhpcy52aWV3KTtcclxuICAgIH07XHJcbiAgICBDb250cm9sbGVyLnByb3RvdHlwZS5iaW5kID0gZnVuY3Rpb24gKHNjb3BlKSB7XHJcbiAgICAgICAgdmFyIHNraXBTZWxmU3Vic2NyaWJlciA9IHRoaXMuYmVoYXZpb3IuaGFuZGxlc0JpbmQ7XHJcbiAgICAgICAgdmFyIGJvdW5kUHJvcGVydGllcyA9IHRoaXMuYm91bmRQcm9wZXJ0aWVzO1xyXG4gICAgICAgIHZhciBpO1xyXG4gICAgICAgIHZhciBpaTtcclxuICAgICAgICB2YXIgeDtcclxuICAgICAgICB2YXIgb2JzZXJ2ZXI7XHJcbiAgICAgICAgdmFyIHNlbGZTdWJzY3JpYmVyO1xyXG4gICAgICAgIGlmICh0aGlzLmlzQm91bmQpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuc2NvcGUgPT09IHNjb3BlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy51bmJpbmQoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5pc0JvdW5kID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLnNjb3BlID0gc2NvcGU7XHJcbiAgICAgICAgZm9yIChpID0gMCwgaWkgPSBib3VuZFByb3BlcnRpZXMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICB4ID0gYm91bmRQcm9wZXJ0aWVzW2ldO1xyXG4gICAgICAgICAgICBvYnNlcnZlciA9IHgub2JzZXJ2ZXI7XHJcbiAgICAgICAgICAgIHNlbGZTdWJzY3JpYmVyID0gb2JzZXJ2ZXIuc2VsZlN1YnNjcmliZXI7XHJcbiAgICAgICAgICAgIG9ic2VydmVyLnB1Ymxpc2hpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgaWYgKHNraXBTZWxmU3Vic2NyaWJlcikge1xyXG4gICAgICAgICAgICAgICAgb2JzZXJ2ZXIuc2VsZlN1YnNjcmliZXIgPSBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHguYmluZGluZy5iaW5kKHNjb3BlKTtcclxuICAgICAgICAgICAgb2JzZXJ2ZXIuY2FsbCgpO1xyXG4gICAgICAgICAgICBvYnNlcnZlci5wdWJsaXNoaW5nID0gdHJ1ZTtcclxuICAgICAgICAgICAgb2JzZXJ2ZXIuc2VsZlN1YnNjcmliZXIgPSBzZWxmU3Vic2NyaWJlcjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIG92ZXJyaWRlQ29udGV4dDtcclxuICAgICAgICBpZiAodGhpcy52aWV3ICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIGlmIChza2lwU2VsZlN1YnNjcmliZXIpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudmlldy52aWV3TW9kZWxTY29wZSA9IHNjb3BlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnZpZXdNb2RlbCA9PT0gc2NvcGUub3ZlcnJpZGVDb250ZXh0LmJpbmRpbmdDb250ZXh0KSB7XHJcbiAgICAgICAgICAgICAgICBvdmVycmlkZUNvbnRleHQgPSBzY29wZS5vdmVycmlkZUNvbnRleHQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5pbnN0cnVjdGlvbi5pbmhlcml0QmluZGluZ0NvbnRleHQpIHtcclxuICAgICAgICAgICAgICAgIG92ZXJyaWRlQ29udGV4dCA9IGNyZWF0ZU92ZXJyaWRlQ29udGV4dCh0aGlzLnZpZXdNb2RlbCwgc2NvcGUub3ZlcnJpZGVDb250ZXh0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIG92ZXJyaWRlQ29udGV4dCA9IGNyZWF0ZU92ZXJyaWRlQ29udGV4dCh0aGlzLnZpZXdNb2RlbCk7XHJcbiAgICAgICAgICAgICAgICBvdmVycmlkZUNvbnRleHQuX19wYXJlbnRPdmVycmlkZUNvbnRleHQgPSBzY29wZS5vdmVycmlkZUNvbnRleHQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy52aWV3LmJpbmQodGhpcy52aWV3TW9kZWwsIG92ZXJyaWRlQ29udGV4dCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKHNraXBTZWxmU3Vic2NyaWJlcikge1xyXG4gICAgICAgICAgICBvdmVycmlkZUNvbnRleHQgPSBzY29wZS5vdmVycmlkZUNvbnRleHQ7XHJcbiAgICAgICAgICAgIGlmIChzY29wZS5vdmVycmlkZUNvbnRleHQuX19wYXJlbnRPdmVycmlkZUNvbnRleHQgIT09IHVuZGVmaW5lZFxyXG4gICAgICAgICAgICAgICAgJiYgdGhpcy52aWV3TW9kZWwudmlld0ZhY3RvcnkgJiYgdGhpcy52aWV3TW9kZWwudmlld0ZhY3RvcnkuZmFjdG9yeUNyZWF0ZUluc3RydWN0aW9uLnBhcnRSZXBsYWNlbWVudHMpIHtcclxuICAgICAgICAgICAgICAgIG92ZXJyaWRlQ29udGV4dCA9IE9iamVjdC5hc3NpZ24oe30sIHNjb3BlLm92ZXJyaWRlQ29udGV4dCk7XHJcbiAgICAgICAgICAgICAgICBvdmVycmlkZUNvbnRleHQucGFyZW50T3ZlcnJpZGVDb250ZXh0ID0gc2NvcGUub3ZlcnJpZGVDb250ZXh0Ll9fcGFyZW50T3ZlcnJpZGVDb250ZXh0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMudmlld01vZGVsLmJpbmQoc2NvcGUuYmluZGluZ0NvbnRleHQsIG92ZXJyaWRlQ29udGV4dCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIENvbnRyb2xsZXIucHJvdG90eXBlLnVuYmluZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAodGhpcy5pc0JvdW5kKSB7XHJcbiAgICAgICAgICAgIHZhciBib3VuZFByb3BlcnRpZXMgPSB0aGlzLmJvdW5kUHJvcGVydGllcztcclxuICAgICAgICAgICAgdmFyIGkgPSB2b2lkIDA7XHJcbiAgICAgICAgICAgIHZhciBpaSA9IHZvaWQgMDtcclxuICAgICAgICAgICAgdGhpcy5pc0JvdW5kID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHRoaXMuc2NvcGUgPSBudWxsO1xyXG4gICAgICAgICAgICBpZiAodGhpcy52aWV3ICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnZpZXcudW5iaW5kKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHRoaXMuYmVoYXZpb3IuaGFuZGxlc1VuYmluZCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy52aWV3TW9kZWwudW5iaW5kKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHRoaXMuZWxlbWVudEV2ZW50cyAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5lbGVtZW50RXZlbnRzLmRpc3Bvc2VBbGwoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IGJvdW5kUHJvcGVydGllcy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgICAgICBib3VuZFByb3BlcnRpZXNbaV0uYmluZGluZy51bmJpbmQoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBDb250cm9sbGVyLnByb3RvdHlwZS5hdHRhY2hlZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAodGhpcy5pc0F0dGFjaGVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5pc0F0dGFjaGVkID0gdHJ1ZTtcclxuICAgICAgICBpZiAodGhpcy5iZWhhdmlvci5oYW5kbGVzQXR0YWNoZWQpIHtcclxuICAgICAgICAgICAgdGhpcy52aWV3TW9kZWwuYXR0YWNoZWQoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMudmlldyAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aGlzLnZpZXcuYXR0YWNoZWQoKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgQ29udHJvbGxlci5wcm90b3R5cGUuZGV0YWNoZWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNBdHRhY2hlZCkge1xyXG4gICAgICAgICAgICB0aGlzLmlzQXR0YWNoZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgaWYgKHRoaXMudmlldyAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy52aWV3LmRldGFjaGVkKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHRoaXMuYmVoYXZpb3IuaGFuZGxlc0RldGFjaGVkKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnZpZXdNb2RlbC5kZXRhY2hlZCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIHJldHVybiBDb250cm9sbGVyO1xyXG59KCkpO1xuXG52YXIgbGFzdFByb3ZpZGVySWQgPSAwO1xyXG5mdW5jdGlvbiBuZXh0UHJvdmlkZXJJZCgpIHtcclxuICAgIHJldHVybiArK2xhc3RQcm92aWRlcklkO1xyXG59XHJcbmZ1bmN0aW9uIGRvUHJvY2Vzc0NvbnRlbnQoKSB7IHJldHVybiB0cnVlOyB9XHJcbmZ1bmN0aW9uIGRvUHJvY2Vzc0F0dHJpYnV0ZXMoKSB7IH1cclxudmFyIEh0bWxCZWhhdmlvclJlc291cmNlID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIEh0bWxCZWhhdmlvclJlc291cmNlKCkge1xyXG4gICAgICAgIHRoaXMuZWxlbWVudE5hbWUgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuYXR0cmlidXRlTmFtZSA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5hdHRyaWJ1dGVEZWZhdWx0QmluZGluZ01vZGUgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgdGhpcy5saWZ0c0NvbnRlbnQgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLnRhcmdldFNoYWRvd0RPTSA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuc2hhZG93RE9NT3B0aW9ucyA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5wcm9jZXNzQXR0cmlidXRlcyA9IGRvUHJvY2Vzc0F0dHJpYnV0ZXM7XHJcbiAgICAgICAgdGhpcy5wcm9jZXNzQ29udGVudCA9IGRvUHJvY2Vzc0NvbnRlbnQ7XHJcbiAgICAgICAgdGhpcy51c2VzU2hhZG93RE9NID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5jaGlsZEJpbmRpbmdzID0gbnVsbDtcclxuICAgICAgICB0aGlzLmhhc0R5bmFtaWNPcHRpb25zID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5jb250YWluZXJsZXNzID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5wcm9wZXJ0aWVzID0gW107XHJcbiAgICAgICAgdGhpcy5hdHRyaWJ1dGVzID0ge307XHJcbiAgICAgICAgdGhpcy5pc0luaXRpYWxpemVkID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5wcmltYXJ5UHJvcGVydHkgPSBudWxsO1xyXG4gICAgfVxyXG4gICAgSHRtbEJlaGF2aW9yUmVzb3VyY2UuY29udmVudGlvbiA9IGZ1bmN0aW9uIChuYW1lLCBleGlzdGluZykge1xyXG4gICAgICAgIHZhciBiZWhhdmlvcjtcclxuICAgICAgICBpZiAobmFtZS5lbmRzV2l0aCgnQ3VzdG9tQXR0cmlidXRlJykpIHtcclxuICAgICAgICAgICAgYmVoYXZpb3IgPSBleGlzdGluZyB8fCBuZXcgSHRtbEJlaGF2aW9yUmVzb3VyY2UoKTtcclxuICAgICAgICAgICAgYmVoYXZpb3IuYXR0cmlidXRlTmFtZSA9IF9oeXBoZW5hdGUobmFtZS5zdWJzdHJpbmcoMCwgbmFtZS5sZW5ndGggLSAxNSkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAobmFtZS5lbmRzV2l0aCgnQ3VzdG9tRWxlbWVudCcpKSB7XHJcbiAgICAgICAgICAgIGJlaGF2aW9yID0gZXhpc3RpbmcgfHwgbmV3IEh0bWxCZWhhdmlvclJlc291cmNlKCk7XHJcbiAgICAgICAgICAgIGJlaGF2aW9yLmVsZW1lbnROYW1lID0gX2h5cGhlbmF0ZShuYW1lLnN1YnN0cmluZygwLCBuYW1lLmxlbmd0aCAtIDEzKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBiZWhhdmlvcjtcclxuICAgIH07XHJcbiAgICBIdG1sQmVoYXZpb3JSZXNvdXJjZS5wcm90b3R5cGUuYWRkQ2hpbGRCaW5kaW5nID0gZnVuY3Rpb24gKGJlaGF2aW9yKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuY2hpbGRCaW5kaW5ncyA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aGlzLmNoaWxkQmluZGluZ3MgPSBbXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5jaGlsZEJpbmRpbmdzLnB1c2goYmVoYXZpb3IpO1xyXG4gICAgfTtcclxuICAgIEh0bWxCZWhhdmlvclJlc291cmNlLnByb3RvdHlwZS5pbml0aWFsaXplID0gZnVuY3Rpb24gKGNvbnRhaW5lciwgdGFyZ2V0KSB7XHJcbiAgICAgICAgdmFyIHByb3RvID0gdGFyZ2V0LnByb3RvdHlwZTtcclxuICAgICAgICB2YXIgcHJvcGVydGllcyA9IHRoaXMucHJvcGVydGllcztcclxuICAgICAgICB2YXIgYXR0cmlidXRlTmFtZSA9IHRoaXMuYXR0cmlidXRlTmFtZTtcclxuICAgICAgICB2YXIgYXR0cmlidXRlRGVmYXVsdEJpbmRpbmdNb2RlID0gdGhpcy5hdHRyaWJ1dGVEZWZhdWx0QmluZGluZ01vZGU7XHJcbiAgICAgICAgdmFyIGk7XHJcbiAgICAgICAgdmFyIGlpO1xyXG4gICAgICAgIHZhciBjdXJyZW50O1xyXG4gICAgICAgIGlmICh0aGlzLmlzSW5pdGlhbGl6ZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmlzSW5pdGlhbGl6ZWQgPSB0cnVlO1xyXG4gICAgICAgIHRhcmdldC5fX3Byb3ZpZGVySWRfXyA9IG5leHRQcm92aWRlcklkKCk7XHJcbiAgICAgICAgdGhpcy5vYnNlcnZlckxvY2F0b3IgPSBjb250YWluZXIuZ2V0KE9ic2VydmVyTG9jYXRvcik7XHJcbiAgICAgICAgdGhpcy50YXNrUXVldWUgPSBjb250YWluZXIuZ2V0KFRhc2tRdWV1ZSk7XHJcbiAgICAgICAgdGhpcy50YXJnZXQgPSB0YXJnZXQ7XHJcbiAgICAgICAgdGhpcy51c2VzU2hhZG93RE9NID0gdGhpcy50YXJnZXRTaGFkb3dET00gJiYgRkVBVFVSRS5zaGFkb3dET007XHJcbiAgICAgICAgdGhpcy5oYW5kbGVzQ3JlYXRlZCA9ICgnY3JlYXRlZCcgaW4gcHJvdG8pO1xyXG4gICAgICAgIHRoaXMuaGFuZGxlc0JpbmQgPSAoJ2JpbmQnIGluIHByb3RvKTtcclxuICAgICAgICB0aGlzLmhhbmRsZXNVbmJpbmQgPSAoJ3VuYmluZCcgaW4gcHJvdG8pO1xyXG4gICAgICAgIHRoaXMuaGFuZGxlc0F0dGFjaGVkID0gKCdhdHRhY2hlZCcgaW4gcHJvdG8pO1xyXG4gICAgICAgIHRoaXMuaGFuZGxlc0RldGFjaGVkID0gKCdkZXRhY2hlZCcgaW4gcHJvdG8pO1xyXG4gICAgICAgIHRoaXMuaHRtbE5hbWUgPSB0aGlzLmVsZW1lbnROYW1lIHx8IHRoaXMuYXR0cmlidXRlTmFtZTtcclxuICAgICAgICBpZiAoYXR0cmlidXRlTmFtZSAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICBpZiAocHJvcGVydGllcy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgICAgIG5ldyBCaW5kYWJsZVByb3BlcnR5KHtcclxuICAgICAgICAgICAgICAgICAgICBuYW1lOiAndmFsdWUnLFxyXG4gICAgICAgICAgICAgICAgICAgIGNoYW5nZUhhbmRsZXI6ICd2YWx1ZUNoYW5nZWQnIGluIHByb3RvID8gJ3ZhbHVlQ2hhbmdlZCcgOiBudWxsLFxyXG4gICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZTogYXR0cmlidXRlTmFtZSxcclxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0QmluZGluZ01vZGU6IGF0dHJpYnV0ZURlZmF1bHRCaW5kaW5nTW9kZVxyXG4gICAgICAgICAgICAgICAgfSkucmVnaXN0ZXJXaXRoKHRhcmdldCwgdGhpcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY3VycmVudCA9IHByb3BlcnRpZXNbMF07XHJcbiAgICAgICAgICAgIGlmIChwcm9wZXJ0aWVzLmxlbmd0aCA9PT0gMSAmJiBjdXJyZW50Lm5hbWUgPT09ICd2YWx1ZScpIHtcclxuICAgICAgICAgICAgICAgIGN1cnJlbnQuaXNEeW5hbWljID0gY3VycmVudC5oYXNPcHRpb25zID0gdGhpcy5oYXNEeW5hbWljT3B0aW9ucztcclxuICAgICAgICAgICAgICAgIGN1cnJlbnQuZGVmaW5lT24odGFyZ2V0LCB0aGlzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGZvciAoaSA9IDAsIGlpID0gcHJvcGVydGllcy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcHJvcGVydGllc1tpXS5kZWZpbmVPbih0YXJnZXQsIHRoaXMpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChwcm9wZXJ0aWVzW2ldLnByaW1hcnlQcm9wZXJ0eSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5wcmltYXJ5UHJvcGVydHkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignT25seSBvbmUgYmluZGFibGUgcHJvcGVydHkgb24gYSBjdXN0b20gZWxlbWVudCBjYW4gYmUgZGVmaW5lZCBhcyB0aGUgZGVmYXVsdCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucHJpbWFyeVByb3BlcnR5ID0gcHJvcGVydGllc1tpXTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50ID0gbmV3IEJpbmRhYmxlUHJvcGVydHkoe1xyXG4gICAgICAgICAgICAgICAgICAgIG5hbWU6ICd2YWx1ZScsXHJcbiAgICAgICAgICAgICAgICAgICAgY2hhbmdlSGFuZGxlcjogJ3ZhbHVlQ2hhbmdlZCcgaW4gcHJvdG8gPyAndmFsdWVDaGFuZ2VkJyA6IG51bGwsXHJcbiAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlOiBhdHRyaWJ1dGVOYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHRCaW5kaW5nTW9kZTogYXR0cmlidXRlRGVmYXVsdEJpbmRpbmdNb2RlXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIGN1cnJlbnQuaGFzT3B0aW9ucyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50LnJlZ2lzdGVyV2l0aCh0YXJnZXQsIHRoaXMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IHByb3BlcnRpZXMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICAgICAgcHJvcGVydGllc1tpXS5kZWZpbmVPbih0YXJnZXQsIHRoaXMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuX2NvcHlJbmhlcml0ZWRQcm9wZXJ0aWVzKGNvbnRhaW5lciwgdGFyZ2V0KTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgSHRtbEJlaGF2aW9yUmVzb3VyY2UucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKHJlZ2lzdHJ5LCBuYW1lKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICBpZiAodGhpcy5hdHRyaWJ1dGVOYW1lICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHJlZ2lzdHJ5LnJlZ2lzdGVyQXR0cmlidXRlKG5hbWUgfHwgdGhpcy5hdHRyaWJ1dGVOYW1lLCB0aGlzLCB0aGlzLmF0dHJpYnV0ZU5hbWUpO1xyXG4gICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh0aGlzLmFsaWFzZXMpKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFsaWFzZXNcclxuICAgICAgICAgICAgICAgICAgICAuZm9yRWFjaChmdW5jdGlvbiAoYWxpYXMpIHtcclxuICAgICAgICAgICAgICAgICAgICByZWdpc3RyeS5yZWdpc3RlckF0dHJpYnV0ZShhbGlhcywgX3RoaXMsIF90aGlzLmF0dHJpYnV0ZU5hbWUpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuZWxlbWVudE5hbWUgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgcmVnaXN0cnkucmVnaXN0ZXJFbGVtZW50KG5hbWUgfHwgdGhpcy5lbGVtZW50TmFtZSwgdGhpcyk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIEh0bWxCZWhhdmlvclJlc291cmNlLnByb3RvdHlwZS5hbGlhc2VzID0gZnVuY3Rpb24gKGFsaWFzZXMpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ01ldGhvZCBub3QgaW1wbGVtZW50ZWQuJyk7XHJcbiAgICB9O1xyXG4gICAgSHRtbEJlaGF2aW9yUmVzb3VyY2UucHJvdG90eXBlLmxvYWQgPSBmdW5jdGlvbiAoY29udGFpbmVyLCB0YXJnZXQsIGxvYWRDb250ZXh0LCB2aWV3U3RyYXRlZ3ksIHRyYW5zaWVudFZpZXcpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHZhciBvcHRpb25zO1xyXG4gICAgICAgIGlmICh0aGlzLmVsZW1lbnROYW1lICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHZpZXdTdHJhdGVneSA9IGNvbnRhaW5lci5nZXQoVmlld0xvY2F0b3IpLmdldFZpZXdTdHJhdGVneSh2aWV3U3RyYXRlZ3kgfHwgdGhpcy52aWV3U3RyYXRlZ3kgfHwgdGFyZ2V0KTtcclxuICAgICAgICAgICAgb3B0aW9ucyA9IG5ldyBWaWV3Q29tcGlsZUluc3RydWN0aW9uKHRoaXMudGFyZ2V0U2hhZG93RE9NLCB0cnVlKTtcclxuICAgICAgICAgICAgaWYgKCF2aWV3U3RyYXRlZ3kubW9kdWxlSWQpIHtcclxuICAgICAgICAgICAgICAgIHZpZXdTdHJhdGVneS5tb2R1bGVJZCA9IE9yaWdpbi5nZXQodGFyZ2V0KS5tb2R1bGVJZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdmlld1N0cmF0ZWd5XHJcbiAgICAgICAgICAgICAgICAubG9hZFZpZXdGYWN0b3J5KGNvbnRhaW5lci5nZXQoVmlld0VuZ2luZSksIG9wdGlvbnMsIGxvYWRDb250ZXh0LCB0YXJnZXQpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAodmlld0ZhY3RvcnkpIHtcclxuICAgICAgICAgICAgICAgIGlmICghdHJhbnNpZW50VmlldyB8fCAhX3RoaXMudmlld0ZhY3RvcnkpIHtcclxuICAgICAgICAgICAgICAgICAgICBfdGhpcy52aWV3RmFjdG9yeSA9IHZpZXdGYWN0b3J5O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHZpZXdGYWN0b3J5O1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh0aGlzKTtcclxuICAgIH07XHJcbiAgICBIdG1sQmVoYXZpb3JSZXNvdXJjZS5wcm90b3R5cGUuY29tcGlsZSA9IGZ1bmN0aW9uIChjb21waWxlciwgcmVzb3VyY2VzLCBub2RlLCBpbnN0cnVjdGlvbiwgcGFyZW50Tm9kZSkge1xyXG4gICAgICAgIGlmICh0aGlzLmxpZnRzQ29udGVudCkge1xyXG4gICAgICAgICAgICBpZiAoIWluc3RydWN0aW9uLnZpZXdGYWN0b3J5KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdGVtcGxhdGUgPSBET00uY3JlYXRlRWxlbWVudCgndGVtcGxhdGUnKTtcclxuICAgICAgICAgICAgICAgIHZhciBmcmFnbWVudCA9IERPTS5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgY2FjaGVTaXplID0gbm9kZS5nZXRBdHRyaWJ1dGUoJ3ZpZXctY2FjaGUnKTtcclxuICAgICAgICAgICAgICAgIHZhciBwYXJ0ID0gbm9kZS5nZXRBdHRyaWJ1dGUoJ3BhcnQnKTtcclxuICAgICAgICAgICAgICAgIG5vZGUucmVtb3ZlQXR0cmlidXRlKGluc3RydWN0aW9uLm9yaWdpbmFsQXR0ck5hbWUpO1xyXG4gICAgICAgICAgICAgICAgRE9NLnJlcGxhY2VOb2RlKHRlbXBsYXRlLCBub2RlLCBwYXJlbnROb2RlKTtcclxuICAgICAgICAgICAgICAgIGZyYWdtZW50LmFwcGVuZENoaWxkKG5vZGUpO1xyXG4gICAgICAgICAgICAgICAgaW5zdHJ1Y3Rpb24udmlld0ZhY3RvcnkgPSBjb21waWxlci5jb21waWxlKGZyYWdtZW50LCByZXNvdXJjZXMpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHBhcnQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpbnN0cnVjdGlvbi52aWV3RmFjdG9yeS5wYXJ0ID0gcGFydDtcclxuICAgICAgICAgICAgICAgICAgICBub2RlLnJlbW92ZUF0dHJpYnV0ZSgncGFydCcpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKGNhY2hlU2l6ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGluc3RydWN0aW9uLnZpZXdGYWN0b3J5LnNldENhY2hlU2l6ZShjYWNoZVNpemUpO1xyXG4gICAgICAgICAgICAgICAgICAgIG5vZGUucmVtb3ZlQXR0cmlidXRlKCd2aWV3LWNhY2hlJyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBub2RlID0gdGVtcGxhdGU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAodGhpcy5lbGVtZW50TmFtZSAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICB2YXIgcGFydFJlcGxhY2VtZW50cyA9IHt9O1xyXG4gICAgICAgICAgICBpZiAodGhpcy5wcm9jZXNzQ29udGVudChjb21waWxlciwgcmVzb3VyY2VzLCBub2RlLCBpbnN0cnVjdGlvbikgJiYgbm9kZS5oYXNDaGlsZE5vZGVzKCkpIHtcclxuICAgICAgICAgICAgICAgIHZhciBjdXJyZW50Q2hpbGQgPSBub2RlLmZpcnN0Q2hpbGQ7XHJcbiAgICAgICAgICAgICAgICB2YXIgY29udGVudEVsZW1lbnQgPSB0aGlzLnVzZXNTaGFkb3dET00gPyBudWxsIDogRE9NLmNyZWF0ZUVsZW1lbnQoJ2F1LWNvbnRlbnQnKTtcclxuICAgICAgICAgICAgICAgIHZhciBuZXh0U2libGluZyA9IHZvaWQgMDtcclxuICAgICAgICAgICAgICAgIHZhciB0b1JlcGxhY2UgPSB2b2lkIDA7XHJcbiAgICAgICAgICAgICAgICB3aGlsZSAoY3VycmVudENoaWxkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbmV4dFNpYmxpbmcgPSBjdXJyZW50Q2hpbGQubmV4dFNpYmxpbmc7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRDaGlsZC50YWdOYW1lID09PSAnVEVNUExBVEUnICYmICh0b1JlcGxhY2UgPSBjdXJyZW50Q2hpbGQuZ2V0QXR0cmlidXRlKCdyZXBsYWNlLXBhcnQnKSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGFydFJlcGxhY2VtZW50c1t0b1JlcGxhY2VdID0gY29tcGlsZXIuY29tcGlsZShjdXJyZW50Q2hpbGQsIHJlc291cmNlcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIERPTS5yZW1vdmVOb2RlKGN1cnJlbnRDaGlsZCwgcGFyZW50Tm9kZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGluc3RydWN0aW9uLnBhcnRSZXBsYWNlbWVudHMgPSBwYXJ0UmVwbGFjZW1lbnRzO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChjb250ZW50RWxlbWVudCAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudENoaWxkLm5vZGVUeXBlID09PSAzICYmIF9pc0FsbFdoaXRlc3BhY2UoY3VycmVudENoaWxkKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgRE9NLnJlbW92ZU5vZGUoY3VycmVudENoaWxkLCBwYXJlbnROb2RlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRFbGVtZW50LmFwcGVuZENoaWxkKGN1cnJlbnRDaGlsZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudENoaWxkID0gbmV4dFNpYmxpbmc7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoY29udGVudEVsZW1lbnQgIT09IG51bGwgJiYgY29udGVudEVsZW1lbnQuaGFzQ2hpbGROb2RlcygpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbm9kZS5hcHBlbmRDaGlsZChjb250ZW50RWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpbnN0cnVjdGlvbi5za2lwQ29udGVudFByb2Nlc3NpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGluc3RydWN0aW9uLnNraXBDb250ZW50UHJvY2Vzc2luZyA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoIXRoaXMucHJvY2Vzc0NvbnRlbnQoY29tcGlsZXIsIHJlc291cmNlcywgbm9kZSwgaW5zdHJ1Y3Rpb24pKSB7XHJcbiAgICAgICAgICAgIGluc3RydWN0aW9uLnNraXBDb250ZW50UHJvY2Vzc2luZyA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBub2RlO1xyXG4gICAgfTtcclxuICAgIEh0bWxCZWhhdmlvclJlc291cmNlLnByb3RvdHlwZS5jcmVhdGUgPSBmdW5jdGlvbiAoY29udGFpbmVyLCBpbnN0cnVjdGlvbiwgZWxlbWVudCwgYmluZGluZ3MpIHtcclxuICAgICAgICB2YXIgdmlld0hvc3Q7XHJcbiAgICAgICAgdmFyIGF1ID0gbnVsbDtcclxuICAgICAgICBpbnN0cnVjdGlvbiA9IGluc3RydWN0aW9uIHx8IEJlaGF2aW9ySW5zdHJ1Y3Rpb24ubm9ybWFsO1xyXG4gICAgICAgIGVsZW1lbnQgPSBlbGVtZW50IHx8IG51bGw7XHJcbiAgICAgICAgYmluZGluZ3MgPSBiaW5kaW5ncyB8fCBudWxsO1xyXG4gICAgICAgIGlmICh0aGlzLmVsZW1lbnROYW1lICE9PSBudWxsICYmIGVsZW1lbnQpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMudXNlc1NoYWRvd0RPTSkge1xyXG4gICAgICAgICAgICAgICAgdmlld0hvc3QgPSBlbGVtZW50LmF0dGFjaFNoYWRvdyh0aGlzLnNoYWRvd0RPTU9wdGlvbnMpO1xyXG4gICAgICAgICAgICAgICAgY29udGFpbmVyLnJlZ2lzdGVySW5zdGFuY2UoRE9NLmJvdW5kYXJ5LCB2aWV3SG9zdCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB2aWV3SG9zdCA9IGVsZW1lbnQ7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy50YXJnZXRTaGFkb3dET00pIHtcclxuICAgICAgICAgICAgICAgICAgICBjb250YWluZXIucmVnaXN0ZXJJbnN0YW5jZShET00uYm91bmRhcnksIHZpZXdIb3N0KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoZWxlbWVudCAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICBlbGVtZW50LmF1ID0gYXUgPSBlbGVtZW50LmF1IHx8IHt9O1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgdmlld01vZGVsID0gaW5zdHJ1Y3Rpb24udmlld01vZGVsIHx8IGNvbnRhaW5lci5nZXQodGhpcy50YXJnZXQpO1xyXG4gICAgICAgIHZhciBjb250cm9sbGVyID0gbmV3IENvbnRyb2xsZXIodGhpcywgaW5zdHJ1Y3Rpb24sIHZpZXdNb2RlbCwgY29udGFpbmVyKTtcclxuICAgICAgICB2YXIgY2hpbGRCaW5kaW5ncyA9IHRoaXMuY2hpbGRCaW5kaW5ncztcclxuICAgICAgICB2YXIgdmlld0ZhY3Rvcnk7XHJcbiAgICAgICAgaWYgKHRoaXMubGlmdHNDb250ZW50KSB7XHJcbiAgICAgICAgICAgIGF1LmNvbnRyb2xsZXIgPSBjb250cm9sbGVyO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmICh0aGlzLmVsZW1lbnROYW1lICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHZpZXdGYWN0b3J5ID0gaW5zdHJ1Y3Rpb24udmlld0ZhY3RvcnkgfHwgdGhpcy52aWV3RmFjdG9yeTtcclxuICAgICAgICAgICAgY29udGFpbmVyLnZpZXdNb2RlbCA9IHZpZXdNb2RlbDtcclxuICAgICAgICAgICAgaWYgKHZpZXdGYWN0b3J5KSB7XHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyLnZpZXcgPSB2aWV3RmFjdG9yeS5jcmVhdGUoY29udGFpbmVyLCBpbnN0cnVjdGlvbiwgZWxlbWVudCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGVsZW1lbnQgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIGF1LmNvbnRyb2xsZXIgPSBjb250cm9sbGVyO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNvbnRyb2xsZXIudmlldykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy51c2VzU2hhZG93RE9NICYmIChlbGVtZW50LmNoaWxkTm9kZXMubGVuZ3RoID09PSAxIHx8IGVsZW1lbnQuY29udGVudEVsZW1lbnQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb250ZW50RWxlbWVudCA9IGVsZW1lbnQuY2hpbGROb2Rlc1swXSB8fCBlbGVtZW50LmNvbnRlbnRFbGVtZW50O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyLnZpZXcuY29udGVudFZpZXcgPSB7IGZyYWdtZW50OiBjb250ZW50RWxlbWVudCB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50RWxlbWVudC5wYXJlbnROb2RlICYmIERPTS5yZW1vdmVOb2RlKGNvbnRlbnRFbGVtZW50KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGluc3RydWN0aW9uLmFuY2hvcklzQ29udGFpbmVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjaGlsZEJpbmRpbmdzICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBjaGlsZEJpbmRpbmdzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyLnZpZXcuYWRkQmluZGluZyhjaGlsZEJpbmRpbmdzW2ldLmNyZWF0ZShlbGVtZW50LCB2aWV3TW9kZWwsIGNvbnRyb2xsZXIpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyLnZpZXcuYXBwZW5kTm9kZXNUbyh2aWV3SG9zdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyLnZpZXcuaW5zZXJ0Tm9kZXNCZWZvcmUodmlld0hvc3QpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGNoaWxkQmluZGluZ3MgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBjaGlsZEJpbmRpbmdzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYmluZGluZ3MucHVzaChjaGlsZEJpbmRpbmdzW2ldLmNyZWF0ZShlbGVtZW50LCB2aWV3TW9kZWwsIGNvbnRyb2xsZXIpKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAoY29udHJvbGxlci52aWV3KSB7XHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyLnZpZXcuY29udHJvbGxlciA9IGNvbnRyb2xsZXI7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2hpbGRCaW5kaW5ncyAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IGNoaWxkQmluZGluZ3MubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyLnZpZXcuYWRkQmluZGluZyhjaGlsZEJpbmRpbmdzW2ldLmNyZWF0ZShpbnN0cnVjdGlvbi5ob3N0LCB2aWV3TW9kZWwsIGNvbnRyb2xsZXIpKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAoY2hpbGRCaW5kaW5ncyAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gY2hpbGRCaW5kaW5ncy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYmluZGluZ3MucHVzaChjaGlsZEJpbmRpbmdzW2ldLmNyZWF0ZShpbnN0cnVjdGlvbi5ob3N0LCB2aWV3TW9kZWwsIGNvbnRyb2xsZXIpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChjaGlsZEJpbmRpbmdzICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IGNoaWxkQmluZGluZ3MubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICAgICAgYmluZGluZ3MucHVzaChjaGlsZEJpbmRpbmdzW2ldLmNyZWF0ZShlbGVtZW50LCB2aWV3TW9kZWwsIGNvbnRyb2xsZXIpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoYXUgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgYXVbdGhpcy5odG1sTmFtZV0gPSBjb250cm9sbGVyO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoaW5zdHJ1Y3Rpb24uaW5pdGlhdGVkQnlCZWhhdmlvciAmJiB2aWV3RmFjdG9yeSkge1xyXG4gICAgICAgICAgICBjb250cm9sbGVyLnZpZXcuY3JlYXRlZCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gY29udHJvbGxlcjtcclxuICAgIH07XHJcbiAgICBIdG1sQmVoYXZpb3JSZXNvdXJjZS5wcm90b3R5cGUuX2Vuc3VyZVByb3BlcnRpZXNEZWZpbmVkID0gZnVuY3Rpb24gKGluc3RhbmNlLCBsb29rdXApIHtcclxuICAgICAgICB2YXIgcHJvcGVydGllcztcclxuICAgICAgICB2YXIgaTtcclxuICAgICAgICB2YXIgaWk7XHJcbiAgICAgICAgdmFyIG9ic2VydmVyO1xyXG4gICAgICAgIGlmICgnX19wcm9wZXJ0aWVzRGVmaW5lZF9fJyBpbiBsb29rdXApIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsb29rdXAuX19wcm9wZXJ0aWVzRGVmaW5lZF9fID0gdHJ1ZTtcclxuICAgICAgICBwcm9wZXJ0aWVzID0gdGhpcy5wcm9wZXJ0aWVzO1xyXG4gICAgICAgIGZvciAoaSA9IDAsIGlpID0gcHJvcGVydGllcy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgIG9ic2VydmVyID0gcHJvcGVydGllc1tpXS5jcmVhdGVPYnNlcnZlcihpbnN0YW5jZSk7XHJcbiAgICAgICAgICAgIGlmIChvYnNlcnZlciAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICBsb29rdXBbb2JzZXJ2ZXIucHJvcGVydHlOYW1lXSA9IG9ic2VydmVyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIEh0bWxCZWhhdmlvclJlc291cmNlLnByb3RvdHlwZS5fY29weUluaGVyaXRlZFByb3BlcnRpZXMgPSBmdW5jdGlvbiAoY29udGFpbmVyLCB0YXJnZXQpIHtcclxuICAgICAgICB2YXIgYmVoYXZpb3I7XHJcbiAgICAgICAgdmFyIGRlcml2ZWQgPSB0YXJnZXQ7XHJcbiAgICAgICAgd2hpbGUgKHRydWUpIHtcclxuICAgICAgICAgICAgdmFyIHByb3RvID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKHRhcmdldC5wcm90b3R5cGUpO1xyXG4gICAgICAgICAgICB0YXJnZXQgPSBwcm90byAmJiBwcm90by5jb25zdHJ1Y3RvcjtcclxuICAgICAgICAgICAgaWYgKCF0YXJnZXQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBiZWhhdmlvciA9IG1ldGFkYXRhLmdldE93bihtZXRhZGF0YS5yZXNvdXJjZSwgdGFyZ2V0KTtcclxuICAgICAgICAgICAgaWYgKGJlaGF2aW9yKSB7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBiZWhhdmlvci5pbml0aWFsaXplKGNvbnRhaW5lciwgdGFyZ2V0KTtcclxuICAgICAgICB2YXIgX2xvb3BfMSA9IGZ1bmN0aW9uIChpLCBpaSkge1xyXG4gICAgICAgICAgICB2YXIgcHJvcCA9IGJlaGF2aW9yLnByb3BlcnRpZXNbaV07XHJcbiAgICAgICAgICAgIGlmICh0aGlzXzEucHJvcGVydGllcy5zb21lKGZ1bmN0aW9uIChwKSB7IHJldHVybiBwLm5hbWUgPT09IHByb3AubmFtZTsgfSkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBcImNvbnRpbnVlXCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgbmV3IEJpbmRhYmxlUHJvcGVydHkocHJvcCkucmVnaXN0ZXJXaXRoKGRlcml2ZWQsIHRoaXNfMSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICB2YXIgdGhpc18xID0gdGhpcztcclxuICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBiZWhhdmlvci5wcm9wZXJ0aWVzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgX2xvb3BfMShpKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIEh0bWxCZWhhdmlvclJlc291cmNlO1xyXG59KCkpO1xuXG5mdW5jdGlvbiByZWdpc3Rlcihsb29rdXAsIG5hbWUsIHJlc291cmNlLCB0eXBlKSB7XHJcbiAgICBpZiAoIW5hbWUpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICB2YXIgZXhpc3RpbmcgPSBsb29rdXBbbmFtZV07XHJcbiAgICBpZiAoZXhpc3RpbmcpIHtcclxuICAgICAgICBpZiAoZXhpc3RpbmcgIT09IHJlc291cmNlKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkF0dGVtcHRlZCB0byByZWdpc3RlciBcIi5jb25jYXQodHlwZSwgXCIgd2hlbiBvbmUgd2l0aCB0aGUgc2FtZSBuYW1lIGFscmVhZHkgZXhpc3RzLiBOYW1lOiBcIikuY29uY2F0KG5hbWUsIFwiLlwiKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGxvb2t1cFtuYW1lXSA9IHJlc291cmNlO1xyXG59XHJcbmZ1bmN0aW9uIHZhbGlkYXRlQmVoYXZpb3JOYW1lKG5hbWUsIHR5cGUpIHtcclxuICAgIGlmICgvW0EtWl0vLnRlc3QobmFtZSkpIHtcclxuICAgICAgICB2YXIgbmV3TmFtZSA9IF9oeXBoZW5hdGUobmFtZSk7XHJcbiAgICAgICAgTG9nTWFuYWdlclxyXG4gICAgICAgICAgICAuZ2V0TG9nZ2VyKCd0ZW1wbGF0aW5nJylcclxuICAgICAgICAgICAgLndhcm4oXCInXCIuY29uY2F0KG5hbWUsIFwiJyBpcyBub3QgYSB2YWxpZCBcIikuY29uY2F0KHR5cGUsIFwiIG5hbWUgYW5kIGhhcyBiZWVuIGNvbnZlcnRlZCB0byAnXCIpLmNvbmNhdChuZXdOYW1lLCBcIicuIFVwcGVyLWNhc2UgbGV0dGVycyBhcmUgbm90IGFsbG93ZWQgYmVjYXVzZSB0aGUgRE9NIGlzIG5vdCBjYXNlLXNlbnNpdGl2ZS5cIikpO1xyXG4gICAgICAgIHJldHVybiBuZXdOYW1lO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIG5hbWU7XHJcbn1cclxudmFyIGNvbnZlbnRpb25NYXJrID0gJ19fYXVfcmVzb3VyY2VfXyc7XHJcbnZhciBWaWV3UmVzb3VyY2VzID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIFZpZXdSZXNvdXJjZXMocGFyZW50LCB2aWV3VXJsKSB7XHJcbiAgICAgICAgdGhpcy5iaW5kaW5nTGFuZ3VhZ2UgPSBudWxsO1xyXG4gICAgICAgIHRoaXMucGFyZW50ID0gcGFyZW50IHx8IG51bGw7XHJcbiAgICAgICAgdGhpcy5oYXNQYXJlbnQgPSB0aGlzLnBhcmVudCAhPT0gbnVsbDtcclxuICAgICAgICB0aGlzLnZpZXdVcmwgPSB2aWV3VXJsIHx8ICcnO1xyXG4gICAgICAgIHRoaXMubG9va3VwRnVuY3Rpb25zID0ge1xyXG4gICAgICAgICAgICB2YWx1ZUNvbnZlcnRlcnM6IHRoaXMuZ2V0VmFsdWVDb252ZXJ0ZXIuYmluZCh0aGlzKSxcclxuICAgICAgICAgICAgYmluZGluZ0JlaGF2aW9yczogdGhpcy5nZXRCaW5kaW5nQmVoYXZpb3IuYmluZCh0aGlzKVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgdGhpcy5hdHRyaWJ1dGVzID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcclxuICAgICAgICB0aGlzLmVsZW1lbnRzID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcclxuICAgICAgICB0aGlzLnZhbHVlQ29udmVydGVycyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XHJcbiAgICAgICAgdGhpcy5iaW5kaW5nQmVoYXZpb3JzID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcclxuICAgICAgICB0aGlzLmF0dHJpYnV0ZU1hcCA9IE9iamVjdC5jcmVhdGUobnVsbCk7XHJcbiAgICAgICAgdGhpcy52YWx1ZXMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xyXG4gICAgICAgIHRoaXMuYmVmb3JlQ29tcGlsZSA9IHRoaXMuYWZ0ZXJDb21waWxlID0gdGhpcy5iZWZvcmVDcmVhdGUgPSB0aGlzLmFmdGVyQ3JlYXRlID0gdGhpcy5iZWZvcmVCaW5kID0gdGhpcy5iZWZvcmVVbmJpbmQgPSBmYWxzZTtcclxuICAgIH1cclxuICAgIFZpZXdSZXNvdXJjZXMuY29udmVudGlvbiA9IGZ1bmN0aW9uICh0YXJnZXQsIGV4aXN0aW5nKSB7XHJcbiAgICAgICAgdmFyIHJlc291cmNlO1xyXG4gICAgICAgIGlmIChleGlzdGluZyAmJiBjb252ZW50aW9uTWFyayBpbiBleGlzdGluZykge1xyXG4gICAgICAgICAgICByZXR1cm4gZXhpc3Rpbmc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICgnJHJlc291cmNlJyBpbiB0YXJnZXQpIHtcclxuICAgICAgICAgICAgdmFyIGNvbmZpZyA9IHRhcmdldC4kcmVzb3VyY2U7XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgY29uZmlnID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICAgICAgcmVzb3VyY2UgPSBleGlzdGluZyB8fCBuZXcgSHRtbEJlaGF2aW9yUmVzb3VyY2UoKTtcclxuICAgICAgICAgICAgICAgIHJlc291cmNlW2NvbnZlbnRpb25NYXJrXSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXJlc291cmNlLmVsZW1lbnROYW1lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2UuZWxlbWVudE5hbWUgPSB2YWxpZGF0ZUJlaGF2aW9yTmFtZShjb25maWcsICdjdXN0b20gZWxlbWVudCcpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBjb25maWcgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25maWcgPSBjb25maWcuY2FsbCh0YXJnZXQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBjb25maWcgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uZmlnID0geyBuYW1lOiBjb25maWcgfTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGNvbmZpZyA9IE9iamVjdC5hc3NpZ24oe30sIGNvbmZpZyk7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVzb3VyY2VUeXBlID0gY29uZmlnLnR5cGUgfHwgJ2VsZW1lbnQnO1xyXG4gICAgICAgICAgICAgICAgdmFyIG5hbWVfMSA9IGNvbmZpZy5uYW1lO1xyXG4gICAgICAgICAgICAgICAgc3dpdGNoIChyZXNvdXJjZVR5cGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdlbGVtZW50JzpcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdhdHRyaWJ1dGUnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZSA9IGV4aXN0aW5nIHx8IG5ldyBIdG1sQmVoYXZpb3JSZXNvdXJjZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZVtjb252ZW50aW9uTWFya10gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzb3VyY2VUeXBlID09PSAnZWxlbWVudCcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcmVzb3VyY2UuZWxlbWVudE5hbWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZS5lbGVtZW50TmFtZSA9IG5hbWVfMVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IHZhbGlkYXRlQmVoYXZpb3JOYW1lKG5hbWVfMSwgJ2N1c3RvbSBlbGVtZW50JylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBfaHlwaGVuYXRlKHRhcmdldC5uYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcmVzb3VyY2UuYXR0cmlidXRlTmFtZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc291cmNlLmF0dHJpYnV0ZU5hbWUgPSBuYW1lXzFcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyB2YWxpZGF0ZUJlaGF2aW9yTmFtZShuYW1lXzEsICdjdXN0b20gYXR0cmlidXRlJylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBfaHlwaGVuYXRlKHRhcmdldC5uYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoJ3RlbXBsYXRlQ29udHJvbGxlcicgaW4gY29uZmlnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWcubGlmdHNDb250ZW50ID0gY29uZmlnLnRlbXBsYXRlQ29udHJvbGxlcjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBjb25maWcudGVtcGxhdGVDb250cm9sbGVyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgnZGVmYXVsdEJpbmRpbmdNb2RlJyBpbiBjb25maWcgJiYgcmVzb3VyY2UuYXR0cmlidXRlRGVmYXVsdEJpbmRpbmdNb2RlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZy5hdHRyaWJ1dGVEZWZhdWx0QmluZGluZ01vZGUgPSBjb25maWcuZGVmYXVsdEJpbmRpbmdNb2RlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGNvbmZpZy5kZWZhdWx0QmluZGluZ01vZGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGNvbmZpZy5uYW1lO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHJlc291cmNlLCBjb25maWcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICd2YWx1ZUNvbnZlcnRlcic6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc291cmNlID0gbmV3IFZhbHVlQ29udmVydGVyUmVzb3VyY2UoY2FtZWxDYXNlKG5hbWVfMSB8fCB0YXJnZXQubmFtZSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdiaW5kaW5nQmVoYXZpb3InOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZSA9IG5ldyBCaW5kaW5nQmVoYXZpb3JSZXNvdXJjZShjYW1lbENhc2UobmFtZV8xIHx8IHRhcmdldC5uYW1lKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ3ZpZXdFbmdpbmVIb29rcyc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc291cmNlID0gbmV3IFZpZXdFbmdpbmVIb29rc1Jlc291cmNlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChyZXNvdXJjZSBpbnN0YW5jZW9mIEh0bWxCZWhhdmlvclJlc291cmNlKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYmluZGFibGVzID0gdHlwZW9mIGNvbmZpZyA9PT0gJ3N0cmluZycgPyB1bmRlZmluZWQgOiBjb25maWcuYmluZGFibGVzO1xyXG4gICAgICAgICAgICAgICAgdmFyIGN1cnJlbnRQcm9wcyA9IHJlc291cmNlLnByb3BlcnRpZXM7XHJcbiAgICAgICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShiaW5kYWJsZXMpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gYmluZGFibGVzLmxlbmd0aDsgaWkgPiBpOyArK2kpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHByb3AgPSBiaW5kYWJsZXNbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcHJvcCB8fCAodHlwZW9mIHByb3AgIT09ICdzdHJpbmcnICYmICFwcm9wLm5hbWUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIGJpbmRhYmxlIHByb3BlcnR5IGF0IFxcXCJcIi5jb25jYXQoaSwgXCJcXFwiIGZvciBjbGFzcyBcXFwiXCIpLmNvbmNhdCh0YXJnZXQubmFtZSwgXCJcXFwiLiBFeHBlY3RlZCBlaXRoZXIgYSBzdHJpbmcgb3IgYW4gb2JqZWN0IHdpdGggXFxcIm5hbWVcXFwiIHByb3BlcnR5LlwiKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG5ld1Byb3AgPSBuZXcgQmluZGFibGVQcm9wZXJ0eShwcm9wKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGV4aXN0ZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDAsIGpqID0gY3VycmVudFByb3BzLmxlbmd0aDsgamogPiBqOyArK2opIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50UHJvcHNbal0ubmFtZSA9PT0gbmV3UHJvcC5uYW1lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhpc3RlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGV4aXN0ZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ld1Byb3AucmVnaXN0ZXJXaXRoKHRhcmdldCwgcmVzb3VyY2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzb3VyY2U7XHJcbiAgICB9O1xyXG4gICAgVmlld1Jlc291cmNlcy5wcm90b3R5cGUuX3RyeUFkZEhvb2sgPSBmdW5jdGlvbiAob2JqLCBuYW1lKSB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBvYmpbbmFtZV0gPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgdmFyIGZ1bmMgPSBvYmpbbmFtZV0uYmluZChvYmopO1xyXG4gICAgICAgICAgICB2YXIgY291bnRlciA9IDE7XHJcbiAgICAgICAgICAgIHZhciBjYWxsYmFja05hbWUgPSB2b2lkIDA7XHJcbiAgICAgICAgICAgIHdoaWxlICh0aGlzW2NhbGxiYWNrTmFtZSA9IG5hbWUgKyBjb3VudGVyLnRvU3RyaW5nKCldICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIGNvdW50ZXIrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzW25hbWVdID0gdHJ1ZTtcclxuICAgICAgICAgICAgdGhpc1tjYWxsYmFja05hbWVdID0gZnVuYztcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgVmlld1Jlc291cmNlcy5wcm90b3R5cGUuX2ludm9rZUhvb2sgPSBmdW5jdGlvbiAobmFtZSwgb25lLCB0d28sIHRocmVlLCBmb3VyKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuaGFzUGFyZW50KSB7XHJcbiAgICAgICAgICAgIHRoaXMucGFyZW50Ll9pbnZva2VIb29rKG5hbWUsIG9uZSwgdHdvLCB0aHJlZSwgZm91cik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzW25hbWVdKSB7XHJcbiAgICAgICAgICAgIHRoaXNbbmFtZSArICcxJ10ob25lLCB0d28sIHRocmVlLCBmb3VyKTtcclxuICAgICAgICAgICAgdmFyIGNhbGxiYWNrTmFtZSA9IG5hbWUgKyAnMic7XHJcbiAgICAgICAgICAgIGlmICh0aGlzW2NhbGxiYWNrTmFtZV0pIHtcclxuICAgICAgICAgICAgICAgIHRoaXNbY2FsbGJhY2tOYW1lXShvbmUsIHR3bywgdGhyZWUsIGZvdXIpO1xyXG4gICAgICAgICAgICAgICAgY2FsbGJhY2tOYW1lID0gbmFtZSArICczJztcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzW2NhbGxiYWNrTmFtZV0pIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzW2NhbGxiYWNrTmFtZV0ob25lLCB0d28sIHRocmVlLCBmb3VyKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY291bnRlciA9IDQ7XHJcbiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKHRoaXNbY2FsbGJhY2tOYW1lID0gbmFtZSArIGNvdW50ZXIudG9TdHJpbmcoKV0gIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzW2NhbGxiYWNrTmFtZV0ob25lLCB0d28sIHRocmVlLCBmb3VyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY291bnRlcisrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBWaWV3UmVzb3VyY2VzLnByb3RvdHlwZS5yZWdpc3RlclZpZXdFbmdpbmVIb29rcyA9IGZ1bmN0aW9uIChob29rcykge1xyXG4gICAgICAgIHRoaXMuX3RyeUFkZEhvb2soaG9va3MsICdiZWZvcmVDb21waWxlJyk7XHJcbiAgICAgICAgdGhpcy5fdHJ5QWRkSG9vayhob29rcywgJ2FmdGVyQ29tcGlsZScpO1xyXG4gICAgICAgIHRoaXMuX3RyeUFkZEhvb2soaG9va3MsICdiZWZvcmVDcmVhdGUnKTtcclxuICAgICAgICB0aGlzLl90cnlBZGRIb29rKGhvb2tzLCAnYWZ0ZXJDcmVhdGUnKTtcclxuICAgICAgICB0aGlzLl90cnlBZGRIb29rKGhvb2tzLCAnYmVmb3JlQmluZCcpO1xyXG4gICAgICAgIHRoaXMuX3RyeUFkZEhvb2soaG9va3MsICdiZWZvcmVVbmJpbmQnKTtcclxuICAgIH07XHJcbiAgICBWaWV3UmVzb3VyY2VzLnByb3RvdHlwZS5nZXRCaW5kaW5nTGFuZ3VhZ2UgPSBmdW5jdGlvbiAoYmluZGluZ0xhbmd1YWdlRmFsbGJhY2spIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5iaW5kaW5nTGFuZ3VhZ2UgfHwgKHRoaXMuYmluZGluZ0xhbmd1YWdlID0gYmluZGluZ0xhbmd1YWdlRmFsbGJhY2spO1xyXG4gICAgfTtcclxuICAgIFZpZXdSZXNvdXJjZXMucHJvdG90eXBlLnBhdGNoSW5QYXJlbnQgPSBmdW5jdGlvbiAobmV3UGFyZW50KSB7XHJcbiAgICAgICAgdmFyIG9yaWdpbmFsUGFyZW50ID0gdGhpcy5wYXJlbnQ7XHJcbiAgICAgICAgdGhpcy5wYXJlbnQgPSBuZXdQYXJlbnQgfHwgbnVsbDtcclxuICAgICAgICB0aGlzLmhhc1BhcmVudCA9IHRoaXMucGFyZW50ICE9PSBudWxsO1xyXG4gICAgICAgIGlmIChuZXdQYXJlbnQucGFyZW50ID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgIG5ld1BhcmVudC5wYXJlbnQgPSBvcmlnaW5hbFBhcmVudDtcclxuICAgICAgICAgICAgbmV3UGFyZW50Lmhhc1BhcmVudCA9IG9yaWdpbmFsUGFyZW50ICE9PSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBWaWV3UmVzb3VyY2VzLnByb3RvdHlwZS5yZWxhdGl2ZVRvVmlldyA9IGZ1bmN0aW9uIChwYXRoKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlbGF0aXZlVG9GaWxlKHBhdGgsIHRoaXMudmlld1VybCk7XHJcbiAgICB9O1xyXG4gICAgVmlld1Jlc291cmNlcy5wcm90b3R5cGUucmVnaXN0ZXJFbGVtZW50ID0gZnVuY3Rpb24gKHRhZ05hbWUsIGJlaGF2aW9yKSB7XHJcbiAgICAgICAgcmVnaXN0ZXIodGhpcy5lbGVtZW50cywgdGFnTmFtZSwgYmVoYXZpb3IsICdhbiBFbGVtZW50Jyk7XHJcbiAgICB9O1xyXG4gICAgVmlld1Jlc291cmNlcy5wcm90b3R5cGUuZ2V0RWxlbWVudCA9IGZ1bmN0aW9uICh0YWdOYW1lKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZWxlbWVudHNbdGFnTmFtZV0gfHwgKHRoaXMuaGFzUGFyZW50ID8gdGhpcy5wYXJlbnQuZ2V0RWxlbWVudCh0YWdOYW1lKSA6IG51bGwpO1xyXG4gICAgfTtcclxuICAgIFZpZXdSZXNvdXJjZXMucHJvdG90eXBlLm1hcEF0dHJpYnV0ZSA9IGZ1bmN0aW9uIChhdHRyaWJ1dGUpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5hdHRyaWJ1dGVNYXBbYXR0cmlidXRlXSB8fCAodGhpcy5oYXNQYXJlbnQgPyB0aGlzLnBhcmVudC5tYXBBdHRyaWJ1dGUoYXR0cmlidXRlKSA6IG51bGwpO1xyXG4gICAgfTtcclxuICAgIFZpZXdSZXNvdXJjZXMucHJvdG90eXBlLnJlZ2lzdGVyQXR0cmlidXRlID0gZnVuY3Rpb24gKGF0dHJpYnV0ZSwgYmVoYXZpb3IsIGtub3duQXR0cmlidXRlKSB7XHJcbiAgICAgICAgdGhpcy5hdHRyaWJ1dGVNYXBbYXR0cmlidXRlXSA9IGtub3duQXR0cmlidXRlO1xyXG4gICAgICAgIHJlZ2lzdGVyKHRoaXMuYXR0cmlidXRlcywgYXR0cmlidXRlLCBiZWhhdmlvciwgJ2FuIEF0dHJpYnV0ZScpO1xyXG4gICAgfTtcclxuICAgIFZpZXdSZXNvdXJjZXMucHJvdG90eXBlLmdldEF0dHJpYnV0ZSA9IGZ1bmN0aW9uIChhdHRyaWJ1dGUpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5hdHRyaWJ1dGVzW2F0dHJpYnV0ZV0gfHwgKHRoaXMuaGFzUGFyZW50ID8gdGhpcy5wYXJlbnQuZ2V0QXR0cmlidXRlKGF0dHJpYnV0ZSkgOiBudWxsKTtcclxuICAgIH07XHJcbiAgICBWaWV3UmVzb3VyY2VzLnByb3RvdHlwZS5yZWdpc3RlclZhbHVlQ29udmVydGVyID0gZnVuY3Rpb24gKG5hbWUsIHZhbHVlQ29udmVydGVyKSB7XHJcbiAgICAgICAgcmVnaXN0ZXIodGhpcy52YWx1ZUNvbnZlcnRlcnMsIG5hbWUsIHZhbHVlQ29udmVydGVyLCAnYSBWYWx1ZUNvbnZlcnRlcicpO1xyXG4gICAgfTtcclxuICAgIFZpZXdSZXNvdXJjZXMucHJvdG90eXBlLmdldFZhbHVlQ29udmVydGVyID0gZnVuY3Rpb24gKG5hbWUpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy52YWx1ZUNvbnZlcnRlcnNbbmFtZV0gfHwgKHRoaXMuaGFzUGFyZW50ID8gdGhpcy5wYXJlbnQuZ2V0VmFsdWVDb252ZXJ0ZXIobmFtZSkgOiBudWxsKTtcclxuICAgIH07XHJcbiAgICBWaWV3UmVzb3VyY2VzLnByb3RvdHlwZS5yZWdpc3RlckJpbmRpbmdCZWhhdmlvciA9IGZ1bmN0aW9uIChuYW1lLCBiaW5kaW5nQmVoYXZpb3IpIHtcclxuICAgICAgICByZWdpc3Rlcih0aGlzLmJpbmRpbmdCZWhhdmlvcnMsIG5hbWUsIGJpbmRpbmdCZWhhdmlvciwgJ2EgQmluZGluZ0JlaGF2aW9yJyk7XHJcbiAgICB9O1xyXG4gICAgVmlld1Jlc291cmNlcy5wcm90b3R5cGUuZ2V0QmluZGluZ0JlaGF2aW9yID0gZnVuY3Rpb24gKG5hbWUpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5iaW5kaW5nQmVoYXZpb3JzW25hbWVdIHx8ICh0aGlzLmhhc1BhcmVudCA/IHRoaXMucGFyZW50LmdldEJpbmRpbmdCZWhhdmlvcihuYW1lKSA6IG51bGwpO1xyXG4gICAgfTtcclxuICAgIFZpZXdSZXNvdXJjZXMucHJvdG90eXBlLnJlZ2lzdGVyVmFsdWUgPSBmdW5jdGlvbiAobmFtZSwgdmFsdWUpIHtcclxuICAgICAgICByZWdpc3Rlcih0aGlzLnZhbHVlcywgbmFtZSwgdmFsdWUsICdhIHZhbHVlJyk7XHJcbiAgICB9O1xyXG4gICAgVmlld1Jlc291cmNlcy5wcm90b3R5cGUuZ2V0VmFsdWUgPSBmdW5jdGlvbiAobmFtZSkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnZhbHVlc1tuYW1lXSB8fCAodGhpcy5oYXNQYXJlbnQgPyB0aGlzLnBhcmVudC5nZXRWYWx1ZShuYW1lKSA6IG51bGwpO1xyXG4gICAgfTtcclxuICAgIFZpZXdSZXNvdXJjZXMucHJvdG90eXBlLmF1dG9SZWdpc3RlciA9IGZ1bmN0aW9uIChjb250YWluZXIsIGltcGwpIHtcclxuICAgICAgICB2YXIgcmVzb3VyY2VUeXBlTWV0YSA9IG1ldGFkYXRhLmdldE93bihtZXRhZGF0YS5yZXNvdXJjZSwgaW1wbCk7XHJcbiAgICAgICAgaWYgKHJlc291cmNlVHlwZU1ldGEpIHtcclxuICAgICAgICAgICAgaWYgKHJlc291cmNlVHlwZU1ldGEgaW5zdGFuY2VvZiBIdG1sQmVoYXZpb3JSZXNvdXJjZSkge1xyXG4gICAgICAgICAgICAgICAgVmlld1Jlc291cmNlcy5jb252ZW50aW9uKGltcGwsIHJlc291cmNlVHlwZU1ldGEpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc291cmNlVHlwZU1ldGEuYXR0cmlidXRlTmFtZSA9PT0gbnVsbCAmJiByZXNvdXJjZVR5cGVNZXRhLmVsZW1lbnROYW1lID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgSHRtbEJlaGF2aW9yUmVzb3VyY2UuY29udmVudGlvbihpbXBsLm5hbWUsIHJlc291cmNlVHlwZU1ldGEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHJlc291cmNlVHlwZU1ldGEuYXR0cmlidXRlTmFtZSA9PT0gbnVsbCAmJiByZXNvdXJjZVR5cGVNZXRhLmVsZW1lbnROYW1lID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VUeXBlTWV0YS5lbGVtZW50TmFtZSA9IF9oeXBoZW5hdGUoaW1wbC5uYW1lKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcmVzb3VyY2VUeXBlTWV0YSA9IFZpZXdSZXNvdXJjZXMuY29udmVudGlvbihpbXBsKVxyXG4gICAgICAgICAgICAgICAgfHwgSHRtbEJlaGF2aW9yUmVzb3VyY2UuY29udmVudGlvbihpbXBsLm5hbWUpXHJcbiAgICAgICAgICAgICAgICB8fCBWYWx1ZUNvbnZlcnRlclJlc291cmNlLmNvbnZlbnRpb24oaW1wbC5uYW1lKVxyXG4gICAgICAgICAgICAgICAgfHwgQmluZGluZ0JlaGF2aW9yUmVzb3VyY2UuY29udmVudGlvbihpbXBsLm5hbWUpXHJcbiAgICAgICAgICAgICAgICB8fCBWaWV3RW5naW5lSG9va3NSZXNvdXJjZS5jb252ZW50aW9uKGltcGwubmFtZSk7XHJcbiAgICAgICAgICAgIGlmICghcmVzb3VyY2VUeXBlTWV0YSkge1xyXG4gICAgICAgICAgICAgICAgcmVzb3VyY2VUeXBlTWV0YSA9IG5ldyBIdG1sQmVoYXZpb3JSZXNvdXJjZSgpO1xyXG4gICAgICAgICAgICAgICAgcmVzb3VyY2VUeXBlTWV0YS5lbGVtZW50TmFtZSA9IF9oeXBoZW5hdGUoaW1wbC5uYW1lKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBtZXRhZGF0YS5kZWZpbmUobWV0YWRhdGEucmVzb3VyY2UsIHJlc291cmNlVHlwZU1ldGEsIGltcGwpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXNvdXJjZVR5cGVNZXRhLmluaXRpYWxpemUoY29udGFpbmVyLCBpbXBsKTtcclxuICAgICAgICByZXNvdXJjZVR5cGVNZXRhLnJlZ2lzdGVyKHRoaXMsIHVuZGVmaW5lZCk7XHJcbiAgICAgICAgcmV0dXJuIHJlc291cmNlVHlwZU1ldGE7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIFZpZXdSZXNvdXJjZXM7XHJcbn0oKSk7XG5cbnZhciB2aWV3U3RyYXRlZ3kgPSBwcm90b2NvbC5jcmVhdGUoJ2F1cmVsaWE6dmlldy1zdHJhdGVneScsIHtcclxuICAgIHZhbGlkYXRlOiBmdW5jdGlvbiAodGFyZ2V0KSB7XHJcbiAgICAgICAgaWYgKCEodHlwZW9mIHRhcmdldC5sb2FkVmlld0ZhY3RvcnkgPT09ICdmdW5jdGlvbicpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAnVmlldyBzdHJhdGVnaWVzIG11c3QgaW1wbGVtZW50OiBsb2FkVmlld0ZhY3Rvcnkodmlld0VuZ2luZTogVmlld0VuZ2luZSwgY29tcGlsZUluc3RydWN0aW9uOiBWaWV3Q29tcGlsZUluc3RydWN0aW9uLCBsb2FkQ29udGV4dD86IFJlc291cmNlTG9hZENvbnRleHQpOiBQcm9taXNlPFZpZXdGYWN0b3J5Pic7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfSxcclxuICAgIGNvbXBvc2U6IGZ1bmN0aW9uICh0YXJnZXQpIHtcclxuICAgICAgICBpZiAoISh0eXBlb2YgdGFyZ2V0Lm1ha2VSZWxhdGl2ZVRvID09PSAnZnVuY3Rpb24nKSkge1xyXG4gICAgICAgICAgICB0YXJnZXQubWFrZVJlbGF0aXZlVG8gPSBQTEFURk9STS5ub29wO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSk7XHJcbnZhciBSZWxhdGl2ZVZpZXdTdHJhdGVneSA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBSZWxhdGl2ZVZpZXdTdHJhdGVneShwYXRoKSB7XHJcbiAgICAgICAgdGhpcy5wYXRoID0gcGF0aDtcclxuICAgICAgICB0aGlzLmFic29sdXRlUGF0aCA9IG51bGw7XHJcbiAgICB9XHJcbiAgICBSZWxhdGl2ZVZpZXdTdHJhdGVneS5wcm90b3R5cGUubG9hZFZpZXdGYWN0b3J5ID0gZnVuY3Rpb24gKHZpZXdFbmdpbmUsIGNvbXBpbGVJbnN0cnVjdGlvbiwgbG9hZENvbnRleHQsIHRhcmdldCkge1xyXG4gICAgICAgIGlmICh0aGlzLmFic29sdXRlUGF0aCA9PT0gbnVsbCAmJiB0aGlzLm1vZHVsZUlkKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYWJzb2x1dGVQYXRoID0gcmVsYXRpdmVUb0ZpbGUodGhpcy5wYXRoLCB0aGlzLm1vZHVsZUlkKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29tcGlsZUluc3RydWN0aW9uLmFzc29jaWF0ZWRNb2R1bGVJZCA9IHRoaXMubW9kdWxlSWQ7XHJcbiAgICAgICAgcmV0dXJuIHZpZXdFbmdpbmUubG9hZFZpZXdGYWN0b3J5KHRoaXMuYWJzb2x1dGVQYXRoIHx8IHRoaXMucGF0aCwgY29tcGlsZUluc3RydWN0aW9uLCBsb2FkQ29udGV4dCwgdGFyZ2V0KTtcclxuICAgIH07XHJcbiAgICBSZWxhdGl2ZVZpZXdTdHJhdGVneS5wcm90b3R5cGUubWFrZVJlbGF0aXZlVG8gPSBmdW5jdGlvbiAoZmlsZSkge1xyXG4gICAgICAgIGlmICh0aGlzLmFic29sdXRlUGF0aCA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aGlzLmFic29sdXRlUGF0aCA9IHJlbGF0aXZlVG9GaWxlKHRoaXMucGF0aCwgZmlsZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFJlbGF0aXZlVmlld1N0cmF0ZWd5ID0gX19kZWNvcmF0ZShbXHJcbiAgICAgICAgdmlld1N0cmF0ZWd5KClcclxuICAgIF0sIFJlbGF0aXZlVmlld1N0cmF0ZWd5KTtcclxuICAgIHJldHVybiBSZWxhdGl2ZVZpZXdTdHJhdGVneTtcclxufSgpKTtcclxudmFyIENvbnZlbnRpb25hbFZpZXdTdHJhdGVneSA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBDb252ZW50aW9uYWxWaWV3U3RyYXRlZ3kodmlld0xvY2F0b3IsIG9yaWdpbikge1xyXG4gICAgICAgIHRoaXMubW9kdWxlSWQgPSBvcmlnaW4ubW9kdWxlSWQ7XHJcbiAgICAgICAgdGhpcy52aWV3VXJsID0gdmlld0xvY2F0b3IuY29udmVydE9yaWdpblRvVmlld1VybChvcmlnaW4pO1xyXG4gICAgfVxyXG4gICAgQ29udmVudGlvbmFsVmlld1N0cmF0ZWd5LnByb3RvdHlwZS5sb2FkVmlld0ZhY3RvcnkgPSBmdW5jdGlvbiAodmlld0VuZ2luZSwgY29tcGlsZUluc3RydWN0aW9uLCBsb2FkQ29udGV4dCwgdGFyZ2V0KSB7XHJcbiAgICAgICAgY29tcGlsZUluc3RydWN0aW9uLmFzc29jaWF0ZWRNb2R1bGVJZCA9IHRoaXMubW9kdWxlSWQ7XHJcbiAgICAgICAgcmV0dXJuIHZpZXdFbmdpbmUubG9hZFZpZXdGYWN0b3J5KHRoaXMudmlld1VybCwgY29tcGlsZUluc3RydWN0aW9uLCBsb2FkQ29udGV4dCwgdGFyZ2V0KTtcclxuICAgIH07XHJcbiAgICBDb252ZW50aW9uYWxWaWV3U3RyYXRlZ3kgPSBfX2RlY29yYXRlKFtcclxuICAgICAgICB2aWV3U3RyYXRlZ3koKVxyXG4gICAgXSwgQ29udmVudGlvbmFsVmlld1N0cmF0ZWd5KTtcclxuICAgIHJldHVybiBDb252ZW50aW9uYWxWaWV3U3RyYXRlZ3k7XHJcbn0oKSk7XHJcbnZhciBOb1ZpZXdTdHJhdGVneSA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBOb1ZpZXdTdHJhdGVneShkZXBlbmRlbmNpZXMsIGRlcGVuZGVuY3lCYXNlVXJsKSB7XHJcbiAgICAgICAgdGhpcy5kZXBlbmRlbmNpZXMgPSBkZXBlbmRlbmNpZXMgfHwgbnVsbDtcclxuICAgICAgICB0aGlzLmRlcGVuZGVuY3lCYXNlVXJsID0gZGVwZW5kZW5jeUJhc2VVcmwgfHwgJyc7XHJcbiAgICB9XHJcbiAgICBOb1ZpZXdTdHJhdGVneS5wcm90b3R5cGUubG9hZFZpZXdGYWN0b3J5ID0gZnVuY3Rpb24gKHZpZXdFbmdpbmUsIGNvbXBpbGVJbnN0cnVjdGlvbiwgbG9hZENvbnRleHQsIHRhcmdldCkge1xyXG4gICAgICAgIHZhciBlbnRyeSA9IHRoaXMuZW50cnk7XHJcbiAgICAgICAgdmFyIGRlcGVuZGVuY2llcyA9IHRoaXMuZGVwZW5kZW5jaWVzO1xyXG4gICAgICAgIGlmIChlbnRyeSAmJiBlbnRyeS5mYWN0b3J5SXNSZWFkeSkge1xyXG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKG51bGwpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmVudHJ5ID0gZW50cnkgPSBuZXcgVGVtcGxhdGVSZWdpc3RyeUVudHJ5KHRoaXMubW9kdWxlSWQgfHwgdGhpcy5kZXBlbmRlbmN5QmFzZVVybCk7XHJcbiAgICAgICAgZW50cnkuZGVwZW5kZW5jaWVzID0gW107XHJcbiAgICAgICAgZW50cnkudGVtcGxhdGVJc0xvYWRlZCA9IHRydWU7XHJcbiAgICAgICAgaWYgKGRlcGVuZGVuY2llcyAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBkZXBlbmRlbmNpZXMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGN1cnJlbnQgPSBkZXBlbmRlbmNpZXNbaV07XHJcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGN1cnJlbnQgPT09ICdzdHJpbmcnIHx8IHR5cGVvZiBjdXJyZW50ID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZW50cnkuYWRkRGVwZW5kZW5jeShjdXJyZW50KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGVudHJ5LmFkZERlcGVuZGVuY3koY3VycmVudC5mcm9tLCBjdXJyZW50LmFzKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBjb21waWxlSW5zdHJ1Y3Rpb24uYXNzb2NpYXRlZE1vZHVsZUlkID0gdGhpcy5tb2R1bGVJZDtcclxuICAgICAgICByZXR1cm4gdmlld0VuZ2luZS5sb2FkVmlld0ZhY3RvcnkoZW50cnksIGNvbXBpbGVJbnN0cnVjdGlvbiwgbG9hZENvbnRleHQsIHRhcmdldCk7XHJcbiAgICB9O1xyXG4gICAgTm9WaWV3U3RyYXRlZ3kgPSBfX2RlY29yYXRlKFtcclxuICAgICAgICB2aWV3U3RyYXRlZ3koKVxyXG4gICAgXSwgTm9WaWV3U3RyYXRlZ3kpO1xyXG4gICAgcmV0dXJuIE5vVmlld1N0cmF0ZWd5O1xyXG59KCkpO1xyXG52YXIgVGVtcGxhdGVSZWdpc3RyeVZpZXdTdHJhdGVneSA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBUZW1wbGF0ZVJlZ2lzdHJ5Vmlld1N0cmF0ZWd5KG1vZHVsZUlkLCBlbnRyeSkge1xyXG4gICAgICAgIHRoaXMubW9kdWxlSWQgPSBtb2R1bGVJZDtcclxuICAgICAgICB0aGlzLmVudHJ5ID0gZW50cnk7XHJcbiAgICB9XHJcbiAgICBUZW1wbGF0ZVJlZ2lzdHJ5Vmlld1N0cmF0ZWd5LnByb3RvdHlwZS5sb2FkVmlld0ZhY3RvcnkgPSBmdW5jdGlvbiAodmlld0VuZ2luZSwgY29tcGlsZUluc3RydWN0aW9uLCBsb2FkQ29udGV4dCwgdGFyZ2V0KSB7XHJcbiAgICAgICAgdmFyIGVudHJ5ID0gdGhpcy5lbnRyeTtcclxuICAgICAgICBpZiAoZW50cnkuZmFjdG9yeUlzUmVhZHkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShlbnRyeS5mYWN0b3J5KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29tcGlsZUluc3RydWN0aW9uLmFzc29jaWF0ZWRNb2R1bGVJZCA9IHRoaXMubW9kdWxlSWQ7XHJcbiAgICAgICAgcmV0dXJuIHZpZXdFbmdpbmUubG9hZFZpZXdGYWN0b3J5KGVudHJ5LCBjb21waWxlSW5zdHJ1Y3Rpb24sIGxvYWRDb250ZXh0LCB0YXJnZXQpO1xyXG4gICAgfTtcclxuICAgIFRlbXBsYXRlUmVnaXN0cnlWaWV3U3RyYXRlZ3kgPSBfX2RlY29yYXRlKFtcclxuICAgICAgICB2aWV3U3RyYXRlZ3koKVxyXG4gICAgXSwgVGVtcGxhdGVSZWdpc3RyeVZpZXdTdHJhdGVneSk7XHJcbiAgICByZXR1cm4gVGVtcGxhdGVSZWdpc3RyeVZpZXdTdHJhdGVneTtcclxufSgpKTtcclxudmFyIElubGluZVZpZXdTdHJhdGVneSA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBJbmxpbmVWaWV3U3RyYXRlZ3kobWFya3VwLCBkZXBlbmRlbmNpZXMsIGRlcGVuZGVuY3lCYXNlVXJsKSB7XHJcbiAgICAgICAgdGhpcy5tYXJrdXAgPSBtYXJrdXA7XHJcbiAgICAgICAgdGhpcy5kZXBlbmRlbmNpZXMgPSBkZXBlbmRlbmNpZXMgfHwgbnVsbDtcclxuICAgICAgICB0aGlzLmRlcGVuZGVuY3lCYXNlVXJsID0gZGVwZW5kZW5jeUJhc2VVcmwgfHwgJyc7XHJcbiAgICB9XHJcbiAgICBJbmxpbmVWaWV3U3RyYXRlZ3kucHJvdG90eXBlLmxvYWRWaWV3RmFjdG9yeSA9IGZ1bmN0aW9uICh2aWV3RW5naW5lLCBjb21waWxlSW5zdHJ1Y3Rpb24sIGxvYWRDb250ZXh0LCB0YXJnZXQpIHtcclxuICAgICAgICB2YXIgZW50cnkgPSB0aGlzLmVudHJ5O1xyXG4gICAgICAgIHZhciBkZXBlbmRlbmNpZXMgPSB0aGlzLmRlcGVuZGVuY2llcztcclxuICAgICAgICBpZiAoZW50cnkgJiYgZW50cnkuZmFjdG9yeUlzUmVhZHkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShlbnRyeS5mYWN0b3J5KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5lbnRyeSA9IGVudHJ5ID0gbmV3IFRlbXBsYXRlUmVnaXN0cnlFbnRyeSh0aGlzLm1vZHVsZUlkIHx8IHRoaXMuZGVwZW5kZW5jeUJhc2VVcmwpO1xyXG4gICAgICAgIGVudHJ5LnRlbXBsYXRlID0gRE9NLmNyZWF0ZVRlbXBsYXRlRnJvbU1hcmt1cCh0aGlzLm1hcmt1cCk7XHJcbiAgICAgICAgaWYgKGRlcGVuZGVuY2llcyAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBkZXBlbmRlbmNpZXMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGN1cnJlbnQgPSBkZXBlbmRlbmNpZXNbaV07XHJcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGN1cnJlbnQgPT09ICdzdHJpbmcnIHx8IHR5cGVvZiBjdXJyZW50ID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZW50cnkuYWRkRGVwZW5kZW5jeShjdXJyZW50KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGVudHJ5LmFkZERlcGVuZGVuY3koY3VycmVudC5mcm9tLCBjdXJyZW50LmFzKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBjb21waWxlSW5zdHJ1Y3Rpb24uYXNzb2NpYXRlZE1vZHVsZUlkID0gdGhpcy5tb2R1bGVJZDtcclxuICAgICAgICByZXR1cm4gdmlld0VuZ2luZS5sb2FkVmlld0ZhY3RvcnkoZW50cnksIGNvbXBpbGVJbnN0cnVjdGlvbiwgbG9hZENvbnRleHQsIHRhcmdldCk7XHJcbiAgICB9O1xyXG4gICAgSW5saW5lVmlld1N0cmF0ZWd5ID0gX19kZWNvcmF0ZShbXHJcbiAgICAgICAgdmlld1N0cmF0ZWd5KClcclxuICAgIF0sIElubGluZVZpZXdTdHJhdGVneSk7XHJcbiAgICByZXR1cm4gSW5saW5lVmlld1N0cmF0ZWd5O1xyXG59KCkpO1xyXG52YXIgU3RhdGljVmlld1N0cmF0ZWd5ID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIFN0YXRpY1ZpZXdTdHJhdGVneShjb25maWcpIHtcclxuICAgICAgICBpZiAodHlwZW9mIGNvbmZpZyA9PT0gJ3N0cmluZycgfHwgKGNvbmZpZyBpbnN0YW5jZW9mIERPTS5FbGVtZW50ICYmIGNvbmZpZy50YWdOYW1lID09PSAnVEVNUExBVEUnKSkge1xyXG4gICAgICAgICAgICBjb25maWcgPSB7XHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogY29uZmlnXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSBjb25maWcudGVtcGxhdGU7XHJcbiAgICAgICAgdGhpcy5kZXBlbmRlbmNpZXMgPSBjb25maWcuZGVwZW5kZW5jaWVzIHx8IFtdO1xyXG4gICAgICAgIHRoaXMuZmFjdG9yeUlzUmVhZHkgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLm9uUmVhZHkgPSBudWxsO1xyXG4gICAgICAgIHRoaXMubW9kdWxlSWQgPSAndW5kZWZpbmVkJztcclxuICAgIH1cclxuICAgIFN0YXRpY1ZpZXdTdHJhdGVneS5wcm90b3R5cGUubG9hZFZpZXdGYWN0b3J5ID0gZnVuY3Rpb24gKHZpZXdFbmdpbmUsIGNvbXBpbGVJbnN0cnVjdGlvbiwgbG9hZENvbnRleHQsIHRhcmdldCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgaWYgKHRoaXMuZmFjdG9yeUlzUmVhZHkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh0aGlzLmZhY3RvcnkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgJGRlcHMgPSB0aGlzLmRlcGVuZGVuY2llcztcclxuICAgICAgICB2YXIgZGVwcyA9IHR5cGVvZiAkZGVwcyA9PT0gJ2Z1bmN0aW9uJyA/ICRkZXBzKCkgOiAkZGVwcztcclxuICAgICAgICBkZXBzID0gZGVwcyA/IGRlcHMgOiBbXTtcclxuICAgICAgICBkZXBzID0gQXJyYXkuaXNBcnJheShkZXBzKSA/IGRlcHMgOiBbZGVwc107XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UuYWxsKGRlcHMpLnRoZW4oZnVuY3Rpb24gKGRlcGVuZGVuY2llcykge1xyXG4gICAgICAgICAgICB2YXIgY29udGFpbmVyID0gdmlld0VuZ2luZS5jb250YWluZXI7XHJcbiAgICAgICAgICAgIHZhciBhcHBSZXNvdXJjZXMgPSB2aWV3RW5naW5lLmFwcFJlc291cmNlcztcclxuICAgICAgICAgICAgdmFyIHZpZXdDb21waWxlciA9IHZpZXdFbmdpbmUudmlld0NvbXBpbGVyO1xyXG4gICAgICAgICAgICB2YXIgdmlld1Jlc291cmNlcyA9IG5ldyBWaWV3UmVzb3VyY2VzKGFwcFJlc291cmNlcyk7XHJcbiAgICAgICAgICAgIHZhciByZXNvdXJjZTtcclxuICAgICAgICAgICAgdmFyIGVsRGVwcyA9IFtdO1xyXG4gICAgICAgICAgICBpZiAodGFyZ2V0KSB7XHJcbiAgICAgICAgICAgICAgICB2aWV3UmVzb3VyY2VzLmF1dG9SZWdpc3Rlcihjb250YWluZXIsIHRhcmdldCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBkZXBlbmRlbmNpZXNfMSA9IGRlcGVuZGVuY2llczsgX2kgPCBkZXBlbmRlbmNpZXNfMS5sZW5ndGg7IF9pKyspIHtcclxuICAgICAgICAgICAgICAgIHZhciBkZXAgPSBkZXBlbmRlbmNpZXNfMVtfaV07XHJcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGRlcCA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc291cmNlID0gdmlld1Jlc291cmNlcy5hdXRvUmVnaXN0ZXIoY29udGFpbmVyLCBkZXApO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNvdXJjZS5lbGVtZW50TmFtZSAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbERlcHMucHVzaChyZXNvdXJjZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoZGVwICYmIHR5cGVvZiBkZXAgPT09ICdvYmplY3QnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIga2V5IGluIGRlcCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXhwb3J0ZWQgPSBkZXBba2V5XTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBleHBvcnRlZCA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2UgPSB2aWV3UmVzb3VyY2VzLmF1dG9SZWdpc3Rlcihjb250YWluZXIsIGV4cG9ydGVkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNvdXJjZS5lbGVtZW50TmFtZSAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsRGVwcy5wdXNoKHJlc291cmNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcImRlcGVuZGVuY3kgbmVpdGhlciBmdW5jdGlvbiBub3Igb2JqZWN0LiBSZWNlaXZlZDogXFxcIlwiLmNvbmNhdCh0eXBlb2YgZGVwLCBcIlxcXCJcIikpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLmFsbChlbERlcHMubWFwKGZ1bmN0aW9uIChlbCkgeyByZXR1cm4gZWwubG9hZChjb250YWluZXIsIGVsLnRhcmdldCk7IH0pKS50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHZhciBmYWN0b3J5ID0gX3RoaXMudGVtcGxhdGUgIT09IG51bGxcclxuICAgICAgICAgICAgICAgICAgICA/IHZpZXdDb21waWxlci5jb21waWxlKF90aGlzLnRlbXBsYXRlLCB2aWV3UmVzb3VyY2VzLCBjb21waWxlSW5zdHJ1Y3Rpb24pXHJcbiAgICAgICAgICAgICAgICAgICAgOiBudWxsO1xyXG4gICAgICAgICAgICAgICAgX3RoaXMuZmFjdG9yeUlzUmVhZHkgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgX3RoaXMuZmFjdG9yeSA9IGZhY3Rvcnk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFjdG9yeTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgU3RhdGljVmlld1N0cmF0ZWd5ID0gX19kZWNvcmF0ZShbXHJcbiAgICAgICAgdmlld1N0cmF0ZWd5KClcclxuICAgIF0sIFN0YXRpY1ZpZXdTdHJhdGVneSk7XHJcbiAgICByZXR1cm4gU3RhdGljVmlld1N0cmF0ZWd5O1xyXG59KCkpO1xuXG5mdW5jdGlvbiByZW1vdmUodmlld1Nsb3QsIHByZXZpb3VzKSB7XHJcbiAgICByZXR1cm4gQXJyYXkuaXNBcnJheShwcmV2aW91cylcclxuICAgICAgICA/IHZpZXdTbG90LnJlbW92ZU1hbnkocHJldmlvdXMsIHRydWUpXHJcbiAgICAgICAgOiB2aWV3U2xvdC5yZW1vdmUocHJldmlvdXMsIHRydWUpO1xyXG59XHJcbnZhciBTd2FwU3RyYXRlZ2llcyA9IHtcclxuICAgIGJlZm9yZTogZnVuY3Rpb24gKHZpZXdTbG90LCBwcmV2aW91cywgY2FsbGJhY2spIHtcclxuICAgICAgICByZXR1cm4gKHByZXZpb3VzID09PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgID8gY2FsbGJhY2soKVxyXG4gICAgICAgICAgICA6IGNhbGxiYWNrKCkudGhlbihmdW5jdGlvbiAoKSB7IHJldHVybiByZW1vdmUodmlld1Nsb3QsIHByZXZpb3VzKTsgfSk7XHJcbiAgICB9LFxyXG4gICAgd2l0aDogZnVuY3Rpb24gKHZpZXdTbG90LCBwcmV2aW91cywgY2FsbGJhY2spIHtcclxuICAgICAgICByZXR1cm4gKHByZXZpb3VzID09PSB1bmRlZmluZWQpXHJcbiAgICAgICAgICAgID8gY2FsbGJhY2soKVxyXG4gICAgICAgICAgICA6IFByb21pc2UuYWxsKFtyZW1vdmUodmlld1Nsb3QsIHByZXZpb3VzKSwgY2FsbGJhY2soKV0pO1xyXG4gICAgfSxcclxuICAgIGFmdGVyOiBmdW5jdGlvbiAodmlld1Nsb3QsIHByZXZpb3VzLCBjYWxsYmFjaykge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUodmlld1Nsb3QucmVtb3ZlQWxsKHRydWUpKS50aGVuKGNhbGxiYWNrKTtcclxuICAgIH1cclxufTtcblxuZnVuY3Rpb24gdHJ5QWN0aXZhdGVWaWV3TW9kZWwoY29udGV4dCkge1xyXG4gICAgaWYgKGNvbnRleHQuc2tpcEFjdGl2YXRpb24gfHwgdHlwZW9mIGNvbnRleHQudmlld01vZGVsLmFjdGl2YXRlICE9PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGNvbnRleHQudmlld01vZGVsLmFjdGl2YXRlKGNvbnRleHQubW9kZWwpIHx8IFByb21pc2UucmVzb2x2ZSgpO1xyXG59XHJcbnZhciBDb21wb3NpdGlvbkVuZ2luZSA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBDb21wb3NpdGlvbkVuZ2luZSh2aWV3RW5naW5lLCB2aWV3TG9jYXRvcikge1xyXG4gICAgICAgIHRoaXMudmlld0VuZ2luZSA9IHZpZXdFbmdpbmU7XHJcbiAgICAgICAgdGhpcy52aWV3TG9jYXRvciA9IHZpZXdMb2NhdG9yO1xyXG4gICAgfVxyXG4gICAgQ29tcG9zaXRpb25FbmdpbmUucHJvdG90eXBlLl9zd2FwID0gZnVuY3Rpb24gKGNvbnRleHQsIHZpZXcpIHtcclxuICAgICAgICB2YXIgc3dhcFN0cmF0ZWd5ID0gU3dhcFN0cmF0ZWdpZXNbY29udGV4dC5zd2FwT3JkZXJdIHx8IFN3YXBTdHJhdGVnaWVzLmFmdGVyO1xyXG4gICAgICAgIHZhciBwcmV2aW91c1ZpZXdzID0gY29udGV4dC52aWV3U2xvdC5jaGlsZHJlbi5zbGljZSgpO1xyXG4gICAgICAgIHJldHVybiBzd2FwU3RyYXRlZ3koY29udGV4dC52aWV3U2xvdCwgcHJldmlvdXNWaWV3cywgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGNvbnRleHQudmlld1Nsb3QuYWRkKHZpZXcpKS50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIGlmIChjb250ZXh0LmN1cnJlbnRDb250cm9sbGVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29udGV4dC5jdXJyZW50Q29udHJvbGxlci51bmJpbmQoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmIChjb250ZXh0LmNvbXBvc2l0aW9uVHJhbnNhY3Rpb25Ob3RpZmllcikge1xyXG4gICAgICAgICAgICAgICAgY29udGV4dC5jb21wb3NpdGlvblRyYW5zYWN0aW9uTm90aWZpZXIuZG9uZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgQ29tcG9zaXRpb25FbmdpbmUucHJvdG90eXBlLl9jcmVhdGVDb250cm9sbGVyQW5kU3dhcCA9IGZ1bmN0aW9uIChjb250ZXh0KSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGVDb250cm9sbGVyKGNvbnRleHQpLnRoZW4oZnVuY3Rpb24gKGNvbnRyb2xsZXIpIHtcclxuICAgICAgICAgICAgaWYgKGNvbnRleHQuY29tcG9zaXRpb25UcmFuc2FjdGlvbk93bmVyc2hpcFRva2VuKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY29udGV4dC5jb21wb3NpdGlvblRyYW5zYWN0aW9uT3duZXJzaGlwVG9rZW5cclxuICAgICAgICAgICAgICAgICAgICAud2FpdEZvckNvbXBvc2l0aW9uQ29tcGxldGUoKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyLmF1dG9tYXRlKGNvbnRleHQub3ZlcnJpZGVDb250ZXh0LCBjb250ZXh0Lm93bmluZ1ZpZXcpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5fc3dhcChjb250ZXh0LCBjb250cm9sbGVyLnZpZXcpO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7IHJldHVybiBjb250cm9sbGVyOyB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb250cm9sbGVyLmF1dG9tYXRlKGNvbnRleHQub3ZlcnJpZGVDb250ZXh0LCBjb250ZXh0Lm93bmluZ1ZpZXcpO1xyXG4gICAgICAgICAgICByZXR1cm4gX3RoaXMuX3N3YXAoY29udGV4dCwgY29udHJvbGxlci52aWV3KS50aGVuKGZ1bmN0aW9uICgpIHsgcmV0dXJuIGNvbnRyb2xsZXI7IH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIENvbXBvc2l0aW9uRW5naW5lLnByb3RvdHlwZS5jcmVhdGVDb250cm9sbGVyID0gZnVuY3Rpb24gKGNvbnRleHQpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHZhciBjaGlsZENvbnRhaW5lcjtcclxuICAgICAgICB2YXIgdmlld01vZGVsO1xyXG4gICAgICAgIHZhciB2aWV3TW9kZWxSZXNvdXJjZTtcclxuICAgICAgICB2YXIgbTtcclxuICAgICAgICByZXR1cm4gdGhpc1xyXG4gICAgICAgICAgICAuZW5zdXJlVmlld01vZGVsKGNvbnRleHQpXHJcbiAgICAgICAgICAgIC50aGVuKHRyeUFjdGl2YXRlVmlld01vZGVsKVxyXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGNoaWxkQ29udGFpbmVyID0gY29udGV4dC5jaGlsZENvbnRhaW5lcjtcclxuICAgICAgICAgICAgdmlld01vZGVsID0gY29udGV4dC52aWV3TW9kZWw7XHJcbiAgICAgICAgICAgIHZpZXdNb2RlbFJlc291cmNlID0gY29udGV4dC52aWV3TW9kZWxSZXNvdXJjZTtcclxuICAgICAgICAgICAgbSA9IHZpZXdNb2RlbFJlc291cmNlLm1ldGFkYXRhO1xyXG4gICAgICAgICAgICB2YXIgdmlld1N0cmF0ZWd5ID0gX3RoaXMudmlld0xvY2F0b3IuZ2V0Vmlld1N0cmF0ZWd5KGNvbnRleHQudmlldyB8fCB2aWV3TW9kZWwpO1xyXG4gICAgICAgICAgICBpZiAoY29udGV4dC52aWV3UmVzb3VyY2VzKSB7XHJcbiAgICAgICAgICAgICAgICB2aWV3U3RyYXRlZ3kubWFrZVJlbGF0aXZlVG8oY29udGV4dC52aWV3UmVzb3VyY2VzLnZpZXdVcmwpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBtLmxvYWQoY2hpbGRDb250YWluZXIsIHZpZXdNb2RlbFJlc291cmNlLnZhbHVlLCBudWxsLCB2aWV3U3RyYXRlZ3ksIHRydWUpO1xyXG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHZpZXdGYWN0b3J5KSB7IHJldHVybiBtLmNyZWF0ZShjaGlsZENvbnRhaW5lciwgQmVoYXZpb3JJbnN0cnVjdGlvbi5keW5hbWljKGNvbnRleHQuaG9zdCwgdmlld01vZGVsLCB2aWV3RmFjdG9yeSkpOyB9KTtcclxuICAgIH07XHJcbiAgICBDb21wb3NpdGlvbkVuZ2luZS5wcm90b3R5cGUuZW5zdXJlVmlld01vZGVsID0gZnVuY3Rpb24gKGNvbnRleHQpIHtcclxuICAgICAgICB2YXIgY2hpbGRDb250YWluZXIgPSBjb250ZXh0LmNoaWxkQ29udGFpbmVyID0gKGNvbnRleHQuY2hpbGRDb250YWluZXIgfHwgY29udGV4dC5jb250YWluZXIuY3JlYXRlQ2hpbGQoKSk7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBjb250ZXh0LnZpZXdNb2RlbCA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgY29udGV4dC52aWV3TW9kZWwgPSBjb250ZXh0LnZpZXdSZXNvdXJjZXNcclxuICAgICAgICAgICAgICAgID8gY29udGV4dC52aWV3UmVzb3VyY2VzLnJlbGF0aXZlVG9WaWV3KGNvbnRleHQudmlld01vZGVsKVxyXG4gICAgICAgICAgICAgICAgOiBjb250ZXh0LnZpZXdNb2RlbDtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMudmlld0VuZ2luZS5pbXBvcnRWaWV3TW9kZWxSZXNvdXJjZShjb250ZXh0LnZpZXdNb2RlbCkudGhlbihmdW5jdGlvbiAodmlld01vZGVsUmVzb3VyY2UpIHtcclxuICAgICAgICAgICAgICAgIGNoaWxkQ29udGFpbmVyLmF1dG9SZWdpc3Rlcih2aWV3TW9kZWxSZXNvdXJjZS52YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoY29udGV4dC5ob3N0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2hpbGRDb250YWluZXIucmVnaXN0ZXJJbnN0YW5jZShET00uRWxlbWVudCwgY29udGV4dC5ob3N0KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGNvbnRleHQudmlld01vZGVsID0gY2hpbGRDb250YWluZXIudmlld01vZGVsID0gY2hpbGRDb250YWluZXIuZ2V0KHZpZXdNb2RlbFJlc291cmNlLnZhbHVlKTtcclxuICAgICAgICAgICAgICAgIGNvbnRleHQudmlld01vZGVsUmVzb3VyY2UgPSB2aWV3TW9kZWxSZXNvdXJjZTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBjb250ZXh0O1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIGN0b3IgPSBjb250ZXh0LnZpZXdNb2RlbC5jb25zdHJ1Y3RvcjtcclxuICAgICAgICB2YXIgaXNDbGFzcyA9IHR5cGVvZiBjb250ZXh0LnZpZXdNb2RlbCA9PT0gJ2Z1bmN0aW9uJztcclxuICAgICAgICBpZiAoaXNDbGFzcykge1xyXG4gICAgICAgICAgICBjdG9yID0gY29udGV4dC52aWV3TW9kZWw7XHJcbiAgICAgICAgICAgIGNoaWxkQ29udGFpbmVyLmF1dG9SZWdpc3RlcihjdG9yKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIG0gPSBtZXRhZGF0YS5nZXRPckNyZWF0ZU93bihtZXRhZGF0YS5yZXNvdXJjZSwgSHRtbEJlaGF2aW9yUmVzb3VyY2UsIGN0b3IpO1xyXG4gICAgICAgIG0uZWxlbWVudE5hbWUgPSBtLmVsZW1lbnROYW1lIHx8ICdkeW5hbWljLWVsZW1lbnQnO1xyXG4gICAgICAgIG0uaW5pdGlhbGl6ZShpc0NsYXNzID8gY2hpbGRDb250YWluZXIgOiAoY29udGV4dC5jb250YWluZXIgfHwgY2hpbGRDb250YWluZXIpLCBjdG9yKTtcclxuICAgICAgICBjb250ZXh0LnZpZXdNb2RlbFJlc291cmNlID0geyBtZXRhZGF0YTogbSwgdmFsdWU6IGN0b3IgfTtcclxuICAgICAgICBpZiAoY29udGV4dC5ob3N0KSB7XHJcbiAgICAgICAgICAgIGNoaWxkQ29udGFpbmVyLnJlZ2lzdGVySW5zdGFuY2UoRE9NLkVsZW1lbnQsIGNvbnRleHQuaG9zdCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNoaWxkQ29udGFpbmVyLnZpZXdNb2RlbCA9IGNvbnRleHQudmlld01vZGVsID0gaXNDbGFzcyA/IGNoaWxkQ29udGFpbmVyLmdldChjdG9yKSA6IGNvbnRleHQudmlld01vZGVsO1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoY29udGV4dCk7XHJcbiAgICB9O1xyXG4gICAgQ29tcG9zaXRpb25FbmdpbmUucHJvdG90eXBlLmNvbXBvc2UgPSBmdW5jdGlvbiAoY29udGV4dCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgY29udGV4dC5jaGlsZENvbnRhaW5lciA9IGNvbnRleHQuY2hpbGRDb250YWluZXIgfHwgY29udGV4dC5jb250YWluZXIuY3JlYXRlQ2hpbGQoKTtcclxuICAgICAgICBjb250ZXh0LnZpZXcgPSB0aGlzLnZpZXdMb2NhdG9yLmdldFZpZXdTdHJhdGVneShjb250ZXh0LnZpZXcpO1xyXG4gICAgICAgIHZhciB0cmFuc2FjdGlvbiA9IGNvbnRleHQuY2hpbGRDb250YWluZXIuZ2V0KENvbXBvc2l0aW9uVHJhbnNhY3Rpb24pO1xyXG4gICAgICAgIHZhciBjb21wb3NpdGlvblRyYW5zYWN0aW9uT3duZXJzaGlwVG9rZW4gPSB0cmFuc2FjdGlvbi50cnlDYXB0dXJlKCk7XHJcbiAgICAgICAgaWYgKGNvbXBvc2l0aW9uVHJhbnNhY3Rpb25Pd25lcnNoaXBUb2tlbikge1xyXG4gICAgICAgICAgICBjb250ZXh0LmNvbXBvc2l0aW9uVHJhbnNhY3Rpb25Pd25lcnNoaXBUb2tlbiA9IGNvbXBvc2l0aW9uVHJhbnNhY3Rpb25Pd25lcnNoaXBUb2tlbjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnRleHQuY29tcG9zaXRpb25UcmFuc2FjdGlvbk5vdGlmaWVyID0gdHJhbnNhY3Rpb24uZW5saXN0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChjb250ZXh0LnZpZXdNb2RlbCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fY3JlYXRlQ29udHJvbGxlckFuZFN3YXAoY29udGV4dCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKGNvbnRleHQudmlldykge1xyXG4gICAgICAgICAgICBpZiAoY29udGV4dC52aWV3UmVzb3VyY2VzKSB7XHJcbiAgICAgICAgICAgICAgICBjb250ZXh0LnZpZXcubWFrZVJlbGF0aXZlVG8oY29udGV4dC52aWV3UmVzb3VyY2VzLnZpZXdVcmwpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBjb250ZXh0LnZpZXcubG9hZFZpZXdGYWN0b3J5KHRoaXMudmlld0VuZ2luZSwgbmV3IFZpZXdDb21waWxlSW5zdHJ1Y3Rpb24oKSkudGhlbihmdW5jdGlvbiAodmlld0ZhY3RvcnkpIHtcclxuICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSB2aWV3RmFjdG9yeS5jcmVhdGUoY29udGV4dC5jaGlsZENvbnRhaW5lcik7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQuYmluZChjb250ZXh0LmJpbmRpbmdDb250ZXh0LCBjb250ZXh0Lm92ZXJyaWRlQ29udGV4dCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoY29udGV4dC5jb21wb3NpdGlvblRyYW5zYWN0aW9uT3duZXJzaGlwVG9rZW4pIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29udGV4dC5jb21wb3NpdGlvblRyYW5zYWN0aW9uT3duZXJzaGlwVG9rZW4ud2FpdEZvckNvbXBvc2l0aW9uQ29tcGxldGUoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5fc3dhcChjb250ZXh0LCByZXN1bHQpOyB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7IHJldHVybiByZXN1bHQ7IH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLl9zd2FwKGNvbnRleHQsIHJlc3VsdCkudGhlbihmdW5jdGlvbiAoKSB7IHJldHVybiByZXN1bHQ7IH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoY29udGV4dC52aWV3U2xvdCkge1xyXG4gICAgICAgICAgICBjb250ZXh0LnZpZXdTbG90LnJlbW92ZUFsbCgpO1xyXG4gICAgICAgICAgICBpZiAoY29udGV4dC5jb21wb3NpdGlvblRyYW5zYWN0aW9uTm90aWZpZXIpIHtcclxuICAgICAgICAgICAgICAgIGNvbnRleHQuY29tcG9zaXRpb25UcmFuc2FjdGlvbk5vdGlmaWVyLmRvbmUoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKG51bGwpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKG51bGwpO1xyXG4gICAgfTtcclxuICAgIENvbXBvc2l0aW9uRW5naW5lID0gX19kZWNvcmF0ZShbXHJcbiAgICAgICAgaW5qZWN0KFZpZXdFbmdpbmUsIFZpZXdMb2NhdG9yKVxyXG4gICAgXSwgQ29tcG9zaXRpb25FbmdpbmUpO1xyXG4gICAgcmV0dXJuIENvbXBvc2l0aW9uRW5naW5lO1xyXG59KCkpO1xuXG52YXIgYW5pbWF0aW9uRXZlbnQgPSB7XHJcbiAgICBlbnRlckJlZ2luOiAnYW5pbWF0aW9uOmVudGVyOmJlZ2luJyxcclxuICAgIGVudGVyQWN0aXZlOiAnYW5pbWF0aW9uOmVudGVyOmFjdGl2ZScsXHJcbiAgICBlbnRlckRvbmU6ICdhbmltYXRpb246ZW50ZXI6ZG9uZScsXHJcbiAgICBlbnRlclRpbWVvdXQ6ICdhbmltYXRpb246ZW50ZXI6dGltZW91dCcsXHJcbiAgICBsZWF2ZUJlZ2luOiAnYW5pbWF0aW9uOmxlYXZlOmJlZ2luJyxcclxuICAgIGxlYXZlQWN0aXZlOiAnYW5pbWF0aW9uOmxlYXZlOmFjdGl2ZScsXHJcbiAgICBsZWF2ZURvbmU6ICdhbmltYXRpb246bGVhdmU6ZG9uZScsXHJcbiAgICBsZWF2ZVRpbWVvdXQ6ICdhbmltYXRpb246bGVhdmU6dGltZW91dCcsXHJcbiAgICBzdGFnZ2VyTmV4dDogJ2FuaW1hdGlvbjpzdGFnZ2VyOm5leHQnLFxyXG4gICAgcmVtb3ZlQ2xhc3NCZWdpbjogJ2FuaW1hdGlvbjpyZW1vdmUtY2xhc3M6YmVnaW4nLFxyXG4gICAgcmVtb3ZlQ2xhc3NBY3RpdmU6ICdhbmltYXRpb246cmVtb3ZlLWNsYXNzOmFjdGl2ZScsXHJcbiAgICByZW1vdmVDbGFzc0RvbmU6ICdhbmltYXRpb246cmVtb3ZlLWNsYXNzOmRvbmUnLFxyXG4gICAgcmVtb3ZlQ2xhc3NUaW1lb3V0OiAnYW5pbWF0aW9uOnJlbW92ZS1jbGFzczp0aW1lb3V0JyxcclxuICAgIGFkZENsYXNzQmVnaW46ICdhbmltYXRpb246YWRkLWNsYXNzOmJlZ2luJyxcclxuICAgIGFkZENsYXNzQWN0aXZlOiAnYW5pbWF0aW9uOmFkZC1jbGFzczphY3RpdmUnLFxyXG4gICAgYWRkQ2xhc3NEb25lOiAnYW5pbWF0aW9uOmFkZC1jbGFzczpkb25lJyxcclxuICAgIGFkZENsYXNzVGltZW91dDogJ2FuaW1hdGlvbjphZGQtY2xhc3M6dGltZW91dCcsXHJcbiAgICBhbmltYXRlQmVnaW46ICdhbmltYXRpb246YW5pbWF0ZTpiZWdpbicsXHJcbiAgICBhbmltYXRlQWN0aXZlOiAnYW5pbWF0aW9uOmFuaW1hdGU6YWN0aXZlJyxcclxuICAgIGFuaW1hdGVEb25lOiAnYW5pbWF0aW9uOmFuaW1hdGU6ZG9uZScsXHJcbiAgICBhbmltYXRlVGltZW91dDogJ2FuaW1hdGlvbjphbmltYXRlOnRpbWVvdXQnLFxyXG4gICAgc2VxdWVuY2VCZWdpbjogJ2FuaW1hdGlvbjpzZXF1ZW5jZTpiZWdpbicsXHJcbiAgICBzZXF1ZW5jZURvbmU6ICdhbmltYXRpb246c2VxdWVuY2U6ZG9uZSdcclxufTtcblxuZnVuY3Rpb24gY3JlYXRlQ2hpbGRPYnNlcnZlckRlY29yYXRvcihzZWxlY3Rvck9yQ29uZmlnLCBhbGwpIHtcclxuICAgIHJldHVybiBmdW5jdGlvbiAodGFyZ2V0LCBrZXksIGRlc2NyaXB0b3IpIHtcclxuICAgICAgICB2YXIgYWN0dWFsVGFyZ2V0ID0gdHlwZW9mIGtleSA9PT0gJ3N0cmluZycgPyB0YXJnZXQuY29uc3RydWN0b3IgOiB0YXJnZXQ7XHJcbiAgICAgICAgdmFyIHIgPSBtZXRhZGF0YS5nZXRPckNyZWF0ZU93bihtZXRhZGF0YS5yZXNvdXJjZSwgSHRtbEJlaGF2aW9yUmVzb3VyY2UsIGFjdHVhbFRhcmdldCk7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBzZWxlY3Rvck9yQ29uZmlnID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICBzZWxlY3Rvck9yQ29uZmlnID0ge1xyXG4gICAgICAgICAgICAgICAgc2VsZWN0b3I6IHNlbGVjdG9yT3JDb25maWcsXHJcbiAgICAgICAgICAgICAgICBuYW1lOiBrZXlcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGRlc2NyaXB0b3IpIHtcclxuICAgICAgICAgICAgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7XHJcbiAgICAgICAgICAgIGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgc2VsZWN0b3JPckNvbmZpZy5hbGwgPSBhbGw7XHJcbiAgICAgICAgci5hZGRDaGlsZEJpbmRpbmcobmV3IENoaWxkT2JzZXJ2ZXIoc2VsZWN0b3JPckNvbmZpZykpO1xyXG4gICAgfTtcclxufVxyXG5mdW5jdGlvbiBjaGlsZHJlbihzZWxlY3Rvck9yQ29uZmlnKSB7XHJcbiAgICByZXR1cm4gY3JlYXRlQ2hpbGRPYnNlcnZlckRlY29yYXRvcihzZWxlY3Rvck9yQ29uZmlnLCB0cnVlKTtcclxufVxyXG5mdW5jdGlvbiBjaGlsZChzZWxlY3Rvck9yQ29uZmlnKSB7XHJcbiAgICByZXR1cm4gY3JlYXRlQ2hpbGRPYnNlcnZlckRlY29yYXRvcihzZWxlY3Rvck9yQ29uZmlnLCBmYWxzZSk7XHJcbn1cclxudmFyIENoaWxkT2JzZXJ2ZXIgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gQ2hpbGRPYnNlcnZlcihjb25maWcpIHtcclxuICAgICAgICB0aGlzLm5hbWUgPSBjb25maWcubmFtZTtcclxuICAgICAgICB0aGlzLmNoYW5nZUhhbmRsZXIgPSBjb25maWcuY2hhbmdlSGFuZGxlciB8fCB0aGlzLm5hbWUgKyAnQ2hhbmdlZCc7XHJcbiAgICAgICAgdGhpcy5zZWxlY3RvciA9IGNvbmZpZy5zZWxlY3RvcjtcclxuICAgICAgICB0aGlzLmFsbCA9IGNvbmZpZy5hbGw7XHJcbiAgICB9XHJcbiAgICBDaGlsZE9ic2VydmVyLnByb3RvdHlwZS5jcmVhdGUgPSBmdW5jdGlvbiAodmlld0hvc3QsIHZpZXdNb2RlbCwgY29udHJvbGxlcikge1xyXG4gICAgICAgIHJldHVybiBuZXcgQ2hpbGRPYnNlcnZlckJpbmRlcih0aGlzLnNlbGVjdG9yLCB2aWV3SG9zdCwgdGhpcy5uYW1lLCB2aWV3TW9kZWwsIGNvbnRyb2xsZXIsIHRoaXMuY2hhbmdlSGFuZGxlciwgdGhpcy5hbGwpO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBDaGlsZE9ic2VydmVyO1xyXG59KCkpO1xyXG52YXIgbm9NdXRhdGlvbnMgPSBbXTtcclxuZnVuY3Rpb24gdHJhY2tNdXRhdGlvbihncm91cGVkTXV0YXRpb25zLCBiaW5kZXIsIHJlY29yZCkge1xyXG4gICAgdmFyIG11dGF0aW9ucyA9IGdyb3VwZWRNdXRhdGlvbnMuZ2V0KGJpbmRlcik7XHJcbiAgICBpZiAoIW11dGF0aW9ucykge1xyXG4gICAgICAgIG11dGF0aW9ucyA9IFtdO1xyXG4gICAgICAgIGdyb3VwZWRNdXRhdGlvbnMuc2V0KGJpbmRlciwgbXV0YXRpb25zKTtcclxuICAgIH1cclxuICAgIG11dGF0aW9ucy5wdXNoKHJlY29yZCk7XHJcbn1cclxuZnVuY3Rpb24gb25DaGlsZENoYW5nZShtdXRhdGlvbnMsIG9ic2VydmVyKSB7XHJcbiAgICB2YXIgYmluZGVycyA9IG9ic2VydmVyLmJpbmRlcnM7XHJcbiAgICB2YXIgYmluZGVyc0xlbmd0aCA9IGJpbmRlcnMubGVuZ3RoO1xyXG4gICAgdmFyIGdyb3VwZWRNdXRhdGlvbnMgPSBuZXcgTWFwKCk7XHJcbiAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBtdXRhdGlvbnMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgIHZhciByZWNvcmQgPSBtdXRhdGlvbnNbaV07XHJcbiAgICAgICAgdmFyIGFkZGVkID0gcmVjb3JkLmFkZGVkTm9kZXM7XHJcbiAgICAgICAgdmFyIHJlbW92ZWQgPSByZWNvcmQucmVtb3ZlZE5vZGVzO1xyXG4gICAgICAgIGZvciAodmFyIGogPSAwLCBqaiA9IHJlbW92ZWQubGVuZ3RoOyBqIDwgamo7ICsraikge1xyXG4gICAgICAgICAgICB2YXIgbm9kZSA9IHJlbW92ZWRbal07XHJcbiAgICAgICAgICAgIGlmIChub2RlLm5vZGVUeXBlID09PSAxKSB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBrID0gMDsgayA8IGJpbmRlcnNMZW5ndGg7ICsraykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBiaW5kZXIgPSBiaW5kZXJzW2tdO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChiaW5kZXIub25SZW1vdmUobm9kZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHJhY2tNdXRhdGlvbihncm91cGVkTXV0YXRpb25zLCBiaW5kZXIsIHJlY29yZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZvciAodmFyIGogPSAwLCBqaiA9IGFkZGVkLmxlbmd0aDsgaiA8IGpqOyArK2opIHtcclxuICAgICAgICAgICAgdmFyIG5vZGUgPSBhZGRlZFtqXTtcclxuICAgICAgICAgICAgaWYgKG5vZGUubm9kZVR5cGUgPT09IDEpIHtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGsgPSAwOyBrIDwgYmluZGVyc0xlbmd0aDsgKytrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGJpbmRlciA9IGJpbmRlcnNba107XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGJpbmRlci5vbkFkZChub2RlKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0cmFja011dGF0aW9uKGdyb3VwZWRNdXRhdGlvbnMsIGJpbmRlciwgcmVjb3JkKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBncm91cGVkTXV0YXRpb25zLmZvckVhY2goZnVuY3Rpb24gKG11dGF0aW9uUmVjb3JkcywgYmluZGVyKSB7XHJcbiAgICAgICAgaWYgKGJpbmRlci5pc0JvdW5kICYmIGJpbmRlci5jaGFuZ2VIYW5kbGVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIGJpbmRlci52aWV3TW9kZWxbYmluZGVyLmNoYW5nZUhhbmRsZXJdKG11dGF0aW9uUmVjb3Jkcyk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbn1cclxudmFyIENoaWxkT2JzZXJ2ZXJCaW5kZXIgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gQ2hpbGRPYnNlcnZlckJpbmRlcihzZWxlY3Rvciwgdmlld0hvc3QsIHByb3BlcnR5LCB2aWV3TW9kZWwsIGNvbnRyb2xsZXIsIGNoYW5nZUhhbmRsZXIsIGFsbCkge1xyXG4gICAgICAgIHRoaXMuc2VsZWN0b3IgPSBzZWxlY3RvcjtcclxuICAgICAgICB0aGlzLnZpZXdIb3N0ID0gdmlld0hvc3Q7XHJcbiAgICAgICAgdGhpcy5wcm9wZXJ0eSA9IHByb3BlcnR5O1xyXG4gICAgICAgIHRoaXMudmlld01vZGVsID0gdmlld01vZGVsO1xyXG4gICAgICAgIHRoaXMuY29udHJvbGxlciA9IGNvbnRyb2xsZXI7XHJcbiAgICAgICAgdGhpcy5jaGFuZ2VIYW5kbGVyID0gY2hhbmdlSGFuZGxlciBpbiB2aWV3TW9kZWwgPyBjaGFuZ2VIYW5kbGVyIDogbnVsbDtcclxuICAgICAgICB0aGlzLnVzZXNTaGFkb3dET00gPSBjb250cm9sbGVyLmJlaGF2aW9yLnVzZXNTaGFkb3dET007XHJcbiAgICAgICAgdGhpcy5hbGwgPSBhbGw7XHJcbiAgICAgICAgaWYgKCF0aGlzLnVzZXNTaGFkb3dET00gJiYgY29udHJvbGxlci52aWV3ICYmIGNvbnRyb2xsZXIudmlldy5jb250ZW50Vmlldykge1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRlbnRWaWV3ID0gY29udHJvbGxlci52aWV3LmNvbnRlbnRWaWV3O1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5jb250ZW50VmlldyA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuc291cmNlID0gbnVsbDtcclxuICAgICAgICB0aGlzLmlzQm91bmQgPSBmYWxzZTtcclxuICAgIH1cclxuICAgIENoaWxkT2JzZXJ2ZXJCaW5kZXIucHJvdG90eXBlLm1hdGNoZXMgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xyXG4gICAgICAgIGlmIChlbGVtZW50Lm1hdGNoZXModGhpcy5zZWxlY3RvcikpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuY29udGVudFZpZXcgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBjb250ZW50VmlldyA9IHRoaXMuY29udGVudFZpZXc7XHJcbiAgICAgICAgICAgIHZhciBhc3NpZ25lZFNsb3QgPSBlbGVtZW50LmF1QXNzaWduZWRTbG90O1xyXG4gICAgICAgICAgICBpZiAoYXNzaWduZWRTbG90ICYmIGFzc2lnbmVkU2xvdC5wcm9qZWN0RnJvbUFuY2hvcnMpIHtcclxuICAgICAgICAgICAgICAgIHZhciBhbmNob3JzID0gYXNzaWduZWRTbG90LnByb2plY3RGcm9tQW5jaG9ycztcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IGFuY2hvcnMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChhbmNob3JzW2ldLmF1T3duZXJWaWV3ID09PSBjb250ZW50Vmlldykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQuYXVPd25lclZpZXcgPT09IGNvbnRlbnRWaWV3O1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9O1xyXG4gICAgQ2hpbGRPYnNlcnZlckJpbmRlci5wcm90b3R5cGUuYmluZCA9IGZ1bmN0aW9uIChzb3VyY2UpIHtcclxuICAgICAgICBpZiAodGhpcy5pc0JvdW5kKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnNvdXJjZSA9PT0gc291cmNlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaXNCb3VuZCA9IHRydWU7XHJcbiAgICAgICAgdmFyIHZpZXdIb3N0ID0gdGhpcy52aWV3SG9zdDtcclxuICAgICAgICB2YXIgdmlld01vZGVsID0gdGhpcy52aWV3TW9kZWw7XHJcbiAgICAgICAgdmFyIG9ic2VydmVyID0gdmlld0hvc3QuX19jaGlsZE9ic2VydmVyX187XHJcbiAgICAgICAgaWYgKCFvYnNlcnZlcikge1xyXG4gICAgICAgICAgICBvYnNlcnZlciA9IHZpZXdIb3N0Ll9fY2hpbGRPYnNlcnZlcl9fID0gRE9NLmNyZWF0ZU11dGF0aW9uT2JzZXJ2ZXIob25DaGlsZENoYW5nZSk7XHJcbiAgICAgICAgICAgIHZhciBvcHRpb25zID0ge1xyXG4gICAgICAgICAgICAgICAgY2hpbGRMaXN0OiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgc3VidHJlZTogIXRoaXMudXNlc1NoYWRvd0RPTVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBvYnNlcnZlci5vYnNlcnZlKHZpZXdIb3N0LCBvcHRpb25zKTtcclxuICAgICAgICAgICAgb2JzZXJ2ZXIuYmluZGVycyA9IFtdO1xyXG4gICAgICAgIH1cclxuICAgICAgICBvYnNlcnZlci5iaW5kZXJzLnB1c2godGhpcyk7XHJcbiAgICAgICAgaWYgKHRoaXMudXNlc1NoYWRvd0RPTSkge1xyXG4gICAgICAgICAgICB2YXIgY3VycmVudCA9IHZpZXdIb3N0LmZpcnN0RWxlbWVudENoaWxkO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5hbGwpIHtcclxuICAgICAgICAgICAgICAgIHZhciBpdGVtcyA9IHZpZXdNb2RlbFt0aGlzLnByb3BlcnR5XTtcclxuICAgICAgICAgICAgICAgIGlmICghaXRlbXMpIHtcclxuICAgICAgICAgICAgICAgICAgICBpdGVtcyA9IHZpZXdNb2RlbFt0aGlzLnByb3BlcnR5XSA9IFtdO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbXMuc3BsaWNlKDApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgd2hpbGUgKGN1cnJlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5tYXRjaGVzKGN1cnJlbnQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zLnB1c2goY3VycmVudC5hdSAmJiBjdXJyZW50LmF1LmNvbnRyb2xsZXIgPyBjdXJyZW50LmF1LmNvbnRyb2xsZXIudmlld01vZGVsIDogY3VycmVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnQgPSBjdXJyZW50Lm5leHRFbGVtZW50U2libGluZztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNoYW5nZUhhbmRsZXIgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnZpZXdNb2RlbFt0aGlzLmNoYW5nZUhhbmRsZXJdKG5vTXV0YXRpb25zKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHdoaWxlIChjdXJyZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMubWF0Y2hlcyhjdXJyZW50KSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBjdXJyZW50LmF1ICYmIGN1cnJlbnQuYXUuY29udHJvbGxlciA/IGN1cnJlbnQuYXUuY29udHJvbGxlci52aWV3TW9kZWwgOiBjdXJyZW50O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZpZXdNb2RlbFt0aGlzLnByb3BlcnR5XSA9IHZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5jaGFuZ2VIYW5kbGVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnZpZXdNb2RlbFt0aGlzLmNoYW5nZUhhbmRsZXJdKHZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudCA9IGN1cnJlbnQubmV4dEVsZW1lbnRTaWJsaW5nO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIENoaWxkT2JzZXJ2ZXJCaW5kZXIucHJvdG90eXBlLm9uUmVtb3ZlID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcclxuICAgICAgICBpZiAodGhpcy5tYXRjaGVzKGVsZW1lbnQpKSB7XHJcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGVsZW1lbnQuYXUgJiYgZWxlbWVudC5hdS5jb250cm9sbGVyID8gZWxlbWVudC5hdS5jb250cm9sbGVyLnZpZXdNb2RlbCA6IGVsZW1lbnQ7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmFsbCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGl0ZW1zID0gKHRoaXMudmlld01vZGVsW3RoaXMucHJvcGVydHldIHx8ICh0aGlzLnZpZXdNb2RlbFt0aGlzLnByb3BlcnR5XSA9IFtdKSk7XHJcbiAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSBpdGVtcy5pbmRleE9mKHZhbHVlKTtcclxuICAgICAgICAgICAgICAgIGlmIChpbmRleCAhPT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICBpdGVtcy5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIGN1cnJlbnRWYWx1ZSA9IHRoaXMudmlld01vZGVsW3RoaXMucHJvcGVydHldO1xyXG4gICAgICAgICAgICBpZiAoY3VycmVudFZhbHVlID09PSB2YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy52aWV3TW9kZWxbdGhpcy5wcm9wZXJ0eV0gPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNCb3VuZCAmJiB0aGlzLmNoYW5nZUhhbmRsZXIgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnZpZXdNb2RlbFt0aGlzLmNoYW5nZUhhbmRsZXJdKHZhbHVlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9O1xyXG4gICAgQ2hpbGRPYnNlcnZlckJpbmRlci5wcm90b3R5cGUub25BZGQgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xyXG4gICAgICAgIGlmICh0aGlzLm1hdGNoZXMoZWxlbWVudCkpIHtcclxuICAgICAgICAgICAgdmFyIHZhbHVlID0gZWxlbWVudC5hdSAmJiBlbGVtZW50LmF1LmNvbnRyb2xsZXIgPyBlbGVtZW50LmF1LmNvbnRyb2xsZXIudmlld01vZGVsIDogZWxlbWVudDtcclxuICAgICAgICAgICAgaWYgKHRoaXMuYWxsKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaXRlbXMgPSAodGhpcy52aWV3TW9kZWxbdGhpcy5wcm9wZXJ0eV0gfHwgKHRoaXMudmlld01vZGVsW3RoaXMucHJvcGVydHldID0gW10pKTtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNlbGVjdG9yID09PSAnKicpIHtcclxuICAgICAgICAgICAgICAgICAgICBpdGVtcy5wdXNoKHZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHZhciBpbmRleCA9IDA7XHJcbiAgICAgICAgICAgICAgICB2YXIgcHJldiA9IGVsZW1lbnQucHJldmlvdXNFbGVtZW50U2libGluZztcclxuICAgICAgICAgICAgICAgIHdoaWxlIChwcmV2KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMubWF0Y2hlcyhwcmV2KSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbmRleCsrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBwcmV2ID0gcHJldi5wcmV2aW91c0VsZW1lbnRTaWJsaW5nO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaXRlbXMuc3BsaWNlKGluZGV4LCAwLCB2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLnZpZXdNb2RlbFt0aGlzLnByb3BlcnR5XSA9IHZhbHVlO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5pc0JvdW5kICYmIHRoaXMuY2hhbmdlSGFuZGxlciAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy52aWV3TW9kZWxbdGhpcy5jaGFuZ2VIYW5kbGVyXSh2YWx1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfTtcclxuICAgIENoaWxkT2JzZXJ2ZXJCaW5kZXIucHJvdG90eXBlLnVuYmluZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAoIXRoaXMuaXNCb3VuZCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaXNCb3VuZCA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuc291cmNlID0gbnVsbDtcclxuICAgICAgICB2YXIgY2hpbGRPYnNlcnZlciA9IHRoaXMudmlld0hvc3QuX19jaGlsZE9ic2VydmVyX187XHJcbiAgICAgICAgaWYgKGNoaWxkT2JzZXJ2ZXIpIHtcclxuICAgICAgICAgICAgdmFyIGJpbmRlcnMgPSBjaGlsZE9ic2VydmVyLmJpbmRlcnM7XHJcbiAgICAgICAgICAgIGlmIChiaW5kZXJzICYmIGJpbmRlcnMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaWR4ID0gYmluZGVycy5pbmRleE9mKHRoaXMpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGlkeCAhPT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICBiaW5kZXJzLnNwbGljZShpZHgsIDEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKGJpbmRlcnMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2hpbGRPYnNlcnZlci5kaXNjb25uZWN0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy52aWV3SG9zdC5fX2NoaWxkT2JzZXJ2ZXJfXyA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHRoaXMudXNlc1NoYWRvd0RPTSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy52aWV3TW9kZWxbdGhpcy5wcm9wZXJ0eV0gPSBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIHJldHVybiBDaGlsZE9ic2VydmVyQmluZGVyO1xyXG59KCkpO1xuXG52YXIgRWxlbWVudENvbmZpZ1Jlc291cmNlID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIEVsZW1lbnRDb25maWdSZXNvdXJjZSgpIHtcclxuICAgIH1cclxuICAgIEVsZW1lbnRDb25maWdSZXNvdXJjZS5wcm90b3R5cGUuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uIChjb250YWluZXIsIHRhcmdldCkgeyB9O1xyXG4gICAgRWxlbWVudENvbmZpZ1Jlc291cmNlLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChyZWdpc3RyeSwgbmFtZSkgeyB9O1xyXG4gICAgRWxlbWVudENvbmZpZ1Jlc291cmNlLnByb3RvdHlwZS5sb2FkID0gZnVuY3Rpb24gKGNvbnRhaW5lciwgdGFyZ2V0KSB7XHJcbiAgICAgICAgdmFyIGNvbmZpZyA9IG5ldyB0YXJnZXQoKTtcclxuICAgICAgICB2YXIgZXZlbnRNYW5hZ2VyID0gY29udGFpbmVyLmdldChFdmVudE1hbmFnZXIpO1xyXG4gICAgICAgIGV2ZW50TWFuYWdlci5yZWdpc3RlckVsZW1lbnRDb25maWcoY29uZmlnKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gRWxlbWVudENvbmZpZ1Jlc291cmNlO1xyXG59KCkpO1xuXG5mdW5jdGlvbiByZXNvdXJjZShpbnN0YW5jZU9yQ29uZmlnKSB7XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKHRhcmdldCkge1xyXG4gICAgICAgIHZhciBpc0NvbmZpZyA9IHR5cGVvZiBpbnN0YW5jZU9yQ29uZmlnID09PSAnc3RyaW5nJyB8fCBPYmplY3QuZ2V0UHJvdG90eXBlT2YoaW5zdGFuY2VPckNvbmZpZykgPT09IE9iamVjdC5wcm90b3R5cGU7XHJcbiAgICAgICAgaWYgKGlzQ29uZmlnKSB7XHJcbiAgICAgICAgICAgIHRhcmdldC4kcmVzb3VyY2UgPSBpbnN0YW5jZU9yQ29uZmlnO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgbWV0YWRhdGEuZGVmaW5lKG1ldGFkYXRhLnJlc291cmNlLCBpbnN0YW5jZU9yQ29uZmlnLCB0YXJnZXQpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbn1cclxuZnVuY3Rpb24gYmVoYXZpb3Iob3ZlcnJpZGUpIHtcclxuICAgIHJldHVybiBmdW5jdGlvbiAodGFyZ2V0KSB7XHJcbiAgICAgICAgaWYgKG92ZXJyaWRlIGluc3RhbmNlb2YgSHRtbEJlaGF2aW9yUmVzb3VyY2UpIHtcclxuICAgICAgICAgICAgbWV0YWRhdGEuZGVmaW5lKG1ldGFkYXRhLnJlc291cmNlLCBvdmVycmlkZSwgdGFyZ2V0KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHZhciByID0gbWV0YWRhdGEuZ2V0T3JDcmVhdGVPd24obWV0YWRhdGEucmVzb3VyY2UsIEh0bWxCZWhhdmlvclJlc291cmNlLCB0YXJnZXQpO1xyXG4gICAgICAgICAgICBPYmplY3QuYXNzaWduKHIsIG92ZXJyaWRlKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG59XHJcbmZ1bmN0aW9uIGN1c3RvbUVsZW1lbnQobmFtZSkge1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uICh0YXJnZXQpIHtcclxuICAgICAgICB2YXIgciA9IG1ldGFkYXRhLmdldE9yQ3JlYXRlT3duKG1ldGFkYXRhLnJlc291cmNlLCBIdG1sQmVoYXZpb3JSZXNvdXJjZSwgdGFyZ2V0KTtcclxuICAgICAgICByLmVsZW1lbnROYW1lID0gdmFsaWRhdGVCZWhhdmlvck5hbWUobmFtZSwgJ2N1c3RvbSBlbGVtZW50Jyk7XHJcbiAgICB9O1xyXG59XHJcbmZ1bmN0aW9uIGN1c3RvbUF0dHJpYnV0ZShuYW1lLCBkZWZhdWx0QmluZGluZ01vZGUsIGFsaWFzZXMpIHtcclxuICAgIHJldHVybiBmdW5jdGlvbiAodGFyZ2V0KSB7XHJcbiAgICAgICAgdmFyIHIgPSBtZXRhZGF0YS5nZXRPckNyZWF0ZU93bihtZXRhZGF0YS5yZXNvdXJjZSwgSHRtbEJlaGF2aW9yUmVzb3VyY2UsIHRhcmdldCk7XHJcbiAgICAgICAgci5hdHRyaWJ1dGVOYW1lID0gdmFsaWRhdGVCZWhhdmlvck5hbWUobmFtZSwgJ2N1c3RvbSBhdHRyaWJ1dGUnKTtcclxuICAgICAgICByLmF0dHJpYnV0ZURlZmF1bHRCaW5kaW5nTW9kZSA9IGRlZmF1bHRCaW5kaW5nTW9kZTtcclxuICAgICAgICByLmFsaWFzZXMgPSBhbGlhc2VzO1xyXG4gICAgfTtcclxufVxyXG5mdW5jdGlvbiB0ZW1wbGF0ZUNvbnRyb2xsZXIodGFyZ2V0KSB7XHJcbiAgICB2YXIgZGVjbyA9IGZ1bmN0aW9uICh0KSB7XHJcbiAgICAgICAgdmFyIHIgPSBtZXRhZGF0YS5nZXRPckNyZWF0ZU93bihtZXRhZGF0YS5yZXNvdXJjZSwgSHRtbEJlaGF2aW9yUmVzb3VyY2UsIHQpO1xyXG4gICAgICAgIHIubGlmdHNDb250ZW50ID0gdHJ1ZTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gdGFyZ2V0ID8gZGVjbyh0YXJnZXQpIDogZGVjbztcclxufVxyXG5mdW5jdGlvbiBiaW5kYWJsZShuYW1lT3JDb25maWdPclRhcmdldCwga2V5LCBkZXNjcmlwdG9yKSB7XHJcbiAgICB2YXIgZGVjbyA9IGZ1bmN0aW9uICh0YXJnZXQsIGtleTIsIGRlc2NyaXB0b3IyKSB7XHJcbiAgICAgICAgdmFyIGFjdHVhbFRhcmdldCA9IGtleTIgPyB0YXJnZXQuY29uc3RydWN0b3IgOiB0YXJnZXQ7XHJcbiAgICAgICAgdmFyIHIgPSBtZXRhZGF0YS5nZXRPckNyZWF0ZU93bihtZXRhZGF0YS5yZXNvdXJjZSwgSHRtbEJlaGF2aW9yUmVzb3VyY2UsIGFjdHVhbFRhcmdldCk7XHJcbiAgICAgICAgdmFyIHByb3A7XHJcbiAgICAgICAgaWYgKGtleTIpIHtcclxuICAgICAgICAgICAgbmFtZU9yQ29uZmlnT3JUYXJnZXQgPSBuYW1lT3JDb25maWdPclRhcmdldCB8fCB7fTtcclxuICAgICAgICAgICAgbmFtZU9yQ29uZmlnT3JUYXJnZXQubmFtZSA9IGtleTI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHByb3AgPSBuZXcgQmluZGFibGVQcm9wZXJ0eShuYW1lT3JDb25maWdPclRhcmdldCk7XHJcbiAgICAgICAgcmV0dXJuIHByb3AucmVnaXN0ZXJXaXRoKGFjdHVhbFRhcmdldCwgciwgZGVzY3JpcHRvcjIpO1xyXG4gICAgfTtcclxuICAgIGlmICghbmFtZU9yQ29uZmlnT3JUYXJnZXQpIHtcclxuICAgICAgICByZXR1cm4gZGVjbztcclxuICAgIH1cclxuICAgIGlmIChrZXkpIHtcclxuICAgICAgICB2YXIgdGFyZ2V0ID0gbmFtZU9yQ29uZmlnT3JUYXJnZXQ7XHJcbiAgICAgICAgbmFtZU9yQ29uZmlnT3JUYXJnZXQgPSBudWxsO1xyXG4gICAgICAgIHJldHVybiBkZWNvKHRhcmdldCwga2V5LCBkZXNjcmlwdG9yKTtcclxuICAgIH1cclxuICAgIHJldHVybiBkZWNvO1xyXG59XHJcbmZ1bmN0aW9uIGR5bmFtaWNPcHRpb25zKHRhcmdldCkge1xyXG4gICAgdmFyIGRlY28gPSBmdW5jdGlvbiAodCkge1xyXG4gICAgICAgIHZhciByID0gbWV0YWRhdGEuZ2V0T3JDcmVhdGVPd24obWV0YWRhdGEucmVzb3VyY2UsIEh0bWxCZWhhdmlvclJlc291cmNlLCB0KTtcclxuICAgICAgICByLmhhc0R5bmFtaWNPcHRpb25zID0gdHJ1ZTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gdGFyZ2V0ID8gZGVjbyh0YXJnZXQpIDogZGVjbztcclxufVxyXG52YXIgZGVmYXVsdFNoYWRvd0RPTU9wdGlvbnMgPSB7IG1vZGU6ICdvcGVuJyB9O1xyXG5mdW5jdGlvbiB1c2VTaGFkb3dET00odGFyZ2V0T3JPcHRpb25zKSB7XHJcbiAgICB2YXIgb3B0aW9ucyA9IHR5cGVvZiB0YXJnZXRPck9wdGlvbnMgPT09ICdmdW5jdGlvbicgfHwgIXRhcmdldE9yT3B0aW9uc1xyXG4gICAgICAgID8gZGVmYXVsdFNoYWRvd0RPTU9wdGlvbnNcclxuICAgICAgICA6IHRhcmdldE9yT3B0aW9ucztcclxuICAgIHZhciBkZWNvID0gZnVuY3Rpb24gKHQpIHtcclxuICAgICAgICB2YXIgciA9IG1ldGFkYXRhLmdldE9yQ3JlYXRlT3duKG1ldGFkYXRhLnJlc291cmNlLCBIdG1sQmVoYXZpb3JSZXNvdXJjZSwgdCk7XHJcbiAgICAgICAgci50YXJnZXRTaGFkb3dET00gPSB0cnVlO1xyXG4gICAgICAgIHIuc2hhZG93RE9NT3B0aW9ucyA9IG9wdGlvbnM7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIHR5cGVvZiB0YXJnZXRPck9wdGlvbnMgPT09ICdmdW5jdGlvbicgPyBkZWNvKHRhcmdldE9yT3B0aW9ucykgOiBkZWNvO1xyXG59XHJcbmZ1bmN0aW9uIHByb2Nlc3NBdHRyaWJ1dGVzKHByb2Nlc3Nvcikge1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uICh0KSB7XHJcbiAgICAgICAgdmFyIHIgPSBtZXRhZGF0YS5nZXRPckNyZWF0ZU93bihtZXRhZGF0YS5yZXNvdXJjZSwgSHRtbEJlaGF2aW9yUmVzb3VyY2UsIHQpO1xyXG4gICAgICAgIHIucHJvY2Vzc0F0dHJpYnV0ZXMgPSBmdW5jdGlvbiAoY29tcGlsZXIsIHJlc291cmNlcywgbm9kZSwgYXR0cmlidXRlcywgZWxlbWVudEluc3RydWN0aW9uKSB7XHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICBwcm9jZXNzb3IoY29tcGlsZXIsIHJlc291cmNlcywgbm9kZSwgYXR0cmlidXRlcywgZWxlbWVudEluc3RydWN0aW9uKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIExvZ01hbmFnZXIuZ2V0TG9nZ2VyKCd0ZW1wbGF0aW5nJykuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH07XHJcbn1cclxuZnVuY3Rpb24gZG9Ob3RQcm9jZXNzQ29udGVudCgpIHsgcmV0dXJuIGZhbHNlOyB9XHJcbmZ1bmN0aW9uIHByb2Nlc3NDb250ZW50KHByb2Nlc3Nvcikge1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uICh0KSB7XHJcbiAgICAgICAgdmFyIHIgPSBtZXRhZGF0YS5nZXRPckNyZWF0ZU93bihtZXRhZGF0YS5yZXNvdXJjZSwgSHRtbEJlaGF2aW9yUmVzb3VyY2UsIHQpO1xyXG4gICAgICAgIHIucHJvY2Vzc0NvbnRlbnQgPSBwcm9jZXNzb3IgPyBmdW5jdGlvbiAoY29tcGlsZXIsIHJlc291cmNlcywgbm9kZSwgaW5zdHJ1Y3Rpb24pIHtcclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBwcm9jZXNzb3IoY29tcGlsZXIsIHJlc291cmNlcywgbm9kZSwgaW5zdHJ1Y3Rpb24pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgTG9nTWFuYWdlci5nZXRMb2dnZXIoJ3RlbXBsYXRpbmcnKS5lcnJvcihlcnJvcik7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IDogZG9Ob3RQcm9jZXNzQ29udGVudDtcclxuICAgIH07XHJcbn1cclxuZnVuY3Rpb24gY29udGFpbmVybGVzcyh0YXJnZXQpIHtcclxuICAgIHZhciBkZWNvID0gZnVuY3Rpb24gKHQpIHtcclxuICAgICAgICB2YXIgciA9IG1ldGFkYXRhLmdldE9yQ3JlYXRlT3duKG1ldGFkYXRhLnJlc291cmNlLCBIdG1sQmVoYXZpb3JSZXNvdXJjZSwgdCk7XHJcbiAgICAgICAgci5jb250YWluZXJsZXNzID0gdHJ1ZTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gdGFyZ2V0ID8gZGVjbyh0YXJnZXQpIDogZGVjbztcclxufVxyXG5mdW5jdGlvbiB1c2VWaWV3U3RyYXRlZ3koc3RyYXRlZ3kpIHtcclxuICAgIHJldHVybiBmdW5jdGlvbiAodGFyZ2V0KSB7XHJcbiAgICAgICAgbWV0YWRhdGEuZGVmaW5lKFZpZXdMb2NhdG9yLnZpZXdTdHJhdGVneU1ldGFkYXRhS2V5LCBzdHJhdGVneSwgdGFyZ2V0KTtcclxuICAgIH07XHJcbn1cclxuZnVuY3Rpb24gdXNlVmlldyhwYXRoKSB7XHJcbiAgICByZXR1cm4gdXNlVmlld1N0cmF0ZWd5KG5ldyBSZWxhdGl2ZVZpZXdTdHJhdGVneShwYXRoKSk7XHJcbn1cclxuZnVuY3Rpb24gaW5saW5lVmlldyhtYXJrdXAsIGRlcGVuZGVuY2llcywgZGVwZW5kZW5jeUJhc2VVcmwpIHtcclxuICAgIHJldHVybiB1c2VWaWV3U3RyYXRlZ3kobmV3IElubGluZVZpZXdTdHJhdGVneShtYXJrdXAsIGRlcGVuZGVuY2llcywgZGVwZW5kZW5jeUJhc2VVcmwpKTtcclxufVxyXG5mdW5jdGlvbiBub1ZpZXcodGFyZ2V0T3JEZXBlbmRlbmNpZXMsIGRlcGVuZGVuY3lCYXNlVXJsKSB7XHJcbiAgICB2YXIgdGFyZ2V0O1xyXG4gICAgdmFyIGRlcGVuZGVuY2llcztcclxuICAgIGlmICh0eXBlb2YgdGFyZ2V0T3JEZXBlbmRlbmNpZXMgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICB0YXJnZXQgPSB0YXJnZXRPckRlcGVuZGVuY2llcztcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIGRlcGVuZGVuY2llcyA9IHRhcmdldE9yRGVwZW5kZW5jaWVzO1xyXG4gICAgICAgIHRhcmdldCA9IHVuZGVmaW5lZDtcclxuICAgIH1cclxuICAgIHZhciBkZWNvID0gZnVuY3Rpb24gKHQpIHtcclxuICAgICAgICBtZXRhZGF0YS5kZWZpbmUoVmlld0xvY2F0b3Iudmlld1N0cmF0ZWd5TWV0YWRhdGFLZXksIG5ldyBOb1ZpZXdTdHJhdGVneShkZXBlbmRlbmNpZXMsIGRlcGVuZGVuY3lCYXNlVXJsKSwgdCk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIHRhcmdldCA/IGRlY28odGFyZ2V0KSA6IGRlY287XHJcbn1cclxuZnVuY3Rpb24gdmlldyh0ZW1wbGF0ZU9yQ29uZmlnKSB7XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKHRhcmdldCkge1xyXG4gICAgICAgIHRhcmdldC4kdmlldyA9IHRlbXBsYXRlT3JDb25maWc7XHJcbiAgICB9O1xyXG59XHJcbmZ1bmN0aW9uIGVsZW1lbnRDb25maWcodGFyZ2V0KSB7XHJcbiAgICB2YXIgZGVjbyA9IGZ1bmN0aW9uICh0KSB7XHJcbiAgICAgICAgbWV0YWRhdGEuZGVmaW5lKG1ldGFkYXRhLnJlc291cmNlLCBuZXcgRWxlbWVudENvbmZpZ1Jlc291cmNlKCksIHQpO1xyXG4gICAgfTtcclxuICAgIHJldHVybiB0YXJnZXQgPyBkZWNvKHRhcmdldCkgOiBkZWNvO1xyXG59XHJcbmZ1bmN0aW9uIHZpZXdSZXNvdXJjZXMoKSB7XHJcbiAgICB2YXIgcmVzb3VyY2VzID0gW107XHJcbiAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykge1xyXG4gICAgICAgIHJlc291cmNlc1tfaV0gPSBhcmd1bWVudHNbX2ldO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGZ1bmN0aW9uICh0YXJnZXQpIHtcclxuICAgICAgICBtZXRhZGF0YS5kZWZpbmUoVmlld0VuZ2luZS52aWV3TW9kZWxSZXF1aXJlTWV0YWRhdGFLZXksIHJlc291cmNlcywgdGFyZ2V0KTtcclxuICAgIH07XHJcbn1cblxudmFyIFRlbXBsYXRpbmdFbmdpbmUgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gVGVtcGxhdGluZ0VuZ2luZShjb250YWluZXIsIG1vZHVsZUFuYWx5emVyLCB2aWV3Q29tcGlsZXIsIGNvbXBvc2l0aW9uRW5naW5lKSB7XHJcbiAgICAgICAgdGhpcy5fY29udGFpbmVyID0gY29udGFpbmVyO1xyXG4gICAgICAgIHRoaXMuX21vZHVsZUFuYWx5emVyID0gbW9kdWxlQW5hbHl6ZXI7XHJcbiAgICAgICAgdGhpcy5fdmlld0NvbXBpbGVyID0gdmlld0NvbXBpbGVyO1xyXG4gICAgICAgIHRoaXMuX2NvbXBvc2l0aW9uRW5naW5lID0gY29tcG9zaXRpb25FbmdpbmU7XHJcbiAgICAgICAgY29udGFpbmVyLnJlZ2lzdGVySW5zdGFuY2UoQW5pbWF0b3IsIEFuaW1hdG9yLmluc3RhbmNlID0gbmV3IEFuaW1hdG9yKCkpO1xyXG4gICAgfVxyXG4gICAgVGVtcGxhdGluZ0VuZ2luZS5wcm90b3R5cGUuY29uZmlndXJlQW5pbWF0b3IgPSBmdW5jdGlvbiAoYW5pbWF0b3IpIHtcclxuICAgICAgICB0aGlzLl9jb250YWluZXIudW5yZWdpc3RlcihBbmltYXRvcik7XHJcbiAgICAgICAgdGhpcy5fY29udGFpbmVyLnJlZ2lzdGVySW5zdGFuY2UoQW5pbWF0b3IsIEFuaW1hdG9yLmluc3RhbmNlID0gYW5pbWF0b3IpO1xyXG4gICAgfTtcclxuICAgIFRlbXBsYXRpbmdFbmdpbmUucHJvdG90eXBlLmNvbXBvc2UgPSBmdW5jdGlvbiAoY29udGV4dCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9jb21wb3NpdGlvbkVuZ2luZS5jb21wb3NlKGNvbnRleHQpO1xyXG4gICAgfTtcclxuICAgIFRlbXBsYXRpbmdFbmdpbmUucHJvdG90eXBlLmVuaGFuY2UgPSBmdW5jdGlvbiAoaW5zdHJ1Y3Rpb24pIHtcclxuICAgICAgICBpZiAoaW5zdHJ1Y3Rpb24gaW5zdGFuY2VvZiBET00uRWxlbWVudCkge1xyXG4gICAgICAgICAgICBpbnN0cnVjdGlvbiA9IHsgZWxlbWVudDogaW5zdHJ1Y3Rpb24gfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIGNvbXBpbGVySW5zdHJ1Y3Rpb25zID0geyBsZXRFeHByZXNzaW9uczogW10gfTtcclxuICAgICAgICB2YXIgcmVzb3VyY2VzID0gaW5zdHJ1Y3Rpb24ucmVzb3VyY2VzIHx8IHRoaXMuX2NvbnRhaW5lci5nZXQoVmlld1Jlc291cmNlcyk7XHJcbiAgICAgICAgdGhpcy5fdmlld0NvbXBpbGVyLl9jb21waWxlTm9kZShpbnN0cnVjdGlvbi5lbGVtZW50LCByZXNvdXJjZXMsIGNvbXBpbGVySW5zdHJ1Y3Rpb25zLCBpbnN0cnVjdGlvbi5lbGVtZW50LnBhcmVudE5vZGUsICdyb290JywgdHJ1ZSk7XHJcbiAgICAgICAgdmFyIGZhY3RvcnkgPSBuZXcgVmlld0ZhY3RvcnkoaW5zdHJ1Y3Rpb24uZWxlbWVudCwgY29tcGlsZXJJbnN0cnVjdGlvbnMsIHJlc291cmNlcyk7XHJcbiAgICAgICAgdmFyIGNvbnRhaW5lciA9IGluc3RydWN0aW9uLmNvbnRhaW5lciB8fCB0aGlzLl9jb250YWluZXIuY3JlYXRlQ2hpbGQoKTtcclxuICAgICAgICB2YXIgdmlldyA9IGZhY3RvcnkuY3JlYXRlKGNvbnRhaW5lciwgQmVoYXZpb3JJbnN0cnVjdGlvbi5lbmhhbmNlKCkpO1xyXG4gICAgICAgIHZpZXcuYmluZChpbnN0cnVjdGlvbi5iaW5kaW5nQ29udGV4dCB8fCB7fSwgaW5zdHJ1Y3Rpb24ub3ZlcnJpZGVDb250ZXh0KTtcclxuICAgICAgICB2aWV3LmZpcnN0Q2hpbGQgPSB2aWV3Lmxhc3RDaGlsZCA9IHZpZXcuZnJhZ21lbnQ7XHJcbiAgICAgICAgdmlldy5mcmFnbWVudCA9IERPTS5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XHJcbiAgICAgICAgdmlldy5hdHRhY2hlZCgpO1xyXG4gICAgICAgIHJldHVybiB2aWV3O1xyXG4gICAgfTtcclxuICAgIFRlbXBsYXRpbmdFbmdpbmUuaW5qZWN0ID0gW0NvbnRhaW5lciwgTW9kdWxlQW5hbHl6ZXIsIFZpZXdDb21waWxlciwgQ29tcG9zaXRpb25FbmdpbmVdO1xyXG4gICAgcmV0dXJuIFRlbXBsYXRpbmdFbmdpbmU7XHJcbn0oKSk7XG5cbmV4cG9ydCB7IEFuaW1hdG9yLCBCZWhhdmlvckluc3RydWN0aW9uLCBCZWhhdmlvclByb3BlcnR5T2JzZXJ2ZXIsIEJpbmRhYmxlUHJvcGVydHksIEJpbmRpbmdMYW5ndWFnZSwgQm91bmRWaWV3RmFjdG9yeSwgQ29tcG9zaXRpb25FbmdpbmUsIENvbXBvc2l0aW9uVHJhbnNhY3Rpb24sIENvbXBvc2l0aW9uVHJhbnNhY3Rpb25Ob3RpZmllciwgQ29tcG9zaXRpb25UcmFuc2FjdGlvbk93bmVyc2hpcFRva2VuLCBDb250cm9sbGVyLCBDb252ZW50aW9uYWxWaWV3U3RyYXRlZ3ksIEVsZW1lbnRDb25maWdSZXNvdXJjZSwgRWxlbWVudEV2ZW50cywgSHRtbEJlaGF2aW9yUmVzb3VyY2UsIElubGluZVZpZXdTdHJhdGVneSwgTW9kdWxlQW5hbHl6ZXIsIE5vVmlld1N0cmF0ZWd5LCBQYXNzVGhyb3VnaFNsb3QsIFJlbGF0aXZlVmlld1N0cmF0ZWd5LCBSZXNvdXJjZURlc2NyaXB0aW9uLCBSZXNvdXJjZUxvYWRDb250ZXh0LCBSZXNvdXJjZU1vZHVsZSwgU2hhZG93RE9NLCBTaGFkb3dTbG90LCBTbG90Q3VzdG9tQXR0cmlidXRlLCBTdGF0aWNWaWV3U3RyYXRlZ3ksIFN3YXBTdHJhdGVnaWVzLCBUYXJnZXRJbnN0cnVjdGlvbiwgVGVtcGxhdGVSZWdpc3RyeVZpZXdTdHJhdGVneSwgVGVtcGxhdGluZ0VuZ2luZSwgVmlldywgVmlld0NvbXBpbGVJbnN0cnVjdGlvbiwgVmlld0NvbXBpbGVyLCBWaWV3RW5naW5lLCBWaWV3RW5naW5lSG9va3NSZXNvdXJjZSwgVmlld0ZhY3RvcnksIFZpZXdMb2NhdG9yLCBWaWV3UmVzb3VyY2VzLCBWaWV3U2xvdCwgX2h5cGhlbmF0ZSwgX2lzQWxsV2hpdGVzcGFjZSwgYW5pbWF0aW9uRXZlbnQsIGJlaGF2aW9yLCBiaW5kYWJsZSwgY2hpbGQsIGNoaWxkcmVuLCBjb250YWluZXJsZXNzLCBjdXN0b21BdHRyaWJ1dGUsIGN1c3RvbUVsZW1lbnQsIGR5bmFtaWNPcHRpb25zLCBlbGVtZW50Q29uZmlnLCBpbmxpbmVWaWV3LCBub1ZpZXcsIHByb2Nlc3NBdHRyaWJ1dGVzLCBwcm9jZXNzQ29udGVudCwgcmVzb3VyY2UsIHRlbXBsYXRlQ29udHJvbGxlciwgdXNlU2hhZG93RE9NLCB1c2VWaWV3LCB1c2VWaWV3U3RyYXRlZ3ksIHZhbGlkYXRlQmVoYXZpb3JOYW1lLCB2aWV3LCB2aWV3RW5naW5lSG9va3MsIHZpZXdSZXNvdXJjZXMsIHZpZXdTdHJhdGVneSB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXVyZWxpYS10ZW1wbGF0aW5nLmpzLm1hcFxuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlFQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTsiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///hij8\n");

/***/ })

}]);
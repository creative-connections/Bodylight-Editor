(window["webpackJsonp"] = window["webpackJsonp"] || []).push([["vendors~a147e3f9"],{

/***/ "gCht":
/*!******************************************************************************************************************!*\
  !*** ./node_modules/aurelia-framework/node_modules/aurelia-templating/dist/native-modules/aurelia-templating.js ***!
  \******************************************************************************************************************/
/*! exports provided: Animator, BehaviorInstruction, BehaviorPropertyObserver, BindableProperty, BindingLanguage, BoundViewFactory, CompositionEngine, CompositionTransaction, CompositionTransactionNotifier, CompositionTransactionOwnershipToken, Controller, ConventionalViewStrategy, ElementConfigResource, ElementEvents, HtmlBehaviorResource, InlineViewStrategy, ModuleAnalyzer, NoViewStrategy, PassThroughSlot, RelativeViewStrategy, ResourceDescription, ResourceLoadContext, ResourceModule, ShadowDOM, ShadowSlot, SlotCustomAttribute, StaticViewStrategy, SwapStrategies, TargetInstruction, TemplateRegistryViewStrategy, TemplatingEngine, View, ViewCompileInstruction, ViewCompiler, ViewEngine, ViewEngineHooksResource, ViewFactory, ViewLocator, ViewResources, ViewSlot, _hyphenate, _isAllWhitespace, animationEvent, behavior, bindable, child, children, containerless, customAttribute, customElement, dynamicOptions, elementConfig, inlineView, noView, processAttributes, processContent, resource, templateController, useShadowDOM, useView, useViewStrategy, validateBehaviorName, view, viewEngineHooks, viewResources, viewStrategy */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Animator\", function() { return Animator; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"BehaviorInstruction\", function() { return BehaviorInstruction; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"BehaviorPropertyObserver\", function() { return BehaviorPropertyObserver; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"BindableProperty\", function() { return BindableProperty; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"BindingLanguage\", function() { return BindingLanguage; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"BoundViewFactory\", function() { return BoundViewFactory; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"CompositionEngine\", function() { return CompositionEngine; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"CompositionTransaction\", function() { return CompositionTransaction; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"CompositionTransactionNotifier\", function() { return CompositionTransactionNotifier; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"CompositionTransactionOwnershipToken\", function() { return CompositionTransactionOwnershipToken; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Controller\", function() { return Controller; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ConventionalViewStrategy\", function() { return ConventionalViewStrategy; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ElementConfigResource\", function() { return ElementConfigResource; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ElementEvents\", function() { return ElementEvents; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"HtmlBehaviorResource\", function() { return HtmlBehaviorResource; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"InlineViewStrategy\", function() { return InlineViewStrategy; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ModuleAnalyzer\", function() { return ModuleAnalyzer; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"NoViewStrategy\", function() { return NoViewStrategy; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"PassThroughSlot\", function() { return PassThroughSlot; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"RelativeViewStrategy\", function() { return RelativeViewStrategy; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ResourceDescription\", function() { return ResourceDescription; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ResourceLoadContext\", function() { return ResourceLoadContext; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ResourceModule\", function() { return ResourceModule; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ShadowDOM\", function() { return ShadowDOM; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ShadowSlot\", function() { return ShadowSlot; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"SlotCustomAttribute\", function() { return SlotCustomAttribute; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"StaticViewStrategy\", function() { return StaticViewStrategy; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"SwapStrategies\", function() { return SwapStrategies; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"TargetInstruction\", function() { return TargetInstruction; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"TemplateRegistryViewStrategy\", function() { return TemplateRegistryViewStrategy; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"TemplatingEngine\", function() { return TemplatingEngine; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"View\", function() { return View; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ViewCompileInstruction\", function() { return ViewCompileInstruction; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ViewCompiler\", function() { return ViewCompiler; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ViewEngine\", function() { return ViewEngine; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ViewEngineHooksResource\", function() { return ViewEngineHooksResource; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ViewFactory\", function() { return ViewFactory; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ViewLocator\", function() { return ViewLocator; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ViewResources\", function() { return ViewResources; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"ViewSlot\", function() { return ViewSlot; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"_hyphenate\", function() { return _hyphenate; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"_isAllWhitespace\", function() { return _isAllWhitespace; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"animationEvent\", function() { return animationEvent; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"behavior\", function() { return behavior; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"bindable\", function() { return bindable; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"child\", function() { return child; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"children\", function() { return children; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"containerless\", function() { return containerless; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"customAttribute\", function() { return customAttribute; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"customElement\", function() { return customElement; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"dynamicOptions\", function() { return dynamicOptions; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"elementConfig\", function() { return elementConfig; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"inlineView\", function() { return inlineView; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"noView\", function() { return noView; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"processAttributes\", function() { return processAttributes; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"processContent\", function() { return processContent; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"resource\", function() { return resource; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"templateController\", function() { return templateController; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"useShadowDOM\", function() { return useShadowDOM; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"useView\", function() { return useView; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"useViewStrategy\", function() { return useViewStrategy; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"validateBehaviorName\", function() { return validateBehaviorName; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"view\", function() { return view; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"viewEngineHooks\", function() { return viewEngineHooks; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"viewResources\", function() { return viewResources; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"viewStrategy\", function() { return viewStrategy; });\n/* harmony import */ var aurelia_pal__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! aurelia-pal */ \"70NS\");\n/* harmony import */ var aurelia_loader__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! aurelia-loader */ \"ZdUM\");\n/* harmony import */ var aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! aurelia-metadata */ \"qrcG\");\n/* harmony import */ var aurelia_path__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! aurelia-path */ \"iD3O\");\n/* harmony import */ var aurelia_logging__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! aurelia-logging */ \"MP1E\");\n/* harmony import */ var aurelia_binding__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! aurelia-binding */ \"X5gX\");\n/* harmony import */ var aurelia_dependency_injection__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! aurelia-dependency-injection */ \"3U8n\");\n/* harmony import */ var aurelia_task_queue__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! aurelia-task-queue */ \"K/SW\");\n\n\n\n\n\n\n\n\n\nvar ElementEvents = (function () {\r\n    function ElementEvents(element) {\r\n        this.element = element;\r\n        this.subscriptions = {};\r\n    }\r\n    ElementEvents.prototype._enqueueHandler = function (handler) {\r\n        this.subscriptions[handler.eventName] = this.subscriptions[handler.eventName] || [];\r\n        this.subscriptions[handler.eventName].push(handler);\r\n    };\r\n    ElementEvents.prototype._dequeueHandler = function (handler) {\r\n        var index;\r\n        var subscriptions = this.subscriptions[handler.eventName];\r\n        if (subscriptions) {\r\n            index = subscriptions.indexOf(handler);\r\n            if (index > -1) {\r\n                subscriptions.splice(index, 1);\r\n            }\r\n        }\r\n        return handler;\r\n    };\r\n    ElementEvents.prototype.publish = function (eventName, detail, bubbles, cancelable) {\r\n        if (detail === void 0) { detail = {}; }\r\n        if (bubbles === void 0) { bubbles = true; }\r\n        if (cancelable === void 0) { cancelable = true; }\r\n        var event = aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].createCustomEvent(eventName, { cancelable: cancelable, bubbles: bubbles, detail: detail });\r\n        this.element.dispatchEvent(event);\r\n    };\r\n    ElementEvents.prototype.subscribe = function (eventName, handler, captureOrOptions) {\r\n        if (typeof handler === 'function') {\r\n            if (captureOrOptions === undefined) {\r\n                captureOrOptions = ElementEvents.defaultListenerOptions;\r\n            }\r\n            var eventHandler = new EventHandlerImpl(this, eventName, handler, captureOrOptions, false);\r\n            return eventHandler;\r\n        }\r\n        return undefined;\r\n    };\r\n    ElementEvents.prototype.subscribeOnce = function (eventName, handler, captureOrOptions) {\r\n        if (typeof handler === 'function') {\r\n            if (captureOrOptions === undefined) {\r\n                captureOrOptions = ElementEvents.defaultListenerOptions;\r\n            }\r\n            var eventHandler = new EventHandlerImpl(this, eventName, handler, captureOrOptions, true);\r\n            return eventHandler;\r\n        }\r\n        return undefined;\r\n    };\r\n    ElementEvents.prototype.dispose = function (eventName) {\r\n        if (eventName && typeof eventName === 'string') {\r\n            var subscriptions = this.subscriptions[eventName];\r\n            if (subscriptions) {\r\n                while (subscriptions.length) {\r\n                    var subscription = subscriptions.pop();\r\n                    if (subscription) {\r\n                        subscription.dispose();\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            this.disposeAll();\r\n        }\r\n    };\r\n    ElementEvents.prototype.disposeAll = function () {\r\n        for (var key in this.subscriptions) {\r\n            this.dispose(key);\r\n        }\r\n    };\r\n    ElementEvents.defaultListenerOptions = true;\r\n    return ElementEvents;\r\n}());\r\nvar EventHandlerImpl = (function () {\r\n    function EventHandlerImpl(owner, eventName, handler, captureOrOptions, once) {\r\n        this.owner = owner;\r\n        this.eventName = eventName;\r\n        this.handler = handler;\r\n        this.capture = typeof captureOrOptions === 'boolean' ? captureOrOptions : captureOrOptions.capture;\r\n        this.bubbles = !this.capture;\r\n        this.captureOrOptions = captureOrOptions;\r\n        this.once = once;\r\n        owner.element.addEventListener(eventName, this, captureOrOptions);\r\n        owner._enqueueHandler(this);\r\n    }\r\n    EventHandlerImpl.prototype.handleEvent = function (e) {\r\n        var fn = this.handler;\r\n        fn(e);\r\n        if (this.once) {\r\n            this.dispose();\r\n        }\r\n    };\r\n    EventHandlerImpl.prototype.dispose = function () {\r\n        this.owner.element.removeEventListener(this.eventName, this, this.captureOrOptions);\r\n        this.owner._dequeueHandler(this);\r\n        this.owner = this.handler = null;\r\n    };\r\n    return EventHandlerImpl;\r\n}());\n\nvar ResourceLoadContext = (function () {\r\n    function ResourceLoadContext() {\r\n        this.dependencies = {};\r\n    }\r\n    ResourceLoadContext.prototype.addDependency = function (url) {\r\n        this.dependencies[url] = true;\r\n    };\r\n    ResourceLoadContext.prototype.hasDependency = function (url) {\r\n        return url in this.dependencies;\r\n    };\r\n    return ResourceLoadContext;\r\n}());\r\nvar ViewCompileInstruction = (function () {\r\n    function ViewCompileInstruction(targetShadowDOM, compileSurrogate) {\r\n        if (targetShadowDOM === void 0) { targetShadowDOM = false; }\r\n        if (compileSurrogate === void 0) { compileSurrogate = false; }\r\n        this.targetShadowDOM = targetShadowDOM;\r\n        this.compileSurrogate = compileSurrogate;\r\n        this.associatedModuleId = null;\r\n    }\r\n    ViewCompileInstruction.normal = new ViewCompileInstruction();\r\n    return ViewCompileInstruction;\r\n}());\r\nvar BehaviorInstruction = (function () {\r\n    function BehaviorInstruction() {\r\n    }\r\n    BehaviorInstruction.enhance = function () {\r\n        var instruction = new BehaviorInstruction();\r\n        instruction.enhance = true;\r\n        return instruction;\r\n    };\r\n    BehaviorInstruction.unitTest = function (type, attributes) {\r\n        var instruction = new BehaviorInstruction();\r\n        instruction.type = type;\r\n        instruction.attributes = attributes || {};\r\n        return instruction;\r\n    };\r\n    BehaviorInstruction.element = function (node, type) {\r\n        var instruction = new BehaviorInstruction();\r\n        instruction.type = type;\r\n        instruction.attributes = {};\r\n        instruction.anchorIsContainer = !(node.hasAttribute('containerless') || type.containerless);\r\n        instruction.initiatedByBehavior = true;\r\n        return instruction;\r\n    };\r\n    BehaviorInstruction.attribute = function (attrName, type) {\r\n        var instruction = new BehaviorInstruction();\r\n        instruction.attrName = attrName;\r\n        instruction.type = type || null;\r\n        instruction.attributes = {};\r\n        return instruction;\r\n    };\r\n    BehaviorInstruction.dynamic = function (host, viewModel, viewFactory) {\r\n        var instruction = new BehaviorInstruction();\r\n        instruction.host = host;\r\n        instruction.viewModel = viewModel;\r\n        instruction.viewFactory = viewFactory;\r\n        instruction.inheritBindingContext = true;\r\n        return instruction;\r\n    };\r\n    BehaviorInstruction.normal = new BehaviorInstruction();\r\n    return BehaviorInstruction;\r\n}());\r\nvar biProto = BehaviorInstruction.prototype;\r\nbiProto.initiatedByBehavior = false;\r\nbiProto.enhance = false;\r\nbiProto.partReplacements = null;\r\nbiProto.viewFactory = null;\r\nbiProto.originalAttrName = null;\r\nbiProto.skipContentProcessing = false;\r\nbiProto.contentFactory = null;\r\nbiProto.viewModel = null;\r\nbiProto.anchorIsContainer = false;\r\nbiProto.host = null;\r\nbiProto.attributes = null;\r\nbiProto.type = null;\r\nbiProto.attrName = null;\r\nbiProto.inheritBindingContext = false;\r\nvar TargetInstruction = (function () {\r\n    function TargetInstruction() {\r\n    }\r\n    TargetInstruction.shadowSlot = function (parentInjectorId) {\r\n        var instruction = new TargetInstruction();\r\n        instruction.parentInjectorId = parentInjectorId;\r\n        instruction.shadowSlot = true;\r\n        return instruction;\r\n    };\r\n    TargetInstruction.contentExpression = function (expression) {\r\n        var instruction = new TargetInstruction();\r\n        instruction.contentExpression = expression;\r\n        return instruction;\r\n    };\r\n    TargetInstruction.letElement = function (expressions) {\r\n        var instruction = new TargetInstruction();\r\n        instruction.expressions = expressions;\r\n        instruction.letElement = true;\r\n        return instruction;\r\n    };\r\n    TargetInstruction.lifting = function (parentInjectorId, liftingInstruction) {\r\n        var instruction = new TargetInstruction();\r\n        instruction.parentInjectorId = parentInjectorId;\r\n        instruction.expressions = TargetInstruction.noExpressions;\r\n        instruction.behaviorInstructions = [liftingInstruction];\r\n        instruction.viewFactory = liftingInstruction.viewFactory;\r\n        instruction.providers = [liftingInstruction.type.target];\r\n        instruction.lifting = true;\r\n        return instruction;\r\n    };\r\n    TargetInstruction.normal = function (injectorId, parentInjectorId, providers, behaviorInstructions, expressions, elementInstruction) {\r\n        var instruction = new TargetInstruction();\r\n        instruction.injectorId = injectorId;\r\n        instruction.parentInjectorId = parentInjectorId;\r\n        instruction.providers = providers;\r\n        instruction.behaviorInstructions = behaviorInstructions;\r\n        instruction.expressions = expressions;\r\n        instruction.anchorIsContainer = elementInstruction ? elementInstruction.anchorIsContainer : true;\r\n        instruction.elementInstruction = elementInstruction;\r\n        return instruction;\r\n    };\r\n    TargetInstruction.surrogate = function (providers, behaviorInstructions, expressions, values) {\r\n        var instruction = new TargetInstruction();\r\n        instruction.expressions = expressions;\r\n        instruction.behaviorInstructions = behaviorInstructions;\r\n        instruction.providers = providers;\r\n        instruction.values = values;\r\n        return instruction;\r\n    };\r\n    TargetInstruction.noExpressions = Object.freeze([]);\r\n    return TargetInstruction;\r\n}());\r\nvar tiProto = TargetInstruction.prototype;\r\ntiProto.injectorId = null;\r\ntiProto.parentInjectorId = null;\r\ntiProto.shadowSlot = false;\r\ntiProto.slotName = null;\r\ntiProto.slotFallbackFactory = null;\r\ntiProto.contentExpression = null;\r\ntiProto.letElement = false;\r\ntiProto.expressions = null;\r\ntiProto.expressions = null;\r\ntiProto.providers = null;\r\ntiProto.viewFactory = null;\r\ntiProto.anchorIsContainer = false;\r\ntiProto.elementInstruction = null;\r\ntiProto.lifting = false;\r\ntiProto.values = null;\n\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n\r\nfunction __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\n\nvar capitalMatcher = /([A-Z])/g;\r\nfunction addHyphenAndLower(char) {\r\n    return '-' + char.toLowerCase();\r\n}\r\nfunction _hyphenate(name) {\r\n    return (name.charAt(0).toLowerCase() + name.slice(1)).replace(capitalMatcher, addHyphenAndLower);\r\n}\r\nfunction _isAllWhitespace(node) {\r\n    return !(node.auInterpolationTarget || (/[^\\t\\n\\r ]/.test(node.textContent)));\r\n}\n\nvar BehaviorPropertyObserver = (function () {\r\n    function BehaviorPropertyObserver(taskQueue, obj, propertyName, selfSubscriber, initialValue) {\r\n        this.taskQueue = taskQueue;\r\n        this.obj = obj;\r\n        this.propertyName = propertyName;\r\n        this.notqueued = true;\r\n        this.publishing = false;\r\n        this.selfSubscriber = selfSubscriber;\r\n        this.currentValue = this.oldValue = initialValue;\r\n    }\r\n    BehaviorPropertyObserver.prototype.getValue = function () {\r\n        return this.currentValue;\r\n    };\r\n    BehaviorPropertyObserver.prototype.setValue = function (newValue) {\r\n        var oldValue = this.currentValue;\r\n        if (!Object.is(newValue, oldValue)) {\r\n            this.oldValue = oldValue;\r\n            this.currentValue = newValue;\r\n            if (this.publishing && this.notqueued) {\r\n                if (this.taskQueue.flushing) {\r\n                    this.call();\r\n                }\r\n                else {\r\n                    this.notqueued = false;\r\n                    this.taskQueue.queueMicroTask(this);\r\n                }\r\n            }\r\n        }\r\n    };\r\n    BehaviorPropertyObserver.prototype.call = function () {\r\n        var oldValue = this.oldValue;\r\n        var newValue = this.currentValue;\r\n        this.notqueued = true;\r\n        if (Object.is(newValue, oldValue)) {\r\n            return;\r\n        }\r\n        if (this.selfSubscriber) {\r\n            this.selfSubscriber(newValue, oldValue);\r\n        }\r\n        this.callSubscribers(newValue, oldValue);\r\n        this.oldValue = newValue;\r\n    };\r\n    BehaviorPropertyObserver.prototype.callSubscribers = function (newValue, oldValue) {\r\n        throw new Error('Method not implemented.');\r\n    };\r\n    BehaviorPropertyObserver.prototype.subscribe = function (context, callable) {\r\n        this.addSubscriber(context, callable);\r\n    };\r\n    BehaviorPropertyObserver.prototype.addSubscriber = function (context, callable) {\r\n        throw new Error('Method not implemented.');\r\n    };\r\n    BehaviorPropertyObserver.prototype.unsubscribe = function (context, callable) {\r\n        this.removeSubscriber(context, callable);\r\n    };\r\n    BehaviorPropertyObserver.prototype.removeSubscriber = function (context, callable) {\r\n        throw new Error('Method not implemented.');\r\n    };\r\n    BehaviorPropertyObserver = __decorate([\r\n        Object(aurelia_binding__WEBPACK_IMPORTED_MODULE_5__[\"subscriberCollection\"])()\r\n    ], BehaviorPropertyObserver);\r\n    return BehaviorPropertyObserver;\r\n}());\n\nfunction getObserver(instance, name) {\r\n    var lookup = instance.__observers__;\r\n    if (lookup === undefined) {\r\n        var ctor = Object.getPrototypeOf(instance).constructor;\r\n        var behavior = aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].get(aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].resource, ctor);\r\n        if (!behavior.isInitialized) {\r\n            behavior.initialize(aurelia_dependency_injection__WEBPACK_IMPORTED_MODULE_6__[\"Container\"].instance || new aurelia_dependency_injection__WEBPACK_IMPORTED_MODULE_6__[\"Container\"](), instance.constructor);\r\n        }\r\n        lookup = behavior.observerLocator.getOrCreateObserversLookup(instance);\r\n        behavior._ensurePropertiesDefined(instance, lookup);\r\n    }\r\n    return lookup[name];\r\n}\r\nvar BindableProperty = (function () {\r\n    function BindableProperty(nameOrConfig) {\r\n        if (typeof nameOrConfig === 'string') {\r\n            this.name = nameOrConfig;\r\n        }\r\n        else {\r\n            Object.assign(this, nameOrConfig);\r\n        }\r\n        this.attribute = this.attribute || _hyphenate(this.name);\r\n        var defaultBindingMode = this.defaultBindingMode;\r\n        if (defaultBindingMode === null || defaultBindingMode === undefined) {\r\n            this.defaultBindingMode = aurelia_binding__WEBPACK_IMPORTED_MODULE_5__[\"bindingMode\"].oneWay;\r\n        }\r\n        else if (typeof defaultBindingMode === 'string') {\r\n            this.defaultBindingMode = aurelia_binding__WEBPACK_IMPORTED_MODULE_5__[\"bindingMode\"][defaultBindingMode] || aurelia_binding__WEBPACK_IMPORTED_MODULE_5__[\"bindingMode\"].oneWay;\r\n        }\r\n        this.changeHandler = this.changeHandler || null;\r\n        this.owner = null;\r\n        this.descriptor = null;\r\n    }\r\n    BindableProperty.prototype.registerWith = function (target, behavior, descriptor) {\r\n        behavior.properties.push(this);\r\n        behavior.attributes[this.attribute] = this;\r\n        this.owner = behavior;\r\n        if (descriptor) {\r\n            this.descriptor = descriptor;\r\n            return this._configureDescriptor(descriptor);\r\n        }\r\n        return undefined;\r\n    };\r\n    BindableProperty.prototype._configureDescriptor = function (descriptor) {\r\n        var name = this.name;\r\n        descriptor.configurable = true;\r\n        descriptor.enumerable = true;\r\n        if ('initializer' in descriptor) {\r\n            this.defaultValue = descriptor.initializer;\r\n            delete descriptor.initializer;\r\n            delete descriptor.writable;\r\n        }\r\n        if ('value' in descriptor) {\r\n            this.defaultValue = descriptor.value;\r\n            delete descriptor.value;\r\n            delete descriptor.writable;\r\n        }\r\n        descriptor.get = function () {\r\n            return getObserver(this, name).getValue();\r\n        };\r\n        descriptor.set = function (value) {\r\n            getObserver(this, name).setValue(value);\r\n        };\r\n        descriptor.get.getObserver = function (obj) {\r\n            return getObserver(obj, name);\r\n        };\r\n        return descriptor;\r\n    };\r\n    BindableProperty.prototype.defineOn = function (target, behavior) {\r\n        var name = this.name;\r\n        var handlerName;\r\n        if (this.changeHandler === null) {\r\n            handlerName = name + 'Changed';\r\n            if (handlerName in target.prototype) {\r\n                this.changeHandler = handlerName;\r\n            }\r\n        }\r\n        if (this.descriptor === null) {\r\n            Object.defineProperty(target.prototype, name, this._configureDescriptor({}));\r\n        }\r\n    };\r\n    BindableProperty.prototype.createObserver = function (viewModel) {\r\n        var selfSubscriber = null;\r\n        var defaultValue = this.defaultValue;\r\n        var changeHandlerName = this.changeHandler;\r\n        var name = this.name;\r\n        var initialValue;\r\n        if (this.hasOptions) {\r\n            return undefined;\r\n        }\r\n        if (changeHandlerName in viewModel) {\r\n            if ('propertyChanged' in viewModel) {\r\n                selfSubscriber = function (newValue, oldValue) {\r\n                    viewModel[changeHandlerName](newValue, oldValue);\r\n                    viewModel.propertyChanged(name, newValue, oldValue);\r\n                };\r\n            }\r\n            else {\r\n                selfSubscriber = function (newValue, oldValue) { return viewModel[changeHandlerName](newValue, oldValue); };\r\n            }\r\n        }\r\n        else if ('propertyChanged' in viewModel) {\r\n            selfSubscriber = function (newValue, oldValue) { return viewModel.propertyChanged(name, newValue, oldValue); };\r\n        }\r\n        else if (changeHandlerName !== null) {\r\n            throw new Error(\"Change handler \".concat(changeHandlerName, \" was specified but not declared on the class.\"));\r\n        }\r\n        if (defaultValue !== undefined) {\r\n            initialValue = typeof defaultValue === 'function' ? defaultValue.call(viewModel) : defaultValue;\r\n        }\r\n        return new BehaviorPropertyObserver(this.owner.taskQueue, viewModel, this.name, selfSubscriber, initialValue);\r\n    };\r\n    BindableProperty.prototype._initialize = function (viewModel, observerLookup, attributes, behaviorHandlesBind, boundProperties) {\r\n        var selfSubscriber;\r\n        var observer;\r\n        var attribute;\r\n        var defaultValue = this.defaultValue;\r\n        if (this.isDynamic) {\r\n            for (var key in attributes) {\r\n                this._createDynamicProperty(viewModel, observerLookup, behaviorHandlesBind, key, attributes[key], boundProperties);\r\n            }\r\n        }\r\n        else if (!this.hasOptions) {\r\n            observer = observerLookup[this.name];\r\n            if (attributes !== null) {\r\n                selfSubscriber = observer.selfSubscriber;\r\n                attribute = attributes[this.attribute];\r\n                if (behaviorHandlesBind) {\r\n                    observer.selfSubscriber = null;\r\n                }\r\n                if (typeof attribute === 'string') {\r\n                    viewModel[this.name] = attribute;\r\n                    observer.call();\r\n                }\r\n                else if (attribute) {\r\n                    boundProperties.push({ observer: observer, binding: attribute.createBinding(viewModel) });\r\n                }\r\n                else if (defaultValue !== undefined) {\r\n                    observer.call();\r\n                }\r\n                observer.selfSubscriber = selfSubscriber;\r\n            }\r\n            observer.publishing = true;\r\n        }\r\n    };\r\n    BindableProperty.prototype._createDynamicProperty = function (viewModel, observerLookup, behaviorHandlesBind, name, attribute, boundProperties) {\r\n        var changeHandlerName = name + 'Changed';\r\n        var selfSubscriber = null;\r\n        var observer;\r\n        var info;\r\n        if (changeHandlerName in viewModel) {\r\n            if ('propertyChanged' in viewModel) {\r\n                selfSubscriber = function (newValue, oldValue) {\r\n                    viewModel[changeHandlerName](newValue, oldValue);\r\n                    viewModel.propertyChanged(name, newValue, oldValue);\r\n                };\r\n            }\r\n            else {\r\n                selfSubscriber = function (newValue, oldValue) { return viewModel[changeHandlerName](newValue, oldValue); };\r\n            }\r\n        }\r\n        else if ('propertyChanged' in viewModel) {\r\n            selfSubscriber = function (newValue, oldValue) { return viewModel.propertyChanged(name, newValue, oldValue); };\r\n        }\r\n        observer = observerLookup[name] = new BehaviorPropertyObserver(this.owner.taskQueue, viewModel, name, selfSubscriber);\r\n        Object.defineProperty(viewModel, name, {\r\n            configurable: true,\r\n            enumerable: true,\r\n            get: observer.getValue.bind(observer),\r\n            set: observer.setValue.bind(observer)\r\n        });\r\n        if (behaviorHandlesBind) {\r\n            observer.selfSubscriber = null;\r\n        }\r\n        if (typeof attribute === 'string') {\r\n            viewModel[name] = attribute;\r\n            observer.call();\r\n        }\r\n        else if (attribute) {\r\n            info = { observer: observer, binding: attribute.createBinding(viewModel) };\r\n            boundProperties.push(info);\r\n        }\r\n        observer.publishing = true;\r\n        observer.selfSubscriber = selfSubscriber;\r\n    };\r\n    return BindableProperty;\r\n}());\n\nvar ViewLocator = (function () {\r\n    function ViewLocator() {\r\n    }\r\n    ViewLocator.prototype.getViewStrategy = function (value) {\r\n        if (!value) {\r\n            return null;\r\n        }\r\n        if (typeof value === 'object' && 'getViewStrategy' in value) {\r\n            var origin_1 = aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"Origin\"].get(value.constructor);\r\n            value = value.getViewStrategy();\r\n            if (typeof value === 'string') {\r\n                value = new RelativeViewStrategy(value);\r\n            }\r\n            viewStrategy.assert(value);\r\n            if (origin_1.moduleId) {\r\n                value.makeRelativeTo(origin_1.moduleId);\r\n            }\r\n            return value;\r\n        }\r\n        if (typeof value === 'string') {\r\n            value = new RelativeViewStrategy(value);\r\n        }\r\n        if (viewStrategy.validate(value)) {\r\n            return value;\r\n        }\r\n        if (typeof value !== 'function') {\r\n            value = value.constructor;\r\n        }\r\n        if ('$view' in value) {\r\n            var c = value.$view;\r\n            var view = void 0;\r\n            c = typeof c === 'function' ? c.call(value) : c;\r\n            if (c === null) {\r\n                view = new NoViewStrategy();\r\n            }\r\n            else {\r\n                view = c instanceof StaticViewStrategy ? c : new StaticViewStrategy(c);\r\n            }\r\n            aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].define(ViewLocator.viewStrategyMetadataKey, view, value);\r\n            return view;\r\n        }\r\n        var origin = aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"Origin\"].get(value);\r\n        var strategy = aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].get(ViewLocator.viewStrategyMetadataKey, value);\r\n        if (!strategy) {\r\n            if (!origin.moduleId) {\r\n                throw new Error('Cannot determine default view strategy for object.\\n' + value);\r\n            }\r\n            strategy = this.createFallbackViewStrategy(origin);\r\n        }\r\n        else if (origin.moduleId) {\r\n            strategy.moduleId = origin.moduleId;\r\n        }\r\n        return strategy;\r\n    };\r\n    ViewLocator.prototype.createFallbackViewStrategy = function (origin) {\r\n        return new ConventionalViewStrategy(this, origin);\r\n    };\r\n    ViewLocator.prototype.convertOriginToViewUrl = function (origin) {\r\n        var moduleId = origin.moduleId;\r\n        var id = (moduleId.endsWith('.js') || moduleId.endsWith('.ts')) ? moduleId.substring(0, moduleId.length - 3) : moduleId;\r\n        return id + '.html';\r\n    };\r\n    ViewLocator.viewStrategyMetadataKey = 'aurelia:view-strategy';\r\n    return ViewLocator;\r\n}());\n\nfunction mi(name) {\r\n    throw new Error(\"BindingLanguage must implement \".concat(name, \"().\"));\r\n}\r\nvar BindingLanguage = (function () {\r\n    function BindingLanguage() {\r\n    }\r\n    BindingLanguage.prototype.inspectAttribute = function (resources, elementName, attrName, attrValue) {\r\n        mi('inspectAttribute');\r\n    };\r\n    BindingLanguage.prototype.createAttributeInstruction = function (resources, element, info, existingInstruction, context) {\r\n        mi('createAttributeInstruction');\r\n    };\r\n    BindingLanguage.prototype.createLetExpressions = function (resources, element) {\r\n        mi('createLetExpressions');\r\n    };\r\n    BindingLanguage.prototype.inspectTextContent = function (resources, value) {\r\n        mi('inspectTextContent');\r\n    };\r\n    return BindingLanguage;\r\n}());\n\nvar noNodes = Object.freeze([]);\r\nvar SlotCustomAttribute = (function () {\r\n    function SlotCustomAttribute(element) {\r\n        this.element = element;\r\n        this.element.auSlotAttribute = this;\r\n    }\r\n    SlotCustomAttribute.inject = function () {\r\n        return [aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].Element];\r\n    };\r\n    SlotCustomAttribute.prototype.valueChanged = function (newValue, oldValue) { };\r\n    return SlotCustomAttribute;\r\n}());\r\nvar PassThroughSlot = (function () {\r\n    function PassThroughSlot(anchor, name, destinationName, fallbackFactory) {\r\n        this.anchor = anchor;\r\n        this.anchor.viewSlot = this;\r\n        this.name = name;\r\n        this.destinationName = destinationName;\r\n        this.fallbackFactory = fallbackFactory;\r\n        this.destinationSlot = null;\r\n        this.projections = 0;\r\n        this.contentView = null;\r\n        var attr = new SlotCustomAttribute(this.anchor);\r\n        attr.value = this.destinationName;\r\n    }\r\n    Object.defineProperty(PassThroughSlot.prototype, \"needsFallbackRendering\", {\r\n        get: function () {\r\n            return this.fallbackFactory && this.projections === 0;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    PassThroughSlot.prototype.renderFallbackContent = function (view, nodes, projectionSource, index) {\r\n        if (this.contentView === null) {\r\n            this.contentView = this.fallbackFactory.create(this.ownerView.container);\r\n            this.contentView.bind(this.ownerView.bindingContext, this.ownerView.overrideContext);\r\n            var slots = Object.create(null);\r\n            slots[this.destinationSlot.name] = this.destinationSlot;\r\n            ShadowDOM.distributeView(this.contentView, slots, projectionSource, index, this.destinationSlot.name);\r\n        }\r\n    };\r\n    PassThroughSlot.prototype.passThroughTo = function (destinationSlot) {\r\n        this.destinationSlot = destinationSlot;\r\n    };\r\n    PassThroughSlot.prototype.addNode = function (view, node, projectionSource, index) {\r\n        if (this.contentView !== null) {\r\n            this.contentView.removeNodes();\r\n            this.contentView.detached();\r\n            this.contentView.unbind();\r\n            this.contentView = null;\r\n        }\r\n        if (node.viewSlot instanceof PassThroughSlot) {\r\n            node.viewSlot.passThroughTo(this);\r\n            return;\r\n        }\r\n        this.projections++;\r\n        this.destinationSlot.addNode(view, node, projectionSource, index);\r\n    };\r\n    PassThroughSlot.prototype.removeView = function (view, projectionSource) {\r\n        this.projections--;\r\n        this.destinationSlot.removeView(view, projectionSource);\r\n        if (this.needsFallbackRendering) {\r\n            this.renderFallbackContent(null, noNodes, projectionSource);\r\n        }\r\n    };\r\n    PassThroughSlot.prototype.removeAll = function (projectionSource) {\r\n        this.projections = 0;\r\n        this.destinationSlot.removeAll(projectionSource);\r\n        if (this.needsFallbackRendering) {\r\n            this.renderFallbackContent(null, noNodes, projectionSource);\r\n        }\r\n    };\r\n    PassThroughSlot.prototype.projectFrom = function (view, projectionSource) {\r\n        this.destinationSlot.projectFrom(view, projectionSource);\r\n    };\r\n    PassThroughSlot.prototype.created = function (ownerView) {\r\n        this.ownerView = ownerView;\r\n    };\r\n    PassThroughSlot.prototype.bind = function (view) {\r\n        if (this.contentView) {\r\n            this.contentView.bind(view.bindingContext, view.overrideContext);\r\n        }\r\n    };\r\n    PassThroughSlot.prototype.attached = function () {\r\n        if (this.contentView) {\r\n            this.contentView.attached();\r\n        }\r\n    };\r\n    PassThroughSlot.prototype.detached = function () {\r\n        if (this.contentView) {\r\n            this.contentView.detached();\r\n        }\r\n    };\r\n    PassThroughSlot.prototype.unbind = function () {\r\n        if (this.contentView) {\r\n            this.contentView.unbind();\r\n        }\r\n    };\r\n    return PassThroughSlot;\r\n}());\r\nvar ShadowSlot = (function () {\r\n    function ShadowSlot(anchor, name, fallbackFactory) {\r\n        this.anchor = anchor;\r\n        this.anchor.isContentProjectionSource = true;\r\n        this.anchor.viewSlot = this;\r\n        this.name = name;\r\n        this.fallbackFactory = fallbackFactory;\r\n        this.contentView = null;\r\n        this.projections = 0;\r\n        this.children = [];\r\n        this.projectFromAnchors = null;\r\n        this.destinationSlots = null;\r\n    }\r\n    Object.defineProperty(ShadowSlot.prototype, \"needsFallbackRendering\", {\r\n        get: function () {\r\n            return this.fallbackFactory && this.projections === 0;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    ShadowSlot.prototype.addNode = function (view, node, projectionSource, index, destination) {\r\n        var $node = node;\r\n        if (this.contentView !== null) {\r\n            this.contentView.removeNodes();\r\n            this.contentView.detached();\r\n            this.contentView.unbind();\r\n            this.contentView = null;\r\n        }\r\n        if ($node.viewSlot instanceof PassThroughSlot) {\r\n            $node.viewSlot.passThroughTo(this);\r\n            return;\r\n        }\r\n        if (this.destinationSlots !== null) {\r\n            ShadowDOM.distributeNodes(view, [$node], this.destinationSlots, this, index);\r\n        }\r\n        else {\r\n            $node.auOwnerView = view;\r\n            $node.auProjectionSource = projectionSource;\r\n            $node.auAssignedSlot = this;\r\n            var anchor = this._findAnchor(view, $node, projectionSource, index);\r\n            var parent_1 = anchor.parentNode;\r\n            parent_1.insertBefore($node, anchor);\r\n            this.children.push($node);\r\n            this.projections++;\r\n        }\r\n    };\r\n    ShadowSlot.prototype.removeView = function (view, projectionSource) {\r\n        if (this.destinationSlots !== null) {\r\n            ShadowDOM.undistributeView(view, this.destinationSlots, this);\r\n        }\r\n        else if (this.contentView && this.contentView.hasSlots) {\r\n            ShadowDOM.undistributeView(view, this.contentView.slots, projectionSource);\r\n        }\r\n        else {\r\n            var found = this.children.find(function (x) { return x.auSlotProjectFrom === projectionSource; });\r\n            if (found) {\r\n                var children = found.auProjectionChildren;\r\n                var ownChildren = this.children;\r\n                for (var i = 0, ii = children.length; i < ii; ++i) {\r\n                    var child = children[i];\r\n                    if (child.auOwnerView === view) {\r\n                        children.splice(i, 1);\r\n                        view.fragment.appendChild(child);\r\n                        i--;\r\n                        ii--;\r\n                        this.projections--;\r\n                        var idx = ownChildren.indexOf(child);\r\n                        if (idx > -1) {\r\n                            ownChildren.splice(idx, 1);\r\n                        }\r\n                    }\r\n                }\r\n                if (this.needsFallbackRendering) {\r\n                    this.renderFallbackContent(view, noNodes, projectionSource);\r\n                }\r\n            }\r\n        }\r\n    };\r\n    ShadowSlot.prototype.removeAll = function (projectionSource) {\r\n        if (this.destinationSlots !== null) {\r\n            ShadowDOM.undistributeAll(this.destinationSlots, this);\r\n        }\r\n        else if (this.contentView && this.contentView.hasSlots) {\r\n            ShadowDOM.undistributeAll(this.contentView.slots, projectionSource);\r\n        }\r\n        else {\r\n            var found = this.children.find(function (x) { return x.auSlotProjectFrom === projectionSource; });\r\n            if (found) {\r\n                var children = found.auProjectionChildren;\r\n                var ownChildren = this.children;\r\n                for (var i = 0, ii = children.length; i < ii; ++i) {\r\n                    var child = children[i];\r\n                    child.auOwnerView.fragment.appendChild(child);\r\n                    this.projections--;\r\n                    var idx = ownChildren.indexOf(child);\r\n                    if (idx > -1) {\r\n                        ownChildren.splice(idx, 1);\r\n                    }\r\n                }\r\n                found.auProjectionChildren = [];\r\n                if (this.needsFallbackRendering) {\r\n                    this.renderFallbackContent(null, noNodes, projectionSource);\r\n                }\r\n            }\r\n        }\r\n    };\r\n    ShadowSlot.prototype._findAnchor = function (view, node, projectionSource, index) {\r\n        if (projectionSource) {\r\n            var found = this.children.find(function (x) { return x.auSlotProjectFrom === projectionSource; });\r\n            if (found) {\r\n                if (index !== undefined) {\r\n                    var children = found.auProjectionChildren;\r\n                    var viewIndex = -1;\r\n                    var lastView = void 0;\r\n                    for (var i = 0, ii = children.length; i < ii; ++i) {\r\n                        var current = children[i];\r\n                        if (current.auOwnerView !== lastView) {\r\n                            viewIndex++;\r\n                            lastView = current.auOwnerView;\r\n                            if (viewIndex >= index && lastView !== view) {\r\n                                children.splice(i, 0, node);\r\n                                return current;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                found.auProjectionChildren.push(node);\r\n                return found;\r\n            }\r\n        }\r\n        return this.anchor;\r\n    };\r\n    ShadowSlot.prototype.projectTo = function (slots) {\r\n        this.destinationSlots = slots;\r\n    };\r\n    ShadowSlot.prototype.projectFrom = function (view, projectionSource) {\r\n        var anchor = aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].createComment('anchor');\r\n        var parent = this.anchor.parentNode;\r\n        anchor.auSlotProjectFrom = projectionSource;\r\n        anchor.auOwnerView = view;\r\n        anchor.auProjectionChildren = [];\r\n        parent.insertBefore(anchor, this.anchor);\r\n        this.children.push(anchor);\r\n        if (this.projectFromAnchors === null) {\r\n            this.projectFromAnchors = [];\r\n        }\r\n        this.projectFromAnchors.push(anchor);\r\n    };\r\n    ShadowSlot.prototype.renderFallbackContent = function (view, nodes, projectionSource, index) {\r\n        if (this.contentView === null) {\r\n            this.contentView = this.fallbackFactory.create(this.ownerView.container);\r\n            this.contentView.bind(this.ownerView.bindingContext, this.ownerView.overrideContext);\r\n            this.contentView.insertNodesBefore(this.anchor);\r\n        }\r\n        if (this.contentView.hasSlots) {\r\n            var slots = this.contentView.slots;\r\n            var projectFromAnchors = this.projectFromAnchors;\r\n            if (projectFromAnchors !== null) {\r\n                for (var slotName in slots) {\r\n                    var slot = slots[slotName];\r\n                    for (var i = 0, ii = projectFromAnchors.length; i < ii; ++i) {\r\n                        var anchor = projectFromAnchors[i];\r\n                        slot.projectFrom(anchor.auOwnerView, anchor.auSlotProjectFrom);\r\n                    }\r\n                }\r\n            }\r\n            this.fallbackSlots = slots;\r\n            ShadowDOM.distributeNodes(view, nodes, slots, projectionSource, index);\r\n        }\r\n    };\r\n    ShadowSlot.prototype.created = function (ownerView) {\r\n        this.ownerView = ownerView;\r\n    };\r\n    ShadowSlot.prototype.bind = function (view) {\r\n        if (this.contentView) {\r\n            this.contentView.bind(view.bindingContext, view.overrideContext);\r\n        }\r\n    };\r\n    ShadowSlot.prototype.attached = function () {\r\n        if (this.contentView) {\r\n            this.contentView.attached();\r\n        }\r\n    };\r\n    ShadowSlot.prototype.detached = function () {\r\n        if (this.contentView) {\r\n            this.contentView.detached();\r\n        }\r\n    };\r\n    ShadowSlot.prototype.unbind = function () {\r\n        if (this.contentView) {\r\n            this.contentView.unbind();\r\n        }\r\n    };\r\n    return ShadowSlot;\r\n}());\r\nvar ShadowDOM = (function () {\r\n    function ShadowDOM() {\r\n    }\r\n    ShadowDOM.getSlotName = function (node) {\r\n        if (node.auSlotAttribute === undefined) {\r\n            return ShadowDOM.defaultSlotKey;\r\n        }\r\n        return node.auSlotAttribute.value;\r\n    };\r\n    ShadowDOM.distributeView = function (view, slots, projectionSource, index, destinationOverride) {\r\n        var nodes;\r\n        if (view === null) {\r\n            nodes = noNodes;\r\n        }\r\n        else {\r\n            var childNodes = view.fragment.childNodes;\r\n            var ii = childNodes.length;\r\n            nodes = new Array(ii);\r\n            for (var i = 0; i < ii; ++i) {\r\n                nodes[i] = childNodes[i];\r\n            }\r\n        }\r\n        ShadowDOM.distributeNodes(view, nodes, slots, projectionSource, index, destinationOverride);\r\n    };\r\n    ShadowDOM.undistributeView = function (view, slots, projectionSource) {\r\n        for (var slotName in slots) {\r\n            slots[slotName].removeView(view, projectionSource);\r\n        }\r\n    };\r\n    ShadowDOM.undistributeAll = function (slots, projectionSource) {\r\n        for (var slotName in slots) {\r\n            slots[slotName].removeAll(projectionSource);\r\n        }\r\n    };\r\n    ShadowDOM.distributeNodes = function (view, nodes, slots, projectionSource, index, destinationOverride) {\r\n        for (var i = 0, ii = nodes.length; i < ii; ++i) {\r\n            var currentNode = nodes[i];\r\n            var nodeType = currentNode.nodeType;\r\n            if (currentNode.isContentProjectionSource) {\r\n                currentNode.viewSlot.projectTo(slots);\r\n                for (var slotName in slots) {\r\n                    slots[slotName].projectFrom(view, currentNode.viewSlot);\r\n                }\r\n                nodes.splice(i, 1);\r\n                ii--;\r\n                i--;\r\n            }\r\n            else if (nodeType === 1 || nodeType === 3 || currentNode.viewSlot instanceof PassThroughSlot) {\r\n                if (nodeType === 3 && _isAllWhitespace(currentNode)) {\r\n                    nodes.splice(i, 1);\r\n                    ii--;\r\n                    i--;\r\n                }\r\n                else {\r\n                    var found = slots[destinationOverride || ShadowDOM.getSlotName(currentNode)];\r\n                    if (found) {\r\n                        found.addNode(view, currentNode, projectionSource, index);\r\n                        nodes.splice(i, 1);\r\n                        ii--;\r\n                        i--;\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                nodes.splice(i, 1);\r\n                ii--;\r\n                i--;\r\n            }\r\n        }\r\n        for (var slotName in slots) {\r\n            var slot = slots[slotName];\r\n            if (slot.needsFallbackRendering) {\r\n                slot.renderFallbackContent(view, nodes, projectionSource, index);\r\n            }\r\n        }\r\n    };\r\n    ShadowDOM.defaultSlotKey = '__au-default-slot-key__';\r\n    return ShadowDOM;\r\n}());\n\nvar CompositionTransactionNotifier = (function () {\r\n    function CompositionTransactionNotifier(owner) {\r\n        this.owner = owner;\r\n        this.owner._compositionCount++;\r\n    }\r\n    CompositionTransactionNotifier.prototype.done = function () {\r\n        this.owner._compositionCount--;\r\n        this.owner._tryCompleteTransaction();\r\n    };\r\n    return CompositionTransactionNotifier;\r\n}());\r\nvar CompositionTransactionOwnershipToken = (function () {\r\n    function CompositionTransactionOwnershipToken(owner) {\r\n        this.owner = owner;\r\n        this.owner._ownershipToken = this;\r\n        this.thenable = this._createThenable();\r\n    }\r\n    CompositionTransactionOwnershipToken.prototype.waitForCompositionComplete = function () {\r\n        this.owner._tryCompleteTransaction();\r\n        return this.thenable;\r\n    };\r\n    CompositionTransactionOwnershipToken.prototype.resolve = function () {\r\n        this._resolveCallback();\r\n    };\r\n    CompositionTransactionOwnershipToken.prototype._resolveCallback = function () {\r\n        throw new Error(\"Method not implemented.\");\r\n    };\r\n    CompositionTransactionOwnershipToken.prototype._createThenable = function () {\r\n        var _this = this;\r\n        return new Promise(function (resolve) {\r\n            _this._resolveCallback = resolve;\r\n        });\r\n    };\r\n    return CompositionTransactionOwnershipToken;\r\n}());\r\nvar CompositionTransaction = (function () {\r\n    function CompositionTransaction() {\r\n        this._ownershipToken = null;\r\n        this._compositionCount = 0;\r\n    }\r\n    CompositionTransaction.prototype.tryCapture = function () {\r\n        return this._ownershipToken === null\r\n            ? new CompositionTransactionOwnershipToken(this)\r\n            : null;\r\n    };\r\n    CompositionTransaction.prototype.enlist = function () {\r\n        return new CompositionTransactionNotifier(this);\r\n    };\r\n    CompositionTransaction.prototype._tryCompleteTransaction = function () {\r\n        if (this._compositionCount <= 0) {\r\n            this._compositionCount = 0;\r\n            if (this._ownershipToken !== null) {\r\n                var token = this._ownershipToken;\r\n                this._ownershipToken = null;\r\n                token.resolve();\r\n            }\r\n        }\r\n    };\r\n    return CompositionTransaction;\r\n}());\n\nvar View = (function () {\r\n    function View(container, viewFactory, fragment, controllers, bindings, children, slots) {\r\n        this.container = container;\r\n        this.viewFactory = viewFactory;\r\n        this.resources = viewFactory.resources;\r\n        this.fragment = fragment;\r\n        this.firstChild = fragment.firstChild;\r\n        this.lastChild = fragment.lastChild;\r\n        this.controllers = controllers;\r\n        this.bindings = bindings;\r\n        this.children = children;\r\n        this.slots = slots;\r\n        this.hasSlots = false;\r\n        this.fromCache = false;\r\n        this.isBound = false;\r\n        this.isAttached = false;\r\n        this.bindingContext = null;\r\n        this.overrideContext = null;\r\n        this.controller = null;\r\n        this.viewModelScope = null;\r\n        this.animatableElement = undefined;\r\n        this._isUserControlled = false;\r\n        this.contentView = null;\r\n        for (var _ in slots) {\r\n            this.hasSlots = true;\r\n            break;\r\n        }\r\n    }\r\n    View.prototype.returnToCache = function () {\r\n        this.viewFactory.returnViewToCache(this);\r\n    };\r\n    View.prototype.created = function () {\r\n        var i;\r\n        var ii;\r\n        var controllers = this.controllers;\r\n        for (i = 0, ii = controllers.length; i < ii; ++i) {\r\n            controllers[i].created(this);\r\n        }\r\n    };\r\n    View.prototype.bind = function (bindingContext, overrideContext, _systemUpdate) {\r\n        var controllers;\r\n        var bindings;\r\n        var children;\r\n        var i;\r\n        var ii;\r\n        if (_systemUpdate && this._isUserControlled) {\r\n            return;\r\n        }\r\n        if (this.isBound) {\r\n            if (this.bindingContext === bindingContext) {\r\n                return;\r\n            }\r\n            this.unbind();\r\n        }\r\n        this.isBound = true;\r\n        this.bindingContext = bindingContext;\r\n        this.overrideContext = overrideContext || Object(aurelia_binding__WEBPACK_IMPORTED_MODULE_5__[\"createOverrideContext\"])(bindingContext);\r\n        this.resources._invokeHook('beforeBind', this);\r\n        bindings = this.bindings;\r\n        for (i = 0, ii = bindings.length; i < ii; ++i) {\r\n            bindings[i].bind(this);\r\n        }\r\n        if (this.viewModelScope !== null) {\r\n            bindingContext.bind(this.viewModelScope.bindingContext, this.viewModelScope.overrideContext);\r\n            this.viewModelScope = null;\r\n        }\r\n        controllers = this.controllers;\r\n        for (i = 0, ii = controllers.length; i < ii; ++i) {\r\n            controllers[i].bind(this);\r\n        }\r\n        children = this.children;\r\n        for (i = 0, ii = children.length; i < ii; ++i) {\r\n            children[i].bind(bindingContext, overrideContext, true);\r\n        }\r\n        if (this.hasSlots) {\r\n            ShadowDOM.distributeView(this.contentView, this.slots);\r\n        }\r\n    };\r\n    View.prototype.addBinding = function (binding) {\r\n        this.bindings.push(binding);\r\n        if (this.isBound) {\r\n            binding.bind(this);\r\n        }\r\n    };\r\n    View.prototype.unbind = function () {\r\n        var controllers;\r\n        var bindings;\r\n        var children;\r\n        var i;\r\n        var ii;\r\n        if (this.isBound) {\r\n            this.isBound = false;\r\n            this.resources._invokeHook('beforeUnbind', this);\r\n            if (this.controller !== null) {\r\n                this.controller.unbind();\r\n            }\r\n            bindings = this.bindings;\r\n            for (i = 0, ii = bindings.length; i < ii; ++i) {\r\n                bindings[i].unbind();\r\n            }\r\n            controllers = this.controllers;\r\n            for (i = 0, ii = controllers.length; i < ii; ++i) {\r\n                controllers[i].unbind();\r\n            }\r\n            children = this.children;\r\n            for (i = 0, ii = children.length; i < ii; ++i) {\r\n                children[i].unbind();\r\n            }\r\n            this.bindingContext = null;\r\n            this.overrideContext = null;\r\n        }\r\n    };\r\n    View.prototype.insertNodesBefore = function (refNode) {\r\n        refNode.parentNode.insertBefore(this.fragment, refNode);\r\n    };\r\n    View.prototype.appendNodesTo = function (parent) {\r\n        parent.appendChild(this.fragment);\r\n    };\r\n    View.prototype.removeNodes = function () {\r\n        var fragment = this.fragment;\r\n        var current = this.firstChild;\r\n        var end = this.lastChild;\r\n        var next;\r\n        while (current) {\r\n            next = current.nextSibling;\r\n            fragment.appendChild(current);\r\n            if (current === end) {\r\n                break;\r\n            }\r\n            current = next;\r\n        }\r\n    };\r\n    View.prototype.attached = function () {\r\n        var controllers;\r\n        var children;\r\n        var i;\r\n        var ii;\r\n        if (this.isAttached) {\r\n            return;\r\n        }\r\n        this.isAttached = true;\r\n        if (this.controller !== null) {\r\n            this.controller.attached();\r\n        }\r\n        controllers = this.controllers;\r\n        for (i = 0, ii = controllers.length; i < ii; ++i) {\r\n            controllers[i].attached();\r\n        }\r\n        children = this.children;\r\n        for (i = 0, ii = children.length; i < ii; ++i) {\r\n            children[i].attached();\r\n        }\r\n    };\r\n    View.prototype.detached = function () {\r\n        var controllers;\r\n        var children;\r\n        var i;\r\n        var ii;\r\n        if (this.isAttached) {\r\n            this.isAttached = false;\r\n            if (this.controller !== null) {\r\n                this.controller.detached();\r\n            }\r\n            controllers = this.controllers;\r\n            for (i = 0, ii = controllers.length; i < ii; ++i) {\r\n                controllers[i].detached();\r\n            }\r\n            children = this.children;\r\n            for (i = 0, ii = children.length; i < ii; ++i) {\r\n                children[i].detached();\r\n            }\r\n        }\r\n    };\r\n    return View;\r\n}());\n\nvar Animator = (function () {\r\n    function Animator() {\r\n    }\r\n    Animator.prototype.enter = function (element) {\r\n        return Promise.resolve(false);\r\n    };\r\n    Animator.prototype.leave = function (element) {\r\n        return Promise.resolve(false);\r\n    };\r\n    Animator.prototype.removeClass = function (element, className) {\r\n        element.classList.remove(className);\r\n        return Promise.resolve(false);\r\n    };\r\n    Animator.prototype.addClass = function (element, className) {\r\n        element.classList.add(className);\r\n        return Promise.resolve(false);\r\n    };\r\n    Animator.prototype.animate = function (element, className) {\r\n        return Promise.resolve(false);\r\n    };\r\n    Animator.prototype.runSequence = function (animations) {\r\n        return Promise.resolve(false);\r\n    };\r\n    Animator.prototype.registerEffect = function (effectName, properties) { };\r\n    Animator.prototype.unregisterEffect = function (effectName) { };\r\n    return Animator;\r\n}());\n\nfunction getAnimatableElement(view) {\r\n    if (view.animatableElement !== undefined) {\r\n        return view.animatableElement;\r\n    }\r\n    var current = view.firstChild;\r\n    while (current && current.nodeType !== 1) {\r\n        current = current.nextSibling;\r\n    }\r\n    if (current && current.nodeType === 1) {\r\n        return (view.animatableElement = current.classList.contains('au-animate') ? current : null);\r\n    }\r\n    return (view.animatableElement = null);\r\n}\r\nvar ViewSlot = (function () {\r\n    function ViewSlot(anchor, anchorIsContainer, animator) {\r\n        if (animator === void 0) { animator = Animator.instance; }\r\n        this.anchor = anchor;\r\n        this.anchorIsContainer = anchorIsContainer;\r\n        this.bindingContext = null;\r\n        this.overrideContext = null;\r\n        this.animator = animator;\r\n        this.children = [];\r\n        this.isBound = false;\r\n        this.isAttached = false;\r\n        this.contentSelectors = null;\r\n        anchor.viewSlot = this;\r\n        anchor.isContentProjectionSource = false;\r\n    }\r\n    ViewSlot.prototype.animateView = function (view, direction) {\r\n        if (direction === void 0) { direction = 'enter'; }\r\n        var animatableElement = getAnimatableElement(view);\r\n        if (animatableElement !== null) {\r\n            switch (direction) {\r\n                case 'enter':\r\n                    return this.animator.enter(animatableElement);\r\n                case 'leave':\r\n                    return this.animator.leave(animatableElement);\r\n                default:\r\n                    throw new Error('Invalid animation direction: ' + direction);\r\n            }\r\n        }\r\n    };\r\n    ViewSlot.prototype.transformChildNodesIntoView = function () {\r\n        var parent = this.anchor;\r\n        this.children.push({\r\n            fragment: parent,\r\n            firstChild: parent.firstChild,\r\n            lastChild: parent.lastChild,\r\n            returnToCache: function () { },\r\n            removeNodes: function () {\r\n                var last;\r\n                while (last = parent.lastChild) {\r\n                    parent.removeChild(last);\r\n                }\r\n            },\r\n            created: function () { },\r\n            bind: function () { },\r\n            unbind: function () { },\r\n            attached: function () { },\r\n            detached: function () { }\r\n        });\r\n    };\r\n    ViewSlot.prototype.bind = function (bindingContext, overrideContext) {\r\n        var i;\r\n        var ii;\r\n        var children;\r\n        if (this.isBound) {\r\n            if (this.bindingContext === bindingContext) {\r\n                return;\r\n            }\r\n            this.unbind();\r\n        }\r\n        this.isBound = true;\r\n        this.bindingContext = bindingContext = bindingContext || this.bindingContext;\r\n        this.overrideContext = overrideContext = overrideContext || this.overrideContext;\r\n        children = this.children;\r\n        for (i = 0, ii = children.length; i < ii; ++i) {\r\n            children[i].bind(bindingContext, overrideContext, true);\r\n        }\r\n    };\r\n    ViewSlot.prototype.unbind = function () {\r\n        if (this.isBound) {\r\n            var i = void 0;\r\n            var ii = void 0;\r\n            var children = this.children;\r\n            this.isBound = false;\r\n            this.bindingContext = null;\r\n            this.overrideContext = null;\r\n            for (i = 0, ii = children.length; i < ii; ++i) {\r\n                children[i].unbind();\r\n            }\r\n        }\r\n    };\r\n    ViewSlot.prototype.add = function (view) {\r\n        if (this.anchorIsContainer) {\r\n            view.appendNodesTo(this.anchor);\r\n        }\r\n        else {\r\n            view.insertNodesBefore(this.anchor);\r\n        }\r\n        this.children.push(view);\r\n        if (this.isAttached) {\r\n            view.attached();\r\n            return this.animateView(view, 'enter');\r\n        }\r\n    };\r\n    ViewSlot.prototype.insert = function (index, view) {\r\n        var children = this.children;\r\n        var length = children.length;\r\n        if ((index === 0 && length === 0) || index >= length) {\r\n            return this.add(view);\r\n        }\r\n        view.insertNodesBefore(children[index].firstChild);\r\n        children.splice(index, 0, view);\r\n        if (this.isAttached) {\r\n            view.attached();\r\n            return this.animateView(view, 'enter');\r\n        }\r\n    };\r\n    ViewSlot.prototype.move = function (sourceIndex, targetIndex) {\r\n        if (sourceIndex === targetIndex) {\r\n            return;\r\n        }\r\n        var children = this.children;\r\n        var view = children[sourceIndex];\r\n        view.removeNodes();\r\n        view.insertNodesBefore(children[targetIndex].firstChild);\r\n        children.splice(sourceIndex, 1);\r\n        children.splice(targetIndex, 0, view);\r\n    };\r\n    ViewSlot.prototype.remove = function (view, returnToCache, skipAnimation) {\r\n        return this.removeAt(this.children.indexOf(view), returnToCache, skipAnimation);\r\n    };\r\n    ViewSlot.prototype.removeMany = function (viewsToRemove, returnToCache, skipAnimation) {\r\n        var _this = this;\r\n        var children = this.children;\r\n        var ii = viewsToRemove.length;\r\n        var i;\r\n        var rmPromises = [];\r\n        viewsToRemove.forEach(function (child) {\r\n            if (skipAnimation) {\r\n                child.removeNodes();\r\n                return;\r\n            }\r\n            var animation = _this.animateView(child, 'leave');\r\n            if (animation) {\r\n                rmPromises.push(animation.then(function () { return child.removeNodes(); }));\r\n            }\r\n            else {\r\n                child.removeNodes();\r\n            }\r\n        });\r\n        var removeAction = function () {\r\n            if (_this.isAttached) {\r\n                for (i = 0; i < ii; ++i) {\r\n                    viewsToRemove[i].detached();\r\n                }\r\n            }\r\n            if (returnToCache) {\r\n                for (i = 0; i < ii; ++i) {\r\n                    viewsToRemove[i].returnToCache();\r\n                }\r\n            }\r\n            for (i = 0; i < ii; ++i) {\r\n                var index = children.indexOf(viewsToRemove[i]);\r\n                if (index >= 0) {\r\n                    children.splice(index, 1);\r\n                }\r\n            }\r\n        };\r\n        if (rmPromises.length > 0) {\r\n            return Promise.all(rmPromises).then(function () { return removeAction(); });\r\n        }\r\n        return removeAction();\r\n    };\r\n    ViewSlot.prototype.removeAt = function (index, returnToCache, skipAnimation) {\r\n        var _this = this;\r\n        var view = this.children[index];\r\n        var removeAction = function () {\r\n            index = _this.children.indexOf(view);\r\n            view.removeNodes();\r\n            _this.children.splice(index, 1);\r\n            if (_this.isAttached) {\r\n                view.detached();\r\n            }\r\n            if (returnToCache) {\r\n                view.returnToCache();\r\n            }\r\n            return view;\r\n        };\r\n        if (!skipAnimation) {\r\n            var animation = this.animateView(view, 'leave');\r\n            if (animation) {\r\n                return animation.then(function () { return removeAction(); });\r\n            }\r\n        }\r\n        return removeAction();\r\n    };\r\n    ViewSlot.prototype.removeAll = function (returnToCache, skipAnimation) {\r\n        var _this = this;\r\n        var children = this.children;\r\n        var ii = children.length;\r\n        var i;\r\n        var rmPromises = [];\r\n        children.forEach(function (child) {\r\n            if (skipAnimation) {\r\n                child.removeNodes();\r\n                return;\r\n            }\r\n            var animation = _this.animateView(child, 'leave');\r\n            if (animation) {\r\n                rmPromises.push(animation.then(function () { return child.removeNodes(); }));\r\n            }\r\n            else {\r\n                child.removeNodes();\r\n            }\r\n        });\r\n        var removeAction = function () {\r\n            if (_this.isAttached) {\r\n                for (i = 0; i < ii; ++i) {\r\n                    children[i].detached();\r\n                }\r\n            }\r\n            if (returnToCache) {\r\n                for (i = 0; i < ii; ++i) {\r\n                    var child = children[i];\r\n                    if (child) {\r\n                        child.returnToCache();\r\n                    }\r\n                }\r\n            }\r\n            _this.children = [];\r\n        };\r\n        if (rmPromises.length > 0) {\r\n            return Promise.all(rmPromises).then(function () { return removeAction(); });\r\n        }\r\n        return removeAction();\r\n    };\r\n    ViewSlot.prototype.attached = function () {\r\n        var i;\r\n        var ii;\r\n        var children;\r\n        var child;\r\n        if (this.isAttached) {\r\n            return;\r\n        }\r\n        this.isAttached = true;\r\n        children = this.children;\r\n        for (i = 0, ii = children.length; i < ii; ++i) {\r\n            child = children[i];\r\n            child.attached();\r\n            this.animateView(child, 'enter');\r\n        }\r\n    };\r\n    ViewSlot.prototype.detached = function () {\r\n        var i;\r\n        var ii;\r\n        var children;\r\n        if (this.isAttached) {\r\n            this.isAttached = false;\r\n            children = this.children;\r\n            for (i = 0, ii = children.length; i < ii; ++i) {\r\n                children[i].detached();\r\n            }\r\n        }\r\n    };\r\n    ViewSlot.prototype.projectTo = function (slots) {\r\n        var _this = this;\r\n        this.projectToSlots = slots;\r\n        this.add = this._projectionAdd;\r\n        this.insert = this._projectionInsert;\r\n        this.move = this._projectionMove;\r\n        this.remove = this._projectionRemove;\r\n        this.removeAt = this._projectionRemoveAt;\r\n        this.removeMany = this._projectionRemoveMany;\r\n        this.removeAll = this._projectionRemoveAll;\r\n        this.children.forEach(function (view) { return ShadowDOM.distributeView(view, slots, _this); });\r\n    };\r\n    ViewSlot.prototype._projectionAdd = function (view) {\r\n        ShadowDOM.distributeView(view, this.projectToSlots, this);\r\n        this.children.push(view);\r\n        if (this.isAttached) {\r\n            view.attached();\r\n        }\r\n    };\r\n    ViewSlot.prototype._projectionInsert = function (index, view) {\r\n        if ((index === 0 && !this.children.length) || index >= this.children.length) {\r\n            this.add(view);\r\n        }\r\n        else {\r\n            ShadowDOM.distributeView(view, this.projectToSlots, this, index);\r\n            this.children.splice(index, 0, view);\r\n            if (this.isAttached) {\r\n                view.attached();\r\n            }\r\n        }\r\n    };\r\n    ViewSlot.prototype._projectionMove = function (sourceIndex, targetIndex) {\r\n        if (sourceIndex === targetIndex) {\r\n            return;\r\n        }\r\n        var children = this.children;\r\n        var view = children[sourceIndex];\r\n        ShadowDOM.undistributeView(view, this.projectToSlots, this);\r\n        ShadowDOM.distributeView(view, this.projectToSlots, this, targetIndex);\r\n        children.splice(sourceIndex, 1);\r\n        children.splice(targetIndex, 0, view);\r\n    };\r\n    ViewSlot.prototype._projectionRemove = function (view, returnToCache) {\r\n        ShadowDOM.undistributeView(view, this.projectToSlots, this);\r\n        this.children.splice(this.children.indexOf(view), 1);\r\n        if (this.isAttached) {\r\n            view.detached();\r\n        }\r\n        if (returnToCache) {\r\n            view.returnToCache();\r\n        }\r\n    };\r\n    ViewSlot.prototype._projectionRemoveAt = function (index, returnToCache) {\r\n        var view = this.children[index];\r\n        ShadowDOM.undistributeView(view, this.projectToSlots, this);\r\n        this.children.splice(index, 1);\r\n        if (this.isAttached) {\r\n            view.detached();\r\n        }\r\n        if (returnToCache) {\r\n            view.returnToCache();\r\n        }\r\n    };\r\n    ViewSlot.prototype._projectionRemoveMany = function (viewsToRemove, returnToCache) {\r\n        var _this = this;\r\n        viewsToRemove.forEach(function (view) { return _this.remove(view, returnToCache); });\r\n    };\r\n    ViewSlot.prototype._projectionRemoveAll = function (returnToCache) {\r\n        ShadowDOM.undistributeAll(this.projectToSlots, this);\r\n        var children = this.children;\r\n        var ii = children.length;\r\n        for (var i = 0; i < ii; ++i) {\r\n            if (returnToCache) {\r\n                children[i].returnToCache();\r\n            }\r\n            else if (this.isAttached) {\r\n                children[i].detached();\r\n            }\r\n        }\r\n        this.children = [];\r\n    };\r\n    return ViewSlot;\r\n}());\n\nvar $resolver = aurelia_dependency_injection__WEBPACK_IMPORTED_MODULE_6__[\"resolver\"];\r\nvar ProviderResolver = (function () {\r\n    function ProviderResolver() {\r\n    }\r\n    ProviderResolver.prototype.get = function (container, key) {\r\n        var id = key.__providerId__;\r\n        return id in container ? container[id] : (container[id] = container.invoke(key));\r\n    };\r\n    ProviderResolver = __decorate([\r\n        $resolver\r\n    ], ProviderResolver);\r\n    return ProviderResolver;\r\n}());\r\nvar providerResolverInstance = new ProviderResolver();\r\nfunction elementContainerGet(key) {\r\n    if (key === aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].Element) {\r\n        return this.element;\r\n    }\r\n    if (key === BoundViewFactory) {\r\n        if (this.boundViewFactory) {\r\n            return this.boundViewFactory;\r\n        }\r\n        var factory = this.instruction.viewFactory;\r\n        var partReplacements = this.partReplacements;\r\n        if (partReplacements) {\r\n            factory = partReplacements[factory.part] || factory;\r\n        }\r\n        this.boundViewFactory = new BoundViewFactory(this, factory, partReplacements);\r\n        return this.boundViewFactory;\r\n    }\r\n    if (key === ViewSlot) {\r\n        if (this.viewSlot === undefined) {\r\n            this.viewSlot = new ViewSlot(this.element, this.instruction.anchorIsContainer);\r\n            this.element.isContentProjectionSource = this.instruction.lifting;\r\n            this.children.push(this.viewSlot);\r\n        }\r\n        return this.viewSlot;\r\n    }\r\n    if (key === ElementEvents) {\r\n        return this.elementEvents || (this.elementEvents = new ElementEvents(this.element));\r\n    }\r\n    if (key === CompositionTransaction) {\r\n        return this.compositionTransaction || (this.compositionTransaction = this.parent.get(key));\r\n    }\r\n    if (key === ViewResources) {\r\n        return this.viewResources;\r\n    }\r\n    if (key === TargetInstruction) {\r\n        return this.instruction;\r\n    }\r\n    return this.superGet(key);\r\n}\r\nfunction createElementContainer(parent, element, instruction, children, partReplacements, resources) {\r\n    var container = parent.createChild();\r\n    var providers;\r\n    var i;\r\n    container.element = element;\r\n    container.instruction = instruction;\r\n    container.children = children;\r\n    container.viewResources = resources;\r\n    container.partReplacements = partReplacements;\r\n    providers = instruction.providers;\r\n    i = providers.length;\r\n    while (i--) {\r\n        container._resolvers.set(providers[i], providerResolverInstance);\r\n    }\r\n    container.superGet = container.get;\r\n    container.get = elementContainerGet;\r\n    return container;\r\n}\r\nfunction hasAttribute(name) {\r\n    return this._element.hasAttribute(name);\r\n}\r\nfunction getAttribute(name) {\r\n    return this._element.getAttribute(name);\r\n}\r\nfunction setAttribute(name, value) {\r\n    this._element.setAttribute(name, value);\r\n}\r\nfunction makeElementIntoAnchor(element, elementInstruction) {\r\n    var anchor = aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].createComment('anchor');\r\n    if (elementInstruction) {\r\n        var firstChild = element.firstChild;\r\n        if (firstChild && firstChild.tagName === 'AU-CONTENT') {\r\n            anchor.contentElement = firstChild;\r\n        }\r\n        anchor._element = element;\r\n        anchor.hasAttribute = hasAttribute;\r\n        anchor.getAttribute = getAttribute;\r\n        anchor.setAttribute = setAttribute;\r\n    }\r\n    aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].replaceNode(anchor, element);\r\n    return anchor;\r\n}\r\nfunction applyInstructions(containers, element, instruction, controllers, bindings, children, shadowSlots, partReplacements, resources) {\r\n    var behaviorInstructions = instruction.behaviorInstructions;\r\n    var expressions = instruction.expressions;\r\n    var elementContainer;\r\n    var i;\r\n    var ii;\r\n    var current;\r\n    var instance;\r\n    if (instruction.contentExpression) {\r\n        bindings.push(instruction.contentExpression.createBinding(element.nextSibling));\r\n        element.nextSibling.auInterpolationTarget = true;\r\n        element.parentNode.removeChild(element);\r\n        return;\r\n    }\r\n    if (instruction.shadowSlot) {\r\n        var commentAnchor = aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].createComment('slot');\r\n        var slot = void 0;\r\n        if (instruction.slotDestination) {\r\n            slot = new PassThroughSlot(commentAnchor, instruction.slotName, instruction.slotDestination, instruction.slotFallbackFactory);\r\n        }\r\n        else {\r\n            slot = new ShadowSlot(commentAnchor, instruction.slotName, instruction.slotFallbackFactory);\r\n        }\r\n        aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].replaceNode(commentAnchor, element);\r\n        shadowSlots[instruction.slotName] = slot;\r\n        controllers.push(slot);\r\n        return;\r\n    }\r\n    if (instruction.letElement) {\r\n        for (i = 0, ii = expressions.length; i < ii; ++i) {\r\n            bindings.push(expressions[i].createBinding());\r\n        }\r\n        element.parentNode.removeChild(element);\r\n        return;\r\n    }\r\n    if (behaviorInstructions.length) {\r\n        if (!instruction.anchorIsContainer) {\r\n            element = makeElementIntoAnchor(element, instruction.elementInstruction);\r\n        }\r\n        containers[instruction.injectorId] = elementContainer =\r\n            createElementContainer(containers[instruction.parentInjectorId], element, instruction, children, partReplacements, resources);\r\n        for (i = 0, ii = behaviorInstructions.length; i < ii; ++i) {\r\n            current = behaviorInstructions[i];\r\n            instance = current.type.create(elementContainer, current, element, bindings);\r\n            controllers.push(instance);\r\n        }\r\n    }\r\n    for (i = 0, ii = expressions.length; i < ii; ++i) {\r\n        bindings.push(expressions[i].createBinding(element));\r\n    }\r\n}\r\nfunction styleStringToObject(style, target) {\r\n    var attributes = style.split(';');\r\n    var firstIndexOfColon;\r\n    var i;\r\n    var current;\r\n    var key;\r\n    var value;\r\n    target = target || {};\r\n    for (i = 0; i < attributes.length; i++) {\r\n        current = attributes[i];\r\n        firstIndexOfColon = current.indexOf(':');\r\n        key = current.substring(0, firstIndexOfColon).trim();\r\n        value = current.substring(firstIndexOfColon + 1).trim();\r\n        target[key] = value;\r\n    }\r\n    return target;\r\n}\r\nfunction styleObjectToString(obj) {\r\n    var result = '';\r\n    for (var key in obj) {\r\n        result += key + ':' + obj[key] + ';';\r\n    }\r\n    return result;\r\n}\r\nfunction applySurrogateInstruction(container, element, instruction, controllers, bindings, children) {\r\n    var behaviorInstructions = instruction.behaviorInstructions;\r\n    var expressions = instruction.expressions;\r\n    var providers = instruction.providers;\r\n    var values = instruction.values;\r\n    var i;\r\n    var ii;\r\n    var current;\r\n    var instance;\r\n    var currentAttributeValue;\r\n    i = providers.length;\r\n    while (i--) {\r\n        container._resolvers.set(providers[i], providerResolverInstance);\r\n    }\r\n    for (var key in values) {\r\n        currentAttributeValue = element.getAttribute(key);\r\n        if (currentAttributeValue) {\r\n            if (key === 'class') {\r\n                element.setAttribute('class', currentAttributeValue + ' ' + values[key]);\r\n            }\r\n            else if (key === 'style') {\r\n                var styleObject = styleStringToObject(values[key]);\r\n                styleStringToObject(currentAttributeValue, styleObject);\r\n                element.setAttribute('style', styleObjectToString(styleObject));\r\n            }\r\n        }\r\n        else {\r\n            element.setAttribute(key, values[key]);\r\n        }\r\n    }\r\n    if (behaviorInstructions.length) {\r\n        for (i = 0, ii = behaviorInstructions.length; i < ii; ++i) {\r\n            current = behaviorInstructions[i];\r\n            instance = current.type.create(container, current, element, bindings);\r\n            if (instance.contentView) {\r\n                children.push(instance.contentView);\r\n            }\r\n            controllers.push(instance);\r\n        }\r\n    }\r\n    for (i = 0, ii = expressions.length; i < ii; ++i) {\r\n        bindings.push(expressions[i].createBinding(element));\r\n    }\r\n}\r\nvar BoundViewFactory = (function () {\r\n    function BoundViewFactory(parentContainer, viewFactory, partReplacements) {\r\n        this.parentContainer = parentContainer;\r\n        this.viewFactory = viewFactory;\r\n        this.factoryCreateInstruction = { partReplacements: partReplacements };\r\n    }\r\n    BoundViewFactory.prototype.create = function () {\r\n        var view = this.viewFactory.create(this.parentContainer.createChild(), this.factoryCreateInstruction);\r\n        view._isUserControlled = true;\r\n        return view;\r\n    };\r\n    Object.defineProperty(BoundViewFactory.prototype, \"isCaching\", {\r\n        get: function () {\r\n            return this.viewFactory.isCaching;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    BoundViewFactory.prototype.setCacheSize = function (size, doNotOverrideIfAlreadySet) {\r\n        this.viewFactory.setCacheSize(size, doNotOverrideIfAlreadySet);\r\n    };\r\n    BoundViewFactory.prototype.getCachedView = function () {\r\n        return this.viewFactory.getCachedView();\r\n    };\r\n    BoundViewFactory.prototype.returnViewToCache = function (view) {\r\n        this.viewFactory.returnViewToCache(view);\r\n    };\r\n    return BoundViewFactory;\r\n}());\r\nvar ViewFactory = (function () {\r\n    function ViewFactory(template, instructions, resources) {\r\n        this.isCaching = false;\r\n        this.template = template;\r\n        this.instructions = instructions;\r\n        this.resources = resources;\r\n        this.cacheSize = -1;\r\n        this.cache = null;\r\n    }\r\n    ViewFactory.prototype.setCacheSize = function (size, doNotOverrideIfAlreadySet) {\r\n        if (size) {\r\n            if (size === '*') {\r\n                size = Number.MAX_VALUE;\r\n            }\r\n            else if (typeof size === 'string') {\r\n                size = parseInt(size, 10);\r\n            }\r\n        }\r\n        if (this.cacheSize === -1 || !doNotOverrideIfAlreadySet) {\r\n            this.cacheSize = Number(size);\r\n        }\r\n        if (this.cacheSize > 0) {\r\n            this.cache = [];\r\n        }\r\n        else {\r\n            this.cache = null;\r\n        }\r\n        this.isCaching = this.cacheSize > 0;\r\n    };\r\n    ViewFactory.prototype.getCachedView = function () {\r\n        return this.cache !== null ? (this.cache.pop() || null) : null;\r\n    };\r\n    ViewFactory.prototype.returnViewToCache = function (view) {\r\n        if (view.isAttached) {\r\n            view.detached();\r\n        }\r\n        if (view.isBound) {\r\n            view.unbind();\r\n        }\r\n        if (this.cache !== null && this.cache.length < this.cacheSize) {\r\n            view.fromCache = true;\r\n            this.cache.push(view);\r\n        }\r\n    };\r\n    ViewFactory.prototype.create = function (container, createInstruction, element) {\r\n        createInstruction = createInstruction || BehaviorInstruction.normal;\r\n        var cachedView = this.getCachedView();\r\n        if (cachedView !== null) {\r\n            return cachedView;\r\n        }\r\n        var fragment = createInstruction.enhance ? this.template : this.template.cloneNode(true);\r\n        var instructables = fragment.querySelectorAll('.au-target');\r\n        var instructions = this.instructions;\r\n        var resources = this.resources;\r\n        var controllers = [];\r\n        var bindings = [];\r\n        var children = [];\r\n        var shadowSlots = Object.create(null);\r\n        var containers = { root: container };\r\n        var partReplacements = createInstruction.partReplacements;\r\n        var i;\r\n        var ii;\r\n        var view;\r\n        var instructable;\r\n        var instruction;\r\n        this.resources._invokeHook('beforeCreate', this, container, fragment, createInstruction);\r\n        if (element && this.surrogateInstruction !== null) {\r\n            applySurrogateInstruction(container, element, this.surrogateInstruction, controllers, bindings, children);\r\n        }\r\n        if (createInstruction.enhance && fragment.hasAttribute('au-target-id')) {\r\n            instructable = fragment;\r\n            instruction = instructions[instructable.getAttribute('au-target-id')];\r\n            applyInstructions(containers, instructable, instruction, controllers, bindings, children, shadowSlots, partReplacements, resources);\r\n        }\r\n        for (i = 0, ii = instructables.length; i < ii; ++i) {\r\n            instructable = instructables[i];\r\n            instruction = instructions[instructable.getAttribute('au-target-id')];\r\n            applyInstructions(containers, instructable, instruction, controllers, bindings, children, shadowSlots, partReplacements, resources);\r\n        }\r\n        view = new View(container, this, fragment, controllers, bindings, children, shadowSlots);\r\n        if (!createInstruction.initiatedByBehavior) {\r\n            view.created();\r\n        }\r\n        this.resources._invokeHook('afterCreate', view);\r\n        return view;\r\n    };\r\n    return ViewFactory;\r\n}());\n\nvar nextInjectorId = 0;\r\nfunction getNextInjectorId() {\r\n    return ++nextInjectorId;\r\n}\r\nvar lastAUTargetID = 0;\r\nfunction getNextAUTargetID() {\r\n    return (++lastAUTargetID).toString();\r\n}\r\nfunction makeIntoInstructionTarget(element) {\r\n    var value = element.getAttribute('class');\r\n    var auTargetID = getNextAUTargetID();\r\n    element.setAttribute('class', (value ? value + ' au-target' : 'au-target'));\r\n    element.setAttribute('au-target-id', auTargetID);\r\n    return auTargetID;\r\n}\r\nfunction makeShadowSlot(compiler, resources, node, instructions, parentInjectorId) {\r\n    var auShadowSlot = aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].createElement('au-shadow-slot');\r\n    aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].replaceNode(auShadowSlot, node);\r\n    var auTargetID = makeIntoInstructionTarget(auShadowSlot);\r\n    var instruction = TargetInstruction.shadowSlot(parentInjectorId);\r\n    instruction.slotName = node.getAttribute('name') || ShadowDOM.defaultSlotKey;\r\n    instruction.slotDestination = node.getAttribute('slot');\r\n    if (node.innerHTML.trim()) {\r\n        var fragment = aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].createDocumentFragment();\r\n        var child = void 0;\r\n        while (child = node.firstChild) {\r\n            fragment.appendChild(child);\r\n        }\r\n        instruction.slotFallbackFactory = compiler.compile(fragment, resources);\r\n    }\r\n    instructions[auTargetID] = instruction;\r\n    return auShadowSlot;\r\n}\r\nvar defaultLetHandler = BindingLanguage.prototype.createLetExpressions;\r\nvar ViewCompiler = (function () {\r\n    function ViewCompiler(bindingLanguage, resources) {\r\n        this.bindingLanguage = bindingLanguage;\r\n        this.resources = resources;\r\n    }\r\n    ViewCompiler.inject = function () {\r\n        return [BindingLanguage, ViewResources];\r\n    };\r\n    ViewCompiler.prototype.compile = function (source, resources, compileInstruction) {\r\n        resources = resources || this.resources;\r\n        compileInstruction = compileInstruction || ViewCompileInstruction.normal;\r\n        source = typeof source === 'string' ? aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].createTemplateFromMarkup(source) : source;\r\n        var content;\r\n        var part;\r\n        var cacheSize;\r\n        if (source.content) {\r\n            part = source.getAttribute('part');\r\n            cacheSize = source.getAttribute('view-cache');\r\n            content = aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].adoptNode(source.content);\r\n        }\r\n        else {\r\n            content = source;\r\n        }\r\n        compileInstruction.targetShadowDOM = compileInstruction.targetShadowDOM && aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"FEATURE\"].shadowDOM;\r\n        resources._invokeHook('beforeCompile', content, resources, compileInstruction);\r\n        var instructions = {};\r\n        this._compileNode(content, resources, instructions, source, 'root', !compileInstruction.targetShadowDOM);\r\n        var firstChild = content.firstChild;\r\n        if (firstChild && firstChild.nodeType === 1) {\r\n            var targetId = firstChild.getAttribute('au-target-id');\r\n            if (targetId) {\r\n                var ins = instructions[targetId];\r\n                if (ins.shadowSlot || ins.lifting || (ins.elementInstruction && !ins.elementInstruction.anchorIsContainer)) {\r\n                    content.insertBefore(aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].createComment('view'), firstChild);\r\n                }\r\n            }\r\n        }\r\n        var factory = new ViewFactory(content, instructions, resources);\r\n        factory.surrogateInstruction = compileInstruction.compileSurrogate ? this._compileSurrogate(source, resources) : null;\r\n        factory.part = part;\r\n        if (cacheSize) {\r\n            factory.setCacheSize(cacheSize);\r\n        }\r\n        resources._invokeHook('afterCompile', factory);\r\n        return factory;\r\n    };\r\n    ViewCompiler.prototype._compileNode = function (node, resources, instructions, parentNode, parentInjectorId, targetLightDOM) {\r\n        switch (node.nodeType) {\r\n            case 1:\r\n                return this._compileElement(node, resources, instructions, parentNode, parentInjectorId, targetLightDOM);\r\n            case 3:\r\n                var expression = resources.getBindingLanguage(this.bindingLanguage).inspectTextContent(resources, node.wholeText);\r\n                if (expression) {\r\n                    var marker = aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].createElement('au-marker');\r\n                    var auTargetID = makeIntoInstructionTarget(marker);\r\n                    (node.parentNode || parentNode).insertBefore(marker, node);\r\n                    node.textContent = ' ';\r\n                    instructions[auTargetID] = TargetInstruction.contentExpression(expression);\r\n                    while (node.nextSibling && node.nextSibling.nodeType === 3) {\r\n                        (node.parentNode || parentNode).removeChild(node.nextSibling);\r\n                    }\r\n                }\r\n                else {\r\n                    while (node.nextSibling && node.nextSibling.nodeType === 3) {\r\n                        node = node.nextSibling;\r\n                    }\r\n                }\r\n                return node.nextSibling;\r\n            case 11:\r\n                var currentChild = node.firstChild;\r\n                while (currentChild) {\r\n                    currentChild = this._compileNode(currentChild, resources, instructions, node, parentInjectorId, targetLightDOM);\r\n                }\r\n                break;\r\n        }\r\n        return node.nextSibling;\r\n    };\r\n    ViewCompiler.prototype._compileSurrogate = function (node, resources) {\r\n        var tagName = node.tagName.toLowerCase();\r\n        var attributes = node.attributes;\r\n        var bindingLanguage = resources.getBindingLanguage(this.bindingLanguage);\r\n        var knownAttribute;\r\n        var property;\r\n        var instruction;\r\n        var i;\r\n        var ii;\r\n        var attr;\r\n        var attrName;\r\n        var attrValue;\r\n        var info;\r\n        var type;\r\n        var expressions = [];\r\n        var expression;\r\n        var behaviorInstructions = [];\r\n        var values = {};\r\n        var hasValues = false;\r\n        var providers = [];\r\n        for (i = 0, ii = attributes.length; i < ii; ++i) {\r\n            attr = attributes[i];\r\n            attrName = attr.name;\r\n            attrValue = attr.value;\r\n            info = bindingLanguage.inspectAttribute(resources, tagName, attrName, attrValue);\r\n            type = resources.getAttribute(info.attrName);\r\n            if (type) {\r\n                knownAttribute = resources.mapAttribute(info.attrName);\r\n                if (knownAttribute) {\r\n                    property = type.attributes[knownAttribute];\r\n                    if (property) {\r\n                        info.defaultBindingMode = property.defaultBindingMode;\r\n                        if (!info.command && !info.expression) {\r\n                            info.command = property.hasOptions ? 'options' : null;\r\n                        }\r\n                        if (info.command && (info.command !== 'options') && type.primaryProperty) {\r\n                            var primaryProperty = type.primaryProperty;\r\n                            attrName = info.attrName = primaryProperty.attribute;\r\n                            info.defaultBindingMode = primaryProperty.defaultBindingMode;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            instruction = bindingLanguage.createAttributeInstruction(resources, node, info, undefined, type);\r\n            if (instruction) {\r\n                if (instruction.alteredAttr) {\r\n                    type = resources.getAttribute(instruction.attrName);\r\n                }\r\n                if (instruction.discrete) {\r\n                    expressions.push(instruction);\r\n                }\r\n                else {\r\n                    if (type) {\r\n                        instruction.type = type;\r\n                        this._configureProperties(instruction, resources);\r\n                        if (type.liftsContent) {\r\n                            throw new Error('You cannot place a template controller on a surrogate element.');\r\n                        }\r\n                        else {\r\n                            behaviorInstructions.push(instruction);\r\n                        }\r\n                    }\r\n                    else {\r\n                        expressions.push(instruction.attributes[instruction.attrName]);\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                if (type) {\r\n                    instruction = BehaviorInstruction.attribute(attrName, type);\r\n                    instruction.attributes[resources.mapAttribute(attrName)] = attrValue;\r\n                    if (type.liftsContent) {\r\n                        throw new Error('You cannot place a template controller on a surrogate element.');\r\n                    }\r\n                    else {\r\n                        behaviorInstructions.push(instruction);\r\n                    }\r\n                }\r\n                else if (attrName !== 'id' && attrName !== 'part' && attrName !== 'replace-part') {\r\n                    hasValues = true;\r\n                    values[attrName] = attrValue;\r\n                }\r\n            }\r\n        }\r\n        if (expressions.length || behaviorInstructions.length || hasValues) {\r\n            for (i = 0, ii = behaviorInstructions.length; i < ii; ++i) {\r\n                instruction = behaviorInstructions[i];\r\n                instruction.type.compile(this, resources, node, instruction);\r\n                providers.push(instruction.type.target);\r\n            }\r\n            for (i = 0, ii = expressions.length; i < ii; ++i) {\r\n                expression = expressions[i];\r\n                if (expression.attrToRemove !== undefined) {\r\n                    node.removeAttribute(expression.attrToRemove);\r\n                }\r\n            }\r\n            return TargetInstruction.surrogate(providers, behaviorInstructions, expressions, values);\r\n        }\r\n        return null;\r\n    };\r\n    ViewCompiler.prototype._compileElement = function (node, resources, instructions, parentNode, parentInjectorId, targetLightDOM) {\r\n        var tagName = node.tagName.toLowerCase();\r\n        var attributes = node.attributes;\r\n        var expressions = [];\r\n        var expression;\r\n        var behaviorInstructions = [];\r\n        var providers = [];\r\n        var bindingLanguage = resources.getBindingLanguage(this.bindingLanguage);\r\n        var liftingInstruction;\r\n        var viewFactory;\r\n        var type;\r\n        var elementInstruction;\r\n        var elementProperty;\r\n        var i;\r\n        var ii;\r\n        var attr;\r\n        var attrName;\r\n        var attrValue;\r\n        var originalAttrName;\r\n        var instruction;\r\n        var info;\r\n        var property;\r\n        var knownAttribute;\r\n        var auTargetID;\r\n        var injectorId;\r\n        if (tagName === 'slot') {\r\n            if (targetLightDOM) {\r\n                node = makeShadowSlot(this, resources, node, instructions, parentInjectorId);\r\n            }\r\n            return node.nextSibling;\r\n        }\r\n        else if (tagName === 'template') {\r\n            if (!('content' in node)) {\r\n                throw new Error('You cannot place a template element within ' + node.namespaceURI + ' namespace');\r\n            }\r\n            viewFactory = this.compile(node, resources);\r\n            viewFactory.part = node.getAttribute('part');\r\n        }\r\n        else {\r\n            type = resources.getElement(node.getAttribute('as-element') || tagName);\r\n            if (tagName === 'let' && !type && bindingLanguage.createLetExpressions !== defaultLetHandler) {\r\n                expressions = bindingLanguage.createLetExpressions(resources, node);\r\n                auTargetID = makeIntoInstructionTarget(node);\r\n                instructions[auTargetID] = TargetInstruction.letElement(expressions);\r\n                return node.nextSibling;\r\n            }\r\n            if (type) {\r\n                elementInstruction = BehaviorInstruction.element(node, type);\r\n                type.processAttributes(this, resources, node, attributes, elementInstruction);\r\n                behaviorInstructions.push(elementInstruction);\r\n            }\r\n        }\r\n        for (i = 0, ii = attributes.length; i < ii; ++i) {\r\n            attr = attributes[i];\r\n            originalAttrName = attrName = attr.name;\r\n            attrValue = attr.value;\r\n            info = bindingLanguage.inspectAttribute(resources, tagName, attrName, attrValue);\r\n            if (targetLightDOM && info.attrName === 'slot') {\r\n                info.attrName = attrName = 'au-slot';\r\n            }\r\n            type = resources.getAttribute(info.attrName);\r\n            elementProperty = null;\r\n            if (type) {\r\n                knownAttribute = resources.mapAttribute(info.attrName);\r\n                if (knownAttribute) {\r\n                    property = type.attributes[knownAttribute];\r\n                    if (property) {\r\n                        info.defaultBindingMode = property.defaultBindingMode;\r\n                        if (!info.command && !info.expression) {\r\n                            info.command = property.hasOptions ? 'options' : null;\r\n                        }\r\n                        if (info.command && (info.command !== 'options') && type.primaryProperty) {\r\n                            var primaryProperty = type.primaryProperty;\r\n                            attrName = info.attrName = primaryProperty.attribute;\r\n                            info.defaultBindingMode = primaryProperty.defaultBindingMode;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            else if (elementInstruction) {\r\n                elementProperty = elementInstruction.type.attributes[info.attrName];\r\n                if (elementProperty) {\r\n                    info.defaultBindingMode = elementProperty.defaultBindingMode;\r\n                }\r\n            }\r\n            if (elementProperty) {\r\n                instruction = bindingLanguage.createAttributeInstruction(resources, node, info, elementInstruction);\r\n            }\r\n            else {\r\n                instruction = bindingLanguage.createAttributeInstruction(resources, node, info, undefined, type);\r\n            }\r\n            if (instruction) {\r\n                if (instruction.alteredAttr) {\r\n                    type = resources.getAttribute(instruction.attrName);\r\n                }\r\n                if (instruction.discrete) {\r\n                    expressions.push(instruction);\r\n                }\r\n                else {\r\n                    if (type) {\r\n                        instruction.type = type;\r\n                        this._configureProperties(instruction, resources);\r\n                        if (type.liftsContent) {\r\n                            instruction.originalAttrName = originalAttrName;\r\n                            liftingInstruction = instruction;\r\n                            break;\r\n                        }\r\n                        else {\r\n                            behaviorInstructions.push(instruction);\r\n                        }\r\n                    }\r\n                    else if (elementProperty) {\r\n                        elementInstruction.attributes[info.attrName].targetProperty = elementProperty.name;\r\n                    }\r\n                    else {\r\n                        expressions.push(instruction.attributes[instruction.attrName]);\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                if (type) {\r\n                    instruction = BehaviorInstruction.attribute(attrName, type);\r\n                    instruction.attributes[resources.mapAttribute(attrName)] = attrValue;\r\n                    if (type.liftsContent) {\r\n                        instruction.originalAttrName = originalAttrName;\r\n                        liftingInstruction = instruction;\r\n                        break;\r\n                    }\r\n                    else {\r\n                        behaviorInstructions.push(instruction);\r\n                    }\r\n                }\r\n                else if (elementProperty) {\r\n                    elementInstruction.attributes[attrName] = attrValue;\r\n                }\r\n            }\r\n        }\r\n        if (liftingInstruction) {\r\n            liftingInstruction.viewFactory = viewFactory;\r\n            node = liftingInstruction.type.compile(this, resources, node, liftingInstruction, parentNode);\r\n            auTargetID = makeIntoInstructionTarget(node);\r\n            instructions[auTargetID] = TargetInstruction.lifting(parentInjectorId, liftingInstruction);\r\n        }\r\n        else {\r\n            var skipContentProcessing = false;\r\n            if (expressions.length || behaviorInstructions.length) {\r\n                injectorId = behaviorInstructions.length ? getNextInjectorId() : false;\r\n                for (i = 0, ii = behaviorInstructions.length; i < ii; ++i) {\r\n                    instruction = behaviorInstructions[i];\r\n                    instruction.type.compile(this, resources, node, instruction, parentNode);\r\n                    providers.push(instruction.type.target);\r\n                    skipContentProcessing = skipContentProcessing || instruction.skipContentProcessing;\r\n                }\r\n                for (i = 0, ii = expressions.length; i < ii; ++i) {\r\n                    expression = expressions[i];\r\n                    if (expression.attrToRemove !== undefined) {\r\n                        node.removeAttribute(expression.attrToRemove);\r\n                    }\r\n                }\r\n                auTargetID = makeIntoInstructionTarget(node);\r\n                instructions[auTargetID] = TargetInstruction.normal(injectorId, parentInjectorId, providers, behaviorInstructions, expressions, elementInstruction);\r\n            }\r\n            if (skipContentProcessing) {\r\n                return node.nextSibling;\r\n            }\r\n            var currentChild = node.firstChild;\r\n            while (currentChild) {\r\n                currentChild = this._compileNode(currentChild, resources, instructions, node, injectorId || parentInjectorId, targetLightDOM);\r\n            }\r\n        }\r\n        return node.nextSibling;\r\n    };\r\n    ViewCompiler.prototype._configureProperties = function (instruction, resources) {\r\n        var type = instruction.type;\r\n        var attrName = instruction.attrName;\r\n        var attributes = instruction.attributes;\r\n        var property;\r\n        var key;\r\n        var value;\r\n        var knownAttribute = resources.mapAttribute(attrName);\r\n        if (knownAttribute && attrName in attributes && knownAttribute !== attrName) {\r\n            attributes[knownAttribute] = attributes[attrName];\r\n            delete attributes[attrName];\r\n        }\r\n        for (key in attributes) {\r\n            value = attributes[key];\r\n            if (value !== null && typeof value === 'object') {\r\n                property = type.attributes[key];\r\n                if (property !== undefined) {\r\n                    value.targetProperty = property.name;\r\n                }\r\n                else {\r\n                    value.targetProperty = key;\r\n                }\r\n            }\r\n        }\r\n    };\r\n    return ViewCompiler;\r\n}());\n\nvar ViewEngineHooksResource = (function () {\r\n    function ViewEngineHooksResource() {\r\n    }\r\n    ViewEngineHooksResource.prototype.initialize = function (container, target) {\r\n        this.instance = container.get(target);\r\n    };\r\n    ViewEngineHooksResource.prototype.register = function (registry, name) {\r\n        registry.registerViewEngineHooks(this.instance);\r\n    };\r\n    ViewEngineHooksResource.prototype.load = function (container, target) { };\r\n    ViewEngineHooksResource.convention = function (name) {\r\n        if (name.endsWith('ViewEngineHooks')) {\r\n            return new ViewEngineHooksResource();\r\n        }\r\n    };\r\n    return ViewEngineHooksResource;\r\n}());\r\nfunction viewEngineHooks(target) {\r\n    var deco = function (t) {\r\n        aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].define(aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].resource, new ViewEngineHooksResource(), t);\r\n    };\r\n    return target ? deco(target) : deco;\r\n}\n\nvar ResourceModule = (function () {\r\n    function ResourceModule(moduleId) {\r\n        this.id = moduleId;\r\n        this.moduleInstance = null;\r\n        this.mainResource = null;\r\n        this.resources = null;\r\n        this.viewStrategy = null;\r\n        this.isInitialized = false;\r\n        this.onLoaded = null;\r\n        this.loadContext = null;\r\n    }\r\n    ResourceModule.prototype.initialize = function (container) {\r\n        var current = this.mainResource;\r\n        var resources = this.resources;\r\n        var vs = this.viewStrategy;\r\n        if (this.isInitialized) {\r\n            return;\r\n        }\r\n        this.isInitialized = true;\r\n        if (current !== undefined) {\r\n            current.metadata.viewStrategy = vs;\r\n            current.initialize(container);\r\n        }\r\n        for (var i = 0, ii = resources.length; i < ii; ++i) {\r\n            current = resources[i];\r\n            current.metadata.viewStrategy = vs;\r\n            current.initialize(container);\r\n        }\r\n    };\r\n    ResourceModule.prototype.register = function (registry, name) {\r\n        var main = this.mainResource;\r\n        var resources = this.resources;\r\n        if (main !== undefined) {\r\n            main.register(registry, name);\r\n            name = null;\r\n        }\r\n        for (var i = 0, ii = resources.length; i < ii; ++i) {\r\n            resources[i].register(registry, name);\r\n            name = null;\r\n        }\r\n    };\r\n    ResourceModule.prototype.load = function (container, loadContext) {\r\n        if (this.onLoaded !== null) {\r\n            return this.loadContext === loadContext ? Promise.resolve() : this.onLoaded;\r\n        }\r\n        var main = this.mainResource;\r\n        var resources = this.resources;\r\n        var loads;\r\n        if (main !== undefined) {\r\n            loads = new Array(resources.length + 1);\r\n            loads[0] = main.load(container, loadContext);\r\n            for (var i = 0, ii = resources.length; i < ii; ++i) {\r\n                loads[i + 1] = resources[i].load(container, loadContext);\r\n            }\r\n        }\r\n        else {\r\n            loads = new Array(resources.length);\r\n            for (var i = 0, ii = resources.length; i < ii; ++i) {\r\n                loads[i] = resources[i].load(container, loadContext);\r\n            }\r\n        }\r\n        this.loadContext = loadContext;\r\n        this.onLoaded = Promise.all(loads);\r\n        return this.onLoaded;\r\n    };\r\n    return ResourceModule;\r\n}());\r\nvar ResourceDescription = (function () {\r\n    function ResourceDescription(key, exportedValue, resourceTypeMeta) {\r\n        if (!resourceTypeMeta) {\r\n            resourceTypeMeta = aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].get(aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].resource, exportedValue);\r\n            if (!resourceTypeMeta) {\r\n                resourceTypeMeta = new HtmlBehaviorResource();\r\n                resourceTypeMeta.elementName = _hyphenate(key);\r\n                aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].define(aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].resource, resourceTypeMeta, exportedValue);\r\n            }\r\n        }\r\n        if (resourceTypeMeta instanceof HtmlBehaviorResource) {\r\n            if (resourceTypeMeta.elementName === undefined) {\r\n                resourceTypeMeta.elementName = _hyphenate(key);\r\n            }\r\n            else if (resourceTypeMeta.attributeName === undefined) {\r\n                resourceTypeMeta.attributeName = _hyphenate(key);\r\n            }\r\n            else if (resourceTypeMeta.attributeName === null && resourceTypeMeta.elementName === null) {\r\n                HtmlBehaviorResource.convention(key, resourceTypeMeta);\r\n            }\r\n        }\r\n        else if (!resourceTypeMeta.name) {\r\n            resourceTypeMeta.name = _hyphenate(key);\r\n        }\r\n        this.metadata = resourceTypeMeta;\r\n        this.value = exportedValue;\r\n    }\r\n    ResourceDescription.prototype.initialize = function (container) {\r\n        this.metadata.initialize(container, this.value);\r\n    };\r\n    ResourceDescription.prototype.register = function (registry, name) {\r\n        this.metadata.register(registry, name);\r\n    };\r\n    ResourceDescription.prototype.load = function (container, loadContext) {\r\n        return this.metadata.load(container, this.value, loadContext);\r\n    };\r\n    return ResourceDescription;\r\n}());\r\nvar ModuleAnalyzer = (function () {\r\n    function ModuleAnalyzer() {\r\n        this.cache = Object.create(null);\r\n    }\r\n    ModuleAnalyzer.prototype.getAnalysis = function (moduleId) {\r\n        return this.cache[moduleId];\r\n    };\r\n    ModuleAnalyzer.prototype.analyze = function (moduleId, moduleInstance, mainResourceKey) {\r\n        var mainResource;\r\n        var fallbackValue;\r\n        var fallbackKey;\r\n        var resourceTypeMeta;\r\n        var key;\r\n        var exportedValue;\r\n        var resources = [];\r\n        var conventional;\r\n        var vs;\r\n        var resourceModule;\r\n        resourceModule = this.cache[moduleId];\r\n        if (resourceModule) {\r\n            return resourceModule;\r\n        }\r\n        resourceModule = new ResourceModule(moduleId);\r\n        this.cache[moduleId] = resourceModule;\r\n        if (typeof moduleInstance === 'function') {\r\n            moduleInstance = { 'default': moduleInstance };\r\n        }\r\n        if (mainResourceKey) {\r\n            mainResource = new ResourceDescription(mainResourceKey, moduleInstance[mainResourceKey]);\r\n        }\r\n        for (key in moduleInstance) {\r\n            exportedValue = moduleInstance[key];\r\n            if (key === mainResourceKey || typeof exportedValue !== 'function') {\r\n                continue;\r\n            }\r\n            resourceTypeMeta = aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].get(aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].resource, exportedValue);\r\n            if (resourceTypeMeta) {\r\n                if (resourceTypeMeta instanceof HtmlBehaviorResource) {\r\n                    ViewResources.convention(exportedValue, resourceTypeMeta);\r\n                    if (resourceTypeMeta.attributeName === null && resourceTypeMeta.elementName === null) {\r\n                        HtmlBehaviorResource.convention(key, resourceTypeMeta);\r\n                    }\r\n                    if (resourceTypeMeta.attributeName === null && resourceTypeMeta.elementName === null) {\r\n                        resourceTypeMeta.elementName = _hyphenate(key);\r\n                    }\r\n                }\r\n                if (!mainResource && resourceTypeMeta instanceof HtmlBehaviorResource && resourceTypeMeta.elementName !== null) {\r\n                    mainResource = new ResourceDescription(key, exportedValue, resourceTypeMeta);\r\n                }\r\n                else {\r\n                    resources.push(new ResourceDescription(key, exportedValue, resourceTypeMeta));\r\n                }\r\n            }\r\n            else if (viewStrategy.decorates(exportedValue)) {\r\n                vs = exportedValue;\r\n            }\r\n            else if (exportedValue instanceof aurelia_loader__WEBPACK_IMPORTED_MODULE_1__[\"TemplateRegistryEntry\"]) {\r\n                vs = new TemplateRegistryViewStrategy(moduleId, exportedValue);\r\n            }\r\n            else {\r\n                if (conventional = ViewResources.convention(exportedValue)) {\r\n                    if (conventional.elementName !== null && !mainResource) {\r\n                        mainResource = new ResourceDescription(key, exportedValue, conventional);\r\n                    }\r\n                    else {\r\n                        resources.push(new ResourceDescription(key, exportedValue, conventional));\r\n                    }\r\n                    aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].define(aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].resource, conventional, exportedValue);\r\n                }\r\n                else if (conventional = HtmlBehaviorResource.convention(key)) {\r\n                    if (conventional.elementName !== null && !mainResource) {\r\n                        mainResource = new ResourceDescription(key, exportedValue, conventional);\r\n                    }\r\n                    else {\r\n                        resources.push(new ResourceDescription(key, exportedValue, conventional));\r\n                    }\r\n                    aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].define(aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].resource, conventional, exportedValue);\r\n                }\r\n                else if (conventional = aurelia_binding__WEBPACK_IMPORTED_MODULE_5__[\"ValueConverterResource\"].convention(key)\r\n                    || aurelia_binding__WEBPACK_IMPORTED_MODULE_5__[\"BindingBehaviorResource\"].convention(key)\r\n                    || ViewEngineHooksResource.convention(key)) {\r\n                    resources.push(new ResourceDescription(key, exportedValue, conventional));\r\n                    aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].define(aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].resource, conventional, exportedValue);\r\n                }\r\n                else if (!fallbackValue) {\r\n                    fallbackValue = exportedValue;\r\n                    fallbackKey = key;\r\n                }\r\n            }\r\n        }\r\n        if (!mainResource && fallbackValue) {\r\n            mainResource = new ResourceDescription(fallbackKey, fallbackValue);\r\n        }\r\n        resourceModule.moduleInstance = moduleInstance;\r\n        resourceModule.mainResource = mainResource;\r\n        resourceModule.resources = resources;\r\n        resourceModule.viewStrategy = vs;\r\n        return resourceModule;\r\n    };\r\n    return ModuleAnalyzer;\r\n}());\n\nvar logger = aurelia_logging__WEBPACK_IMPORTED_MODULE_4__[\"getLogger\"]('templating');\r\nfunction ensureRegistryEntry(loader, urlOrRegistryEntry) {\r\n    if (urlOrRegistryEntry instanceof aurelia_loader__WEBPACK_IMPORTED_MODULE_1__[\"TemplateRegistryEntry\"]) {\r\n        return Promise.resolve(urlOrRegistryEntry);\r\n    }\r\n    return loader.loadTemplate(urlOrRegistryEntry);\r\n}\r\nvar ProxyViewFactory = (function () {\r\n    function ProxyViewFactory(promise) {\r\n        var _this = this;\r\n        promise.then(function (x) { return _this.viewFactory = x; });\r\n    }\r\n    ProxyViewFactory.prototype.create = function (container, bindingContext, createInstruction, element) {\r\n        return this.viewFactory.create(container, bindingContext, createInstruction, element);\r\n    };\r\n    Object.defineProperty(ProxyViewFactory.prototype, \"isCaching\", {\r\n        get: function () {\r\n            return this.viewFactory.isCaching;\r\n        },\r\n        enumerable: false,\r\n        configurable: true\r\n    });\r\n    ProxyViewFactory.prototype.setCacheSize = function (size, doNotOverrideIfAlreadySet) {\r\n        this.viewFactory.setCacheSize(size, doNotOverrideIfAlreadySet);\r\n    };\r\n    ProxyViewFactory.prototype.getCachedView = function () {\r\n        return this.viewFactory.getCachedView();\r\n    };\r\n    ProxyViewFactory.prototype.returnViewToCache = function (view) {\r\n        this.viewFactory.returnViewToCache(view);\r\n    };\r\n    return ProxyViewFactory;\r\n}());\r\nvar auSlotBehavior = null;\r\nvar ViewEngine = (function () {\r\n    function ViewEngine(loader, container, viewCompiler, moduleAnalyzer, appResources) {\r\n        this.loader = loader;\r\n        this.container = container;\r\n        this.viewCompiler = viewCompiler;\r\n        this.moduleAnalyzer = moduleAnalyzer;\r\n        this.appResources = appResources;\r\n        this._pluginMap = {};\r\n        if (auSlotBehavior === null) {\r\n            auSlotBehavior = new HtmlBehaviorResource();\r\n            auSlotBehavior.attributeName = 'au-slot';\r\n            aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].define(aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].resource, auSlotBehavior, SlotCustomAttribute);\r\n        }\r\n        auSlotBehavior.initialize(container, SlotCustomAttribute);\r\n        auSlotBehavior.register(appResources);\r\n    }\r\n    ViewEngine.inject = function () {\r\n        return [aurelia_loader__WEBPACK_IMPORTED_MODULE_1__[\"Loader\"], aurelia_dependency_injection__WEBPACK_IMPORTED_MODULE_6__[\"Container\"], ViewCompiler, ModuleAnalyzer, ViewResources];\r\n    };\r\n    ViewEngine.prototype.addResourcePlugin = function (extension, implementation) {\r\n        var name = extension.replace('.', '') + '-resource-plugin';\r\n        this._pluginMap[extension] = name;\r\n        this.loader.addPlugin(name, implementation);\r\n    };\r\n    ViewEngine.prototype.loadViewFactory = function (urlOrRegistryEntry, compileInstruction, loadContext, target) {\r\n        var _this = this;\r\n        loadContext = loadContext || new ResourceLoadContext();\r\n        return ensureRegistryEntry(this.loader, urlOrRegistryEntry).then(function (registryEntry) {\r\n            var url = registryEntry.address;\r\n            if (registryEntry.onReady) {\r\n                if (!loadContext.hasDependency(url)) {\r\n                    loadContext.addDependency(url);\r\n                    return registryEntry.onReady;\r\n                }\r\n                if (registryEntry.template === null) {\r\n                    return registryEntry.onReady;\r\n                }\r\n                return Promise.resolve(new ProxyViewFactory(registryEntry.onReady));\r\n            }\r\n            loadContext.addDependency(url);\r\n            registryEntry.onReady = _this.loadTemplateResources(registryEntry, compileInstruction, loadContext, target).then(function (resources) {\r\n                registryEntry.resources = resources;\r\n                if (registryEntry.template === null) {\r\n                    return registryEntry.factory = null;\r\n                }\r\n                var viewFactory = _this.viewCompiler.compile(registryEntry.template, resources, compileInstruction);\r\n                return registryEntry.factory = viewFactory;\r\n            });\r\n            return registryEntry.onReady;\r\n        });\r\n    };\r\n    ViewEngine.prototype.loadTemplateResources = function (registryEntry, compileInstruction, loadContext, target) {\r\n        var resources = new ViewResources(this.appResources, registryEntry.address);\r\n        var dependencies = registryEntry.dependencies;\r\n        var importIds;\r\n        var names;\r\n        compileInstruction = compileInstruction || ViewCompileInstruction.normal;\r\n        if (dependencies.length === 0 && !compileInstruction.associatedModuleId) {\r\n            return Promise.resolve(resources);\r\n        }\r\n        importIds = dependencies.map(function (x) { return x.src; });\r\n        names = dependencies.map(function (x) { return x.name; });\r\n        logger.debug(\"importing resources for \".concat(registryEntry.address), importIds);\r\n        if (target) {\r\n            var viewModelRequires = aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].get(ViewEngine.viewModelRequireMetadataKey, target);\r\n            if (viewModelRequires) {\r\n                var templateImportCount = importIds.length;\r\n                for (var i = 0, ii = viewModelRequires.length; i < ii; ++i) {\r\n                    var req = viewModelRequires[i];\r\n                    var importId = typeof req === 'function'\r\n                        ? aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"Origin\"].get(req).moduleId\r\n                        : Object(aurelia_path__WEBPACK_IMPORTED_MODULE_3__[\"relativeToFile\"])(req.src || req, registryEntry.address);\r\n                    if (importIds.indexOf(importId) === -1) {\r\n                        importIds.push(importId);\r\n                        names.push(req.as);\r\n                    }\r\n                }\r\n                logger.debug(\"importing ViewModel resources for \".concat(compileInstruction.associatedModuleId), importIds.slice(templateImportCount));\r\n            }\r\n        }\r\n        return this.importViewResources(importIds, names, resources, compileInstruction, loadContext);\r\n    };\r\n    ViewEngine.prototype.importViewModelResource = function (moduleImport, moduleMember) {\r\n        var _this = this;\r\n        return this.loader.loadModule(moduleImport).then(function (viewModelModule) {\r\n            var normalizedId = aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"Origin\"].get(viewModelModule).moduleId;\r\n            var resourceModule = _this.moduleAnalyzer.analyze(normalizedId, viewModelModule, moduleMember);\r\n            if (!resourceModule.mainResource) {\r\n                throw new Error(\"No view model found in module \\\"\".concat(moduleImport, \"\\\".\"));\r\n            }\r\n            resourceModule.initialize(_this.container);\r\n            return resourceModule.mainResource;\r\n        });\r\n    };\r\n    ViewEngine.prototype.importViewResources = function (moduleIds, names, resources, compileInstruction, loadContext) {\r\n        var _this = this;\r\n        loadContext = loadContext || new ResourceLoadContext();\r\n        compileInstruction = compileInstruction || ViewCompileInstruction.normal;\r\n        moduleIds = moduleIds.map(function (x) { return _this._applyLoaderPlugin(x); });\r\n        return this.loader.loadAllModules(moduleIds).then(function (imports) {\r\n            var i;\r\n            var ii;\r\n            var analysis;\r\n            var normalizedId;\r\n            var current;\r\n            var associatedModule;\r\n            var container = _this.container;\r\n            var moduleAnalyzer = _this.moduleAnalyzer;\r\n            var allAnalysis = new Array(imports.length);\r\n            for (i = 0, ii = imports.length; i < ii; ++i) {\r\n                current = imports[i];\r\n                normalizedId = aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"Origin\"].get(current).moduleId;\r\n                analysis = moduleAnalyzer.analyze(normalizedId, current);\r\n                analysis.initialize(container);\r\n                analysis.register(resources, names[i]);\r\n                allAnalysis[i] = analysis;\r\n            }\r\n            if (compileInstruction.associatedModuleId) {\r\n                associatedModule = moduleAnalyzer.getAnalysis(compileInstruction.associatedModuleId);\r\n                if (associatedModule) {\r\n                    associatedModule.register(resources);\r\n                }\r\n            }\r\n            for (i = 0, ii = allAnalysis.length; i < ii; ++i) {\r\n                allAnalysis[i] = allAnalysis[i].load(container, loadContext);\r\n            }\r\n            return Promise.all(allAnalysis).then(function () { return resources; });\r\n        });\r\n    };\r\n    ViewEngine.prototype._applyLoaderPlugin = function (id) {\r\n        var index = id.lastIndexOf('.');\r\n        if (index !== -1) {\r\n            var ext = id.substring(index);\r\n            var pluginName = this._pluginMap[ext];\r\n            if (pluginName === undefined) {\r\n                return id;\r\n            }\r\n            return this.loader.applyPluginToUrl(id, pluginName);\r\n        }\r\n        return id;\r\n    };\r\n    ViewEngine.viewModelRequireMetadataKey = 'aurelia:view-model-require';\r\n    return ViewEngine;\r\n}());\n\nvar Controller = (function () {\r\n    function Controller(behavior, instruction, viewModel, container) {\r\n        this.behavior = behavior;\r\n        this.instruction = instruction;\r\n        this.viewModel = viewModel;\r\n        this.isAttached = false;\r\n        this.view = null;\r\n        this.isBound = false;\r\n        this.scope = null;\r\n        this.container = container;\r\n        this.elementEvents = container.elementEvents || null;\r\n        var observerLookup = behavior.observerLocator.getOrCreateObserversLookup(viewModel);\r\n        var handlesBind = behavior.handlesBind;\r\n        var attributes = instruction.attributes;\r\n        var boundProperties = this.boundProperties = [];\r\n        var properties = behavior.properties;\r\n        var i;\r\n        var ii;\r\n        behavior._ensurePropertiesDefined(viewModel, observerLookup);\r\n        for (i = 0, ii = properties.length; i < ii; ++i) {\r\n            properties[i]._initialize(viewModel, observerLookup, attributes, handlesBind, boundProperties);\r\n        }\r\n    }\r\n    Controller.prototype.created = function (owningView) {\r\n        if (this.behavior.handlesCreated) {\r\n            this.viewModel.created(owningView, this.view);\r\n        }\r\n    };\r\n    Controller.prototype.automate = function (overrideContext, owningView) {\r\n        this.view.bindingContext = this.viewModel;\r\n        this.view.overrideContext = overrideContext || Object(aurelia_binding__WEBPACK_IMPORTED_MODULE_5__[\"createOverrideContext\"])(this.viewModel);\r\n        this.view._isUserControlled = true;\r\n        if (this.behavior.handlesCreated) {\r\n            this.viewModel.created(owningView || null, this.view);\r\n        }\r\n        this.bind(this.view);\r\n    };\r\n    Controller.prototype.bind = function (scope) {\r\n        var skipSelfSubscriber = this.behavior.handlesBind;\r\n        var boundProperties = this.boundProperties;\r\n        var i;\r\n        var ii;\r\n        var x;\r\n        var observer;\r\n        var selfSubscriber;\r\n        if (this.isBound) {\r\n            if (this.scope === scope) {\r\n                return;\r\n            }\r\n            this.unbind();\r\n        }\r\n        this.isBound = true;\r\n        this.scope = scope;\r\n        for (i = 0, ii = boundProperties.length; i < ii; ++i) {\r\n            x = boundProperties[i];\r\n            observer = x.observer;\r\n            selfSubscriber = observer.selfSubscriber;\r\n            observer.publishing = false;\r\n            if (skipSelfSubscriber) {\r\n                observer.selfSubscriber = null;\r\n            }\r\n            x.binding.bind(scope);\r\n            observer.call();\r\n            observer.publishing = true;\r\n            observer.selfSubscriber = selfSubscriber;\r\n        }\r\n        var overrideContext;\r\n        if (this.view !== null) {\r\n            if (skipSelfSubscriber) {\r\n                this.view.viewModelScope = scope;\r\n            }\r\n            if (this.viewModel === scope.overrideContext.bindingContext) {\r\n                overrideContext = scope.overrideContext;\r\n            }\r\n            else if (this.instruction.inheritBindingContext) {\r\n                overrideContext = Object(aurelia_binding__WEBPACK_IMPORTED_MODULE_5__[\"createOverrideContext\"])(this.viewModel, scope.overrideContext);\r\n            }\r\n            else {\r\n                overrideContext = Object(aurelia_binding__WEBPACK_IMPORTED_MODULE_5__[\"createOverrideContext\"])(this.viewModel);\r\n                overrideContext.__parentOverrideContext = scope.overrideContext;\r\n            }\r\n            this.view.bind(this.viewModel, overrideContext);\r\n        }\r\n        else if (skipSelfSubscriber) {\r\n            overrideContext = scope.overrideContext;\r\n            if (scope.overrideContext.__parentOverrideContext !== undefined\r\n                && this.viewModel.viewFactory && this.viewModel.viewFactory.factoryCreateInstruction.partReplacements) {\r\n                overrideContext = Object.assign({}, scope.overrideContext);\r\n                overrideContext.parentOverrideContext = scope.overrideContext.__parentOverrideContext;\r\n            }\r\n            this.viewModel.bind(scope.bindingContext, overrideContext);\r\n        }\r\n    };\r\n    Controller.prototype.unbind = function () {\r\n        if (this.isBound) {\r\n            var boundProperties = this.boundProperties;\r\n            var i = void 0;\r\n            var ii = void 0;\r\n            this.isBound = false;\r\n            this.scope = null;\r\n            if (this.view !== null) {\r\n                this.view.unbind();\r\n            }\r\n            if (this.behavior.handlesUnbind) {\r\n                this.viewModel.unbind();\r\n            }\r\n            if (this.elementEvents !== null) {\r\n                this.elementEvents.disposeAll();\r\n            }\r\n            for (i = 0, ii = boundProperties.length; i < ii; ++i) {\r\n                boundProperties[i].binding.unbind();\r\n            }\r\n        }\r\n    };\r\n    Controller.prototype.attached = function () {\r\n        if (this.isAttached) {\r\n            return;\r\n        }\r\n        this.isAttached = true;\r\n        if (this.behavior.handlesAttached) {\r\n            this.viewModel.attached();\r\n        }\r\n        if (this.view !== null) {\r\n            this.view.attached();\r\n        }\r\n    };\r\n    Controller.prototype.detached = function () {\r\n        if (this.isAttached) {\r\n            this.isAttached = false;\r\n            if (this.view !== null) {\r\n                this.view.detached();\r\n            }\r\n            if (this.behavior.handlesDetached) {\r\n                this.viewModel.detached();\r\n            }\r\n        }\r\n    };\r\n    return Controller;\r\n}());\n\nvar lastProviderId = 0;\r\nfunction nextProviderId() {\r\n    return ++lastProviderId;\r\n}\r\nfunction doProcessContent() { return true; }\r\nfunction doProcessAttributes() { }\r\nvar HtmlBehaviorResource = (function () {\r\n    function HtmlBehaviorResource() {\r\n        this.elementName = null;\r\n        this.attributeName = null;\r\n        this.attributeDefaultBindingMode = undefined;\r\n        this.liftsContent = false;\r\n        this.targetShadowDOM = false;\r\n        this.shadowDOMOptions = null;\r\n        this.processAttributes = doProcessAttributes;\r\n        this.processContent = doProcessContent;\r\n        this.usesShadowDOM = false;\r\n        this.childBindings = null;\r\n        this.hasDynamicOptions = false;\r\n        this.containerless = false;\r\n        this.properties = [];\r\n        this.attributes = {};\r\n        this.isInitialized = false;\r\n        this.primaryProperty = null;\r\n    }\r\n    HtmlBehaviorResource.convention = function (name, existing) {\r\n        var behavior;\r\n        if (name.endsWith('CustomAttribute')) {\r\n            behavior = existing || new HtmlBehaviorResource();\r\n            behavior.attributeName = _hyphenate(name.substring(0, name.length - 15));\r\n        }\r\n        if (name.endsWith('CustomElement')) {\r\n            behavior = existing || new HtmlBehaviorResource();\r\n            behavior.elementName = _hyphenate(name.substring(0, name.length - 13));\r\n        }\r\n        return behavior;\r\n    };\r\n    HtmlBehaviorResource.prototype.addChildBinding = function (behavior) {\r\n        if (this.childBindings === null) {\r\n            this.childBindings = [];\r\n        }\r\n        this.childBindings.push(behavior);\r\n    };\r\n    HtmlBehaviorResource.prototype.initialize = function (container, target) {\r\n        var proto = target.prototype;\r\n        var properties = this.properties;\r\n        var attributeName = this.attributeName;\r\n        var attributeDefaultBindingMode = this.attributeDefaultBindingMode;\r\n        var i;\r\n        var ii;\r\n        var current;\r\n        if (this.isInitialized) {\r\n            return;\r\n        }\r\n        this.isInitialized = true;\r\n        target.__providerId__ = nextProviderId();\r\n        this.observerLocator = container.get(aurelia_binding__WEBPACK_IMPORTED_MODULE_5__[\"ObserverLocator\"]);\r\n        this.taskQueue = container.get(aurelia_task_queue__WEBPACK_IMPORTED_MODULE_7__[\"TaskQueue\"]);\r\n        this.target = target;\r\n        this.usesShadowDOM = this.targetShadowDOM && aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"FEATURE\"].shadowDOM;\r\n        this.handlesCreated = ('created' in proto);\r\n        this.handlesBind = ('bind' in proto);\r\n        this.handlesUnbind = ('unbind' in proto);\r\n        this.handlesAttached = ('attached' in proto);\r\n        this.handlesDetached = ('detached' in proto);\r\n        this.htmlName = this.elementName || this.attributeName;\r\n        if (attributeName !== null) {\r\n            if (properties.length === 0) {\r\n                new BindableProperty({\r\n                    name: 'value',\r\n                    changeHandler: 'valueChanged' in proto ? 'valueChanged' : null,\r\n                    attribute: attributeName,\r\n                    defaultBindingMode: attributeDefaultBindingMode\r\n                }).registerWith(target, this);\r\n            }\r\n            current = properties[0];\r\n            if (properties.length === 1 && current.name === 'value') {\r\n                current.isDynamic = current.hasOptions = this.hasDynamicOptions;\r\n                current.defineOn(target, this);\r\n            }\r\n            else {\r\n                for (i = 0, ii = properties.length; i < ii; ++i) {\r\n                    properties[i].defineOn(target, this);\r\n                    if (properties[i].primaryProperty) {\r\n                        if (this.primaryProperty) {\r\n                            throw new Error('Only one bindable property on a custom element can be defined as the default');\r\n                        }\r\n                        this.primaryProperty = properties[i];\r\n                    }\r\n                }\r\n                current = new BindableProperty({\r\n                    name: 'value',\r\n                    changeHandler: 'valueChanged' in proto ? 'valueChanged' : null,\r\n                    attribute: attributeName,\r\n                    defaultBindingMode: attributeDefaultBindingMode\r\n                });\r\n                current.hasOptions = true;\r\n                current.registerWith(target, this);\r\n            }\r\n        }\r\n        else {\r\n            for (i = 0, ii = properties.length; i < ii; ++i) {\r\n                properties[i].defineOn(target, this);\r\n            }\r\n            this._copyInheritedProperties(container, target);\r\n        }\r\n    };\r\n    HtmlBehaviorResource.prototype.register = function (registry, name) {\r\n        var _this = this;\r\n        if (this.attributeName !== null) {\r\n            registry.registerAttribute(name || this.attributeName, this, this.attributeName);\r\n            if (Array.isArray(this.aliases)) {\r\n                this.aliases\r\n                    .forEach(function (alias) {\r\n                    registry.registerAttribute(alias, _this, _this.attributeName);\r\n                });\r\n            }\r\n        }\r\n        if (this.elementName !== null) {\r\n            registry.registerElement(name || this.elementName, this);\r\n        }\r\n    };\r\n    HtmlBehaviorResource.prototype.aliases = function (aliases) {\r\n        throw new Error('Method not implemented.');\r\n    };\r\n    HtmlBehaviorResource.prototype.load = function (container, target, loadContext, viewStrategy, transientView) {\r\n        var _this = this;\r\n        var options;\r\n        if (this.elementName !== null) {\r\n            viewStrategy = container.get(ViewLocator).getViewStrategy(viewStrategy || this.viewStrategy || target);\r\n            options = new ViewCompileInstruction(this.targetShadowDOM, true);\r\n            if (!viewStrategy.moduleId) {\r\n                viewStrategy.moduleId = aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"Origin\"].get(target).moduleId;\r\n            }\r\n            return viewStrategy\r\n                .loadViewFactory(container.get(ViewEngine), options, loadContext, target)\r\n                .then(function (viewFactory) {\r\n                if (!transientView || !_this.viewFactory) {\r\n                    _this.viewFactory = viewFactory;\r\n                }\r\n                return viewFactory;\r\n            });\r\n        }\r\n        return Promise.resolve(this);\r\n    };\r\n    HtmlBehaviorResource.prototype.compile = function (compiler, resources, node, instruction, parentNode) {\r\n        if (this.liftsContent) {\r\n            if (!instruction.viewFactory) {\r\n                var template = aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].createElement('template');\r\n                var fragment = aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].createDocumentFragment();\r\n                var cacheSize = node.getAttribute('view-cache');\r\n                var part = node.getAttribute('part');\r\n                node.removeAttribute(instruction.originalAttrName);\r\n                aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].replaceNode(template, node, parentNode);\r\n                fragment.appendChild(node);\r\n                instruction.viewFactory = compiler.compile(fragment, resources);\r\n                if (part) {\r\n                    instruction.viewFactory.part = part;\r\n                    node.removeAttribute('part');\r\n                }\r\n                if (cacheSize) {\r\n                    instruction.viewFactory.setCacheSize(cacheSize);\r\n                    node.removeAttribute('view-cache');\r\n                }\r\n                node = template;\r\n            }\r\n        }\r\n        else if (this.elementName !== null) {\r\n            var partReplacements = {};\r\n            if (this.processContent(compiler, resources, node, instruction) && node.hasChildNodes()) {\r\n                var currentChild = node.firstChild;\r\n                var contentElement = this.usesShadowDOM ? null : aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].createElement('au-content');\r\n                var nextSibling = void 0;\r\n                var toReplace = void 0;\r\n                while (currentChild) {\r\n                    nextSibling = currentChild.nextSibling;\r\n                    if (currentChild.tagName === 'TEMPLATE' && (toReplace = currentChild.getAttribute('replace-part'))) {\r\n                        partReplacements[toReplace] = compiler.compile(currentChild, resources);\r\n                        aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].removeNode(currentChild, parentNode);\r\n                        instruction.partReplacements = partReplacements;\r\n                    }\r\n                    else if (contentElement !== null) {\r\n                        if (currentChild.nodeType === 3 && _isAllWhitespace(currentChild)) {\r\n                            aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].removeNode(currentChild, parentNode);\r\n                        }\r\n                        else {\r\n                            contentElement.appendChild(currentChild);\r\n                        }\r\n                    }\r\n                    currentChild = nextSibling;\r\n                }\r\n                if (contentElement !== null && contentElement.hasChildNodes()) {\r\n                    node.appendChild(contentElement);\r\n                }\r\n                instruction.skipContentProcessing = false;\r\n            }\r\n            else {\r\n                instruction.skipContentProcessing = true;\r\n            }\r\n        }\r\n        else if (!this.processContent(compiler, resources, node, instruction)) {\r\n            instruction.skipContentProcessing = true;\r\n        }\r\n        return node;\r\n    };\r\n    HtmlBehaviorResource.prototype.create = function (container, instruction, element, bindings) {\r\n        var viewHost;\r\n        var au = null;\r\n        instruction = instruction || BehaviorInstruction.normal;\r\n        element = element || null;\r\n        bindings = bindings || null;\r\n        if (this.elementName !== null && element) {\r\n            if (this.usesShadowDOM) {\r\n                viewHost = element.attachShadow(this.shadowDOMOptions);\r\n                container.registerInstance(aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].boundary, viewHost);\r\n            }\r\n            else {\r\n                viewHost = element;\r\n                if (this.targetShadowDOM) {\r\n                    container.registerInstance(aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].boundary, viewHost);\r\n                }\r\n            }\r\n        }\r\n        if (element !== null) {\r\n            element.au = au = element.au || {};\r\n        }\r\n        var viewModel = instruction.viewModel || container.get(this.target);\r\n        var controller = new Controller(this, instruction, viewModel, container);\r\n        var childBindings = this.childBindings;\r\n        var viewFactory;\r\n        if (this.liftsContent) {\r\n            au.controller = controller;\r\n        }\r\n        else if (this.elementName !== null) {\r\n            viewFactory = instruction.viewFactory || this.viewFactory;\r\n            container.viewModel = viewModel;\r\n            if (viewFactory) {\r\n                controller.view = viewFactory.create(container, instruction, element);\r\n            }\r\n            if (element !== null) {\r\n                au.controller = controller;\r\n                if (controller.view) {\r\n                    if (!this.usesShadowDOM && (element.childNodes.length === 1 || element.contentElement)) {\r\n                        var contentElement = element.childNodes[0] || element.contentElement;\r\n                        controller.view.contentView = { fragment: contentElement };\r\n                        contentElement.parentNode && aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].removeNode(contentElement);\r\n                    }\r\n                    if (instruction.anchorIsContainer) {\r\n                        if (childBindings !== null) {\r\n                            for (var i = 0, ii = childBindings.length; i < ii; ++i) {\r\n                                controller.view.addBinding(childBindings[i].create(element, viewModel, controller));\r\n                            }\r\n                        }\r\n                        controller.view.appendNodesTo(viewHost);\r\n                    }\r\n                    else {\r\n                        controller.view.insertNodesBefore(viewHost);\r\n                    }\r\n                }\r\n                else if (childBindings !== null) {\r\n                    for (var i = 0, ii = childBindings.length; i < ii; ++i) {\r\n                        bindings.push(childBindings[i].create(element, viewModel, controller));\r\n                    }\r\n                }\r\n            }\r\n            else if (controller.view) {\r\n                controller.view.controller = controller;\r\n                if (childBindings !== null) {\r\n                    for (var i = 0, ii = childBindings.length; i < ii; ++i) {\r\n                        controller.view.addBinding(childBindings[i].create(instruction.host, viewModel, controller));\r\n                    }\r\n                }\r\n            }\r\n            else if (childBindings !== null) {\r\n                for (var i = 0, ii = childBindings.length; i < ii; ++i) {\r\n                    bindings.push(childBindings[i].create(instruction.host, viewModel, controller));\r\n                }\r\n            }\r\n        }\r\n        else if (childBindings !== null) {\r\n            for (var i = 0, ii = childBindings.length; i < ii; ++i) {\r\n                bindings.push(childBindings[i].create(element, viewModel, controller));\r\n            }\r\n        }\r\n        if (au !== null) {\r\n            au[this.htmlName] = controller;\r\n        }\r\n        if (instruction.initiatedByBehavior && viewFactory) {\r\n            controller.view.created();\r\n        }\r\n        return controller;\r\n    };\r\n    HtmlBehaviorResource.prototype._ensurePropertiesDefined = function (instance, lookup) {\r\n        var properties;\r\n        var i;\r\n        var ii;\r\n        var observer;\r\n        if ('__propertiesDefined__' in lookup) {\r\n            return;\r\n        }\r\n        lookup.__propertiesDefined__ = true;\r\n        properties = this.properties;\r\n        for (i = 0, ii = properties.length; i < ii; ++i) {\r\n            observer = properties[i].createObserver(instance);\r\n            if (observer !== undefined) {\r\n                lookup[observer.propertyName] = observer;\r\n            }\r\n        }\r\n    };\r\n    HtmlBehaviorResource.prototype._copyInheritedProperties = function (container, target) {\r\n        var behavior;\r\n        var derived = target;\r\n        while (true) {\r\n            var proto = Object.getPrototypeOf(target.prototype);\r\n            target = proto && proto.constructor;\r\n            if (!target) {\r\n                return;\r\n            }\r\n            behavior = aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].getOwn(aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].resource, target);\r\n            if (behavior) {\r\n                break;\r\n            }\r\n        }\r\n        behavior.initialize(container, target);\r\n        var _loop_1 = function (i, ii) {\r\n            var prop = behavior.properties[i];\r\n            if (this_1.properties.some(function (p) { return p.name === prop.name; })) {\r\n                return \"continue\";\r\n            }\r\n            new BindableProperty(prop).registerWith(derived, this_1);\r\n        };\r\n        var this_1 = this;\r\n        for (var i = 0, ii = behavior.properties.length; i < ii; ++i) {\r\n            _loop_1(i);\r\n        }\r\n    };\r\n    return HtmlBehaviorResource;\r\n}());\n\nfunction register(lookup, name, resource, type) {\r\n    if (!name) {\r\n        return;\r\n    }\r\n    var existing = lookup[name];\r\n    if (existing) {\r\n        if (existing !== resource) {\r\n            throw new Error(\"Attempted to register \".concat(type, \" when one with the same name already exists. Name: \").concat(name, \".\"));\r\n        }\r\n        return;\r\n    }\r\n    lookup[name] = resource;\r\n}\r\nfunction validateBehaviorName(name, type) {\r\n    if (/[A-Z]/.test(name)) {\r\n        var newName = _hyphenate(name);\r\n        aurelia_logging__WEBPACK_IMPORTED_MODULE_4__[\"getLogger\"]('templating')\r\n            .warn(\"'\".concat(name, \"' is not a valid \").concat(type, \" name and has been converted to '\").concat(newName, \"'. Upper-case letters are not allowed because the DOM is not case-sensitive.\"));\r\n        return newName;\r\n    }\r\n    return name;\r\n}\r\nvar conventionMark = '__au_resource__';\r\nvar ViewResources = (function () {\r\n    function ViewResources(parent, viewUrl) {\r\n        this.bindingLanguage = null;\r\n        this.parent = parent || null;\r\n        this.hasParent = this.parent !== null;\r\n        this.viewUrl = viewUrl || '';\r\n        this.lookupFunctions = {\r\n            valueConverters: this.getValueConverter.bind(this),\r\n            bindingBehaviors: this.getBindingBehavior.bind(this)\r\n        };\r\n        this.attributes = Object.create(null);\r\n        this.elements = Object.create(null);\r\n        this.valueConverters = Object.create(null);\r\n        this.bindingBehaviors = Object.create(null);\r\n        this.attributeMap = Object.create(null);\r\n        this.values = Object.create(null);\r\n        this.beforeCompile = this.afterCompile = this.beforeCreate = this.afterCreate = this.beforeBind = this.beforeUnbind = false;\r\n    }\r\n    ViewResources.convention = function (target, existing) {\r\n        var resource;\r\n        if (existing && conventionMark in existing) {\r\n            return existing;\r\n        }\r\n        if ('$resource' in target) {\r\n            var config = target.$resource;\r\n            if (typeof config === 'string') {\r\n                resource = existing || new HtmlBehaviorResource();\r\n                resource[conventionMark] = true;\r\n                if (!resource.elementName) {\r\n                    resource.elementName = validateBehaviorName(config, 'custom element');\r\n                }\r\n            }\r\n            else {\r\n                if (typeof config === 'function') {\r\n                    config = config.call(target);\r\n                }\r\n                if (typeof config === 'string') {\r\n                    config = { name: config };\r\n                }\r\n                config = Object.assign({}, config);\r\n                var resourceType = config.type || 'element';\r\n                var name_1 = config.name;\r\n                switch (resourceType) {\r\n                    case 'element':\r\n                    case 'attribute':\r\n                        resource = existing || new HtmlBehaviorResource();\r\n                        resource[conventionMark] = true;\r\n                        if (resourceType === 'element') {\r\n                            if (!resource.elementName) {\r\n                                resource.elementName = name_1\r\n                                    ? validateBehaviorName(name_1, 'custom element')\r\n                                    : _hyphenate(target.name);\r\n                            }\r\n                        }\r\n                        else {\r\n                            if (!resource.attributeName) {\r\n                                resource.attributeName = name_1\r\n                                    ? validateBehaviorName(name_1, 'custom attribute')\r\n                                    : _hyphenate(target.name);\r\n                            }\r\n                        }\r\n                        if ('templateController' in config) {\r\n                            config.liftsContent = config.templateController;\r\n                            delete config.templateController;\r\n                        }\r\n                        if ('defaultBindingMode' in config && resource.attributeDefaultBindingMode !== undefined) {\r\n                            config.attributeDefaultBindingMode = config.defaultBindingMode;\r\n                            delete config.defaultBindingMode;\r\n                        }\r\n                        delete config.name;\r\n                        Object.assign(resource, config);\r\n                        break;\r\n                    case 'valueConverter':\r\n                        resource = new aurelia_binding__WEBPACK_IMPORTED_MODULE_5__[\"ValueConverterResource\"](Object(aurelia_binding__WEBPACK_IMPORTED_MODULE_5__[\"camelCase\"])(name_1 || target.name));\r\n                        break;\r\n                    case 'bindingBehavior':\r\n                        resource = new aurelia_binding__WEBPACK_IMPORTED_MODULE_5__[\"BindingBehaviorResource\"](Object(aurelia_binding__WEBPACK_IMPORTED_MODULE_5__[\"camelCase\"])(name_1 || target.name));\r\n                        break;\r\n                    case 'viewEngineHooks':\r\n                        resource = new ViewEngineHooksResource();\r\n                        break;\r\n                }\r\n            }\r\n            if (resource instanceof HtmlBehaviorResource) {\r\n                var bindables = typeof config === 'string' ? undefined : config.bindables;\r\n                var currentProps = resource.properties;\r\n                if (Array.isArray(bindables)) {\r\n                    for (var i = 0, ii = bindables.length; ii > i; ++i) {\r\n                        var prop = bindables[i];\r\n                        if (!prop || (typeof prop !== 'string' && !prop.name)) {\r\n                            throw new Error(\"Invalid bindable property at \\\"\".concat(i, \"\\\" for class \\\"\").concat(target.name, \"\\\". Expected either a string or an object with \\\"name\\\" property.\"));\r\n                        }\r\n                        var newProp = new BindableProperty(prop);\r\n                        var existed = false;\r\n                        for (var j = 0, jj = currentProps.length; jj > j; ++j) {\r\n                            if (currentProps[j].name === newProp.name) {\r\n                                existed = true;\r\n                                break;\r\n                            }\r\n                        }\r\n                        if (existed) {\r\n                            continue;\r\n                        }\r\n                        newProp.registerWith(target, resource);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return resource;\r\n    };\r\n    ViewResources.prototype._tryAddHook = function (obj, name) {\r\n        if (typeof obj[name] === 'function') {\r\n            var func = obj[name].bind(obj);\r\n            var counter = 1;\r\n            var callbackName = void 0;\r\n            while (this[callbackName = name + counter.toString()] !== undefined) {\r\n                counter++;\r\n            }\r\n            this[name] = true;\r\n            this[callbackName] = func;\r\n        }\r\n    };\r\n    ViewResources.prototype._invokeHook = function (name, one, two, three, four) {\r\n        if (this.hasParent) {\r\n            this.parent._invokeHook(name, one, two, three, four);\r\n        }\r\n        if (this[name]) {\r\n            this[name + '1'](one, two, three, four);\r\n            var callbackName = name + '2';\r\n            if (this[callbackName]) {\r\n                this[callbackName](one, two, three, four);\r\n                callbackName = name + '3';\r\n                if (this[callbackName]) {\r\n                    this[callbackName](one, two, three, four);\r\n                    var counter = 4;\r\n                    while (this[callbackName = name + counter.toString()] !== undefined) {\r\n                        this[callbackName](one, two, three, four);\r\n                        counter++;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    };\r\n    ViewResources.prototype.registerViewEngineHooks = function (hooks) {\r\n        this._tryAddHook(hooks, 'beforeCompile');\r\n        this._tryAddHook(hooks, 'afterCompile');\r\n        this._tryAddHook(hooks, 'beforeCreate');\r\n        this._tryAddHook(hooks, 'afterCreate');\r\n        this._tryAddHook(hooks, 'beforeBind');\r\n        this._tryAddHook(hooks, 'beforeUnbind');\r\n    };\r\n    ViewResources.prototype.getBindingLanguage = function (bindingLanguageFallback) {\r\n        return this.bindingLanguage || (this.bindingLanguage = bindingLanguageFallback);\r\n    };\r\n    ViewResources.prototype.patchInParent = function (newParent) {\r\n        var originalParent = this.parent;\r\n        this.parent = newParent || null;\r\n        this.hasParent = this.parent !== null;\r\n        if (newParent.parent === null) {\r\n            newParent.parent = originalParent;\r\n            newParent.hasParent = originalParent !== null;\r\n        }\r\n    };\r\n    ViewResources.prototype.relativeToView = function (path) {\r\n        return Object(aurelia_path__WEBPACK_IMPORTED_MODULE_3__[\"relativeToFile\"])(path, this.viewUrl);\r\n    };\r\n    ViewResources.prototype.registerElement = function (tagName, behavior) {\r\n        register(this.elements, tagName, behavior, 'an Element');\r\n    };\r\n    ViewResources.prototype.getElement = function (tagName) {\r\n        return this.elements[tagName] || (this.hasParent ? this.parent.getElement(tagName) : null);\r\n    };\r\n    ViewResources.prototype.mapAttribute = function (attribute) {\r\n        return this.attributeMap[attribute] || (this.hasParent ? this.parent.mapAttribute(attribute) : null);\r\n    };\r\n    ViewResources.prototype.registerAttribute = function (attribute, behavior, knownAttribute) {\r\n        this.attributeMap[attribute] = knownAttribute;\r\n        register(this.attributes, attribute, behavior, 'an Attribute');\r\n    };\r\n    ViewResources.prototype.getAttribute = function (attribute) {\r\n        return this.attributes[attribute] || (this.hasParent ? this.parent.getAttribute(attribute) : null);\r\n    };\r\n    ViewResources.prototype.registerValueConverter = function (name, valueConverter) {\r\n        register(this.valueConverters, name, valueConverter, 'a ValueConverter');\r\n    };\r\n    ViewResources.prototype.getValueConverter = function (name) {\r\n        return this.valueConverters[name] || (this.hasParent ? this.parent.getValueConverter(name) : null);\r\n    };\r\n    ViewResources.prototype.registerBindingBehavior = function (name, bindingBehavior) {\r\n        register(this.bindingBehaviors, name, bindingBehavior, 'a BindingBehavior');\r\n    };\r\n    ViewResources.prototype.getBindingBehavior = function (name) {\r\n        return this.bindingBehaviors[name] || (this.hasParent ? this.parent.getBindingBehavior(name) : null);\r\n    };\r\n    ViewResources.prototype.registerValue = function (name, value) {\r\n        register(this.values, name, value, 'a value');\r\n    };\r\n    ViewResources.prototype.getValue = function (name) {\r\n        return this.values[name] || (this.hasParent ? this.parent.getValue(name) : null);\r\n    };\r\n    ViewResources.prototype.autoRegister = function (container, impl) {\r\n        var resourceTypeMeta = aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].getOwn(aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].resource, impl);\r\n        if (resourceTypeMeta) {\r\n            if (resourceTypeMeta instanceof HtmlBehaviorResource) {\r\n                ViewResources.convention(impl, resourceTypeMeta);\r\n                if (resourceTypeMeta.attributeName === null && resourceTypeMeta.elementName === null) {\r\n                    HtmlBehaviorResource.convention(impl.name, resourceTypeMeta);\r\n                }\r\n                if (resourceTypeMeta.attributeName === null && resourceTypeMeta.elementName === null) {\r\n                    resourceTypeMeta.elementName = _hyphenate(impl.name);\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            resourceTypeMeta = ViewResources.convention(impl)\r\n                || HtmlBehaviorResource.convention(impl.name)\r\n                || aurelia_binding__WEBPACK_IMPORTED_MODULE_5__[\"ValueConverterResource\"].convention(impl.name)\r\n                || aurelia_binding__WEBPACK_IMPORTED_MODULE_5__[\"BindingBehaviorResource\"].convention(impl.name)\r\n                || ViewEngineHooksResource.convention(impl.name);\r\n            if (!resourceTypeMeta) {\r\n                resourceTypeMeta = new HtmlBehaviorResource();\r\n                resourceTypeMeta.elementName = _hyphenate(impl.name);\r\n            }\r\n            aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].define(aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].resource, resourceTypeMeta, impl);\r\n        }\r\n        resourceTypeMeta.initialize(container, impl);\r\n        resourceTypeMeta.register(this, undefined);\r\n        return resourceTypeMeta;\r\n    };\r\n    return ViewResources;\r\n}());\n\nvar viewStrategy = aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"protocol\"].create('aurelia:view-strategy', {\r\n    validate: function (target) {\r\n        if (!(typeof target.loadViewFactory === 'function')) {\r\n            return 'View strategies must implement: loadViewFactory(viewEngine: ViewEngine, compileInstruction: ViewCompileInstruction, loadContext?: ResourceLoadContext): Promise<ViewFactory>';\r\n        }\r\n        return true;\r\n    },\r\n    compose: function (target) {\r\n        if (!(typeof target.makeRelativeTo === 'function')) {\r\n            target.makeRelativeTo = aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"PLATFORM\"].noop;\r\n        }\r\n    }\r\n});\r\nvar RelativeViewStrategy = (function () {\r\n    function RelativeViewStrategy(path) {\r\n        this.path = path;\r\n        this.absolutePath = null;\r\n    }\r\n    RelativeViewStrategy.prototype.loadViewFactory = function (viewEngine, compileInstruction, loadContext, target) {\r\n        if (this.absolutePath === null && this.moduleId) {\r\n            this.absolutePath = Object(aurelia_path__WEBPACK_IMPORTED_MODULE_3__[\"relativeToFile\"])(this.path, this.moduleId);\r\n        }\r\n        compileInstruction.associatedModuleId = this.moduleId;\r\n        return viewEngine.loadViewFactory(this.absolutePath || this.path, compileInstruction, loadContext, target);\r\n    };\r\n    RelativeViewStrategy.prototype.makeRelativeTo = function (file) {\r\n        if (this.absolutePath === null) {\r\n            this.absolutePath = Object(aurelia_path__WEBPACK_IMPORTED_MODULE_3__[\"relativeToFile\"])(this.path, file);\r\n        }\r\n    };\r\n    RelativeViewStrategy = __decorate([\r\n        viewStrategy()\r\n    ], RelativeViewStrategy);\r\n    return RelativeViewStrategy;\r\n}());\r\nvar ConventionalViewStrategy = (function () {\r\n    function ConventionalViewStrategy(viewLocator, origin) {\r\n        this.moduleId = origin.moduleId;\r\n        this.viewUrl = viewLocator.convertOriginToViewUrl(origin);\r\n    }\r\n    ConventionalViewStrategy.prototype.loadViewFactory = function (viewEngine, compileInstruction, loadContext, target) {\r\n        compileInstruction.associatedModuleId = this.moduleId;\r\n        return viewEngine.loadViewFactory(this.viewUrl, compileInstruction, loadContext, target);\r\n    };\r\n    ConventionalViewStrategy = __decorate([\r\n        viewStrategy()\r\n    ], ConventionalViewStrategy);\r\n    return ConventionalViewStrategy;\r\n}());\r\nvar NoViewStrategy = (function () {\r\n    function NoViewStrategy(dependencies, dependencyBaseUrl) {\r\n        this.dependencies = dependencies || null;\r\n        this.dependencyBaseUrl = dependencyBaseUrl || '';\r\n    }\r\n    NoViewStrategy.prototype.loadViewFactory = function (viewEngine, compileInstruction, loadContext, target) {\r\n        var entry = this.entry;\r\n        var dependencies = this.dependencies;\r\n        if (entry && entry.factoryIsReady) {\r\n            return Promise.resolve(null);\r\n        }\r\n        this.entry = entry = new aurelia_loader__WEBPACK_IMPORTED_MODULE_1__[\"TemplateRegistryEntry\"](this.moduleId || this.dependencyBaseUrl);\r\n        entry.dependencies = [];\r\n        entry.templateIsLoaded = true;\r\n        if (dependencies !== null) {\r\n            for (var i = 0, ii = dependencies.length; i < ii; ++i) {\r\n                var current = dependencies[i];\r\n                if (typeof current === 'string' || typeof current === 'function') {\r\n                    entry.addDependency(current);\r\n                }\r\n                else {\r\n                    entry.addDependency(current.from, current.as);\r\n                }\r\n            }\r\n        }\r\n        compileInstruction.associatedModuleId = this.moduleId;\r\n        return viewEngine.loadViewFactory(entry, compileInstruction, loadContext, target);\r\n    };\r\n    NoViewStrategy = __decorate([\r\n        viewStrategy()\r\n    ], NoViewStrategy);\r\n    return NoViewStrategy;\r\n}());\r\nvar TemplateRegistryViewStrategy = (function () {\r\n    function TemplateRegistryViewStrategy(moduleId, entry) {\r\n        this.moduleId = moduleId;\r\n        this.entry = entry;\r\n    }\r\n    TemplateRegistryViewStrategy.prototype.loadViewFactory = function (viewEngine, compileInstruction, loadContext, target) {\r\n        var entry = this.entry;\r\n        if (entry.factoryIsReady) {\r\n            return Promise.resolve(entry.factory);\r\n        }\r\n        compileInstruction.associatedModuleId = this.moduleId;\r\n        return viewEngine.loadViewFactory(entry, compileInstruction, loadContext, target);\r\n    };\r\n    TemplateRegistryViewStrategy = __decorate([\r\n        viewStrategy()\r\n    ], TemplateRegistryViewStrategy);\r\n    return TemplateRegistryViewStrategy;\r\n}());\r\nvar InlineViewStrategy = (function () {\r\n    function InlineViewStrategy(markup, dependencies, dependencyBaseUrl) {\r\n        this.markup = markup;\r\n        this.dependencies = dependencies || null;\r\n        this.dependencyBaseUrl = dependencyBaseUrl || '';\r\n    }\r\n    InlineViewStrategy.prototype.loadViewFactory = function (viewEngine, compileInstruction, loadContext, target) {\r\n        var entry = this.entry;\r\n        var dependencies = this.dependencies;\r\n        if (entry && entry.factoryIsReady) {\r\n            return Promise.resolve(entry.factory);\r\n        }\r\n        this.entry = entry = new aurelia_loader__WEBPACK_IMPORTED_MODULE_1__[\"TemplateRegistryEntry\"](this.moduleId || this.dependencyBaseUrl);\r\n        entry.template = aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].createTemplateFromMarkup(this.markup);\r\n        if (dependencies !== null) {\r\n            for (var i = 0, ii = dependencies.length; i < ii; ++i) {\r\n                var current = dependencies[i];\r\n                if (typeof current === 'string' || typeof current === 'function') {\r\n                    entry.addDependency(current);\r\n                }\r\n                else {\r\n                    entry.addDependency(current.from, current.as);\r\n                }\r\n            }\r\n        }\r\n        compileInstruction.associatedModuleId = this.moduleId;\r\n        return viewEngine.loadViewFactory(entry, compileInstruction, loadContext, target);\r\n    };\r\n    InlineViewStrategy = __decorate([\r\n        viewStrategy()\r\n    ], InlineViewStrategy);\r\n    return InlineViewStrategy;\r\n}());\r\nvar StaticViewStrategy = (function () {\r\n    function StaticViewStrategy(config) {\r\n        if (typeof config === 'string' || (config instanceof aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].Element && config.tagName === 'TEMPLATE')) {\r\n            config = {\r\n                template: config\r\n            };\r\n        }\r\n        this.template = config.template;\r\n        this.dependencies = config.dependencies || [];\r\n        this.factoryIsReady = false;\r\n        this.onReady = null;\r\n        this.moduleId = 'undefined';\r\n    }\r\n    StaticViewStrategy.prototype.loadViewFactory = function (viewEngine, compileInstruction, loadContext, target) {\r\n        var _this = this;\r\n        if (this.factoryIsReady) {\r\n            return Promise.resolve(this.factory);\r\n        }\r\n        var $deps = this.dependencies;\r\n        var deps = typeof $deps === 'function' ? $deps() : $deps;\r\n        deps = deps ? deps : [];\r\n        deps = Array.isArray(deps) ? deps : [deps];\r\n        return Promise.all(deps).then(function (dependencies) {\r\n            var container = viewEngine.container;\r\n            var appResources = viewEngine.appResources;\r\n            var viewCompiler = viewEngine.viewCompiler;\r\n            var viewResources = new ViewResources(appResources);\r\n            var resource;\r\n            var elDeps = [];\r\n            if (target) {\r\n                viewResources.autoRegister(container, target);\r\n            }\r\n            for (var _i = 0, dependencies_1 = dependencies; _i < dependencies_1.length; _i++) {\r\n                var dep = dependencies_1[_i];\r\n                if (typeof dep === 'function') {\r\n                    resource = viewResources.autoRegister(container, dep);\r\n                    if (resource.elementName !== null) {\r\n                        elDeps.push(resource);\r\n                    }\r\n                }\r\n                else if (dep && typeof dep === 'object') {\r\n                    for (var key in dep) {\r\n                        var exported = dep[key];\r\n                        if (typeof exported === 'function') {\r\n                            resource = viewResources.autoRegister(container, exported);\r\n                            if (resource.elementName !== null) {\r\n                                elDeps.push(resource);\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                else {\r\n                    throw new Error(\"dependency neither function nor object. Received: \\\"\".concat(typeof dep, \"\\\"\"));\r\n                }\r\n            }\r\n            return Promise.all(elDeps.map(function (el) { return el.load(container, el.target); })).then(function () {\r\n                var factory = _this.template !== null\r\n                    ? viewCompiler.compile(_this.template, viewResources, compileInstruction)\r\n                    : null;\r\n                _this.factoryIsReady = true;\r\n                _this.factory = factory;\r\n                return factory;\r\n            });\r\n        });\r\n    };\r\n    StaticViewStrategy = __decorate([\r\n        viewStrategy()\r\n    ], StaticViewStrategy);\r\n    return StaticViewStrategy;\r\n}());\n\nfunction remove(viewSlot, previous) {\r\n    return Array.isArray(previous)\r\n        ? viewSlot.removeMany(previous, true)\r\n        : viewSlot.remove(previous, true);\r\n}\r\nvar SwapStrategies = {\r\n    before: function (viewSlot, previous, callback) {\r\n        return (previous === undefined)\r\n            ? callback()\r\n            : callback().then(function () { return remove(viewSlot, previous); });\r\n    },\r\n    with: function (viewSlot, previous, callback) {\r\n        return (previous === undefined)\r\n            ? callback()\r\n            : Promise.all([remove(viewSlot, previous), callback()]);\r\n    },\r\n    after: function (viewSlot, previous, callback) {\r\n        return Promise.resolve(viewSlot.removeAll(true)).then(callback);\r\n    }\r\n};\n\nfunction tryActivateViewModel(context) {\r\n    if (context.skipActivation || typeof context.viewModel.activate !== 'function') {\r\n        return Promise.resolve();\r\n    }\r\n    return context.viewModel.activate(context.model) || Promise.resolve();\r\n}\r\nvar CompositionEngine = (function () {\r\n    function CompositionEngine(viewEngine, viewLocator) {\r\n        this.viewEngine = viewEngine;\r\n        this.viewLocator = viewLocator;\r\n    }\r\n    CompositionEngine.prototype._swap = function (context, view) {\r\n        var swapStrategy = SwapStrategies[context.swapOrder] || SwapStrategies.after;\r\n        var previousViews = context.viewSlot.children.slice();\r\n        return swapStrategy(context.viewSlot, previousViews, function () {\r\n            return Promise.resolve(context.viewSlot.add(view)).then(function () {\r\n                if (context.currentController) {\r\n                    context.currentController.unbind();\r\n                }\r\n            });\r\n        }).then(function () {\r\n            if (context.compositionTransactionNotifier) {\r\n                context.compositionTransactionNotifier.done();\r\n            }\r\n        });\r\n    };\r\n    CompositionEngine.prototype._createControllerAndSwap = function (context) {\r\n        var _this = this;\r\n        return this.createController(context).then(function (controller) {\r\n            if (context.compositionTransactionOwnershipToken) {\r\n                return context.compositionTransactionOwnershipToken\r\n                    .waitForCompositionComplete()\r\n                    .then(function () {\r\n                    controller.automate(context.overrideContext, context.owningView);\r\n                    return _this._swap(context, controller.view);\r\n                })\r\n                    .then(function () { return controller; });\r\n            }\r\n            controller.automate(context.overrideContext, context.owningView);\r\n            return _this._swap(context, controller.view).then(function () { return controller; });\r\n        });\r\n    };\r\n    CompositionEngine.prototype.createController = function (context) {\r\n        var _this = this;\r\n        var childContainer;\r\n        var viewModel;\r\n        var viewModelResource;\r\n        var m;\r\n        return this\r\n            .ensureViewModel(context)\r\n            .then(tryActivateViewModel)\r\n            .then(function () {\r\n            childContainer = context.childContainer;\r\n            viewModel = context.viewModel;\r\n            viewModelResource = context.viewModelResource;\r\n            m = viewModelResource.metadata;\r\n            var viewStrategy = _this.viewLocator.getViewStrategy(context.view || viewModel);\r\n            if (context.viewResources) {\r\n                viewStrategy.makeRelativeTo(context.viewResources.viewUrl);\r\n            }\r\n            return m.load(childContainer, viewModelResource.value, null, viewStrategy, true);\r\n        }).then(function (viewFactory) { return m.create(childContainer, BehaviorInstruction.dynamic(context.host, viewModel, viewFactory)); });\r\n    };\r\n    CompositionEngine.prototype.ensureViewModel = function (context) {\r\n        var childContainer = context.childContainer = (context.childContainer || context.container.createChild());\r\n        if (typeof context.viewModel === 'string') {\r\n            context.viewModel = context.viewResources\r\n                ? context.viewResources.relativeToView(context.viewModel)\r\n                : context.viewModel;\r\n            return this.viewEngine.importViewModelResource(context.viewModel).then(function (viewModelResource) {\r\n                childContainer.autoRegister(viewModelResource.value);\r\n                if (context.host) {\r\n                    childContainer.registerInstance(aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].Element, context.host);\r\n                }\r\n                context.viewModel = childContainer.viewModel = childContainer.get(viewModelResource.value);\r\n                context.viewModelResource = viewModelResource;\r\n                return context;\r\n            });\r\n        }\r\n        var ctor = context.viewModel.constructor;\r\n        var isClass = typeof context.viewModel === 'function';\r\n        if (isClass) {\r\n            ctor = context.viewModel;\r\n            childContainer.autoRegister(ctor);\r\n        }\r\n        var m = aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].getOrCreateOwn(aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].resource, HtmlBehaviorResource, ctor);\r\n        m.elementName = m.elementName || 'dynamic-element';\r\n        m.initialize(isClass ? childContainer : (context.container || childContainer), ctor);\r\n        context.viewModelResource = { metadata: m, value: ctor };\r\n        if (context.host) {\r\n            childContainer.registerInstance(aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].Element, context.host);\r\n        }\r\n        childContainer.viewModel = context.viewModel = isClass ? childContainer.get(ctor) : context.viewModel;\r\n        return Promise.resolve(context);\r\n    };\r\n    CompositionEngine.prototype.compose = function (context) {\r\n        var _this = this;\r\n        context.childContainer = context.childContainer || context.container.createChild();\r\n        context.view = this.viewLocator.getViewStrategy(context.view);\r\n        var transaction = context.childContainer.get(CompositionTransaction);\r\n        var compositionTransactionOwnershipToken = transaction.tryCapture();\r\n        if (compositionTransactionOwnershipToken) {\r\n            context.compositionTransactionOwnershipToken = compositionTransactionOwnershipToken;\r\n        }\r\n        else {\r\n            context.compositionTransactionNotifier = transaction.enlist();\r\n        }\r\n        if (context.viewModel) {\r\n            return this._createControllerAndSwap(context);\r\n        }\r\n        else if (context.view) {\r\n            if (context.viewResources) {\r\n                context.view.makeRelativeTo(context.viewResources.viewUrl);\r\n            }\r\n            return context.view.loadViewFactory(this.viewEngine, new ViewCompileInstruction()).then(function (viewFactory) {\r\n                var result = viewFactory.create(context.childContainer);\r\n                result.bind(context.bindingContext, context.overrideContext);\r\n                if (context.compositionTransactionOwnershipToken) {\r\n                    return context.compositionTransactionOwnershipToken.waitForCompositionComplete()\r\n                        .then(function () { return _this._swap(context, result); })\r\n                        .then(function () { return result; });\r\n                }\r\n                return _this._swap(context, result).then(function () { return result; });\r\n            });\r\n        }\r\n        else if (context.viewSlot) {\r\n            context.viewSlot.removeAll();\r\n            if (context.compositionTransactionNotifier) {\r\n                context.compositionTransactionNotifier.done();\r\n            }\r\n            return Promise.resolve(null);\r\n        }\r\n        return Promise.resolve(null);\r\n    };\r\n    CompositionEngine = __decorate([\r\n        Object(aurelia_dependency_injection__WEBPACK_IMPORTED_MODULE_6__[\"inject\"])(ViewEngine, ViewLocator)\r\n    ], CompositionEngine);\r\n    return CompositionEngine;\r\n}());\n\nvar animationEvent = {\r\n    enterBegin: 'animation:enter:begin',\r\n    enterActive: 'animation:enter:active',\r\n    enterDone: 'animation:enter:done',\r\n    enterTimeout: 'animation:enter:timeout',\r\n    leaveBegin: 'animation:leave:begin',\r\n    leaveActive: 'animation:leave:active',\r\n    leaveDone: 'animation:leave:done',\r\n    leaveTimeout: 'animation:leave:timeout',\r\n    staggerNext: 'animation:stagger:next',\r\n    removeClassBegin: 'animation:remove-class:begin',\r\n    removeClassActive: 'animation:remove-class:active',\r\n    removeClassDone: 'animation:remove-class:done',\r\n    removeClassTimeout: 'animation:remove-class:timeout',\r\n    addClassBegin: 'animation:add-class:begin',\r\n    addClassActive: 'animation:add-class:active',\r\n    addClassDone: 'animation:add-class:done',\r\n    addClassTimeout: 'animation:add-class:timeout',\r\n    animateBegin: 'animation:animate:begin',\r\n    animateActive: 'animation:animate:active',\r\n    animateDone: 'animation:animate:done',\r\n    animateTimeout: 'animation:animate:timeout',\r\n    sequenceBegin: 'animation:sequence:begin',\r\n    sequenceDone: 'animation:sequence:done'\r\n};\n\nfunction createChildObserverDecorator(selectorOrConfig, all) {\r\n    return function (target, key, descriptor) {\r\n        var actualTarget = typeof key === 'string' ? target.constructor : target;\r\n        var r = aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].getOrCreateOwn(aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].resource, HtmlBehaviorResource, actualTarget);\r\n        if (typeof selectorOrConfig === 'string') {\r\n            selectorOrConfig = {\r\n                selector: selectorOrConfig,\r\n                name: key\r\n            };\r\n        }\r\n        if (descriptor) {\r\n            descriptor.writable = true;\r\n            descriptor.configurable = true;\r\n        }\r\n        selectorOrConfig.all = all;\r\n        r.addChildBinding(new ChildObserver(selectorOrConfig));\r\n    };\r\n}\r\nfunction children(selectorOrConfig) {\r\n    return createChildObserverDecorator(selectorOrConfig, true);\r\n}\r\nfunction child(selectorOrConfig) {\r\n    return createChildObserverDecorator(selectorOrConfig, false);\r\n}\r\nvar ChildObserver = (function () {\r\n    function ChildObserver(config) {\r\n        this.name = config.name;\r\n        this.changeHandler = config.changeHandler || this.name + 'Changed';\r\n        this.selector = config.selector;\r\n        this.all = config.all;\r\n    }\r\n    ChildObserver.prototype.create = function (viewHost, viewModel, controller) {\r\n        return new ChildObserverBinder(this.selector, viewHost, this.name, viewModel, controller, this.changeHandler, this.all);\r\n    };\r\n    return ChildObserver;\r\n}());\r\nvar noMutations = [];\r\nfunction trackMutation(groupedMutations, binder, record) {\r\n    var mutations = groupedMutations.get(binder);\r\n    if (!mutations) {\r\n        mutations = [];\r\n        groupedMutations.set(binder, mutations);\r\n    }\r\n    mutations.push(record);\r\n}\r\nfunction onChildChange(mutations, observer) {\r\n    var binders = observer.binders;\r\n    var bindersLength = binders.length;\r\n    var groupedMutations = new Map();\r\n    for (var i = 0, ii = mutations.length; i < ii; ++i) {\r\n        var record = mutations[i];\r\n        var added = record.addedNodes;\r\n        var removed = record.removedNodes;\r\n        for (var j = 0, jj = removed.length; j < jj; ++j) {\r\n            var node = removed[j];\r\n            if (node.nodeType === 1) {\r\n                for (var k = 0; k < bindersLength; ++k) {\r\n                    var binder = binders[k];\r\n                    if (binder.onRemove(node)) {\r\n                        trackMutation(groupedMutations, binder, record);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        for (var j = 0, jj = added.length; j < jj; ++j) {\r\n            var node = added[j];\r\n            if (node.nodeType === 1) {\r\n                for (var k = 0; k < bindersLength; ++k) {\r\n                    var binder = binders[k];\r\n                    if (binder.onAdd(node)) {\r\n                        trackMutation(groupedMutations, binder, record);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n    groupedMutations.forEach(function (mutationRecords, binder) {\r\n        if (binder.isBound && binder.changeHandler !== null) {\r\n            binder.viewModel[binder.changeHandler](mutationRecords);\r\n        }\r\n    });\r\n}\r\nvar ChildObserverBinder = (function () {\r\n    function ChildObserverBinder(selector, viewHost, property, viewModel, controller, changeHandler, all) {\r\n        this.selector = selector;\r\n        this.viewHost = viewHost;\r\n        this.property = property;\r\n        this.viewModel = viewModel;\r\n        this.controller = controller;\r\n        this.changeHandler = changeHandler in viewModel ? changeHandler : null;\r\n        this.usesShadowDOM = controller.behavior.usesShadowDOM;\r\n        this.all = all;\r\n        if (!this.usesShadowDOM && controller.view && controller.view.contentView) {\r\n            this.contentView = controller.view.contentView;\r\n        }\r\n        else {\r\n            this.contentView = null;\r\n        }\r\n        this.source = null;\r\n        this.isBound = false;\r\n    }\r\n    ChildObserverBinder.prototype.matches = function (element) {\r\n        if (element.matches(this.selector)) {\r\n            if (this.contentView === null) {\r\n                return true;\r\n            }\r\n            var contentView = this.contentView;\r\n            var assignedSlot = element.auAssignedSlot;\r\n            if (assignedSlot && assignedSlot.projectFromAnchors) {\r\n                var anchors = assignedSlot.projectFromAnchors;\r\n                for (var i = 0, ii = anchors.length; i < ii; ++i) {\r\n                    if (anchors[i].auOwnerView === contentView) {\r\n                        return true;\r\n                    }\r\n                }\r\n                return false;\r\n            }\r\n            return element.auOwnerView === contentView;\r\n        }\r\n        return false;\r\n    };\r\n    ChildObserverBinder.prototype.bind = function (source) {\r\n        if (this.isBound) {\r\n            if (this.source === source) {\r\n                return;\r\n            }\r\n            this.source = source;\r\n        }\r\n        this.isBound = true;\r\n        var viewHost = this.viewHost;\r\n        var viewModel = this.viewModel;\r\n        var observer = viewHost.__childObserver__;\r\n        if (!observer) {\r\n            observer = viewHost.__childObserver__ = aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].createMutationObserver(onChildChange);\r\n            var options = {\r\n                childList: true,\r\n                subtree: !this.usesShadowDOM\r\n            };\r\n            observer.observe(viewHost, options);\r\n            observer.binders = [];\r\n        }\r\n        observer.binders.push(this);\r\n        if (this.usesShadowDOM) {\r\n            var current = viewHost.firstElementChild;\r\n            if (this.all) {\r\n                var items = viewModel[this.property];\r\n                if (!items) {\r\n                    items = viewModel[this.property] = [];\r\n                }\r\n                else {\r\n                    items.splice(0);\r\n                }\r\n                while (current) {\r\n                    if (this.matches(current)) {\r\n                        items.push(current.au && current.au.controller ? current.au.controller.viewModel : current);\r\n                    }\r\n                    current = current.nextElementSibling;\r\n                }\r\n                if (this.changeHandler !== null) {\r\n                    this.viewModel[this.changeHandler](noMutations);\r\n                }\r\n            }\r\n            else {\r\n                while (current) {\r\n                    if (this.matches(current)) {\r\n                        var value = current.au && current.au.controller ? current.au.controller.viewModel : current;\r\n                        this.viewModel[this.property] = value;\r\n                        if (this.changeHandler !== null) {\r\n                            this.viewModel[this.changeHandler](value);\r\n                        }\r\n                        break;\r\n                    }\r\n                    current = current.nextElementSibling;\r\n                }\r\n            }\r\n        }\r\n    };\r\n    ChildObserverBinder.prototype.onRemove = function (element) {\r\n        if (this.matches(element)) {\r\n            var value = element.au && element.au.controller ? element.au.controller.viewModel : element;\r\n            if (this.all) {\r\n                var items = (this.viewModel[this.property] || (this.viewModel[this.property] = []));\r\n                var index = items.indexOf(value);\r\n                if (index !== -1) {\r\n                    items.splice(index, 1);\r\n                }\r\n                return true;\r\n            }\r\n            var currentValue = this.viewModel[this.property];\r\n            if (currentValue === value) {\r\n                this.viewModel[this.property] = null;\r\n                if (this.isBound && this.changeHandler !== null) {\r\n                    this.viewModel[this.changeHandler](value);\r\n                }\r\n            }\r\n        }\r\n        return false;\r\n    };\r\n    ChildObserverBinder.prototype.onAdd = function (element) {\r\n        if (this.matches(element)) {\r\n            var value = element.au && element.au.controller ? element.au.controller.viewModel : element;\r\n            if (this.all) {\r\n                var items = (this.viewModel[this.property] || (this.viewModel[this.property] = []));\r\n                if (this.selector === '*') {\r\n                    items.push(value);\r\n                    return true;\r\n                }\r\n                var index = 0;\r\n                var prev = element.previousElementSibling;\r\n                while (prev) {\r\n                    if (this.matches(prev)) {\r\n                        index++;\r\n                    }\r\n                    prev = prev.previousElementSibling;\r\n                }\r\n                items.splice(index, 0, value);\r\n                return true;\r\n            }\r\n            this.viewModel[this.property] = value;\r\n            if (this.isBound && this.changeHandler !== null) {\r\n                this.viewModel[this.changeHandler](value);\r\n            }\r\n        }\r\n        return false;\r\n    };\r\n    ChildObserverBinder.prototype.unbind = function () {\r\n        if (!this.isBound) {\r\n            return;\r\n        }\r\n        this.isBound = false;\r\n        this.source = null;\r\n        var childObserver = this.viewHost.__childObserver__;\r\n        if (childObserver) {\r\n            var binders = childObserver.binders;\r\n            if (binders && binders.length) {\r\n                var idx = binders.indexOf(this);\r\n                if (idx !== -1) {\r\n                    binders.splice(idx, 1);\r\n                }\r\n                if (binders.length === 0) {\r\n                    childObserver.disconnect();\r\n                    this.viewHost.__childObserver__ = null;\r\n                }\r\n            }\r\n            if (this.usesShadowDOM) {\r\n                this.viewModel[this.property] = null;\r\n            }\r\n        }\r\n    };\r\n    return ChildObserverBinder;\r\n}());\n\nvar ElementConfigResource = (function () {\r\n    function ElementConfigResource() {\r\n    }\r\n    ElementConfigResource.prototype.initialize = function (container, target) { };\r\n    ElementConfigResource.prototype.register = function (registry, name) { };\r\n    ElementConfigResource.prototype.load = function (container, target) {\r\n        var config = new target();\r\n        var eventManager = container.get(aurelia_binding__WEBPACK_IMPORTED_MODULE_5__[\"EventManager\"]);\r\n        eventManager.registerElementConfig(config);\r\n    };\r\n    return ElementConfigResource;\r\n}());\n\nfunction resource(instanceOrConfig) {\r\n    return function (target) {\r\n        var isConfig = typeof instanceOrConfig === 'string' || Object.getPrototypeOf(instanceOrConfig) === Object.prototype;\r\n        if (isConfig) {\r\n            target.$resource = instanceOrConfig;\r\n        }\r\n        else {\r\n            aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].define(aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].resource, instanceOrConfig, target);\r\n        }\r\n    };\r\n}\r\nfunction behavior(override) {\r\n    return function (target) {\r\n        if (override instanceof HtmlBehaviorResource) {\r\n            aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].define(aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].resource, override, target);\r\n        }\r\n        else {\r\n            var r = aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].getOrCreateOwn(aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].resource, HtmlBehaviorResource, target);\r\n            Object.assign(r, override);\r\n        }\r\n    };\r\n}\r\nfunction customElement(name) {\r\n    return function (target) {\r\n        var r = aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].getOrCreateOwn(aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].resource, HtmlBehaviorResource, target);\r\n        r.elementName = validateBehaviorName(name, 'custom element');\r\n    };\r\n}\r\nfunction customAttribute(name, defaultBindingMode, aliases) {\r\n    return function (target) {\r\n        var r = aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].getOrCreateOwn(aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].resource, HtmlBehaviorResource, target);\r\n        r.attributeName = validateBehaviorName(name, 'custom attribute');\r\n        r.attributeDefaultBindingMode = defaultBindingMode;\r\n        r.aliases = aliases;\r\n    };\r\n}\r\nfunction templateController(target) {\r\n    var deco = function (t) {\r\n        var r = aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].getOrCreateOwn(aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].resource, HtmlBehaviorResource, t);\r\n        r.liftsContent = true;\r\n    };\r\n    return target ? deco(target) : deco;\r\n}\r\nfunction bindable(nameOrConfigOrTarget, key, descriptor) {\r\n    var deco = function (target, key2, descriptor2) {\r\n        var actualTarget = key2 ? target.constructor : target;\r\n        var r = aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].getOrCreateOwn(aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].resource, HtmlBehaviorResource, actualTarget);\r\n        var prop;\r\n        if (key2) {\r\n            nameOrConfigOrTarget = nameOrConfigOrTarget || {};\r\n            nameOrConfigOrTarget.name = key2;\r\n        }\r\n        prop = new BindableProperty(nameOrConfigOrTarget);\r\n        return prop.registerWith(actualTarget, r, descriptor2);\r\n    };\r\n    if (!nameOrConfigOrTarget) {\r\n        return deco;\r\n    }\r\n    if (key) {\r\n        var target = nameOrConfigOrTarget;\r\n        nameOrConfigOrTarget = null;\r\n        return deco(target, key, descriptor);\r\n    }\r\n    return deco;\r\n}\r\nfunction dynamicOptions(target) {\r\n    var deco = function (t) {\r\n        var r = aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].getOrCreateOwn(aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].resource, HtmlBehaviorResource, t);\r\n        r.hasDynamicOptions = true;\r\n    };\r\n    return target ? deco(target) : deco;\r\n}\r\nvar defaultShadowDOMOptions = { mode: 'open' };\r\nfunction useShadowDOM(targetOrOptions) {\r\n    var options = typeof targetOrOptions === 'function' || !targetOrOptions\r\n        ? defaultShadowDOMOptions\r\n        : targetOrOptions;\r\n    var deco = function (t) {\r\n        var r = aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].getOrCreateOwn(aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].resource, HtmlBehaviorResource, t);\r\n        r.targetShadowDOM = true;\r\n        r.shadowDOMOptions = options;\r\n    };\r\n    return typeof targetOrOptions === 'function' ? deco(targetOrOptions) : deco;\r\n}\r\nfunction processAttributes(processor) {\r\n    return function (t) {\r\n        var r = aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].getOrCreateOwn(aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].resource, HtmlBehaviorResource, t);\r\n        r.processAttributes = function (compiler, resources, node, attributes, elementInstruction) {\r\n            try {\r\n                processor(compiler, resources, node, attributes, elementInstruction);\r\n            }\r\n            catch (error) {\r\n                aurelia_logging__WEBPACK_IMPORTED_MODULE_4__[\"getLogger\"]('templating').error(error);\r\n            }\r\n        };\r\n    };\r\n}\r\nfunction doNotProcessContent() { return false; }\r\nfunction processContent(processor) {\r\n    return function (t) {\r\n        var r = aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].getOrCreateOwn(aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].resource, HtmlBehaviorResource, t);\r\n        r.processContent = processor ? function (compiler, resources, node, instruction) {\r\n            try {\r\n                return processor(compiler, resources, node, instruction);\r\n            }\r\n            catch (error) {\r\n                aurelia_logging__WEBPACK_IMPORTED_MODULE_4__[\"getLogger\"]('templating').error(error);\r\n                return false;\r\n            }\r\n        } : doNotProcessContent;\r\n    };\r\n}\r\nfunction containerless(target) {\r\n    var deco = function (t) {\r\n        var r = aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].getOrCreateOwn(aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].resource, HtmlBehaviorResource, t);\r\n        r.containerless = true;\r\n    };\r\n    return target ? deco(target) : deco;\r\n}\r\nfunction useViewStrategy(strategy) {\r\n    return function (target) {\r\n        aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].define(ViewLocator.viewStrategyMetadataKey, strategy, target);\r\n    };\r\n}\r\nfunction useView(path) {\r\n    return useViewStrategy(new RelativeViewStrategy(path));\r\n}\r\nfunction inlineView(markup, dependencies, dependencyBaseUrl) {\r\n    return useViewStrategy(new InlineViewStrategy(markup, dependencies, dependencyBaseUrl));\r\n}\r\nfunction noView(targetOrDependencies, dependencyBaseUrl) {\r\n    var target;\r\n    var dependencies;\r\n    if (typeof targetOrDependencies === 'function') {\r\n        target = targetOrDependencies;\r\n    }\r\n    else {\r\n        dependencies = targetOrDependencies;\r\n        target = undefined;\r\n    }\r\n    var deco = function (t) {\r\n        aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].define(ViewLocator.viewStrategyMetadataKey, new NoViewStrategy(dependencies, dependencyBaseUrl), t);\r\n    };\r\n    return target ? deco(target) : deco;\r\n}\r\nfunction view(templateOrConfig) {\r\n    return function (target) {\r\n        target.$view = templateOrConfig;\r\n    };\r\n}\r\nfunction elementConfig(target) {\r\n    var deco = function (t) {\r\n        aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].define(aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].resource, new ElementConfigResource(), t);\r\n    };\r\n    return target ? deco(target) : deco;\r\n}\r\nfunction viewResources() {\r\n    var resources = [];\r\n    for (var _i = 0; _i < arguments.length; _i++) {\r\n        resources[_i] = arguments[_i];\r\n    }\r\n    return function (target) {\r\n        aurelia_metadata__WEBPACK_IMPORTED_MODULE_2__[\"metadata\"].define(ViewEngine.viewModelRequireMetadataKey, resources, target);\r\n    };\r\n}\n\nvar TemplatingEngine = (function () {\r\n    function TemplatingEngine(container, moduleAnalyzer, viewCompiler, compositionEngine) {\r\n        this._container = container;\r\n        this._moduleAnalyzer = moduleAnalyzer;\r\n        this._viewCompiler = viewCompiler;\r\n        this._compositionEngine = compositionEngine;\r\n        container.registerInstance(Animator, Animator.instance = new Animator());\r\n    }\r\n    TemplatingEngine.prototype.configureAnimator = function (animator) {\r\n        this._container.unregister(Animator);\r\n        this._container.registerInstance(Animator, Animator.instance = animator);\r\n    };\r\n    TemplatingEngine.prototype.compose = function (context) {\r\n        return this._compositionEngine.compose(context);\r\n    };\r\n    TemplatingEngine.prototype.enhance = function (instruction) {\r\n        if (instruction instanceof aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].Element) {\r\n            instruction = { element: instruction };\r\n        }\r\n        var compilerInstructions = { letExpressions: [] };\r\n        var resources = instruction.resources || this._container.get(ViewResources);\r\n        this._viewCompiler._compileNode(instruction.element, resources, compilerInstructions, instruction.element.parentNode, 'root', true);\r\n        var factory = new ViewFactory(instruction.element, compilerInstructions, resources);\r\n        var container = instruction.container || this._container.createChild();\r\n        var view = factory.create(container, BehaviorInstruction.enhance());\r\n        view.bind(instruction.bindingContext || {}, instruction.overrideContext);\r\n        view.firstChild = view.lastChild = view.fragment;\r\n        view.fragment = aurelia_pal__WEBPACK_IMPORTED_MODULE_0__[\"DOM\"].createDocumentFragment();\r\n        view.attached();\r\n        return view;\r\n    };\r\n    TemplatingEngine.inject = [aurelia_dependency_injection__WEBPACK_IMPORTED_MODULE_6__[\"Container\"], ModuleAnalyzer, ViewCompiler, CompositionEngine];\r\n    return TemplatingEngine;\r\n}());\n\n\n//# sourceMappingURL=aurelia-templating.js.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ0NodC5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy9hdXJlbGlhLWZyYW1ld29yay9ub2RlX21vZHVsZXMvYXVyZWxpYS10ZW1wbGF0aW5nL2Rpc3QvbmF0aXZlLW1vZHVsZXMvYXVyZWxpYS10ZW1wbGF0aW5nLmpzPzgwMjgiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRE9NLCBGRUFUVVJFLCBQTEFURk9STSB9IGZyb20gJ2F1cmVsaWEtcGFsJztcbmltcG9ydCB7IFRlbXBsYXRlUmVnaXN0cnlFbnRyeSwgTG9hZGVyIH0gZnJvbSAnYXVyZWxpYS1sb2FkZXInO1xuaW1wb3J0IHsgbWV0YWRhdGEsIE9yaWdpbiwgcHJvdG9jb2wgfSBmcm9tICdhdXJlbGlhLW1ldGFkYXRhJztcbmltcG9ydCB7IHJlbGF0aXZlVG9GaWxlIH0gZnJvbSAnYXVyZWxpYS1wYXRoJztcbmltcG9ydCAqIGFzIExvZ01hbmFnZXIgZnJvbSAnYXVyZWxpYS1sb2dnaW5nJztcbmltcG9ydCB7IHN1YnNjcmliZXJDb2xsZWN0aW9uLCBiaW5kaW5nTW9kZSwgY3JlYXRlT3ZlcnJpZGVDb250ZXh0LCBWYWx1ZUNvbnZlcnRlclJlc291cmNlLCBCaW5kaW5nQmVoYXZpb3JSZXNvdXJjZSwgT2JzZXJ2ZXJMb2NhdG9yLCBjYW1lbENhc2UsIEV2ZW50TWFuYWdlciB9IGZyb20gJ2F1cmVsaWEtYmluZGluZyc7XG5pbXBvcnQgeyBDb250YWluZXIsIHJlc29sdmVyLCBpbmplY3QgfSBmcm9tICdhdXJlbGlhLWRlcGVuZGVuY3ktaW5qZWN0aW9uJztcbmltcG9ydCB7IFRhc2tRdWV1ZSB9IGZyb20gJ2F1cmVsaWEtdGFzay1xdWV1ZSc7XG5cbnZhciBFbGVtZW50RXZlbnRzID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIEVsZW1lbnRFdmVudHMoZWxlbWVudCkge1xyXG4gICAgICAgIHRoaXMuZWxlbWVudCA9IGVsZW1lbnQ7XHJcbiAgICAgICAgdGhpcy5zdWJzY3JpcHRpb25zID0ge307XHJcbiAgICB9XHJcbiAgICBFbGVtZW50RXZlbnRzLnByb3RvdHlwZS5fZW5xdWV1ZUhhbmRsZXIgPSBmdW5jdGlvbiAoaGFuZGxlcikge1xyXG4gICAgICAgIHRoaXMuc3Vic2NyaXB0aW9uc1toYW5kbGVyLmV2ZW50TmFtZV0gPSB0aGlzLnN1YnNjcmlwdGlvbnNbaGFuZGxlci5ldmVudE5hbWVdIHx8IFtdO1xyXG4gICAgICAgIHRoaXMuc3Vic2NyaXB0aW9uc1toYW5kbGVyLmV2ZW50TmFtZV0ucHVzaChoYW5kbGVyKTtcclxuICAgIH07XHJcbiAgICBFbGVtZW50RXZlbnRzLnByb3RvdHlwZS5fZGVxdWV1ZUhhbmRsZXIgPSBmdW5jdGlvbiAoaGFuZGxlcikge1xyXG4gICAgICAgIHZhciBpbmRleDtcclxuICAgICAgICB2YXIgc3Vic2NyaXB0aW9ucyA9IHRoaXMuc3Vic2NyaXB0aW9uc1toYW5kbGVyLmV2ZW50TmFtZV07XHJcbiAgICAgICAgaWYgKHN1YnNjcmlwdGlvbnMpIHtcclxuICAgICAgICAgICAgaW5kZXggPSBzdWJzY3JpcHRpb25zLmluZGV4T2YoaGFuZGxlcik7XHJcbiAgICAgICAgICAgIGlmIChpbmRleCA+IC0xKSB7XHJcbiAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb25zLnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGhhbmRsZXI7XHJcbiAgICB9O1xyXG4gICAgRWxlbWVudEV2ZW50cy5wcm90b3R5cGUucHVibGlzaCA9IGZ1bmN0aW9uIChldmVudE5hbWUsIGRldGFpbCwgYnViYmxlcywgY2FuY2VsYWJsZSkge1xyXG4gICAgICAgIGlmIChkZXRhaWwgPT09IHZvaWQgMCkgeyBkZXRhaWwgPSB7fTsgfVxyXG4gICAgICAgIGlmIChidWJibGVzID09PSB2b2lkIDApIHsgYnViYmxlcyA9IHRydWU7IH1cclxuICAgICAgICBpZiAoY2FuY2VsYWJsZSA9PT0gdm9pZCAwKSB7IGNhbmNlbGFibGUgPSB0cnVlOyB9XHJcbiAgICAgICAgdmFyIGV2ZW50ID0gRE9NLmNyZWF0ZUN1c3RvbUV2ZW50KGV2ZW50TmFtZSwgeyBjYW5jZWxhYmxlOiBjYW5jZWxhYmxlLCBidWJibGVzOiBidWJibGVzLCBkZXRhaWw6IGRldGFpbCB9KTtcclxuICAgICAgICB0aGlzLmVsZW1lbnQuZGlzcGF0Y2hFdmVudChldmVudCk7XHJcbiAgICB9O1xyXG4gICAgRWxlbWVudEV2ZW50cy5wcm90b3R5cGUuc3Vic2NyaWJlID0gZnVuY3Rpb24gKGV2ZW50TmFtZSwgaGFuZGxlciwgY2FwdHVyZU9yT3B0aW9ucykge1xyXG4gICAgICAgIGlmICh0eXBlb2YgaGFuZGxlciA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICBpZiAoY2FwdHVyZU9yT3B0aW9ucyA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICBjYXB0dXJlT3JPcHRpb25zID0gRWxlbWVudEV2ZW50cy5kZWZhdWx0TGlzdGVuZXJPcHRpb25zO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBldmVudEhhbmRsZXIgPSBuZXcgRXZlbnRIYW5kbGVySW1wbCh0aGlzLCBldmVudE5hbWUsIGhhbmRsZXIsIGNhcHR1cmVPck9wdGlvbnMsIGZhbHNlKTtcclxuICAgICAgICAgICAgcmV0dXJuIGV2ZW50SGFuZGxlcjtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgIH07XHJcbiAgICBFbGVtZW50RXZlbnRzLnByb3RvdHlwZS5zdWJzY3JpYmVPbmNlID0gZnVuY3Rpb24gKGV2ZW50TmFtZSwgaGFuZGxlciwgY2FwdHVyZU9yT3B0aW9ucykge1xyXG4gICAgICAgIGlmICh0eXBlb2YgaGFuZGxlciA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICBpZiAoY2FwdHVyZU9yT3B0aW9ucyA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICBjYXB0dXJlT3JPcHRpb25zID0gRWxlbWVudEV2ZW50cy5kZWZhdWx0TGlzdGVuZXJPcHRpb25zO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBldmVudEhhbmRsZXIgPSBuZXcgRXZlbnRIYW5kbGVySW1wbCh0aGlzLCBldmVudE5hbWUsIGhhbmRsZXIsIGNhcHR1cmVPck9wdGlvbnMsIHRydWUpO1xyXG4gICAgICAgICAgICByZXR1cm4gZXZlbnRIYW5kbGVyO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgfTtcclxuICAgIEVsZW1lbnRFdmVudHMucHJvdG90eXBlLmRpc3Bvc2UgPSBmdW5jdGlvbiAoZXZlbnROYW1lKSB7XHJcbiAgICAgICAgaWYgKGV2ZW50TmFtZSAmJiB0eXBlb2YgZXZlbnROYW1lID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICB2YXIgc3Vic2NyaXB0aW9ucyA9IHRoaXMuc3Vic2NyaXB0aW9uc1tldmVudE5hbWVdO1xyXG4gICAgICAgICAgICBpZiAoc3Vic2NyaXB0aW9ucykge1xyXG4gICAgICAgICAgICAgICAgd2hpbGUgKHN1YnNjcmlwdGlvbnMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHN1YnNjcmlwdGlvbiA9IHN1YnNjcmlwdGlvbnMucG9wKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHN1YnNjcmlwdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb24uZGlzcG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5kaXNwb3NlQWxsKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIEVsZW1lbnRFdmVudHMucHJvdG90eXBlLmRpc3Bvc2VBbGwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgZm9yICh2YXIga2V5IGluIHRoaXMuc3Vic2NyaXB0aW9ucykge1xyXG4gICAgICAgICAgICB0aGlzLmRpc3Bvc2Uoa2V5KTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgRWxlbWVudEV2ZW50cy5kZWZhdWx0TGlzdGVuZXJPcHRpb25zID0gdHJ1ZTtcclxuICAgIHJldHVybiBFbGVtZW50RXZlbnRzO1xyXG59KCkpO1xyXG52YXIgRXZlbnRIYW5kbGVySW1wbCA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBFdmVudEhhbmRsZXJJbXBsKG93bmVyLCBldmVudE5hbWUsIGhhbmRsZXIsIGNhcHR1cmVPck9wdGlvbnMsIG9uY2UpIHtcclxuICAgICAgICB0aGlzLm93bmVyID0gb3duZXI7XHJcbiAgICAgICAgdGhpcy5ldmVudE5hbWUgPSBldmVudE5hbWU7XHJcbiAgICAgICAgdGhpcy5oYW5kbGVyID0gaGFuZGxlcjtcclxuICAgICAgICB0aGlzLmNhcHR1cmUgPSB0eXBlb2YgY2FwdHVyZU9yT3B0aW9ucyA9PT0gJ2Jvb2xlYW4nID8gY2FwdHVyZU9yT3B0aW9ucyA6IGNhcHR1cmVPck9wdGlvbnMuY2FwdHVyZTtcclxuICAgICAgICB0aGlzLmJ1YmJsZXMgPSAhdGhpcy5jYXB0dXJlO1xyXG4gICAgICAgIHRoaXMuY2FwdHVyZU9yT3B0aW9ucyA9IGNhcHR1cmVPck9wdGlvbnM7XHJcbiAgICAgICAgdGhpcy5vbmNlID0gb25jZTtcclxuICAgICAgICBvd25lci5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCB0aGlzLCBjYXB0dXJlT3JPcHRpb25zKTtcclxuICAgICAgICBvd25lci5fZW5xdWV1ZUhhbmRsZXIodGhpcyk7XHJcbiAgICB9XHJcbiAgICBFdmVudEhhbmRsZXJJbXBsLnByb3RvdHlwZS5oYW5kbGVFdmVudCA9IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgdmFyIGZuID0gdGhpcy5oYW5kbGVyO1xyXG4gICAgICAgIGZuKGUpO1xyXG4gICAgICAgIGlmICh0aGlzLm9uY2UpIHtcclxuICAgICAgICAgICAgdGhpcy5kaXNwb3NlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIEV2ZW50SGFuZGxlckltcGwucHJvdG90eXBlLmRpc3Bvc2UgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdGhpcy5vd25lci5lbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIodGhpcy5ldmVudE5hbWUsIHRoaXMsIHRoaXMuY2FwdHVyZU9yT3B0aW9ucyk7XHJcbiAgICAgICAgdGhpcy5vd25lci5fZGVxdWV1ZUhhbmRsZXIodGhpcyk7XHJcbiAgICAgICAgdGhpcy5vd25lciA9IHRoaXMuaGFuZGxlciA9IG51bGw7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIEV2ZW50SGFuZGxlckltcGw7XHJcbn0oKSk7XG5cbnZhciBSZXNvdXJjZUxvYWRDb250ZXh0ID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIFJlc291cmNlTG9hZENvbnRleHQoKSB7XHJcbiAgICAgICAgdGhpcy5kZXBlbmRlbmNpZXMgPSB7fTtcclxuICAgIH1cclxuICAgIFJlc291cmNlTG9hZENvbnRleHQucHJvdG90eXBlLmFkZERlcGVuZGVuY3kgPSBmdW5jdGlvbiAodXJsKSB7XHJcbiAgICAgICAgdGhpcy5kZXBlbmRlbmNpZXNbdXJsXSA9IHRydWU7XHJcbiAgICB9O1xyXG4gICAgUmVzb3VyY2VMb2FkQ29udGV4dC5wcm90b3R5cGUuaGFzRGVwZW5kZW5jeSA9IGZ1bmN0aW9uICh1cmwpIHtcclxuICAgICAgICByZXR1cm4gdXJsIGluIHRoaXMuZGVwZW5kZW5jaWVzO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBSZXNvdXJjZUxvYWRDb250ZXh0O1xyXG59KCkpO1xyXG52YXIgVmlld0NvbXBpbGVJbnN0cnVjdGlvbiA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBWaWV3Q29tcGlsZUluc3RydWN0aW9uKHRhcmdldFNoYWRvd0RPTSwgY29tcGlsZVN1cnJvZ2F0ZSkge1xyXG4gICAgICAgIGlmICh0YXJnZXRTaGFkb3dET00gPT09IHZvaWQgMCkgeyB0YXJnZXRTaGFkb3dET00gPSBmYWxzZTsgfVxyXG4gICAgICAgIGlmIChjb21waWxlU3Vycm9nYXRlID09PSB2b2lkIDApIHsgY29tcGlsZVN1cnJvZ2F0ZSA9IGZhbHNlOyB9XHJcbiAgICAgICAgdGhpcy50YXJnZXRTaGFkb3dET00gPSB0YXJnZXRTaGFkb3dET007XHJcbiAgICAgICAgdGhpcy5jb21waWxlU3Vycm9nYXRlID0gY29tcGlsZVN1cnJvZ2F0ZTtcclxuICAgICAgICB0aGlzLmFzc29jaWF0ZWRNb2R1bGVJZCA9IG51bGw7XHJcbiAgICB9XHJcbiAgICBWaWV3Q29tcGlsZUluc3RydWN0aW9uLm5vcm1hbCA9IG5ldyBWaWV3Q29tcGlsZUluc3RydWN0aW9uKCk7XHJcbiAgICByZXR1cm4gVmlld0NvbXBpbGVJbnN0cnVjdGlvbjtcclxufSgpKTtcclxudmFyIEJlaGF2aW9ySW5zdHJ1Y3Rpb24gPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gQmVoYXZpb3JJbnN0cnVjdGlvbigpIHtcclxuICAgIH1cclxuICAgIEJlaGF2aW9ySW5zdHJ1Y3Rpb24uZW5oYW5jZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgaW5zdHJ1Y3Rpb24gPSBuZXcgQmVoYXZpb3JJbnN0cnVjdGlvbigpO1xyXG4gICAgICAgIGluc3RydWN0aW9uLmVuaGFuY2UgPSB0cnVlO1xyXG4gICAgICAgIHJldHVybiBpbnN0cnVjdGlvbjtcclxuICAgIH07XHJcbiAgICBCZWhhdmlvckluc3RydWN0aW9uLnVuaXRUZXN0ID0gZnVuY3Rpb24gKHR5cGUsIGF0dHJpYnV0ZXMpIHtcclxuICAgICAgICB2YXIgaW5zdHJ1Y3Rpb24gPSBuZXcgQmVoYXZpb3JJbnN0cnVjdGlvbigpO1xyXG4gICAgICAgIGluc3RydWN0aW9uLnR5cGUgPSB0eXBlO1xyXG4gICAgICAgIGluc3RydWN0aW9uLmF0dHJpYnV0ZXMgPSBhdHRyaWJ1dGVzIHx8IHt9O1xyXG4gICAgICAgIHJldHVybiBpbnN0cnVjdGlvbjtcclxuICAgIH07XHJcbiAgICBCZWhhdmlvckluc3RydWN0aW9uLmVsZW1lbnQgPSBmdW5jdGlvbiAobm9kZSwgdHlwZSkge1xyXG4gICAgICAgIHZhciBpbnN0cnVjdGlvbiA9IG5ldyBCZWhhdmlvckluc3RydWN0aW9uKCk7XHJcbiAgICAgICAgaW5zdHJ1Y3Rpb24udHlwZSA9IHR5cGU7XHJcbiAgICAgICAgaW5zdHJ1Y3Rpb24uYXR0cmlidXRlcyA9IHt9O1xyXG4gICAgICAgIGluc3RydWN0aW9uLmFuY2hvcklzQ29udGFpbmVyID0gIShub2RlLmhhc0F0dHJpYnV0ZSgnY29udGFpbmVybGVzcycpIHx8IHR5cGUuY29udGFpbmVybGVzcyk7XHJcbiAgICAgICAgaW5zdHJ1Y3Rpb24uaW5pdGlhdGVkQnlCZWhhdmlvciA9IHRydWU7XHJcbiAgICAgICAgcmV0dXJuIGluc3RydWN0aW9uO1xyXG4gICAgfTtcclxuICAgIEJlaGF2aW9ySW5zdHJ1Y3Rpb24uYXR0cmlidXRlID0gZnVuY3Rpb24gKGF0dHJOYW1lLCB0eXBlKSB7XHJcbiAgICAgICAgdmFyIGluc3RydWN0aW9uID0gbmV3IEJlaGF2aW9ySW5zdHJ1Y3Rpb24oKTtcclxuICAgICAgICBpbnN0cnVjdGlvbi5hdHRyTmFtZSA9IGF0dHJOYW1lO1xyXG4gICAgICAgIGluc3RydWN0aW9uLnR5cGUgPSB0eXBlIHx8IG51bGw7XHJcbiAgICAgICAgaW5zdHJ1Y3Rpb24uYXR0cmlidXRlcyA9IHt9O1xyXG4gICAgICAgIHJldHVybiBpbnN0cnVjdGlvbjtcclxuICAgIH07XHJcbiAgICBCZWhhdmlvckluc3RydWN0aW9uLmR5bmFtaWMgPSBmdW5jdGlvbiAoaG9zdCwgdmlld01vZGVsLCB2aWV3RmFjdG9yeSkge1xyXG4gICAgICAgIHZhciBpbnN0cnVjdGlvbiA9IG5ldyBCZWhhdmlvckluc3RydWN0aW9uKCk7XHJcbiAgICAgICAgaW5zdHJ1Y3Rpb24uaG9zdCA9IGhvc3Q7XHJcbiAgICAgICAgaW5zdHJ1Y3Rpb24udmlld01vZGVsID0gdmlld01vZGVsO1xyXG4gICAgICAgIGluc3RydWN0aW9uLnZpZXdGYWN0b3J5ID0gdmlld0ZhY3Rvcnk7XHJcbiAgICAgICAgaW5zdHJ1Y3Rpb24uaW5oZXJpdEJpbmRpbmdDb250ZXh0ID0gdHJ1ZTtcclxuICAgICAgICByZXR1cm4gaW5zdHJ1Y3Rpb247XHJcbiAgICB9O1xyXG4gICAgQmVoYXZpb3JJbnN0cnVjdGlvbi5ub3JtYWwgPSBuZXcgQmVoYXZpb3JJbnN0cnVjdGlvbigpO1xyXG4gICAgcmV0dXJuIEJlaGF2aW9ySW5zdHJ1Y3Rpb247XHJcbn0oKSk7XHJcbnZhciBiaVByb3RvID0gQmVoYXZpb3JJbnN0cnVjdGlvbi5wcm90b3R5cGU7XHJcbmJpUHJvdG8uaW5pdGlhdGVkQnlCZWhhdmlvciA9IGZhbHNlO1xyXG5iaVByb3RvLmVuaGFuY2UgPSBmYWxzZTtcclxuYmlQcm90by5wYXJ0UmVwbGFjZW1lbnRzID0gbnVsbDtcclxuYmlQcm90by52aWV3RmFjdG9yeSA9IG51bGw7XHJcbmJpUHJvdG8ub3JpZ2luYWxBdHRyTmFtZSA9IG51bGw7XHJcbmJpUHJvdG8uc2tpcENvbnRlbnRQcm9jZXNzaW5nID0gZmFsc2U7XHJcbmJpUHJvdG8uY29udGVudEZhY3RvcnkgPSBudWxsO1xyXG5iaVByb3RvLnZpZXdNb2RlbCA9IG51bGw7XHJcbmJpUHJvdG8uYW5jaG9ySXNDb250YWluZXIgPSBmYWxzZTtcclxuYmlQcm90by5ob3N0ID0gbnVsbDtcclxuYmlQcm90by5hdHRyaWJ1dGVzID0gbnVsbDtcclxuYmlQcm90by50eXBlID0gbnVsbDtcclxuYmlQcm90by5hdHRyTmFtZSA9IG51bGw7XHJcbmJpUHJvdG8uaW5oZXJpdEJpbmRpbmdDb250ZXh0ID0gZmFsc2U7XHJcbnZhciBUYXJnZXRJbnN0cnVjdGlvbiA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBUYXJnZXRJbnN0cnVjdGlvbigpIHtcclxuICAgIH1cclxuICAgIFRhcmdldEluc3RydWN0aW9uLnNoYWRvd1Nsb3QgPSBmdW5jdGlvbiAocGFyZW50SW5qZWN0b3JJZCkge1xyXG4gICAgICAgIHZhciBpbnN0cnVjdGlvbiA9IG5ldyBUYXJnZXRJbnN0cnVjdGlvbigpO1xyXG4gICAgICAgIGluc3RydWN0aW9uLnBhcmVudEluamVjdG9ySWQgPSBwYXJlbnRJbmplY3RvcklkO1xyXG4gICAgICAgIGluc3RydWN0aW9uLnNoYWRvd1Nsb3QgPSB0cnVlO1xyXG4gICAgICAgIHJldHVybiBpbnN0cnVjdGlvbjtcclxuICAgIH07XHJcbiAgICBUYXJnZXRJbnN0cnVjdGlvbi5jb250ZW50RXhwcmVzc2lvbiA9IGZ1bmN0aW9uIChleHByZXNzaW9uKSB7XHJcbiAgICAgICAgdmFyIGluc3RydWN0aW9uID0gbmV3IFRhcmdldEluc3RydWN0aW9uKCk7XHJcbiAgICAgICAgaW5zdHJ1Y3Rpb24uY29udGVudEV4cHJlc3Npb24gPSBleHByZXNzaW9uO1xyXG4gICAgICAgIHJldHVybiBpbnN0cnVjdGlvbjtcclxuICAgIH07XHJcbiAgICBUYXJnZXRJbnN0cnVjdGlvbi5sZXRFbGVtZW50ID0gZnVuY3Rpb24gKGV4cHJlc3Npb25zKSB7XHJcbiAgICAgICAgdmFyIGluc3RydWN0aW9uID0gbmV3IFRhcmdldEluc3RydWN0aW9uKCk7XHJcbiAgICAgICAgaW5zdHJ1Y3Rpb24uZXhwcmVzc2lvbnMgPSBleHByZXNzaW9ucztcclxuICAgICAgICBpbnN0cnVjdGlvbi5sZXRFbGVtZW50ID0gdHJ1ZTtcclxuICAgICAgICByZXR1cm4gaW5zdHJ1Y3Rpb247XHJcbiAgICB9O1xyXG4gICAgVGFyZ2V0SW5zdHJ1Y3Rpb24ubGlmdGluZyA9IGZ1bmN0aW9uIChwYXJlbnRJbmplY3RvcklkLCBsaWZ0aW5nSW5zdHJ1Y3Rpb24pIHtcclxuICAgICAgICB2YXIgaW5zdHJ1Y3Rpb24gPSBuZXcgVGFyZ2V0SW5zdHJ1Y3Rpb24oKTtcclxuICAgICAgICBpbnN0cnVjdGlvbi5wYXJlbnRJbmplY3RvcklkID0gcGFyZW50SW5qZWN0b3JJZDtcclxuICAgICAgICBpbnN0cnVjdGlvbi5leHByZXNzaW9ucyA9IFRhcmdldEluc3RydWN0aW9uLm5vRXhwcmVzc2lvbnM7XHJcbiAgICAgICAgaW5zdHJ1Y3Rpb24uYmVoYXZpb3JJbnN0cnVjdGlvbnMgPSBbbGlmdGluZ0luc3RydWN0aW9uXTtcclxuICAgICAgICBpbnN0cnVjdGlvbi52aWV3RmFjdG9yeSA9IGxpZnRpbmdJbnN0cnVjdGlvbi52aWV3RmFjdG9yeTtcclxuICAgICAgICBpbnN0cnVjdGlvbi5wcm92aWRlcnMgPSBbbGlmdGluZ0luc3RydWN0aW9uLnR5cGUudGFyZ2V0XTtcclxuICAgICAgICBpbnN0cnVjdGlvbi5saWZ0aW5nID0gdHJ1ZTtcclxuICAgICAgICByZXR1cm4gaW5zdHJ1Y3Rpb247XHJcbiAgICB9O1xyXG4gICAgVGFyZ2V0SW5zdHJ1Y3Rpb24ubm9ybWFsID0gZnVuY3Rpb24gKGluamVjdG9ySWQsIHBhcmVudEluamVjdG9ySWQsIHByb3ZpZGVycywgYmVoYXZpb3JJbnN0cnVjdGlvbnMsIGV4cHJlc3Npb25zLCBlbGVtZW50SW5zdHJ1Y3Rpb24pIHtcclxuICAgICAgICB2YXIgaW5zdHJ1Y3Rpb24gPSBuZXcgVGFyZ2V0SW5zdHJ1Y3Rpb24oKTtcclxuICAgICAgICBpbnN0cnVjdGlvbi5pbmplY3RvcklkID0gaW5qZWN0b3JJZDtcclxuICAgICAgICBpbnN0cnVjdGlvbi5wYXJlbnRJbmplY3RvcklkID0gcGFyZW50SW5qZWN0b3JJZDtcclxuICAgICAgICBpbnN0cnVjdGlvbi5wcm92aWRlcnMgPSBwcm92aWRlcnM7XHJcbiAgICAgICAgaW5zdHJ1Y3Rpb24uYmVoYXZpb3JJbnN0cnVjdGlvbnMgPSBiZWhhdmlvckluc3RydWN0aW9ucztcclxuICAgICAgICBpbnN0cnVjdGlvbi5leHByZXNzaW9ucyA9IGV4cHJlc3Npb25zO1xyXG4gICAgICAgIGluc3RydWN0aW9uLmFuY2hvcklzQ29udGFpbmVyID0gZWxlbWVudEluc3RydWN0aW9uID8gZWxlbWVudEluc3RydWN0aW9uLmFuY2hvcklzQ29udGFpbmVyIDogdHJ1ZTtcclxuICAgICAgICBpbnN0cnVjdGlvbi5lbGVtZW50SW5zdHJ1Y3Rpb24gPSBlbGVtZW50SW5zdHJ1Y3Rpb247XHJcbiAgICAgICAgcmV0dXJuIGluc3RydWN0aW9uO1xyXG4gICAgfTtcclxuICAgIFRhcmdldEluc3RydWN0aW9uLnN1cnJvZ2F0ZSA9IGZ1bmN0aW9uIChwcm92aWRlcnMsIGJlaGF2aW9ySW5zdHJ1Y3Rpb25zLCBleHByZXNzaW9ucywgdmFsdWVzKSB7XHJcbiAgICAgICAgdmFyIGluc3RydWN0aW9uID0gbmV3IFRhcmdldEluc3RydWN0aW9uKCk7XHJcbiAgICAgICAgaW5zdHJ1Y3Rpb24uZXhwcmVzc2lvbnMgPSBleHByZXNzaW9ucztcclxuICAgICAgICBpbnN0cnVjdGlvbi5iZWhhdmlvckluc3RydWN0aW9ucyA9IGJlaGF2aW9ySW5zdHJ1Y3Rpb25zO1xyXG4gICAgICAgIGluc3RydWN0aW9uLnByb3ZpZGVycyA9IHByb3ZpZGVycztcclxuICAgICAgICBpbnN0cnVjdGlvbi52YWx1ZXMgPSB2YWx1ZXM7XHJcbiAgICAgICAgcmV0dXJuIGluc3RydWN0aW9uO1xyXG4gICAgfTtcclxuICAgIFRhcmdldEluc3RydWN0aW9uLm5vRXhwcmVzc2lvbnMgPSBPYmplY3QuZnJlZXplKFtdKTtcclxuICAgIHJldHVybiBUYXJnZXRJbnN0cnVjdGlvbjtcclxufSgpKTtcclxudmFyIHRpUHJvdG8gPSBUYXJnZXRJbnN0cnVjdGlvbi5wcm90b3R5cGU7XHJcbnRpUHJvdG8uaW5qZWN0b3JJZCA9IG51bGw7XHJcbnRpUHJvdG8ucGFyZW50SW5qZWN0b3JJZCA9IG51bGw7XHJcbnRpUHJvdG8uc2hhZG93U2xvdCA9IGZhbHNlO1xyXG50aVByb3RvLnNsb3ROYW1lID0gbnVsbDtcclxudGlQcm90by5zbG90RmFsbGJhY2tGYWN0b3J5ID0gbnVsbDtcclxudGlQcm90by5jb250ZW50RXhwcmVzc2lvbiA9IG51bGw7XHJcbnRpUHJvdG8ubGV0RWxlbWVudCA9IGZhbHNlO1xyXG50aVByb3RvLmV4cHJlc3Npb25zID0gbnVsbDtcclxudGlQcm90by5leHByZXNzaW9ucyA9IG51bGw7XHJcbnRpUHJvdG8ucHJvdmlkZXJzID0gbnVsbDtcclxudGlQcm90by52aWV3RmFjdG9yeSA9IG51bGw7XHJcbnRpUHJvdG8uYW5jaG9ySXNDb250YWluZXIgPSBmYWxzZTtcclxudGlQcm90by5lbGVtZW50SW5zdHJ1Y3Rpb24gPSBudWxsO1xyXG50aVByb3RvLmxpZnRpbmcgPSBmYWxzZTtcclxudGlQcm90by52YWx1ZXMgPSBudWxsO1xuXG4vKiEgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uXHJcblxyXG5QZXJtaXNzaW9uIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBhbmQvb3IgZGlzdHJpYnV0ZSB0aGlzIHNvZnR3YXJlIGZvciBhbnlcclxucHVycG9zZSB3aXRoIG9yIHdpdGhvdXQgZmVlIGlzIGhlcmVieSBncmFudGVkLlxyXG5cclxuVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiBBTkQgVEhFIEFVVEhPUiBESVNDTEFJTVMgQUxMIFdBUlJBTlRJRVMgV0lUSFxyXG5SRUdBUkQgVE8gVEhJUyBTT0ZUV0FSRSBJTkNMVURJTkcgQUxMIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFlcclxuQU5EIEZJVE5FU1MuIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBBVVRIT1IgQkUgTElBQkxFIEZPUiBBTlkgU1BFQ0lBTCwgRElSRUNULFxyXG5JTkRJUkVDVCwgT1IgQ09OU0VRVUVOVElBTCBEQU1BR0VTIE9SIEFOWSBEQU1BR0VTIFdIQVRTT0VWRVIgUkVTVUxUSU5HIEZST01cclxuTE9TUyBPRiBVU0UsIERBVEEgT1IgUFJPRklUUywgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIE5FR0xJR0VOQ0UgT1JcclxuT1RIRVIgVE9SVElPVVMgQUNUSU9OLCBBUklTSU5HIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFVTRSBPUlxyXG5QRVJGT1JNQU5DRSBPRiBUSElTIFNPRlRXQVJFLlxyXG4qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiAqL1xyXG5cclxuZnVuY3Rpb24gX19kZWNvcmF0ZShkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYykge1xyXG4gICAgdmFyIGMgPSBhcmd1bWVudHMubGVuZ3RoLCByID0gYyA8IDMgPyB0YXJnZXQgOiBkZXNjID09PSBudWxsID8gZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodGFyZ2V0LCBrZXkpIDogZGVzYywgZDtcclxuICAgIGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgUmVmbGVjdC5kZWNvcmF0ZSA9PT0gXCJmdW5jdGlvblwiKSByID0gUmVmbGVjdC5kZWNvcmF0ZShkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYyk7XHJcbiAgICBlbHNlIGZvciAodmFyIGkgPSBkZWNvcmF0b3JzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSBpZiAoZCA9IGRlY29yYXRvcnNbaV0pIHIgPSAoYyA8IDMgPyBkKHIpIDogYyA+IDMgPyBkKHRhcmdldCwga2V5LCByKSA6IGQodGFyZ2V0LCBrZXkpKSB8fCByO1xyXG4gICAgcmV0dXJuIGMgPiAzICYmIHIgJiYgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCByKSwgcjtcclxufVxuXG52YXIgY2FwaXRhbE1hdGNoZXIgPSAvKFtBLVpdKS9nO1xyXG5mdW5jdGlvbiBhZGRIeXBoZW5BbmRMb3dlcihjaGFyKSB7XHJcbiAgICByZXR1cm4gJy0nICsgY2hhci50b0xvd2VyQ2FzZSgpO1xyXG59XHJcbmZ1bmN0aW9uIF9oeXBoZW5hdGUobmFtZSkge1xyXG4gICAgcmV0dXJuIChuYW1lLmNoYXJBdCgwKS50b0xvd2VyQ2FzZSgpICsgbmFtZS5zbGljZSgxKSkucmVwbGFjZShjYXBpdGFsTWF0Y2hlciwgYWRkSHlwaGVuQW5kTG93ZXIpO1xyXG59XHJcbmZ1bmN0aW9uIF9pc0FsbFdoaXRlc3BhY2Uobm9kZSkge1xyXG4gICAgcmV0dXJuICEobm9kZS5hdUludGVycG9sYXRpb25UYXJnZXQgfHwgKC9bXlxcdFxcblxcciBdLy50ZXN0KG5vZGUudGV4dENvbnRlbnQpKSk7XHJcbn1cblxudmFyIEJlaGF2aW9yUHJvcGVydHlPYnNlcnZlciA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBCZWhhdmlvclByb3BlcnR5T2JzZXJ2ZXIodGFza1F1ZXVlLCBvYmosIHByb3BlcnR5TmFtZSwgc2VsZlN1YnNjcmliZXIsIGluaXRpYWxWYWx1ZSkge1xyXG4gICAgICAgIHRoaXMudGFza1F1ZXVlID0gdGFza1F1ZXVlO1xyXG4gICAgICAgIHRoaXMub2JqID0gb2JqO1xyXG4gICAgICAgIHRoaXMucHJvcGVydHlOYW1lID0gcHJvcGVydHlOYW1lO1xyXG4gICAgICAgIHRoaXMubm90cXVldWVkID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLnB1Ymxpc2hpbmcgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLnNlbGZTdWJzY3JpYmVyID0gc2VsZlN1YnNjcmliZXI7XHJcbiAgICAgICAgdGhpcy5jdXJyZW50VmFsdWUgPSB0aGlzLm9sZFZhbHVlID0gaW5pdGlhbFZhbHVlO1xyXG4gICAgfVxyXG4gICAgQmVoYXZpb3JQcm9wZXJ0eU9ic2VydmVyLnByb3RvdHlwZS5nZXRWYWx1ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50VmFsdWU7XHJcbiAgICB9O1xyXG4gICAgQmVoYXZpb3JQcm9wZXJ0eU9ic2VydmVyLnByb3RvdHlwZS5zZXRWYWx1ZSA9IGZ1bmN0aW9uIChuZXdWYWx1ZSkge1xyXG4gICAgICAgIHZhciBvbGRWYWx1ZSA9IHRoaXMuY3VycmVudFZhbHVlO1xyXG4gICAgICAgIGlmICghT2JqZWN0LmlzKG5ld1ZhbHVlLCBvbGRWYWx1ZSkpIHtcclxuICAgICAgICAgICAgdGhpcy5vbGRWYWx1ZSA9IG9sZFZhbHVlO1xyXG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRWYWx1ZSA9IG5ld1ZhbHVlO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5wdWJsaXNoaW5nICYmIHRoaXMubm90cXVldWVkKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy50YXNrUXVldWUuZmx1c2hpbmcpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNhbGwoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubm90cXVldWVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50YXNrUXVldWUucXVldWVNaWNyb1Rhc2sodGhpcyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgQmVoYXZpb3JQcm9wZXJ0eU9ic2VydmVyLnByb3RvdHlwZS5jYWxsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBvbGRWYWx1ZSA9IHRoaXMub2xkVmFsdWU7XHJcbiAgICAgICAgdmFyIG5ld1ZhbHVlID0gdGhpcy5jdXJyZW50VmFsdWU7XHJcbiAgICAgICAgdGhpcy5ub3RxdWV1ZWQgPSB0cnVlO1xyXG4gICAgICAgIGlmIChPYmplY3QuaXMobmV3VmFsdWUsIG9sZFZhbHVlKSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLnNlbGZTdWJzY3JpYmVyKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2VsZlN1YnNjcmliZXIobmV3VmFsdWUsIG9sZFZhbHVlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5jYWxsU3Vic2NyaWJlcnMobmV3VmFsdWUsIG9sZFZhbHVlKTtcclxuICAgICAgICB0aGlzLm9sZFZhbHVlID0gbmV3VmFsdWU7XHJcbiAgICB9O1xyXG4gICAgQmVoYXZpb3JQcm9wZXJ0eU9ic2VydmVyLnByb3RvdHlwZS5jYWxsU3Vic2NyaWJlcnMgPSBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdNZXRob2Qgbm90IGltcGxlbWVudGVkLicpO1xyXG4gICAgfTtcclxuICAgIEJlaGF2aW9yUHJvcGVydHlPYnNlcnZlci5wcm90b3R5cGUuc3Vic2NyaWJlID0gZnVuY3Rpb24gKGNvbnRleHQsIGNhbGxhYmxlKSB7XHJcbiAgICAgICAgdGhpcy5hZGRTdWJzY3JpYmVyKGNvbnRleHQsIGNhbGxhYmxlKTtcclxuICAgIH07XHJcbiAgICBCZWhhdmlvclByb3BlcnR5T2JzZXJ2ZXIucHJvdG90eXBlLmFkZFN1YnNjcmliZXIgPSBmdW5jdGlvbiAoY29udGV4dCwgY2FsbGFibGUpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ01ldGhvZCBub3QgaW1wbGVtZW50ZWQuJyk7XHJcbiAgICB9O1xyXG4gICAgQmVoYXZpb3JQcm9wZXJ0eU9ic2VydmVyLnByb3RvdHlwZS51bnN1YnNjcmliZSA9IGZ1bmN0aW9uIChjb250ZXh0LCBjYWxsYWJsZSkge1xyXG4gICAgICAgIHRoaXMucmVtb3ZlU3Vic2NyaWJlcihjb250ZXh0LCBjYWxsYWJsZSk7XHJcbiAgICB9O1xyXG4gICAgQmVoYXZpb3JQcm9wZXJ0eU9ic2VydmVyLnByb3RvdHlwZS5yZW1vdmVTdWJzY3JpYmVyID0gZnVuY3Rpb24gKGNvbnRleHQsIGNhbGxhYmxlKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdNZXRob2Qgbm90IGltcGxlbWVudGVkLicpO1xyXG4gICAgfTtcclxuICAgIEJlaGF2aW9yUHJvcGVydHlPYnNlcnZlciA9IF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIHN1YnNjcmliZXJDb2xsZWN0aW9uKClcclxuICAgIF0sIEJlaGF2aW9yUHJvcGVydHlPYnNlcnZlcik7XHJcbiAgICByZXR1cm4gQmVoYXZpb3JQcm9wZXJ0eU9ic2VydmVyO1xyXG59KCkpO1xuXG5mdW5jdGlvbiBnZXRPYnNlcnZlcihpbnN0YW5jZSwgbmFtZSkge1xyXG4gICAgdmFyIGxvb2t1cCA9IGluc3RhbmNlLl9fb2JzZXJ2ZXJzX187XHJcbiAgICBpZiAobG9va3VwID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICB2YXIgY3RvciA9IE9iamVjdC5nZXRQcm90b3R5cGVPZihpbnN0YW5jZSkuY29uc3RydWN0b3I7XHJcbiAgICAgICAgdmFyIGJlaGF2aW9yID0gbWV0YWRhdGEuZ2V0KG1ldGFkYXRhLnJlc291cmNlLCBjdG9yKTtcclxuICAgICAgICBpZiAoIWJlaGF2aW9yLmlzSW5pdGlhbGl6ZWQpIHtcclxuICAgICAgICAgICAgYmVoYXZpb3IuaW5pdGlhbGl6ZShDb250YWluZXIuaW5zdGFuY2UgfHwgbmV3IENvbnRhaW5lcigpLCBpbnN0YW5jZS5jb25zdHJ1Y3Rvcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxvb2t1cCA9IGJlaGF2aW9yLm9ic2VydmVyTG9jYXRvci5nZXRPckNyZWF0ZU9ic2VydmVyc0xvb2t1cChpbnN0YW5jZSk7XHJcbiAgICAgICAgYmVoYXZpb3IuX2Vuc3VyZVByb3BlcnRpZXNEZWZpbmVkKGluc3RhbmNlLCBsb29rdXApO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGxvb2t1cFtuYW1lXTtcclxufVxyXG52YXIgQmluZGFibGVQcm9wZXJ0eSA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBCaW5kYWJsZVByb3BlcnR5KG5hbWVPckNvbmZpZykge1xyXG4gICAgICAgIGlmICh0eXBlb2YgbmFtZU9yQ29uZmlnID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICB0aGlzLm5hbWUgPSBuYW1lT3JDb25maWc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBPYmplY3QuYXNzaWduKHRoaXMsIG5hbWVPckNvbmZpZyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuYXR0cmlidXRlID0gdGhpcy5hdHRyaWJ1dGUgfHwgX2h5cGhlbmF0ZSh0aGlzLm5hbWUpO1xyXG4gICAgICAgIHZhciBkZWZhdWx0QmluZGluZ01vZGUgPSB0aGlzLmRlZmF1bHRCaW5kaW5nTW9kZTtcclxuICAgICAgICBpZiAoZGVmYXVsdEJpbmRpbmdNb2RlID09PSBudWxsIHx8IGRlZmF1bHRCaW5kaW5nTW9kZSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGVmYXVsdEJpbmRpbmdNb2RlID0gYmluZGluZ01vZGUub25lV2F5O1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmICh0eXBlb2YgZGVmYXVsdEJpbmRpbmdNb2RlID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICB0aGlzLmRlZmF1bHRCaW5kaW5nTW9kZSA9IGJpbmRpbmdNb2RlW2RlZmF1bHRCaW5kaW5nTW9kZV0gfHwgYmluZGluZ01vZGUub25lV2F5O1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmNoYW5nZUhhbmRsZXIgPSB0aGlzLmNoYW5nZUhhbmRsZXIgfHwgbnVsbDtcclxuICAgICAgICB0aGlzLm93bmVyID0gbnVsbDtcclxuICAgICAgICB0aGlzLmRlc2NyaXB0b3IgPSBudWxsO1xyXG4gICAgfVxyXG4gICAgQmluZGFibGVQcm9wZXJ0eS5wcm90b3R5cGUucmVnaXN0ZXJXaXRoID0gZnVuY3Rpb24gKHRhcmdldCwgYmVoYXZpb3IsIGRlc2NyaXB0b3IpIHtcclxuICAgICAgICBiZWhhdmlvci5wcm9wZXJ0aWVzLnB1c2godGhpcyk7XHJcbiAgICAgICAgYmVoYXZpb3IuYXR0cmlidXRlc1t0aGlzLmF0dHJpYnV0ZV0gPSB0aGlzO1xyXG4gICAgICAgIHRoaXMub3duZXIgPSBiZWhhdmlvcjtcclxuICAgICAgICBpZiAoZGVzY3JpcHRvcikge1xyXG4gICAgICAgICAgICB0aGlzLmRlc2NyaXB0b3IgPSBkZXNjcmlwdG9yO1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fY29uZmlndXJlRGVzY3JpcHRvcihkZXNjcmlwdG9yKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgIH07XHJcbiAgICBCaW5kYWJsZVByb3BlcnR5LnByb3RvdHlwZS5fY29uZmlndXJlRGVzY3JpcHRvciA9IGZ1bmN0aW9uIChkZXNjcmlwdG9yKSB7XHJcbiAgICAgICAgdmFyIG5hbWUgPSB0aGlzLm5hbWU7XHJcbiAgICAgICAgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlO1xyXG4gICAgICAgIGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IHRydWU7XHJcbiAgICAgICAgaWYgKCdpbml0aWFsaXplcicgaW4gZGVzY3JpcHRvcikge1xyXG4gICAgICAgICAgICB0aGlzLmRlZmF1bHRWYWx1ZSA9IGRlc2NyaXB0b3IuaW5pdGlhbGl6ZXI7XHJcbiAgICAgICAgICAgIGRlbGV0ZSBkZXNjcmlwdG9yLmluaXRpYWxpemVyO1xyXG4gICAgICAgICAgICBkZWxldGUgZGVzY3JpcHRvci53cml0YWJsZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCd2YWx1ZScgaW4gZGVzY3JpcHRvcikge1xyXG4gICAgICAgICAgICB0aGlzLmRlZmF1bHRWYWx1ZSA9IGRlc2NyaXB0b3IudmFsdWU7XHJcbiAgICAgICAgICAgIGRlbGV0ZSBkZXNjcmlwdG9yLnZhbHVlO1xyXG4gICAgICAgICAgICBkZWxldGUgZGVzY3JpcHRvci53cml0YWJsZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZGVzY3JpcHRvci5nZXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBnZXRPYnNlcnZlcih0aGlzLCBuYW1lKS5nZXRWYWx1ZSgpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgZGVzY3JpcHRvci5zZXQgPSBmdW5jdGlvbiAodmFsdWUpIHtcclxuICAgICAgICAgICAgZ2V0T2JzZXJ2ZXIodGhpcywgbmFtZSkuc2V0VmFsdWUodmFsdWUpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgZGVzY3JpcHRvci5nZXQuZ2V0T2JzZXJ2ZXIgPSBmdW5jdGlvbiAob2JqKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBnZXRPYnNlcnZlcihvYmosIG5hbWUpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIGRlc2NyaXB0b3I7XHJcbiAgICB9O1xyXG4gICAgQmluZGFibGVQcm9wZXJ0eS5wcm90b3R5cGUuZGVmaW5lT24gPSBmdW5jdGlvbiAodGFyZ2V0LCBiZWhhdmlvcikge1xyXG4gICAgICAgIHZhciBuYW1lID0gdGhpcy5uYW1lO1xyXG4gICAgICAgIHZhciBoYW5kbGVyTmFtZTtcclxuICAgICAgICBpZiAodGhpcy5jaGFuZ2VIYW5kbGVyID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgIGhhbmRsZXJOYW1lID0gbmFtZSArICdDaGFuZ2VkJztcclxuICAgICAgICAgICAgaWYgKGhhbmRsZXJOYW1lIGluIHRhcmdldC5wcm90b3R5cGUpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2hhbmdlSGFuZGxlciA9IGhhbmRsZXJOYW1lO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmRlc2NyaXB0b3IgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldC5wcm90b3R5cGUsIG5hbWUsIHRoaXMuX2NvbmZpZ3VyZURlc2NyaXB0b3Ioe30pKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgQmluZGFibGVQcm9wZXJ0eS5wcm90b3R5cGUuY3JlYXRlT2JzZXJ2ZXIgPSBmdW5jdGlvbiAodmlld01vZGVsKSB7XHJcbiAgICAgICAgdmFyIHNlbGZTdWJzY3JpYmVyID0gbnVsbDtcclxuICAgICAgICB2YXIgZGVmYXVsdFZhbHVlID0gdGhpcy5kZWZhdWx0VmFsdWU7XHJcbiAgICAgICAgdmFyIGNoYW5nZUhhbmRsZXJOYW1lID0gdGhpcy5jaGFuZ2VIYW5kbGVyO1xyXG4gICAgICAgIHZhciBuYW1lID0gdGhpcy5uYW1lO1xyXG4gICAgICAgIHZhciBpbml0aWFsVmFsdWU7XHJcbiAgICAgICAgaWYgKHRoaXMuaGFzT3B0aW9ucykge1xyXG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoY2hhbmdlSGFuZGxlck5hbWUgaW4gdmlld01vZGVsKSB7XHJcbiAgICAgICAgICAgIGlmICgncHJvcGVydHlDaGFuZ2VkJyBpbiB2aWV3TW9kZWwpIHtcclxuICAgICAgICAgICAgICAgIHNlbGZTdWJzY3JpYmVyID0gZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZpZXdNb2RlbFtjaGFuZ2VIYW5kbGVyTmFtZV0obmV3VmFsdWUsIG9sZFZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICB2aWV3TW9kZWwucHJvcGVydHlDaGFuZ2VkKG5hbWUsIG5ld1ZhbHVlLCBvbGRWYWx1ZSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgc2VsZlN1YnNjcmliZXIgPSBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7IHJldHVybiB2aWV3TW9kZWxbY2hhbmdlSGFuZGxlck5hbWVdKG5ld1ZhbHVlLCBvbGRWYWx1ZSk7IH07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoJ3Byb3BlcnR5Q2hhbmdlZCcgaW4gdmlld01vZGVsKSB7XHJcbiAgICAgICAgICAgIHNlbGZTdWJzY3JpYmVyID0gZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkgeyByZXR1cm4gdmlld01vZGVsLnByb3BlcnR5Q2hhbmdlZChuYW1lLCBuZXdWYWx1ZSwgb2xkVmFsdWUpOyB9O1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChjaGFuZ2VIYW5kbGVyTmFtZSAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDaGFuZ2UgaGFuZGxlciBcIi5jb25jYXQoY2hhbmdlSGFuZGxlck5hbWUsIFwiIHdhcyBzcGVjaWZpZWQgYnV0IG5vdCBkZWNsYXJlZCBvbiB0aGUgY2xhc3MuXCIpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGRlZmF1bHRWYWx1ZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIGluaXRpYWxWYWx1ZSA9IHR5cGVvZiBkZWZhdWx0VmFsdWUgPT09ICdmdW5jdGlvbicgPyBkZWZhdWx0VmFsdWUuY2FsbCh2aWV3TW9kZWwpIDogZGVmYXVsdFZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbmV3IEJlaGF2aW9yUHJvcGVydHlPYnNlcnZlcih0aGlzLm93bmVyLnRhc2tRdWV1ZSwgdmlld01vZGVsLCB0aGlzLm5hbWUsIHNlbGZTdWJzY3JpYmVyLCBpbml0aWFsVmFsdWUpO1xyXG4gICAgfTtcclxuICAgIEJpbmRhYmxlUHJvcGVydHkucHJvdG90eXBlLl9pbml0aWFsaXplID0gZnVuY3Rpb24gKHZpZXdNb2RlbCwgb2JzZXJ2ZXJMb29rdXAsIGF0dHJpYnV0ZXMsIGJlaGF2aW9ySGFuZGxlc0JpbmQsIGJvdW5kUHJvcGVydGllcykge1xyXG4gICAgICAgIHZhciBzZWxmU3Vic2NyaWJlcjtcclxuICAgICAgICB2YXIgb2JzZXJ2ZXI7XHJcbiAgICAgICAgdmFyIGF0dHJpYnV0ZTtcclxuICAgICAgICB2YXIgZGVmYXVsdFZhbHVlID0gdGhpcy5kZWZhdWx0VmFsdWU7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNEeW5hbWljKSB7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGtleSBpbiBhdHRyaWJ1dGVzKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jcmVhdGVEeW5hbWljUHJvcGVydHkodmlld01vZGVsLCBvYnNlcnZlckxvb2t1cCwgYmVoYXZpb3JIYW5kbGVzQmluZCwga2V5LCBhdHRyaWJ1dGVzW2tleV0sIGJvdW5kUHJvcGVydGllcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoIXRoaXMuaGFzT3B0aW9ucykge1xyXG4gICAgICAgICAgICBvYnNlcnZlciA9IG9ic2VydmVyTG9va3VwW3RoaXMubmFtZV07XHJcbiAgICAgICAgICAgIGlmIChhdHRyaWJ1dGVzICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICBzZWxmU3Vic2NyaWJlciA9IG9ic2VydmVyLnNlbGZTdWJzY3JpYmVyO1xyXG4gICAgICAgICAgICAgICAgYXR0cmlidXRlID0gYXR0cmlidXRlc1t0aGlzLmF0dHJpYnV0ZV07XHJcbiAgICAgICAgICAgICAgICBpZiAoYmVoYXZpb3JIYW5kbGVzQmluZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLnNlbGZTdWJzY3JpYmVyID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgYXR0cmlidXRlID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZpZXdNb2RlbFt0aGlzLm5hbWVdID0gYXR0cmlidXRlO1xyXG4gICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLmNhbGwoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGF0dHJpYnV0ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGJvdW5kUHJvcGVydGllcy5wdXNoKHsgb2JzZXJ2ZXI6IG9ic2VydmVyLCBiaW5kaW5nOiBhdHRyaWJ1dGUuY3JlYXRlQmluZGluZyh2aWV3TW9kZWwpIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoZGVmYXVsdFZhbHVlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci5jYWxsKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBvYnNlcnZlci5zZWxmU3Vic2NyaWJlciA9IHNlbGZTdWJzY3JpYmVyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG9ic2VydmVyLnB1Ymxpc2hpbmcgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBCaW5kYWJsZVByb3BlcnR5LnByb3RvdHlwZS5fY3JlYXRlRHluYW1pY1Byb3BlcnR5ID0gZnVuY3Rpb24gKHZpZXdNb2RlbCwgb2JzZXJ2ZXJMb29rdXAsIGJlaGF2aW9ySGFuZGxlc0JpbmQsIG5hbWUsIGF0dHJpYnV0ZSwgYm91bmRQcm9wZXJ0aWVzKSB7XHJcbiAgICAgICAgdmFyIGNoYW5nZUhhbmRsZXJOYW1lID0gbmFtZSArICdDaGFuZ2VkJztcclxuICAgICAgICB2YXIgc2VsZlN1YnNjcmliZXIgPSBudWxsO1xyXG4gICAgICAgIHZhciBvYnNlcnZlcjtcclxuICAgICAgICB2YXIgaW5mbztcclxuICAgICAgICBpZiAoY2hhbmdlSGFuZGxlck5hbWUgaW4gdmlld01vZGVsKSB7XHJcbiAgICAgICAgICAgIGlmICgncHJvcGVydHlDaGFuZ2VkJyBpbiB2aWV3TW9kZWwpIHtcclxuICAgICAgICAgICAgICAgIHNlbGZTdWJzY3JpYmVyID0gZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZpZXdNb2RlbFtjaGFuZ2VIYW5kbGVyTmFtZV0obmV3VmFsdWUsIG9sZFZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICB2aWV3TW9kZWwucHJvcGVydHlDaGFuZ2VkKG5hbWUsIG5ld1ZhbHVlLCBvbGRWYWx1ZSk7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgc2VsZlN1YnNjcmliZXIgPSBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7IHJldHVybiB2aWV3TW9kZWxbY2hhbmdlSGFuZGxlck5hbWVdKG5ld1ZhbHVlLCBvbGRWYWx1ZSk7IH07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoJ3Byb3BlcnR5Q2hhbmdlZCcgaW4gdmlld01vZGVsKSB7XHJcbiAgICAgICAgICAgIHNlbGZTdWJzY3JpYmVyID0gZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkgeyByZXR1cm4gdmlld01vZGVsLnByb3BlcnR5Q2hhbmdlZChuYW1lLCBuZXdWYWx1ZSwgb2xkVmFsdWUpOyB9O1xyXG4gICAgICAgIH1cclxuICAgICAgICBvYnNlcnZlciA9IG9ic2VydmVyTG9va3VwW25hbWVdID0gbmV3IEJlaGF2aW9yUHJvcGVydHlPYnNlcnZlcih0aGlzLm93bmVyLnRhc2tRdWV1ZSwgdmlld01vZGVsLCBuYW1lLCBzZWxmU3Vic2NyaWJlcik7XHJcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHZpZXdNb2RlbCwgbmFtZSwge1xyXG4gICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXHJcbiAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgICAgIGdldDogb2JzZXJ2ZXIuZ2V0VmFsdWUuYmluZChvYnNlcnZlciksXHJcbiAgICAgICAgICAgIHNldDogb2JzZXJ2ZXIuc2V0VmFsdWUuYmluZChvYnNlcnZlcilcclxuICAgICAgICB9KTtcclxuICAgICAgICBpZiAoYmVoYXZpb3JIYW5kbGVzQmluZCkge1xyXG4gICAgICAgICAgICBvYnNlcnZlci5zZWxmU3Vic2NyaWJlciA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0eXBlb2YgYXR0cmlidXRlID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICB2aWV3TW9kZWxbbmFtZV0gPSBhdHRyaWJ1dGU7XHJcbiAgICAgICAgICAgIG9ic2VydmVyLmNhbGwoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoYXR0cmlidXRlKSB7XHJcbiAgICAgICAgICAgIGluZm8gPSB7IG9ic2VydmVyOiBvYnNlcnZlciwgYmluZGluZzogYXR0cmlidXRlLmNyZWF0ZUJpbmRpbmcodmlld01vZGVsKSB9O1xyXG4gICAgICAgICAgICBib3VuZFByb3BlcnRpZXMucHVzaChpbmZvKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgb2JzZXJ2ZXIucHVibGlzaGluZyA9IHRydWU7XHJcbiAgICAgICAgb2JzZXJ2ZXIuc2VsZlN1YnNjcmliZXIgPSBzZWxmU3Vic2NyaWJlcjtcclxuICAgIH07XHJcbiAgICByZXR1cm4gQmluZGFibGVQcm9wZXJ0eTtcclxufSgpKTtcblxudmFyIFZpZXdMb2NhdG9yID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIFZpZXdMb2NhdG9yKCkge1xyXG4gICAgfVxyXG4gICAgVmlld0xvY2F0b3IucHJvdG90eXBlLmdldFZpZXdTdHJhdGVneSA9IGZ1bmN0aW9uICh2YWx1ZSkge1xyXG4gICAgICAgIGlmICghdmFsdWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmICdnZXRWaWV3U3RyYXRlZ3knIGluIHZhbHVlKSB7XHJcbiAgICAgICAgICAgIHZhciBvcmlnaW5fMSA9IE9yaWdpbi5nZXQodmFsdWUuY29uc3RydWN0b3IpO1xyXG4gICAgICAgICAgICB2YWx1ZSA9IHZhbHVlLmdldFZpZXdTdHJhdGVneSgpO1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICAgICAgdmFsdWUgPSBuZXcgUmVsYXRpdmVWaWV3U3RyYXRlZ3kodmFsdWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZpZXdTdHJhdGVneS5hc3NlcnQodmFsdWUpO1xyXG4gICAgICAgICAgICBpZiAob3JpZ2luXzEubW9kdWxlSWQpIHtcclxuICAgICAgICAgICAgICAgIHZhbHVlLm1ha2VSZWxhdGl2ZVRvKG9yaWdpbl8xLm1vZHVsZUlkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgIHZhbHVlID0gbmV3IFJlbGF0aXZlVmlld1N0cmF0ZWd5KHZhbHVlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHZpZXdTdHJhdGVneS52YWxpZGF0ZSh2YWx1ZSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodHlwZW9mIHZhbHVlICE9PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgIHZhbHVlID0gdmFsdWUuY29uc3RydWN0b3I7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICgnJHZpZXcnIGluIHZhbHVlKSB7XHJcbiAgICAgICAgICAgIHZhciBjID0gdmFsdWUuJHZpZXc7XHJcbiAgICAgICAgICAgIHZhciB2aWV3ID0gdm9pZCAwO1xyXG4gICAgICAgICAgICBjID0gdHlwZW9mIGMgPT09ICdmdW5jdGlvbicgPyBjLmNhbGwodmFsdWUpIDogYztcclxuICAgICAgICAgICAgaWYgKGMgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHZpZXcgPSBuZXcgTm9WaWV3U3RyYXRlZ3koKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHZpZXcgPSBjIGluc3RhbmNlb2YgU3RhdGljVmlld1N0cmF0ZWd5ID8gYyA6IG5ldyBTdGF0aWNWaWV3U3RyYXRlZ3koYyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgbWV0YWRhdGEuZGVmaW5lKFZpZXdMb2NhdG9yLnZpZXdTdHJhdGVneU1ldGFkYXRhS2V5LCB2aWV3LCB2YWx1ZSk7XHJcbiAgICAgICAgICAgIHJldHVybiB2aWV3O1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgb3JpZ2luID0gT3JpZ2luLmdldCh2YWx1ZSk7XHJcbiAgICAgICAgdmFyIHN0cmF0ZWd5ID0gbWV0YWRhdGEuZ2V0KFZpZXdMb2NhdG9yLnZpZXdTdHJhdGVneU1ldGFkYXRhS2V5LCB2YWx1ZSk7XHJcbiAgICAgICAgaWYgKCFzdHJhdGVneSkge1xyXG4gICAgICAgICAgICBpZiAoIW9yaWdpbi5tb2R1bGVJZCkge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYW5ub3QgZGV0ZXJtaW5lIGRlZmF1bHQgdmlldyBzdHJhdGVneSBmb3Igb2JqZWN0LlxcbicgKyB2YWx1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc3RyYXRlZ3kgPSB0aGlzLmNyZWF0ZUZhbGxiYWNrVmlld1N0cmF0ZWd5KG9yaWdpbik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKG9yaWdpbi5tb2R1bGVJZCkge1xyXG4gICAgICAgICAgICBzdHJhdGVneS5tb2R1bGVJZCA9IG9yaWdpbi5tb2R1bGVJZDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHN0cmF0ZWd5O1xyXG4gICAgfTtcclxuICAgIFZpZXdMb2NhdG9yLnByb3RvdHlwZS5jcmVhdGVGYWxsYmFja1ZpZXdTdHJhdGVneSA9IGZ1bmN0aW9uIChvcmlnaW4pIHtcclxuICAgICAgICByZXR1cm4gbmV3IENvbnZlbnRpb25hbFZpZXdTdHJhdGVneSh0aGlzLCBvcmlnaW4pO1xyXG4gICAgfTtcclxuICAgIFZpZXdMb2NhdG9yLnByb3RvdHlwZS5jb252ZXJ0T3JpZ2luVG9WaWV3VXJsID0gZnVuY3Rpb24gKG9yaWdpbikge1xyXG4gICAgICAgIHZhciBtb2R1bGVJZCA9IG9yaWdpbi5tb2R1bGVJZDtcclxuICAgICAgICB2YXIgaWQgPSAobW9kdWxlSWQuZW5kc1dpdGgoJy5qcycpIHx8IG1vZHVsZUlkLmVuZHNXaXRoKCcudHMnKSkgPyBtb2R1bGVJZC5zdWJzdHJpbmcoMCwgbW9kdWxlSWQubGVuZ3RoIC0gMykgOiBtb2R1bGVJZDtcclxuICAgICAgICByZXR1cm4gaWQgKyAnLmh0bWwnO1xyXG4gICAgfTtcclxuICAgIFZpZXdMb2NhdG9yLnZpZXdTdHJhdGVneU1ldGFkYXRhS2V5ID0gJ2F1cmVsaWE6dmlldy1zdHJhdGVneSc7XHJcbiAgICByZXR1cm4gVmlld0xvY2F0b3I7XHJcbn0oKSk7XG5cbmZ1bmN0aW9uIG1pKG5hbWUpIHtcclxuICAgIHRocm93IG5ldyBFcnJvcihcIkJpbmRpbmdMYW5ndWFnZSBtdXN0IGltcGxlbWVudCBcIi5jb25jYXQobmFtZSwgXCIoKS5cIikpO1xyXG59XHJcbnZhciBCaW5kaW5nTGFuZ3VhZ2UgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gQmluZGluZ0xhbmd1YWdlKCkge1xyXG4gICAgfVxyXG4gICAgQmluZGluZ0xhbmd1YWdlLnByb3RvdHlwZS5pbnNwZWN0QXR0cmlidXRlID0gZnVuY3Rpb24gKHJlc291cmNlcywgZWxlbWVudE5hbWUsIGF0dHJOYW1lLCBhdHRyVmFsdWUpIHtcclxuICAgICAgICBtaSgnaW5zcGVjdEF0dHJpYnV0ZScpO1xyXG4gICAgfTtcclxuICAgIEJpbmRpbmdMYW5ndWFnZS5wcm90b3R5cGUuY3JlYXRlQXR0cmlidXRlSW5zdHJ1Y3Rpb24gPSBmdW5jdGlvbiAocmVzb3VyY2VzLCBlbGVtZW50LCBpbmZvLCBleGlzdGluZ0luc3RydWN0aW9uLCBjb250ZXh0KSB7XHJcbiAgICAgICAgbWkoJ2NyZWF0ZUF0dHJpYnV0ZUluc3RydWN0aW9uJyk7XHJcbiAgICB9O1xyXG4gICAgQmluZGluZ0xhbmd1YWdlLnByb3RvdHlwZS5jcmVhdGVMZXRFeHByZXNzaW9ucyA9IGZ1bmN0aW9uIChyZXNvdXJjZXMsIGVsZW1lbnQpIHtcclxuICAgICAgICBtaSgnY3JlYXRlTGV0RXhwcmVzc2lvbnMnKTtcclxuICAgIH07XHJcbiAgICBCaW5kaW5nTGFuZ3VhZ2UucHJvdG90eXBlLmluc3BlY3RUZXh0Q29udGVudCA9IGZ1bmN0aW9uIChyZXNvdXJjZXMsIHZhbHVlKSB7XHJcbiAgICAgICAgbWkoJ2luc3BlY3RUZXh0Q29udGVudCcpO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBCaW5kaW5nTGFuZ3VhZ2U7XHJcbn0oKSk7XG5cbnZhciBub05vZGVzID0gT2JqZWN0LmZyZWV6ZShbXSk7XHJcbnZhciBTbG90Q3VzdG9tQXR0cmlidXRlID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIFNsb3RDdXN0b21BdHRyaWJ1dGUoZWxlbWVudCkge1xyXG4gICAgICAgIHRoaXMuZWxlbWVudCA9IGVsZW1lbnQ7XHJcbiAgICAgICAgdGhpcy5lbGVtZW50LmF1U2xvdEF0dHJpYnV0ZSA9IHRoaXM7XHJcbiAgICB9XHJcbiAgICBTbG90Q3VzdG9tQXR0cmlidXRlLmluamVjdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gW0RPTS5FbGVtZW50XTtcclxuICAgIH07XHJcbiAgICBTbG90Q3VzdG9tQXR0cmlidXRlLnByb3RvdHlwZS52YWx1ZUNoYW5nZWQgPSBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7IH07XHJcbiAgICByZXR1cm4gU2xvdEN1c3RvbUF0dHJpYnV0ZTtcclxufSgpKTtcclxudmFyIFBhc3NUaHJvdWdoU2xvdCA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBQYXNzVGhyb3VnaFNsb3QoYW5jaG9yLCBuYW1lLCBkZXN0aW5hdGlvbk5hbWUsIGZhbGxiYWNrRmFjdG9yeSkge1xyXG4gICAgICAgIHRoaXMuYW5jaG9yID0gYW5jaG9yO1xyXG4gICAgICAgIHRoaXMuYW5jaG9yLnZpZXdTbG90ID0gdGhpcztcclxuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xyXG4gICAgICAgIHRoaXMuZGVzdGluYXRpb25OYW1lID0gZGVzdGluYXRpb25OYW1lO1xyXG4gICAgICAgIHRoaXMuZmFsbGJhY2tGYWN0b3J5ID0gZmFsbGJhY2tGYWN0b3J5O1xyXG4gICAgICAgIHRoaXMuZGVzdGluYXRpb25TbG90ID0gbnVsbDtcclxuICAgICAgICB0aGlzLnByb2plY3Rpb25zID0gMDtcclxuICAgICAgICB0aGlzLmNvbnRlbnRWaWV3ID0gbnVsbDtcclxuICAgICAgICB2YXIgYXR0ciA9IG5ldyBTbG90Q3VzdG9tQXR0cmlidXRlKHRoaXMuYW5jaG9yKTtcclxuICAgICAgICBhdHRyLnZhbHVlID0gdGhpcy5kZXN0aW5hdGlvbk5hbWU7XHJcbiAgICB9XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoUGFzc1Rocm91Z2hTbG90LnByb3RvdHlwZSwgXCJuZWVkc0ZhbGxiYWNrUmVuZGVyaW5nXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZmFsbGJhY2tGYWN0b3J5ICYmIHRoaXMucHJvamVjdGlvbnMgPT09IDA7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgUGFzc1Rocm91Z2hTbG90LnByb3RvdHlwZS5yZW5kZXJGYWxsYmFja0NvbnRlbnQgPSBmdW5jdGlvbiAodmlldywgbm9kZXMsIHByb2plY3Rpb25Tb3VyY2UsIGluZGV4KSB7XHJcbiAgICAgICAgaWYgKHRoaXMuY29udGVudFZpZXcgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgdGhpcy5jb250ZW50VmlldyA9IHRoaXMuZmFsbGJhY2tGYWN0b3J5LmNyZWF0ZSh0aGlzLm93bmVyVmlldy5jb250YWluZXIpO1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRlbnRWaWV3LmJpbmQodGhpcy5vd25lclZpZXcuYmluZGluZ0NvbnRleHQsIHRoaXMub3duZXJWaWV3Lm92ZXJyaWRlQ29udGV4dCk7XHJcbiAgICAgICAgICAgIHZhciBzbG90cyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XHJcbiAgICAgICAgICAgIHNsb3RzW3RoaXMuZGVzdGluYXRpb25TbG90Lm5hbWVdID0gdGhpcy5kZXN0aW5hdGlvblNsb3Q7XHJcbiAgICAgICAgICAgIFNoYWRvd0RPTS5kaXN0cmlidXRlVmlldyh0aGlzLmNvbnRlbnRWaWV3LCBzbG90cywgcHJvamVjdGlvblNvdXJjZSwgaW5kZXgsIHRoaXMuZGVzdGluYXRpb25TbG90Lm5hbWUpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBQYXNzVGhyb3VnaFNsb3QucHJvdG90eXBlLnBhc3NUaHJvdWdoVG8gPSBmdW5jdGlvbiAoZGVzdGluYXRpb25TbG90KSB7XHJcbiAgICAgICAgdGhpcy5kZXN0aW5hdGlvblNsb3QgPSBkZXN0aW5hdGlvblNsb3Q7XHJcbiAgICB9O1xyXG4gICAgUGFzc1Rocm91Z2hTbG90LnByb3RvdHlwZS5hZGROb2RlID0gZnVuY3Rpb24gKHZpZXcsIG5vZGUsIHByb2plY3Rpb25Tb3VyY2UsIGluZGV4KSB7XHJcbiAgICAgICAgaWYgKHRoaXMuY29udGVudFZpZXcgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgdGhpcy5jb250ZW50Vmlldy5yZW1vdmVOb2RlcygpO1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRlbnRWaWV3LmRldGFjaGVkKCk7XHJcbiAgICAgICAgICAgIHRoaXMuY29udGVudFZpZXcudW5iaW5kKCk7XHJcbiAgICAgICAgICAgIHRoaXMuY29udGVudFZpZXcgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAobm9kZS52aWV3U2xvdCBpbnN0YW5jZW9mIFBhc3NUaHJvdWdoU2xvdCkge1xyXG4gICAgICAgICAgICBub2RlLnZpZXdTbG90LnBhc3NUaHJvdWdoVG8odGhpcyk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5wcm9qZWN0aW9ucysrO1xyXG4gICAgICAgIHRoaXMuZGVzdGluYXRpb25TbG90LmFkZE5vZGUodmlldywgbm9kZSwgcHJvamVjdGlvblNvdXJjZSwgaW5kZXgpO1xyXG4gICAgfTtcclxuICAgIFBhc3NUaHJvdWdoU2xvdC5wcm90b3R5cGUucmVtb3ZlVmlldyA9IGZ1bmN0aW9uICh2aWV3LCBwcm9qZWN0aW9uU291cmNlKSB7XHJcbiAgICAgICAgdGhpcy5wcm9qZWN0aW9ucy0tO1xyXG4gICAgICAgIHRoaXMuZGVzdGluYXRpb25TbG90LnJlbW92ZVZpZXcodmlldywgcHJvamVjdGlvblNvdXJjZSk7XHJcbiAgICAgICAgaWYgKHRoaXMubmVlZHNGYWxsYmFja1JlbmRlcmluZykge1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlckZhbGxiYWNrQ29udGVudChudWxsLCBub05vZGVzLCBwcm9qZWN0aW9uU291cmNlKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgUGFzc1Rocm91Z2hTbG90LnByb3RvdHlwZS5yZW1vdmVBbGwgPSBmdW5jdGlvbiAocHJvamVjdGlvblNvdXJjZSkge1xyXG4gICAgICAgIHRoaXMucHJvamVjdGlvbnMgPSAwO1xyXG4gICAgICAgIHRoaXMuZGVzdGluYXRpb25TbG90LnJlbW92ZUFsbChwcm9qZWN0aW9uU291cmNlKTtcclxuICAgICAgICBpZiAodGhpcy5uZWVkc0ZhbGxiYWNrUmVuZGVyaW5nKSB7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyRmFsbGJhY2tDb250ZW50KG51bGwsIG5vTm9kZXMsIHByb2plY3Rpb25Tb3VyY2UpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBQYXNzVGhyb3VnaFNsb3QucHJvdG90eXBlLnByb2plY3RGcm9tID0gZnVuY3Rpb24gKHZpZXcsIHByb2plY3Rpb25Tb3VyY2UpIHtcclxuICAgICAgICB0aGlzLmRlc3RpbmF0aW9uU2xvdC5wcm9qZWN0RnJvbSh2aWV3LCBwcm9qZWN0aW9uU291cmNlKTtcclxuICAgIH07XHJcbiAgICBQYXNzVGhyb3VnaFNsb3QucHJvdG90eXBlLmNyZWF0ZWQgPSBmdW5jdGlvbiAob3duZXJWaWV3KSB7XHJcbiAgICAgICAgdGhpcy5vd25lclZpZXcgPSBvd25lclZpZXc7XHJcbiAgICB9O1xyXG4gICAgUGFzc1Rocm91Z2hTbG90LnByb3RvdHlwZS5iaW5kID0gZnVuY3Rpb24gKHZpZXcpIHtcclxuICAgICAgICBpZiAodGhpcy5jb250ZW50Vmlldykge1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRlbnRWaWV3LmJpbmQodmlldy5iaW5kaW5nQ29udGV4dCwgdmlldy5vdmVycmlkZUNvbnRleHQpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBQYXNzVGhyb3VnaFNsb3QucHJvdG90eXBlLmF0dGFjaGVkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmNvbnRlbnRWaWV3KSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29udGVudFZpZXcuYXR0YWNoZWQoKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgUGFzc1Rocm91Z2hTbG90LnByb3RvdHlwZS5kZXRhY2hlZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAodGhpcy5jb250ZW50Vmlldykge1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRlbnRWaWV3LmRldGFjaGVkKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFBhc3NUaHJvdWdoU2xvdC5wcm90b3R5cGUudW5iaW5kID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmNvbnRlbnRWaWV3KSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29udGVudFZpZXcudW5iaW5kKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIHJldHVybiBQYXNzVGhyb3VnaFNsb3Q7XHJcbn0oKSk7XHJcbnZhciBTaGFkb3dTbG90ID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIFNoYWRvd1Nsb3QoYW5jaG9yLCBuYW1lLCBmYWxsYmFja0ZhY3RvcnkpIHtcclxuICAgICAgICB0aGlzLmFuY2hvciA9IGFuY2hvcjtcclxuICAgICAgICB0aGlzLmFuY2hvci5pc0NvbnRlbnRQcm9qZWN0aW9uU291cmNlID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLmFuY2hvci52aWV3U2xvdCA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcclxuICAgICAgICB0aGlzLmZhbGxiYWNrRmFjdG9yeSA9IGZhbGxiYWNrRmFjdG9yeTtcclxuICAgICAgICB0aGlzLmNvbnRlbnRWaWV3ID0gbnVsbDtcclxuICAgICAgICB0aGlzLnByb2plY3Rpb25zID0gMDtcclxuICAgICAgICB0aGlzLmNoaWxkcmVuID0gW107XHJcbiAgICAgICAgdGhpcy5wcm9qZWN0RnJvbUFuY2hvcnMgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuZGVzdGluYXRpb25TbG90cyA9IG51bGw7XHJcbiAgICB9XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoU2hhZG93U2xvdC5wcm90b3R5cGUsIFwibmVlZHNGYWxsYmFja1JlbmRlcmluZ1wiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmZhbGxiYWNrRmFjdG9yeSAmJiB0aGlzLnByb2plY3Rpb25zID09PSAwO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIFNoYWRvd1Nsb3QucHJvdG90eXBlLmFkZE5vZGUgPSBmdW5jdGlvbiAodmlldywgbm9kZSwgcHJvamVjdGlvblNvdXJjZSwgaW5kZXgsIGRlc3RpbmF0aW9uKSB7XHJcbiAgICAgICAgdmFyICRub2RlID0gbm9kZTtcclxuICAgICAgICBpZiAodGhpcy5jb250ZW50VmlldyAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRlbnRWaWV3LnJlbW92ZU5vZGVzKCk7XHJcbiAgICAgICAgICAgIHRoaXMuY29udGVudFZpZXcuZGV0YWNoZWQoKTtcclxuICAgICAgICAgICAgdGhpcy5jb250ZW50Vmlldy51bmJpbmQoKTtcclxuICAgICAgICAgICAgdGhpcy5jb250ZW50VmlldyA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICgkbm9kZS52aWV3U2xvdCBpbnN0YW5jZW9mIFBhc3NUaHJvdWdoU2xvdCkge1xyXG4gICAgICAgICAgICAkbm9kZS52aWV3U2xvdC5wYXNzVGhyb3VnaFRvKHRoaXMpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmRlc3RpbmF0aW9uU2xvdHMgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgU2hhZG93RE9NLmRpc3RyaWJ1dGVOb2Rlcyh2aWV3LCBbJG5vZGVdLCB0aGlzLmRlc3RpbmF0aW9uU2xvdHMsIHRoaXMsIGluZGV4KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICRub2RlLmF1T3duZXJWaWV3ID0gdmlldztcclxuICAgICAgICAgICAgJG5vZGUuYXVQcm9qZWN0aW9uU291cmNlID0gcHJvamVjdGlvblNvdXJjZTtcclxuICAgICAgICAgICAgJG5vZGUuYXVBc3NpZ25lZFNsb3QgPSB0aGlzO1xyXG4gICAgICAgICAgICB2YXIgYW5jaG9yID0gdGhpcy5fZmluZEFuY2hvcih2aWV3LCAkbm9kZSwgcHJvamVjdGlvblNvdXJjZSwgaW5kZXgpO1xyXG4gICAgICAgICAgICB2YXIgcGFyZW50XzEgPSBhbmNob3IucGFyZW50Tm9kZTtcclxuICAgICAgICAgICAgcGFyZW50XzEuaW5zZXJ0QmVmb3JlKCRub2RlLCBhbmNob3IpO1xyXG4gICAgICAgICAgICB0aGlzLmNoaWxkcmVuLnB1c2goJG5vZGUpO1xyXG4gICAgICAgICAgICB0aGlzLnByb2plY3Rpb25zKys7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFNoYWRvd1Nsb3QucHJvdG90eXBlLnJlbW92ZVZpZXcgPSBmdW5jdGlvbiAodmlldywgcHJvamVjdGlvblNvdXJjZSkge1xyXG4gICAgICAgIGlmICh0aGlzLmRlc3RpbmF0aW9uU2xvdHMgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgU2hhZG93RE9NLnVuZGlzdHJpYnV0ZVZpZXcodmlldywgdGhpcy5kZXN0aW5hdGlvblNsb3RzLCB0aGlzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAodGhpcy5jb250ZW50VmlldyAmJiB0aGlzLmNvbnRlbnRWaWV3Lmhhc1Nsb3RzKSB7XHJcbiAgICAgICAgICAgIFNoYWRvd0RPTS51bmRpc3RyaWJ1dGVWaWV3KHZpZXcsIHRoaXMuY29udGVudFZpZXcuc2xvdHMsIHByb2plY3Rpb25Tb3VyY2UpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdmFyIGZvdW5kID0gdGhpcy5jaGlsZHJlbi5maW5kKGZ1bmN0aW9uICh4KSB7IHJldHVybiB4LmF1U2xvdFByb2plY3RGcm9tID09PSBwcm9qZWN0aW9uU291cmNlOyB9KTtcclxuICAgICAgICAgICAgaWYgKGZvdW5kKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgY2hpbGRyZW4gPSBmb3VuZC5hdVByb2plY3Rpb25DaGlsZHJlbjtcclxuICAgICAgICAgICAgICAgIHZhciBvd25DaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBjaGlsZHJlbi5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNoaWxkID0gY2hpbGRyZW5baV07XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNoaWxkLmF1T3duZXJWaWV3ID09PSB2aWV3KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkcmVuLnNwbGljZShpLCAxKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmlldy5mcmFnbWVudC5hcHBlbmRDaGlsZChjaGlsZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGktLTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWktLTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wcm9qZWN0aW9ucy0tO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaWR4ID0gb3duQ2hpbGRyZW4uaW5kZXhPZihjaGlsZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpZHggPiAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3duQ2hpbGRyZW4uc3BsaWNlKGlkeCwgMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5uZWVkc0ZhbGxiYWNrUmVuZGVyaW5nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJGYWxsYmFja0NvbnRlbnQodmlldywgbm9Ob2RlcywgcHJvamVjdGlvblNvdXJjZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgU2hhZG93U2xvdC5wcm90b3R5cGUucmVtb3ZlQWxsID0gZnVuY3Rpb24gKHByb2plY3Rpb25Tb3VyY2UpIHtcclxuICAgICAgICBpZiAodGhpcy5kZXN0aW5hdGlvblNsb3RzICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIFNoYWRvd0RPTS51bmRpc3RyaWJ1dGVBbGwodGhpcy5kZXN0aW5hdGlvblNsb3RzLCB0aGlzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAodGhpcy5jb250ZW50VmlldyAmJiB0aGlzLmNvbnRlbnRWaWV3Lmhhc1Nsb3RzKSB7XHJcbiAgICAgICAgICAgIFNoYWRvd0RPTS51bmRpc3RyaWJ1dGVBbGwodGhpcy5jb250ZW50Vmlldy5zbG90cywgcHJvamVjdGlvblNvdXJjZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB2YXIgZm91bmQgPSB0aGlzLmNoaWxkcmVuLmZpbmQoZnVuY3Rpb24gKHgpIHsgcmV0dXJuIHguYXVTbG90UHJvamVjdEZyb20gPT09IHByb2plY3Rpb25Tb3VyY2U7IH0pO1xyXG4gICAgICAgICAgICBpZiAoZm91bmQpIHtcclxuICAgICAgICAgICAgICAgIHZhciBjaGlsZHJlbiA9IGZvdW5kLmF1UHJvamVjdGlvbkNoaWxkcmVuO1xyXG4gICAgICAgICAgICAgICAgdmFyIG93bkNoaWxkcmVuID0gdGhpcy5jaGlsZHJlbjtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IGNoaWxkcmVuLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY2hpbGQgPSBjaGlsZHJlbltpXTtcclxuICAgICAgICAgICAgICAgICAgICBjaGlsZC5hdU93bmVyVmlldy5mcmFnbWVudC5hcHBlbmRDaGlsZChjaGlsZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wcm9qZWN0aW9ucy0tO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpZHggPSBvd25DaGlsZHJlbi5pbmRleE9mKGNoaWxkKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaWR4ID4gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb3duQ2hpbGRyZW4uc3BsaWNlKGlkeCwgMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZm91bmQuYXVQcm9qZWN0aW9uQ2hpbGRyZW4gPSBbXTtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLm5lZWRzRmFsbGJhY2tSZW5kZXJpbmcpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbmRlckZhbGxiYWNrQ29udGVudChudWxsLCBub05vZGVzLCBwcm9qZWN0aW9uU291cmNlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBTaGFkb3dTbG90LnByb3RvdHlwZS5fZmluZEFuY2hvciA9IGZ1bmN0aW9uICh2aWV3LCBub2RlLCBwcm9qZWN0aW9uU291cmNlLCBpbmRleCkge1xyXG4gICAgICAgIGlmIChwcm9qZWN0aW9uU291cmNlKSB7XHJcbiAgICAgICAgICAgIHZhciBmb3VuZCA9IHRoaXMuY2hpbGRyZW4uZmluZChmdW5jdGlvbiAoeCkgeyByZXR1cm4geC5hdVNsb3RQcm9qZWN0RnJvbSA9PT0gcHJvamVjdGlvblNvdXJjZTsgfSk7XHJcbiAgICAgICAgICAgIGlmIChmb3VuZCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGluZGV4ICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY2hpbGRyZW4gPSBmb3VuZC5hdVByb2plY3Rpb25DaGlsZHJlbjtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdmlld0luZGV4ID0gLTE7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGxhc3RWaWV3ID0gdm9pZCAwO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IGNoaWxkcmVuLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGN1cnJlbnQgPSBjaGlsZHJlbltpXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnQuYXVPd25lclZpZXcgIT09IGxhc3RWaWV3KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aWV3SW5kZXgrKztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RWaWV3ID0gY3VycmVudC5hdU93bmVyVmlldztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2aWV3SW5kZXggPj0gaW5kZXggJiYgbGFzdFZpZXcgIT09IHZpZXcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGlsZHJlbi5zcGxpY2UoaSwgMCwgbm9kZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBmb3VuZC5hdVByb2plY3Rpb25DaGlsZHJlbi5wdXNoKG5vZGUpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZvdW5kO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLmFuY2hvcjtcclxuICAgIH07XHJcbiAgICBTaGFkb3dTbG90LnByb3RvdHlwZS5wcm9qZWN0VG8gPSBmdW5jdGlvbiAoc2xvdHMpIHtcclxuICAgICAgICB0aGlzLmRlc3RpbmF0aW9uU2xvdHMgPSBzbG90cztcclxuICAgIH07XHJcbiAgICBTaGFkb3dTbG90LnByb3RvdHlwZS5wcm9qZWN0RnJvbSA9IGZ1bmN0aW9uICh2aWV3LCBwcm9qZWN0aW9uU291cmNlKSB7XHJcbiAgICAgICAgdmFyIGFuY2hvciA9IERPTS5jcmVhdGVDb21tZW50KCdhbmNob3InKTtcclxuICAgICAgICB2YXIgcGFyZW50ID0gdGhpcy5hbmNob3IucGFyZW50Tm9kZTtcclxuICAgICAgICBhbmNob3IuYXVTbG90UHJvamVjdEZyb20gPSBwcm9qZWN0aW9uU291cmNlO1xyXG4gICAgICAgIGFuY2hvci5hdU93bmVyVmlldyA9IHZpZXc7XHJcbiAgICAgICAgYW5jaG9yLmF1UHJvamVjdGlvbkNoaWxkcmVuID0gW107XHJcbiAgICAgICAgcGFyZW50Lmluc2VydEJlZm9yZShhbmNob3IsIHRoaXMuYW5jaG9yKTtcclxuICAgICAgICB0aGlzLmNoaWxkcmVuLnB1c2goYW5jaG9yKTtcclxuICAgICAgICBpZiAodGhpcy5wcm9qZWN0RnJvbUFuY2hvcnMgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgdGhpcy5wcm9qZWN0RnJvbUFuY2hvcnMgPSBbXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5wcm9qZWN0RnJvbUFuY2hvcnMucHVzaChhbmNob3IpO1xyXG4gICAgfTtcclxuICAgIFNoYWRvd1Nsb3QucHJvdG90eXBlLnJlbmRlckZhbGxiYWNrQ29udGVudCA9IGZ1bmN0aW9uICh2aWV3LCBub2RlcywgcHJvamVjdGlvblNvdXJjZSwgaW5kZXgpIHtcclxuICAgICAgICBpZiAodGhpcy5jb250ZW50VmlldyA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRlbnRWaWV3ID0gdGhpcy5mYWxsYmFja0ZhY3RvcnkuY3JlYXRlKHRoaXMub3duZXJWaWV3LmNvbnRhaW5lcik7XHJcbiAgICAgICAgICAgIHRoaXMuY29udGVudFZpZXcuYmluZCh0aGlzLm93bmVyVmlldy5iaW5kaW5nQ29udGV4dCwgdGhpcy5vd25lclZpZXcub3ZlcnJpZGVDb250ZXh0KTtcclxuICAgICAgICAgICAgdGhpcy5jb250ZW50Vmlldy5pbnNlcnROb2Rlc0JlZm9yZSh0aGlzLmFuY2hvcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmNvbnRlbnRWaWV3Lmhhc1Nsb3RzKSB7XHJcbiAgICAgICAgICAgIHZhciBzbG90cyA9IHRoaXMuY29udGVudFZpZXcuc2xvdHM7XHJcbiAgICAgICAgICAgIHZhciBwcm9qZWN0RnJvbUFuY2hvcnMgPSB0aGlzLnByb2plY3RGcm9tQW5jaG9ycztcclxuICAgICAgICAgICAgaWYgKHByb2plY3RGcm9tQW5jaG9ycyAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgc2xvdE5hbWUgaW4gc2xvdHMpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgc2xvdCA9IHNsb3RzW3Nsb3ROYW1lXTtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBwcm9qZWN0RnJvbUFuY2hvcnMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYW5jaG9yID0gcHJvamVjdEZyb21BbmNob3JzW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzbG90LnByb2plY3RGcm9tKGFuY2hvci5hdU93bmVyVmlldywgYW5jaG9yLmF1U2xvdFByb2plY3RGcm9tKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5mYWxsYmFja1Nsb3RzID0gc2xvdHM7XHJcbiAgICAgICAgICAgIFNoYWRvd0RPTS5kaXN0cmlidXRlTm9kZXModmlldywgbm9kZXMsIHNsb3RzLCBwcm9qZWN0aW9uU291cmNlLCBpbmRleCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFNoYWRvd1Nsb3QucHJvdG90eXBlLmNyZWF0ZWQgPSBmdW5jdGlvbiAob3duZXJWaWV3KSB7XHJcbiAgICAgICAgdGhpcy5vd25lclZpZXcgPSBvd25lclZpZXc7XHJcbiAgICB9O1xyXG4gICAgU2hhZG93U2xvdC5wcm90b3R5cGUuYmluZCA9IGZ1bmN0aW9uICh2aWV3KSB7XHJcbiAgICAgICAgaWYgKHRoaXMuY29udGVudFZpZXcpIHtcclxuICAgICAgICAgICAgdGhpcy5jb250ZW50Vmlldy5iaW5kKHZpZXcuYmluZGluZ0NvbnRleHQsIHZpZXcub3ZlcnJpZGVDb250ZXh0KTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgU2hhZG93U2xvdC5wcm90b3R5cGUuYXR0YWNoZWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuY29udGVudFZpZXcpIHtcclxuICAgICAgICAgICAgdGhpcy5jb250ZW50Vmlldy5hdHRhY2hlZCgpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBTaGFkb3dTbG90LnByb3RvdHlwZS5kZXRhY2hlZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAodGhpcy5jb250ZW50Vmlldykge1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRlbnRWaWV3LmRldGFjaGVkKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFNoYWRvd1Nsb3QucHJvdG90eXBlLnVuYmluZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAodGhpcy5jb250ZW50Vmlldykge1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRlbnRWaWV3LnVuYmluZCgpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICByZXR1cm4gU2hhZG93U2xvdDtcclxufSgpKTtcclxudmFyIFNoYWRvd0RPTSA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBTaGFkb3dET00oKSB7XHJcbiAgICB9XHJcbiAgICBTaGFkb3dET00uZ2V0U2xvdE5hbWUgPSBmdW5jdGlvbiAobm9kZSkge1xyXG4gICAgICAgIGlmIChub2RlLmF1U2xvdEF0dHJpYnV0ZSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBTaGFkb3dET00uZGVmYXVsdFNsb3RLZXk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBub2RlLmF1U2xvdEF0dHJpYnV0ZS52YWx1ZTtcclxuICAgIH07XHJcbiAgICBTaGFkb3dET00uZGlzdHJpYnV0ZVZpZXcgPSBmdW5jdGlvbiAodmlldywgc2xvdHMsIHByb2plY3Rpb25Tb3VyY2UsIGluZGV4LCBkZXN0aW5hdGlvbk92ZXJyaWRlKSB7XHJcbiAgICAgICAgdmFyIG5vZGVzO1xyXG4gICAgICAgIGlmICh2aWV3ID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgIG5vZGVzID0gbm9Ob2RlcztcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHZhciBjaGlsZE5vZGVzID0gdmlldy5mcmFnbWVudC5jaGlsZE5vZGVzO1xyXG4gICAgICAgICAgICB2YXIgaWkgPSBjaGlsZE5vZGVzLmxlbmd0aDtcclxuICAgICAgICAgICAgbm9kZXMgPSBuZXcgQXJyYXkoaWkpO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgICAgIG5vZGVzW2ldID0gY2hpbGROb2Rlc1tpXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBTaGFkb3dET00uZGlzdHJpYnV0ZU5vZGVzKHZpZXcsIG5vZGVzLCBzbG90cywgcHJvamVjdGlvblNvdXJjZSwgaW5kZXgsIGRlc3RpbmF0aW9uT3ZlcnJpZGUpO1xyXG4gICAgfTtcclxuICAgIFNoYWRvd0RPTS51bmRpc3RyaWJ1dGVWaWV3ID0gZnVuY3Rpb24gKHZpZXcsIHNsb3RzLCBwcm9qZWN0aW9uU291cmNlKSB7XHJcbiAgICAgICAgZm9yICh2YXIgc2xvdE5hbWUgaW4gc2xvdHMpIHtcclxuICAgICAgICAgICAgc2xvdHNbc2xvdE5hbWVdLnJlbW92ZVZpZXcodmlldywgcHJvamVjdGlvblNvdXJjZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFNoYWRvd0RPTS51bmRpc3RyaWJ1dGVBbGwgPSBmdW5jdGlvbiAoc2xvdHMsIHByb2plY3Rpb25Tb3VyY2UpIHtcclxuICAgICAgICBmb3IgKHZhciBzbG90TmFtZSBpbiBzbG90cykge1xyXG4gICAgICAgICAgICBzbG90c1tzbG90TmFtZV0ucmVtb3ZlQWxsKHByb2plY3Rpb25Tb3VyY2UpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBTaGFkb3dET00uZGlzdHJpYnV0ZU5vZGVzID0gZnVuY3Rpb24gKHZpZXcsIG5vZGVzLCBzbG90cywgcHJvamVjdGlvblNvdXJjZSwgaW5kZXgsIGRlc3RpbmF0aW9uT3ZlcnJpZGUpIHtcclxuICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBub2Rlcy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgIHZhciBjdXJyZW50Tm9kZSA9IG5vZGVzW2ldO1xyXG4gICAgICAgICAgICB2YXIgbm9kZVR5cGUgPSBjdXJyZW50Tm9kZS5ub2RlVHlwZTtcclxuICAgICAgICAgICAgaWYgKGN1cnJlbnROb2RlLmlzQ29udGVudFByb2plY3Rpb25Tb3VyY2UpIHtcclxuICAgICAgICAgICAgICAgIGN1cnJlbnROb2RlLnZpZXdTbG90LnByb2plY3RUbyhzbG90cyk7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBzbG90TmFtZSBpbiBzbG90cykge1xyXG4gICAgICAgICAgICAgICAgICAgIHNsb3RzW3Nsb3ROYW1lXS5wcm9qZWN0RnJvbSh2aWV3LCBjdXJyZW50Tm9kZS52aWV3U2xvdCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBub2Rlcy5zcGxpY2UoaSwgMSk7XHJcbiAgICAgICAgICAgICAgICBpaS0tO1xyXG4gICAgICAgICAgICAgICAgaS0tO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKG5vZGVUeXBlID09PSAxIHx8IG5vZGVUeXBlID09PSAzIHx8IGN1cnJlbnROb2RlLnZpZXdTbG90IGluc3RhbmNlb2YgUGFzc1Rocm91Z2hTbG90KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAobm9kZVR5cGUgPT09IDMgJiYgX2lzQWxsV2hpdGVzcGFjZShjdXJyZW50Tm9kZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICBub2Rlcy5zcGxpY2UoaSwgMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWktLTtcclxuICAgICAgICAgICAgICAgICAgICBpLS07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZm91bmQgPSBzbG90c1tkZXN0aW5hdGlvbk92ZXJyaWRlIHx8IFNoYWRvd0RPTS5nZXRTbG90TmFtZShjdXJyZW50Tm9kZSldO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChmb3VuZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3VuZC5hZGROb2RlKHZpZXcsIGN1cnJlbnROb2RlLCBwcm9qZWN0aW9uU291cmNlLCBpbmRleCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGVzLnNwbGljZShpLCAxKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWktLTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaS0tO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIG5vZGVzLnNwbGljZShpLCAxKTtcclxuICAgICAgICAgICAgICAgIGlpLS07XHJcbiAgICAgICAgICAgICAgICBpLS07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZm9yICh2YXIgc2xvdE5hbWUgaW4gc2xvdHMpIHtcclxuICAgICAgICAgICAgdmFyIHNsb3QgPSBzbG90c1tzbG90TmFtZV07XHJcbiAgICAgICAgICAgIGlmIChzbG90Lm5lZWRzRmFsbGJhY2tSZW5kZXJpbmcpIHtcclxuICAgICAgICAgICAgICAgIHNsb3QucmVuZGVyRmFsbGJhY2tDb250ZW50KHZpZXcsIG5vZGVzLCBwcm9qZWN0aW9uU291cmNlLCBpbmRleCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgU2hhZG93RE9NLmRlZmF1bHRTbG90S2V5ID0gJ19fYXUtZGVmYXVsdC1zbG90LWtleV9fJztcclxuICAgIHJldHVybiBTaGFkb3dET007XHJcbn0oKSk7XG5cbnZhciBDb21wb3NpdGlvblRyYW5zYWN0aW9uTm90aWZpZXIgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gQ29tcG9zaXRpb25UcmFuc2FjdGlvbk5vdGlmaWVyKG93bmVyKSB7XHJcbiAgICAgICAgdGhpcy5vd25lciA9IG93bmVyO1xyXG4gICAgICAgIHRoaXMub3duZXIuX2NvbXBvc2l0aW9uQ291bnQrKztcclxuICAgIH1cclxuICAgIENvbXBvc2l0aW9uVHJhbnNhY3Rpb25Ob3RpZmllci5wcm90b3R5cGUuZG9uZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLm93bmVyLl9jb21wb3NpdGlvbkNvdW50LS07XHJcbiAgICAgICAgdGhpcy5vd25lci5fdHJ5Q29tcGxldGVUcmFuc2FjdGlvbigpO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBDb21wb3NpdGlvblRyYW5zYWN0aW9uTm90aWZpZXI7XHJcbn0oKSk7XHJcbnZhciBDb21wb3NpdGlvblRyYW5zYWN0aW9uT3duZXJzaGlwVG9rZW4gPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gQ29tcG9zaXRpb25UcmFuc2FjdGlvbk93bmVyc2hpcFRva2VuKG93bmVyKSB7XHJcbiAgICAgICAgdGhpcy5vd25lciA9IG93bmVyO1xyXG4gICAgICAgIHRoaXMub3duZXIuX293bmVyc2hpcFRva2VuID0gdGhpcztcclxuICAgICAgICB0aGlzLnRoZW5hYmxlID0gdGhpcy5fY3JlYXRlVGhlbmFibGUoKTtcclxuICAgIH1cclxuICAgIENvbXBvc2l0aW9uVHJhbnNhY3Rpb25Pd25lcnNoaXBUb2tlbi5wcm90b3R5cGUud2FpdEZvckNvbXBvc2l0aW9uQ29tcGxldGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdGhpcy5vd25lci5fdHJ5Q29tcGxldGVUcmFuc2FjdGlvbigpO1xyXG4gICAgICAgIHJldHVybiB0aGlzLnRoZW5hYmxlO1xyXG4gICAgfTtcclxuICAgIENvbXBvc2l0aW9uVHJhbnNhY3Rpb25Pd25lcnNoaXBUb2tlbi5wcm90b3R5cGUucmVzb2x2ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLl9yZXNvbHZlQ2FsbGJhY2soKTtcclxuICAgIH07XHJcbiAgICBDb21wb3NpdGlvblRyYW5zYWN0aW9uT3duZXJzaGlwVG9rZW4ucHJvdG90eXBlLl9yZXNvbHZlQ2FsbGJhY2sgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTWV0aG9kIG5vdCBpbXBsZW1lbnRlZC5cIik7XHJcbiAgICB9O1xyXG4gICAgQ29tcG9zaXRpb25UcmFuc2FjdGlvbk93bmVyc2hpcFRva2VuLnByb3RvdHlwZS5fY3JlYXRlVGhlbmFibGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHtcclxuICAgICAgICAgICAgX3RoaXMuX3Jlc29sdmVDYWxsYmFjayA9IHJlc29sdmU7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIENvbXBvc2l0aW9uVHJhbnNhY3Rpb25Pd25lcnNoaXBUb2tlbjtcclxufSgpKTtcclxudmFyIENvbXBvc2l0aW9uVHJhbnNhY3Rpb24gPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gQ29tcG9zaXRpb25UcmFuc2FjdGlvbigpIHtcclxuICAgICAgICB0aGlzLl9vd25lcnNoaXBUb2tlbiA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5fY29tcG9zaXRpb25Db3VudCA9IDA7XHJcbiAgICB9XHJcbiAgICBDb21wb3NpdGlvblRyYW5zYWN0aW9uLnByb3RvdHlwZS50cnlDYXB0dXJlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9vd25lcnNoaXBUb2tlbiA9PT0gbnVsbFxyXG4gICAgICAgICAgICA/IG5ldyBDb21wb3NpdGlvblRyYW5zYWN0aW9uT3duZXJzaGlwVG9rZW4odGhpcylcclxuICAgICAgICAgICAgOiBudWxsO1xyXG4gICAgfTtcclxuICAgIENvbXBvc2l0aW9uVHJhbnNhY3Rpb24ucHJvdG90eXBlLmVubGlzdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gbmV3IENvbXBvc2l0aW9uVHJhbnNhY3Rpb25Ob3RpZmllcih0aGlzKTtcclxuICAgIH07XHJcbiAgICBDb21wb3NpdGlvblRyYW5zYWN0aW9uLnByb3RvdHlwZS5fdHJ5Q29tcGxldGVUcmFuc2FjdGlvbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAodGhpcy5fY29tcG9zaXRpb25Db3VudCA8PSAwKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2NvbXBvc2l0aW9uQ291bnQgPSAwO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5fb3duZXJzaGlwVG9rZW4gIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHZhciB0b2tlbiA9IHRoaXMuX293bmVyc2hpcFRva2VuO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fb3duZXJzaGlwVG9rZW4gPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgdG9rZW4ucmVzb2x2ZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIHJldHVybiBDb21wb3NpdGlvblRyYW5zYWN0aW9uO1xyXG59KCkpO1xuXG52YXIgVmlldyA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBWaWV3KGNvbnRhaW5lciwgdmlld0ZhY3RvcnksIGZyYWdtZW50LCBjb250cm9sbGVycywgYmluZGluZ3MsIGNoaWxkcmVuLCBzbG90cykge1xyXG4gICAgICAgIHRoaXMuY29udGFpbmVyID0gY29udGFpbmVyO1xyXG4gICAgICAgIHRoaXMudmlld0ZhY3RvcnkgPSB2aWV3RmFjdG9yeTtcclxuICAgICAgICB0aGlzLnJlc291cmNlcyA9IHZpZXdGYWN0b3J5LnJlc291cmNlcztcclxuICAgICAgICB0aGlzLmZyYWdtZW50ID0gZnJhZ21lbnQ7XHJcbiAgICAgICAgdGhpcy5maXJzdENoaWxkID0gZnJhZ21lbnQuZmlyc3RDaGlsZDtcclxuICAgICAgICB0aGlzLmxhc3RDaGlsZCA9IGZyYWdtZW50Lmxhc3RDaGlsZDtcclxuICAgICAgICB0aGlzLmNvbnRyb2xsZXJzID0gY29udHJvbGxlcnM7XHJcbiAgICAgICAgdGhpcy5iaW5kaW5ncyA9IGJpbmRpbmdzO1xyXG4gICAgICAgIHRoaXMuY2hpbGRyZW4gPSBjaGlsZHJlbjtcclxuICAgICAgICB0aGlzLnNsb3RzID0gc2xvdHM7XHJcbiAgICAgICAgdGhpcy5oYXNTbG90cyA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuZnJvbUNhY2hlID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5pc0JvdW5kID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5pc0F0dGFjaGVkID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5iaW5kaW5nQ29udGV4dCA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5vdmVycmlkZUNvbnRleHQgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuY29udHJvbGxlciA9IG51bGw7XHJcbiAgICAgICAgdGhpcy52aWV3TW9kZWxTY29wZSA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5hbmltYXRhYmxlRWxlbWVudCA9IHVuZGVmaW5lZDtcclxuICAgICAgICB0aGlzLl9pc1VzZXJDb250cm9sbGVkID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5jb250ZW50VmlldyA9IG51bGw7XHJcbiAgICAgICAgZm9yICh2YXIgXyBpbiBzbG90cykge1xyXG4gICAgICAgICAgICB0aGlzLmhhc1Nsb3RzID0gdHJ1ZTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgVmlldy5wcm90b3R5cGUucmV0dXJuVG9DYWNoZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLnZpZXdGYWN0b3J5LnJldHVyblZpZXdUb0NhY2hlKHRoaXMpO1xyXG4gICAgfTtcclxuICAgIFZpZXcucHJvdG90eXBlLmNyZWF0ZWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGk7XHJcbiAgICAgICAgdmFyIGlpO1xyXG4gICAgICAgIHZhciBjb250cm9sbGVycyA9IHRoaXMuY29udHJvbGxlcnM7XHJcbiAgICAgICAgZm9yIChpID0gMCwgaWkgPSBjb250cm9sbGVycy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXJzW2ldLmNyZWF0ZWQodGhpcyk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFZpZXcucHJvdG90eXBlLmJpbmQgPSBmdW5jdGlvbiAoYmluZGluZ0NvbnRleHQsIG92ZXJyaWRlQ29udGV4dCwgX3N5c3RlbVVwZGF0ZSkge1xyXG4gICAgICAgIHZhciBjb250cm9sbGVycztcclxuICAgICAgICB2YXIgYmluZGluZ3M7XHJcbiAgICAgICAgdmFyIGNoaWxkcmVuO1xyXG4gICAgICAgIHZhciBpO1xyXG4gICAgICAgIHZhciBpaTtcclxuICAgICAgICBpZiAoX3N5c3RlbVVwZGF0ZSAmJiB0aGlzLl9pc1VzZXJDb250cm9sbGVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuaXNCb3VuZCkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5iaW5kaW5nQ29udGV4dCA9PT0gYmluZGluZ0NvbnRleHQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLnVuYmluZCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmlzQm91bmQgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMuYmluZGluZ0NvbnRleHQgPSBiaW5kaW5nQ29udGV4dDtcclxuICAgICAgICB0aGlzLm92ZXJyaWRlQ29udGV4dCA9IG92ZXJyaWRlQ29udGV4dCB8fCBjcmVhdGVPdmVycmlkZUNvbnRleHQoYmluZGluZ0NvbnRleHQpO1xyXG4gICAgICAgIHRoaXMucmVzb3VyY2VzLl9pbnZva2VIb29rKCdiZWZvcmVCaW5kJywgdGhpcyk7XHJcbiAgICAgICAgYmluZGluZ3MgPSB0aGlzLmJpbmRpbmdzO1xyXG4gICAgICAgIGZvciAoaSA9IDAsIGlpID0gYmluZGluZ3MubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICBiaW5kaW5nc1tpXS5iaW5kKHRoaXMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy52aWV3TW9kZWxTY29wZSAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICBiaW5kaW5nQ29udGV4dC5iaW5kKHRoaXMudmlld01vZGVsU2NvcGUuYmluZGluZ0NvbnRleHQsIHRoaXMudmlld01vZGVsU2NvcGUub3ZlcnJpZGVDb250ZXh0KTtcclxuICAgICAgICAgICAgdGhpcy52aWV3TW9kZWxTY29wZSA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnRyb2xsZXJzID0gdGhpcy5jb250cm9sbGVycztcclxuICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IGNvbnRyb2xsZXJzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgY29udHJvbGxlcnNbaV0uYmluZCh0aGlzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuO1xyXG4gICAgICAgIGZvciAoaSA9IDAsIGlpID0gY2hpbGRyZW4ubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICBjaGlsZHJlbltpXS5iaW5kKGJpbmRpbmdDb250ZXh0LCBvdmVycmlkZUNvbnRleHQsIHRydWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5oYXNTbG90cykge1xyXG4gICAgICAgICAgICBTaGFkb3dET00uZGlzdHJpYnV0ZVZpZXcodGhpcy5jb250ZW50VmlldywgdGhpcy5zbG90cyk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFZpZXcucHJvdG90eXBlLmFkZEJpbmRpbmcgPSBmdW5jdGlvbiAoYmluZGluZykge1xyXG4gICAgICAgIHRoaXMuYmluZGluZ3MucHVzaChiaW5kaW5nKTtcclxuICAgICAgICBpZiAodGhpcy5pc0JvdW5kKSB7XHJcbiAgICAgICAgICAgIGJpbmRpbmcuYmluZCh0aGlzKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgVmlldy5wcm90b3R5cGUudW5iaW5kID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBjb250cm9sbGVycztcclxuICAgICAgICB2YXIgYmluZGluZ3M7XHJcbiAgICAgICAgdmFyIGNoaWxkcmVuO1xyXG4gICAgICAgIHZhciBpO1xyXG4gICAgICAgIHZhciBpaTtcclxuICAgICAgICBpZiAodGhpcy5pc0JvdW5kKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaXNCb3VuZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB0aGlzLnJlc291cmNlcy5faW52b2tlSG9vaygnYmVmb3JlVW5iaW5kJywgdGhpcyk7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmNvbnRyb2xsZXIgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY29udHJvbGxlci51bmJpbmQoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBiaW5kaW5ncyA9IHRoaXMuYmluZGluZ3M7XHJcbiAgICAgICAgICAgIGZvciAoaSA9IDAsIGlpID0gYmluZGluZ3MubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICAgICAgYmluZGluZ3NbaV0udW5iaW5kKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29udHJvbGxlcnMgPSB0aGlzLmNvbnRyb2xsZXJzO1xyXG4gICAgICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IGNvbnRyb2xsZXJzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJzW2ldLnVuYmluZCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNoaWxkcmVuID0gdGhpcy5jaGlsZHJlbjtcclxuICAgICAgICAgICAgZm9yIChpID0gMCwgaWkgPSBjaGlsZHJlbi5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgICAgICBjaGlsZHJlbltpXS51bmJpbmQoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmJpbmRpbmdDb250ZXh0ID0gbnVsbDtcclxuICAgICAgICAgICAgdGhpcy5vdmVycmlkZUNvbnRleHQgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBWaWV3LnByb3RvdHlwZS5pbnNlcnROb2Rlc0JlZm9yZSA9IGZ1bmN0aW9uIChyZWZOb2RlKSB7XHJcbiAgICAgICAgcmVmTm9kZS5wYXJlbnROb2RlLmluc2VydEJlZm9yZSh0aGlzLmZyYWdtZW50LCByZWZOb2RlKTtcclxuICAgIH07XHJcbiAgICBWaWV3LnByb3RvdHlwZS5hcHBlbmROb2Rlc1RvID0gZnVuY3Rpb24gKHBhcmVudCkge1xyXG4gICAgICAgIHBhcmVudC5hcHBlbmRDaGlsZCh0aGlzLmZyYWdtZW50KTtcclxuICAgIH07XHJcbiAgICBWaWV3LnByb3RvdHlwZS5yZW1vdmVOb2RlcyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgZnJhZ21lbnQgPSB0aGlzLmZyYWdtZW50O1xyXG4gICAgICAgIHZhciBjdXJyZW50ID0gdGhpcy5maXJzdENoaWxkO1xyXG4gICAgICAgIHZhciBlbmQgPSB0aGlzLmxhc3RDaGlsZDtcclxuICAgICAgICB2YXIgbmV4dDtcclxuICAgICAgICB3aGlsZSAoY3VycmVudCkge1xyXG4gICAgICAgICAgICBuZXh0ID0gY3VycmVudC5uZXh0U2libGluZztcclxuICAgICAgICAgICAgZnJhZ21lbnQuYXBwZW5kQ2hpbGQoY3VycmVudCk7XHJcbiAgICAgICAgICAgIGlmIChjdXJyZW50ID09PSBlbmQpIHtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGN1cnJlbnQgPSBuZXh0O1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBWaWV3LnByb3RvdHlwZS5hdHRhY2hlZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgY29udHJvbGxlcnM7XHJcbiAgICAgICAgdmFyIGNoaWxkcmVuO1xyXG4gICAgICAgIHZhciBpO1xyXG4gICAgICAgIHZhciBpaTtcclxuICAgICAgICBpZiAodGhpcy5pc0F0dGFjaGVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5pc0F0dGFjaGVkID0gdHJ1ZTtcclxuICAgICAgICBpZiAodGhpcy5jb250cm9sbGVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29udHJvbGxlci5hdHRhY2hlZCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb250cm9sbGVycyA9IHRoaXMuY29udHJvbGxlcnM7XHJcbiAgICAgICAgZm9yIChpID0gMCwgaWkgPSBjb250cm9sbGVycy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXJzW2ldLmF0dGFjaGVkKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNoaWxkcmVuID0gdGhpcy5jaGlsZHJlbjtcclxuICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IGNoaWxkcmVuLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgY2hpbGRyZW5baV0uYXR0YWNoZWQoKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgVmlldy5wcm90b3R5cGUuZGV0YWNoZWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGNvbnRyb2xsZXJzO1xyXG4gICAgICAgIHZhciBjaGlsZHJlbjtcclxuICAgICAgICB2YXIgaTtcclxuICAgICAgICB2YXIgaWk7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNBdHRhY2hlZCkge1xyXG4gICAgICAgICAgICB0aGlzLmlzQXR0YWNoZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuY29udHJvbGxlciAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jb250cm9sbGVyLmRldGFjaGVkKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29udHJvbGxlcnMgPSB0aGlzLmNvbnRyb2xsZXJzO1xyXG4gICAgICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IGNvbnRyb2xsZXJzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJzW2ldLmRldGFjaGVkKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuO1xyXG4gICAgICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IGNoaWxkcmVuLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgICAgIGNoaWxkcmVuW2ldLmRldGFjaGVkKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIFZpZXc7XHJcbn0oKSk7XG5cbnZhciBBbmltYXRvciA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBBbmltYXRvcigpIHtcclxuICAgIH1cclxuICAgIEFuaW1hdG9yLnByb3RvdHlwZS5lbnRlciA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShmYWxzZSk7XHJcbiAgICB9O1xyXG4gICAgQW5pbWF0b3IucHJvdG90eXBlLmxlYXZlID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGZhbHNlKTtcclxuICAgIH07XHJcbiAgICBBbmltYXRvci5wcm90b3R5cGUucmVtb3ZlQ2xhc3MgPSBmdW5jdGlvbiAoZWxlbWVudCwgY2xhc3NOYW1lKSB7XHJcbiAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKGNsYXNzTmFtZSk7XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShmYWxzZSk7XHJcbiAgICB9O1xyXG4gICAgQW5pbWF0b3IucHJvdG90eXBlLmFkZENsYXNzID0gZnVuY3Rpb24gKGVsZW1lbnQsIGNsYXNzTmFtZSkge1xyXG4gICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LmFkZChjbGFzc05hbWUpO1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoZmFsc2UpO1xyXG4gICAgfTtcclxuICAgIEFuaW1hdG9yLnByb3RvdHlwZS5hbmltYXRlID0gZnVuY3Rpb24gKGVsZW1lbnQsIGNsYXNzTmFtZSkge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoZmFsc2UpO1xyXG4gICAgfTtcclxuICAgIEFuaW1hdG9yLnByb3RvdHlwZS5ydW5TZXF1ZW5jZSA9IGZ1bmN0aW9uIChhbmltYXRpb25zKSB7XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShmYWxzZSk7XHJcbiAgICB9O1xyXG4gICAgQW5pbWF0b3IucHJvdG90eXBlLnJlZ2lzdGVyRWZmZWN0ID0gZnVuY3Rpb24gKGVmZmVjdE5hbWUsIHByb3BlcnRpZXMpIHsgfTtcclxuICAgIEFuaW1hdG9yLnByb3RvdHlwZS51bnJlZ2lzdGVyRWZmZWN0ID0gZnVuY3Rpb24gKGVmZmVjdE5hbWUpIHsgfTtcclxuICAgIHJldHVybiBBbmltYXRvcjtcclxufSgpKTtcblxuZnVuY3Rpb24gZ2V0QW5pbWF0YWJsZUVsZW1lbnQodmlldykge1xyXG4gICAgaWYgKHZpZXcuYW5pbWF0YWJsZUVsZW1lbnQgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgIHJldHVybiB2aWV3LmFuaW1hdGFibGVFbGVtZW50O1xyXG4gICAgfVxyXG4gICAgdmFyIGN1cnJlbnQgPSB2aWV3LmZpcnN0Q2hpbGQ7XHJcbiAgICB3aGlsZSAoY3VycmVudCAmJiBjdXJyZW50Lm5vZGVUeXBlICE9PSAxKSB7XHJcbiAgICAgICAgY3VycmVudCA9IGN1cnJlbnQubmV4dFNpYmxpbmc7XHJcbiAgICB9XHJcbiAgICBpZiAoY3VycmVudCAmJiBjdXJyZW50Lm5vZGVUeXBlID09PSAxKSB7XHJcbiAgICAgICAgcmV0dXJuICh2aWV3LmFuaW1hdGFibGVFbGVtZW50ID0gY3VycmVudC5jbGFzc0xpc3QuY29udGFpbnMoJ2F1LWFuaW1hdGUnKSA/IGN1cnJlbnQgOiBudWxsKTtcclxuICAgIH1cclxuICAgIHJldHVybiAodmlldy5hbmltYXRhYmxlRWxlbWVudCA9IG51bGwpO1xyXG59XHJcbnZhciBWaWV3U2xvdCA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBWaWV3U2xvdChhbmNob3IsIGFuY2hvcklzQ29udGFpbmVyLCBhbmltYXRvcikge1xyXG4gICAgICAgIGlmIChhbmltYXRvciA9PT0gdm9pZCAwKSB7IGFuaW1hdG9yID0gQW5pbWF0b3IuaW5zdGFuY2U7IH1cclxuICAgICAgICB0aGlzLmFuY2hvciA9IGFuY2hvcjtcclxuICAgICAgICB0aGlzLmFuY2hvcklzQ29udGFpbmVyID0gYW5jaG9ySXNDb250YWluZXI7XHJcbiAgICAgICAgdGhpcy5iaW5kaW5nQ29udGV4dCA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5vdmVycmlkZUNvbnRleHQgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuYW5pbWF0b3IgPSBhbmltYXRvcjtcclxuICAgICAgICB0aGlzLmNoaWxkcmVuID0gW107XHJcbiAgICAgICAgdGhpcy5pc0JvdW5kID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5pc0F0dGFjaGVkID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5jb250ZW50U2VsZWN0b3JzID0gbnVsbDtcclxuICAgICAgICBhbmNob3Iudmlld1Nsb3QgPSB0aGlzO1xyXG4gICAgICAgIGFuY2hvci5pc0NvbnRlbnRQcm9qZWN0aW9uU291cmNlID0gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBWaWV3U2xvdC5wcm90b3R5cGUuYW5pbWF0ZVZpZXcgPSBmdW5jdGlvbiAodmlldywgZGlyZWN0aW9uKSB7XHJcbiAgICAgICAgaWYgKGRpcmVjdGlvbiA9PT0gdm9pZCAwKSB7IGRpcmVjdGlvbiA9ICdlbnRlcic7IH1cclxuICAgICAgICB2YXIgYW5pbWF0YWJsZUVsZW1lbnQgPSBnZXRBbmltYXRhYmxlRWxlbWVudCh2aWV3KTtcclxuICAgICAgICBpZiAoYW5pbWF0YWJsZUVsZW1lbnQgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgc3dpdGNoIChkaXJlY3Rpb24pIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgJ2VudGVyJzpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5hbmltYXRvci5lbnRlcihhbmltYXRhYmxlRWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdsZWF2ZSc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYW5pbWF0b3IubGVhdmUoYW5pbWF0YWJsZUVsZW1lbnQpO1xyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgYW5pbWF0aW9uIGRpcmVjdGlvbjogJyArIGRpcmVjdGlvbik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgVmlld1Nsb3QucHJvdG90eXBlLnRyYW5zZm9ybUNoaWxkTm9kZXNJbnRvVmlldyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgcGFyZW50ID0gdGhpcy5hbmNob3I7XHJcbiAgICAgICAgdGhpcy5jaGlsZHJlbi5wdXNoKHtcclxuICAgICAgICAgICAgZnJhZ21lbnQ6IHBhcmVudCxcclxuICAgICAgICAgICAgZmlyc3RDaGlsZDogcGFyZW50LmZpcnN0Q2hpbGQsXHJcbiAgICAgICAgICAgIGxhc3RDaGlsZDogcGFyZW50Lmxhc3RDaGlsZCxcclxuICAgICAgICAgICAgcmV0dXJuVG9DYWNoZTogZnVuY3Rpb24gKCkgeyB9LFxyXG4gICAgICAgICAgICByZW1vdmVOb2RlczogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGxhc3Q7XHJcbiAgICAgICAgICAgICAgICB3aGlsZSAobGFzdCA9IHBhcmVudC5sYXN0Q2hpbGQpIHtcclxuICAgICAgICAgICAgICAgICAgICBwYXJlbnQucmVtb3ZlQ2hpbGQobGFzdCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGNyZWF0ZWQ6IGZ1bmN0aW9uICgpIHsgfSxcclxuICAgICAgICAgICAgYmluZDogZnVuY3Rpb24gKCkgeyB9LFxyXG4gICAgICAgICAgICB1bmJpbmQ6IGZ1bmN0aW9uICgpIHsgfSxcclxuICAgICAgICAgICAgYXR0YWNoZWQ6IGZ1bmN0aW9uICgpIHsgfSxcclxuICAgICAgICAgICAgZGV0YWNoZWQ6IGZ1bmN0aW9uICgpIHsgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIFZpZXdTbG90LnByb3RvdHlwZS5iaW5kID0gZnVuY3Rpb24gKGJpbmRpbmdDb250ZXh0LCBvdmVycmlkZUNvbnRleHQpIHtcclxuICAgICAgICB2YXIgaTtcclxuICAgICAgICB2YXIgaWk7XHJcbiAgICAgICAgdmFyIGNoaWxkcmVuO1xyXG4gICAgICAgIGlmICh0aGlzLmlzQm91bmQpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuYmluZGluZ0NvbnRleHQgPT09IGJpbmRpbmdDb250ZXh0KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy51bmJpbmQoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5pc0JvdW5kID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLmJpbmRpbmdDb250ZXh0ID0gYmluZGluZ0NvbnRleHQgPSBiaW5kaW5nQ29udGV4dCB8fCB0aGlzLmJpbmRpbmdDb250ZXh0O1xyXG4gICAgICAgIHRoaXMub3ZlcnJpZGVDb250ZXh0ID0gb3ZlcnJpZGVDb250ZXh0ID0gb3ZlcnJpZGVDb250ZXh0IHx8IHRoaXMub3ZlcnJpZGVDb250ZXh0O1xyXG4gICAgICAgIGNoaWxkcmVuID0gdGhpcy5jaGlsZHJlbjtcclxuICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IGNoaWxkcmVuLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgY2hpbGRyZW5baV0uYmluZChiaW5kaW5nQ29udGV4dCwgb3ZlcnJpZGVDb250ZXh0LCB0cnVlKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgVmlld1Nsb3QucHJvdG90eXBlLnVuYmluZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAodGhpcy5pc0JvdW5kKSB7XHJcbiAgICAgICAgICAgIHZhciBpID0gdm9pZCAwO1xyXG4gICAgICAgICAgICB2YXIgaWkgPSB2b2lkIDA7XHJcbiAgICAgICAgICAgIHZhciBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47XHJcbiAgICAgICAgICAgIHRoaXMuaXNCb3VuZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB0aGlzLmJpbmRpbmdDb250ZXh0ID0gbnVsbDtcclxuICAgICAgICAgICAgdGhpcy5vdmVycmlkZUNvbnRleHQgPSBudWxsO1xyXG4gICAgICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IGNoaWxkcmVuLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgICAgIGNoaWxkcmVuW2ldLnVuYmluZCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFZpZXdTbG90LnByb3RvdHlwZS5hZGQgPSBmdW5jdGlvbiAodmlldykge1xyXG4gICAgICAgIGlmICh0aGlzLmFuY2hvcklzQ29udGFpbmVyKSB7XHJcbiAgICAgICAgICAgIHZpZXcuYXBwZW5kTm9kZXNUbyh0aGlzLmFuY2hvcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB2aWV3Lmluc2VydE5vZGVzQmVmb3JlKHRoaXMuYW5jaG9yKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5jaGlsZHJlbi5wdXNoKHZpZXcpO1xyXG4gICAgICAgIGlmICh0aGlzLmlzQXR0YWNoZWQpIHtcclxuICAgICAgICAgICAgdmlldy5hdHRhY2hlZCgpO1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5hbmltYXRlVmlldyh2aWV3LCAnZW50ZXInKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgVmlld1Nsb3QucHJvdG90eXBlLmluc2VydCA9IGZ1bmN0aW9uIChpbmRleCwgdmlldykge1xyXG4gICAgICAgIHZhciBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47XHJcbiAgICAgICAgdmFyIGxlbmd0aCA9IGNoaWxkcmVuLmxlbmd0aDtcclxuICAgICAgICBpZiAoKGluZGV4ID09PSAwICYmIGxlbmd0aCA9PT0gMCkgfHwgaW5kZXggPj0gbGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmFkZCh2aWV3KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmlldy5pbnNlcnROb2Rlc0JlZm9yZShjaGlsZHJlbltpbmRleF0uZmlyc3RDaGlsZCk7XHJcbiAgICAgICAgY2hpbGRyZW4uc3BsaWNlKGluZGV4LCAwLCB2aWV3KTtcclxuICAgICAgICBpZiAodGhpcy5pc0F0dGFjaGVkKSB7XHJcbiAgICAgICAgICAgIHZpZXcuYXR0YWNoZWQoKTtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuYW5pbWF0ZVZpZXcodmlldywgJ2VudGVyJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFZpZXdTbG90LnByb3RvdHlwZS5tb3ZlID0gZnVuY3Rpb24gKHNvdXJjZUluZGV4LCB0YXJnZXRJbmRleCkge1xyXG4gICAgICAgIGlmIChzb3VyY2VJbmRleCA9PT0gdGFyZ2V0SW5kZXgpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuO1xyXG4gICAgICAgIHZhciB2aWV3ID0gY2hpbGRyZW5bc291cmNlSW5kZXhdO1xyXG4gICAgICAgIHZpZXcucmVtb3ZlTm9kZXMoKTtcclxuICAgICAgICB2aWV3Lmluc2VydE5vZGVzQmVmb3JlKGNoaWxkcmVuW3RhcmdldEluZGV4XS5maXJzdENoaWxkKTtcclxuICAgICAgICBjaGlsZHJlbi5zcGxpY2Uoc291cmNlSW5kZXgsIDEpO1xyXG4gICAgICAgIGNoaWxkcmVuLnNwbGljZSh0YXJnZXRJbmRleCwgMCwgdmlldyk7XHJcbiAgICB9O1xyXG4gICAgVmlld1Nsb3QucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uICh2aWV3LCByZXR1cm5Ub0NhY2hlLCBza2lwQW5pbWF0aW9uKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucmVtb3ZlQXQodGhpcy5jaGlsZHJlbi5pbmRleE9mKHZpZXcpLCByZXR1cm5Ub0NhY2hlLCBza2lwQW5pbWF0aW9uKTtcclxuICAgIH07XHJcbiAgICBWaWV3U2xvdC5wcm90b3R5cGUucmVtb3ZlTWFueSA9IGZ1bmN0aW9uICh2aWV3c1RvUmVtb3ZlLCByZXR1cm5Ub0NhY2hlLCBza2lwQW5pbWF0aW9uKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICB2YXIgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuO1xyXG4gICAgICAgIHZhciBpaSA9IHZpZXdzVG9SZW1vdmUubGVuZ3RoO1xyXG4gICAgICAgIHZhciBpO1xyXG4gICAgICAgIHZhciBybVByb21pc2VzID0gW107XHJcbiAgICAgICAgdmlld3NUb1JlbW92ZS5mb3JFYWNoKGZ1bmN0aW9uIChjaGlsZCkge1xyXG4gICAgICAgICAgICBpZiAoc2tpcEFuaW1hdGlvbikge1xyXG4gICAgICAgICAgICAgICAgY2hpbGQucmVtb3ZlTm9kZXMoKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgYW5pbWF0aW9uID0gX3RoaXMuYW5pbWF0ZVZpZXcoY2hpbGQsICdsZWF2ZScpO1xyXG4gICAgICAgICAgICBpZiAoYW5pbWF0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICBybVByb21pc2VzLnB1c2goYW5pbWF0aW9uLnRoZW4oZnVuY3Rpb24gKCkgeyByZXR1cm4gY2hpbGQucmVtb3ZlTm9kZXMoKTsgfSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY2hpbGQucmVtb3ZlTm9kZXMoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHZhciByZW1vdmVBY3Rpb24gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmIChfdGhpcy5pc0F0dGFjaGVkKSB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZpZXdzVG9SZW1vdmVbaV0uZGV0YWNoZWQoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAocmV0dXJuVG9DYWNoZSkge1xyXG4gICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgICAgICAgICB2aWV3c1RvUmVtb3ZlW2ldLnJldHVyblRvQ2FjaGUoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGluZGV4ID0gY2hpbGRyZW4uaW5kZXhPZih2aWV3c1RvUmVtb3ZlW2ldKTtcclxuICAgICAgICAgICAgICAgIGlmIChpbmRleCA+PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW4uc3BsaWNlKGluZGV4LCAxKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgaWYgKHJtUHJvbWlzZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwocm1Qcm9taXNlcykudGhlbihmdW5jdGlvbiAoKSB7IHJldHVybiByZW1vdmVBY3Rpb24oKTsgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZW1vdmVBY3Rpb24oKTtcclxuICAgIH07XHJcbiAgICBWaWV3U2xvdC5wcm90b3R5cGUucmVtb3ZlQXQgPSBmdW5jdGlvbiAoaW5kZXgsIHJldHVyblRvQ2FjaGUsIHNraXBBbmltYXRpb24pIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHZhciB2aWV3ID0gdGhpcy5jaGlsZHJlbltpbmRleF07XHJcbiAgICAgICAgdmFyIHJlbW92ZUFjdGlvbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaW5kZXggPSBfdGhpcy5jaGlsZHJlbi5pbmRleE9mKHZpZXcpO1xyXG4gICAgICAgICAgICB2aWV3LnJlbW92ZU5vZGVzKCk7XHJcbiAgICAgICAgICAgIF90aGlzLmNoaWxkcmVuLnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgICAgICAgIGlmIChfdGhpcy5pc0F0dGFjaGVkKSB7XHJcbiAgICAgICAgICAgICAgICB2aWV3LmRldGFjaGVkKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHJldHVyblRvQ2FjaGUpIHtcclxuICAgICAgICAgICAgICAgIHZpZXcucmV0dXJuVG9DYWNoZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiB2aWV3O1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgaWYgKCFza2lwQW5pbWF0aW9uKSB7XHJcbiAgICAgICAgICAgIHZhciBhbmltYXRpb24gPSB0aGlzLmFuaW1hdGVWaWV3KHZpZXcsICdsZWF2ZScpO1xyXG4gICAgICAgICAgICBpZiAoYW5pbWF0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYW5pbWF0aW9uLnRoZW4oZnVuY3Rpb24gKCkgeyByZXR1cm4gcmVtb3ZlQWN0aW9uKCk7IH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZW1vdmVBY3Rpb24oKTtcclxuICAgIH07XHJcbiAgICBWaWV3U2xvdC5wcm90b3R5cGUucmVtb3ZlQWxsID0gZnVuY3Rpb24gKHJldHVyblRvQ2FjaGUsIHNraXBBbmltYXRpb24pIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHZhciBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47XHJcbiAgICAgICAgdmFyIGlpID0gY2hpbGRyZW4ubGVuZ3RoO1xyXG4gICAgICAgIHZhciBpO1xyXG4gICAgICAgIHZhciBybVByb21pc2VzID0gW107XHJcbiAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoY2hpbGQpIHtcclxuICAgICAgICAgICAgaWYgKHNraXBBbmltYXRpb24pIHtcclxuICAgICAgICAgICAgICAgIGNoaWxkLnJlbW92ZU5vZGVzKCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIGFuaW1hdGlvbiA9IF90aGlzLmFuaW1hdGVWaWV3KGNoaWxkLCAnbGVhdmUnKTtcclxuICAgICAgICAgICAgaWYgKGFuaW1hdGlvbikge1xyXG4gICAgICAgICAgICAgICAgcm1Qcm9taXNlcy5wdXNoKGFuaW1hdGlvbi50aGVuKGZ1bmN0aW9uICgpIHsgcmV0dXJuIGNoaWxkLnJlbW92ZU5vZGVzKCk7IH0pKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGNoaWxkLnJlbW92ZU5vZGVzKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICB2YXIgcmVtb3ZlQWN0aW9uID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpZiAoX3RoaXMuaXNBdHRhY2hlZCkge1xyXG4gICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgICAgICAgICBjaGlsZHJlbltpXS5kZXRhY2hlZCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChyZXR1cm5Ub0NhY2hlKSB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjaGlsZCA9IGNoaWxkcmVuW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjaGlsZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjaGlsZC5yZXR1cm5Ub0NhY2hlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIF90aGlzLmNoaWxkcmVuID0gW107XHJcbiAgICAgICAgfTtcclxuICAgICAgICBpZiAocm1Qcm9taXNlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLmFsbChybVByb21pc2VzKS50aGVuKGZ1bmN0aW9uICgpIHsgcmV0dXJuIHJlbW92ZUFjdGlvbigpOyB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlbW92ZUFjdGlvbigpO1xyXG4gICAgfTtcclxuICAgIFZpZXdTbG90LnByb3RvdHlwZS5hdHRhY2hlZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgaTtcclxuICAgICAgICB2YXIgaWk7XHJcbiAgICAgICAgdmFyIGNoaWxkcmVuO1xyXG4gICAgICAgIHZhciBjaGlsZDtcclxuICAgICAgICBpZiAodGhpcy5pc0F0dGFjaGVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5pc0F0dGFjaGVkID0gdHJ1ZTtcclxuICAgICAgICBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47XHJcbiAgICAgICAgZm9yIChpID0gMCwgaWkgPSBjaGlsZHJlbi5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgIGNoaWxkID0gY2hpbGRyZW5baV07XHJcbiAgICAgICAgICAgIGNoaWxkLmF0dGFjaGVkKCk7XHJcbiAgICAgICAgICAgIHRoaXMuYW5pbWF0ZVZpZXcoY2hpbGQsICdlbnRlcicpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBWaWV3U2xvdC5wcm90b3R5cGUuZGV0YWNoZWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGk7XHJcbiAgICAgICAgdmFyIGlpO1xyXG4gICAgICAgIHZhciBjaGlsZHJlbjtcclxuICAgICAgICBpZiAodGhpcy5pc0F0dGFjaGVkKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaXNBdHRhY2hlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47XHJcbiAgICAgICAgICAgIGZvciAoaSA9IDAsIGlpID0gY2hpbGRyZW4ubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICAgICAgY2hpbGRyZW5baV0uZGV0YWNoZWQoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBWaWV3U2xvdC5wcm90b3R5cGUucHJvamVjdFRvID0gZnVuY3Rpb24gKHNsb3RzKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICB0aGlzLnByb2plY3RUb1Nsb3RzID0gc2xvdHM7XHJcbiAgICAgICAgdGhpcy5hZGQgPSB0aGlzLl9wcm9qZWN0aW9uQWRkO1xyXG4gICAgICAgIHRoaXMuaW5zZXJ0ID0gdGhpcy5fcHJvamVjdGlvbkluc2VydDtcclxuICAgICAgICB0aGlzLm1vdmUgPSB0aGlzLl9wcm9qZWN0aW9uTW92ZTtcclxuICAgICAgICB0aGlzLnJlbW92ZSA9IHRoaXMuX3Byb2plY3Rpb25SZW1vdmU7XHJcbiAgICAgICAgdGhpcy5yZW1vdmVBdCA9IHRoaXMuX3Byb2plY3Rpb25SZW1vdmVBdDtcclxuICAgICAgICB0aGlzLnJlbW92ZU1hbnkgPSB0aGlzLl9wcm9qZWN0aW9uUmVtb3ZlTWFueTtcclxuICAgICAgICB0aGlzLnJlbW92ZUFsbCA9IHRoaXMuX3Byb2plY3Rpb25SZW1vdmVBbGw7XHJcbiAgICAgICAgdGhpcy5jaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uICh2aWV3KSB7IHJldHVybiBTaGFkb3dET00uZGlzdHJpYnV0ZVZpZXcodmlldywgc2xvdHMsIF90aGlzKTsgfSk7XHJcbiAgICB9O1xyXG4gICAgVmlld1Nsb3QucHJvdG90eXBlLl9wcm9qZWN0aW9uQWRkID0gZnVuY3Rpb24gKHZpZXcpIHtcclxuICAgICAgICBTaGFkb3dET00uZGlzdHJpYnV0ZVZpZXcodmlldywgdGhpcy5wcm9qZWN0VG9TbG90cywgdGhpcyk7XHJcbiAgICAgICAgdGhpcy5jaGlsZHJlbi5wdXNoKHZpZXcpO1xyXG4gICAgICAgIGlmICh0aGlzLmlzQXR0YWNoZWQpIHtcclxuICAgICAgICAgICAgdmlldy5hdHRhY2hlZCgpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBWaWV3U2xvdC5wcm90b3R5cGUuX3Byb2plY3Rpb25JbnNlcnQgPSBmdW5jdGlvbiAoaW5kZXgsIHZpZXcpIHtcclxuICAgICAgICBpZiAoKGluZGV4ID09PSAwICYmICF0aGlzLmNoaWxkcmVuLmxlbmd0aCkgfHwgaW5kZXggPj0gdGhpcy5jaGlsZHJlbi5sZW5ndGgpIHtcclxuICAgICAgICAgICAgdGhpcy5hZGQodmlldyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBTaGFkb3dET00uZGlzdHJpYnV0ZVZpZXcodmlldywgdGhpcy5wcm9qZWN0VG9TbG90cywgdGhpcywgaW5kZXgpO1xyXG4gICAgICAgICAgICB0aGlzLmNoaWxkcmVuLnNwbGljZShpbmRleCwgMCwgdmlldyk7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmlzQXR0YWNoZWQpIHtcclxuICAgICAgICAgICAgICAgIHZpZXcuYXR0YWNoZWQoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBWaWV3U2xvdC5wcm90b3R5cGUuX3Byb2plY3Rpb25Nb3ZlID0gZnVuY3Rpb24gKHNvdXJjZUluZGV4LCB0YXJnZXRJbmRleCkge1xyXG4gICAgICAgIGlmIChzb3VyY2VJbmRleCA9PT0gdGFyZ2V0SW5kZXgpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuO1xyXG4gICAgICAgIHZhciB2aWV3ID0gY2hpbGRyZW5bc291cmNlSW5kZXhdO1xyXG4gICAgICAgIFNoYWRvd0RPTS51bmRpc3RyaWJ1dGVWaWV3KHZpZXcsIHRoaXMucHJvamVjdFRvU2xvdHMsIHRoaXMpO1xyXG4gICAgICAgIFNoYWRvd0RPTS5kaXN0cmlidXRlVmlldyh2aWV3LCB0aGlzLnByb2plY3RUb1Nsb3RzLCB0aGlzLCB0YXJnZXRJbmRleCk7XHJcbiAgICAgICAgY2hpbGRyZW4uc3BsaWNlKHNvdXJjZUluZGV4LCAxKTtcclxuICAgICAgICBjaGlsZHJlbi5zcGxpY2UodGFyZ2V0SW5kZXgsIDAsIHZpZXcpO1xyXG4gICAgfTtcclxuICAgIFZpZXdTbG90LnByb3RvdHlwZS5fcHJvamVjdGlvblJlbW92ZSA9IGZ1bmN0aW9uICh2aWV3LCByZXR1cm5Ub0NhY2hlKSB7XHJcbiAgICAgICAgU2hhZG93RE9NLnVuZGlzdHJpYnV0ZVZpZXcodmlldywgdGhpcy5wcm9qZWN0VG9TbG90cywgdGhpcyk7XHJcbiAgICAgICAgdGhpcy5jaGlsZHJlbi5zcGxpY2UodGhpcy5jaGlsZHJlbi5pbmRleE9mKHZpZXcpLCAxKTtcclxuICAgICAgICBpZiAodGhpcy5pc0F0dGFjaGVkKSB7XHJcbiAgICAgICAgICAgIHZpZXcuZGV0YWNoZWQoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHJldHVyblRvQ2FjaGUpIHtcclxuICAgICAgICAgICAgdmlldy5yZXR1cm5Ub0NhY2hlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFZpZXdTbG90LnByb3RvdHlwZS5fcHJvamVjdGlvblJlbW92ZUF0ID0gZnVuY3Rpb24gKGluZGV4LCByZXR1cm5Ub0NhY2hlKSB7XHJcbiAgICAgICAgdmFyIHZpZXcgPSB0aGlzLmNoaWxkcmVuW2luZGV4XTtcclxuICAgICAgICBTaGFkb3dET00udW5kaXN0cmlidXRlVmlldyh2aWV3LCB0aGlzLnByb2plY3RUb1Nsb3RzLCB0aGlzKTtcclxuICAgICAgICB0aGlzLmNoaWxkcmVuLnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNBdHRhY2hlZCkge1xyXG4gICAgICAgICAgICB2aWV3LmRldGFjaGVkKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChyZXR1cm5Ub0NhY2hlKSB7XHJcbiAgICAgICAgICAgIHZpZXcucmV0dXJuVG9DYWNoZSgpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBWaWV3U2xvdC5wcm90b3R5cGUuX3Byb2plY3Rpb25SZW1vdmVNYW55ID0gZnVuY3Rpb24gKHZpZXdzVG9SZW1vdmUsIHJldHVyblRvQ2FjaGUpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHZpZXdzVG9SZW1vdmUuZm9yRWFjaChmdW5jdGlvbiAodmlldykgeyByZXR1cm4gX3RoaXMucmVtb3ZlKHZpZXcsIHJldHVyblRvQ2FjaGUpOyB9KTtcclxuICAgIH07XHJcbiAgICBWaWV3U2xvdC5wcm90b3R5cGUuX3Byb2plY3Rpb25SZW1vdmVBbGwgPSBmdW5jdGlvbiAocmV0dXJuVG9DYWNoZSkge1xyXG4gICAgICAgIFNoYWRvd0RPTS51bmRpc3RyaWJ1dGVBbGwodGhpcy5wcm9qZWN0VG9TbG90cywgdGhpcyk7XHJcbiAgICAgICAgdmFyIGNoaWxkcmVuID0gdGhpcy5jaGlsZHJlbjtcclxuICAgICAgICB2YXIgaWkgPSBjaGlsZHJlbi5sZW5ndGg7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgIGlmIChyZXR1cm5Ub0NhY2hlKSB7XHJcbiAgICAgICAgICAgICAgICBjaGlsZHJlbltpXS5yZXR1cm5Ub0NhY2hlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5pc0F0dGFjaGVkKSB7XHJcbiAgICAgICAgICAgICAgICBjaGlsZHJlbltpXS5kZXRhY2hlZCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuY2hpbGRyZW4gPSBbXTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gVmlld1Nsb3Q7XHJcbn0oKSk7XG5cbnZhciAkcmVzb2x2ZXIgPSByZXNvbHZlcjtcclxudmFyIFByb3ZpZGVyUmVzb2x2ZXIgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gUHJvdmlkZXJSZXNvbHZlcigpIHtcclxuICAgIH1cclxuICAgIFByb3ZpZGVyUmVzb2x2ZXIucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uIChjb250YWluZXIsIGtleSkge1xyXG4gICAgICAgIHZhciBpZCA9IGtleS5fX3Byb3ZpZGVySWRfXztcclxuICAgICAgICByZXR1cm4gaWQgaW4gY29udGFpbmVyID8gY29udGFpbmVyW2lkXSA6IChjb250YWluZXJbaWRdID0gY29udGFpbmVyLmludm9rZShrZXkpKTtcclxuICAgIH07XHJcbiAgICBQcm92aWRlclJlc29sdmVyID0gX19kZWNvcmF0ZShbXHJcbiAgICAgICAgJHJlc29sdmVyXHJcbiAgICBdLCBQcm92aWRlclJlc29sdmVyKTtcclxuICAgIHJldHVybiBQcm92aWRlclJlc29sdmVyO1xyXG59KCkpO1xyXG52YXIgcHJvdmlkZXJSZXNvbHZlckluc3RhbmNlID0gbmV3IFByb3ZpZGVyUmVzb2x2ZXIoKTtcclxuZnVuY3Rpb24gZWxlbWVudENvbnRhaW5lckdldChrZXkpIHtcclxuICAgIGlmIChrZXkgPT09IERPTS5FbGVtZW50KSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZWxlbWVudDtcclxuICAgIH1cclxuICAgIGlmIChrZXkgPT09IEJvdW5kVmlld0ZhY3RvcnkpIHtcclxuICAgICAgICBpZiAodGhpcy5ib3VuZFZpZXdGYWN0b3J5KSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmJvdW5kVmlld0ZhY3Rvcnk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBmYWN0b3J5ID0gdGhpcy5pbnN0cnVjdGlvbi52aWV3RmFjdG9yeTtcclxuICAgICAgICB2YXIgcGFydFJlcGxhY2VtZW50cyA9IHRoaXMucGFydFJlcGxhY2VtZW50cztcclxuICAgICAgICBpZiAocGFydFJlcGxhY2VtZW50cykge1xyXG4gICAgICAgICAgICBmYWN0b3J5ID0gcGFydFJlcGxhY2VtZW50c1tmYWN0b3J5LnBhcnRdIHx8IGZhY3Rvcnk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuYm91bmRWaWV3RmFjdG9yeSA9IG5ldyBCb3VuZFZpZXdGYWN0b3J5KHRoaXMsIGZhY3RvcnksIHBhcnRSZXBsYWNlbWVudHMpO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmJvdW5kVmlld0ZhY3Rvcnk7XHJcbiAgICB9XHJcbiAgICBpZiAoa2V5ID09PSBWaWV3U2xvdCkge1xyXG4gICAgICAgIGlmICh0aGlzLnZpZXdTbG90ID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgdGhpcy52aWV3U2xvdCA9IG5ldyBWaWV3U2xvdCh0aGlzLmVsZW1lbnQsIHRoaXMuaW5zdHJ1Y3Rpb24uYW5jaG9ySXNDb250YWluZXIpO1xyXG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQuaXNDb250ZW50UHJvamVjdGlvblNvdXJjZSA9IHRoaXMuaW5zdHJ1Y3Rpb24ubGlmdGluZztcclxuICAgICAgICAgICAgdGhpcy5jaGlsZHJlbi5wdXNoKHRoaXMudmlld1Nsb3QpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy52aWV3U2xvdDtcclxuICAgIH1cclxuICAgIGlmIChrZXkgPT09IEVsZW1lbnRFdmVudHMpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5lbGVtZW50RXZlbnRzIHx8ICh0aGlzLmVsZW1lbnRFdmVudHMgPSBuZXcgRWxlbWVudEV2ZW50cyh0aGlzLmVsZW1lbnQpKTtcclxuICAgIH1cclxuICAgIGlmIChrZXkgPT09IENvbXBvc2l0aW9uVHJhbnNhY3Rpb24pIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5jb21wb3NpdGlvblRyYW5zYWN0aW9uIHx8ICh0aGlzLmNvbXBvc2l0aW9uVHJhbnNhY3Rpb24gPSB0aGlzLnBhcmVudC5nZXQoa2V5KSk7XHJcbiAgICB9XHJcbiAgICBpZiAoa2V5ID09PSBWaWV3UmVzb3VyY2VzKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld1Jlc291cmNlcztcclxuICAgIH1cclxuICAgIGlmIChrZXkgPT09IFRhcmdldEluc3RydWN0aW9uKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5zdHJ1Y3Rpb247XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGhpcy5zdXBlckdldChrZXkpO1xyXG59XHJcbmZ1bmN0aW9uIGNyZWF0ZUVsZW1lbnRDb250YWluZXIocGFyZW50LCBlbGVtZW50LCBpbnN0cnVjdGlvbiwgY2hpbGRyZW4sIHBhcnRSZXBsYWNlbWVudHMsIHJlc291cmNlcykge1xyXG4gICAgdmFyIGNvbnRhaW5lciA9IHBhcmVudC5jcmVhdGVDaGlsZCgpO1xyXG4gICAgdmFyIHByb3ZpZGVycztcclxuICAgIHZhciBpO1xyXG4gICAgY29udGFpbmVyLmVsZW1lbnQgPSBlbGVtZW50O1xyXG4gICAgY29udGFpbmVyLmluc3RydWN0aW9uID0gaW5zdHJ1Y3Rpb247XHJcbiAgICBjb250YWluZXIuY2hpbGRyZW4gPSBjaGlsZHJlbjtcclxuICAgIGNvbnRhaW5lci52aWV3UmVzb3VyY2VzID0gcmVzb3VyY2VzO1xyXG4gICAgY29udGFpbmVyLnBhcnRSZXBsYWNlbWVudHMgPSBwYXJ0UmVwbGFjZW1lbnRzO1xyXG4gICAgcHJvdmlkZXJzID0gaW5zdHJ1Y3Rpb24ucHJvdmlkZXJzO1xyXG4gICAgaSA9IHByb3ZpZGVycy5sZW5ndGg7XHJcbiAgICB3aGlsZSAoaS0tKSB7XHJcbiAgICAgICAgY29udGFpbmVyLl9yZXNvbHZlcnMuc2V0KHByb3ZpZGVyc1tpXSwgcHJvdmlkZXJSZXNvbHZlckluc3RhbmNlKTtcclxuICAgIH1cclxuICAgIGNvbnRhaW5lci5zdXBlckdldCA9IGNvbnRhaW5lci5nZXQ7XHJcbiAgICBjb250YWluZXIuZ2V0ID0gZWxlbWVudENvbnRhaW5lckdldDtcclxuICAgIHJldHVybiBjb250YWluZXI7XHJcbn1cclxuZnVuY3Rpb24gaGFzQXR0cmlidXRlKG5hbWUpIHtcclxuICAgIHJldHVybiB0aGlzLl9lbGVtZW50Lmhhc0F0dHJpYnV0ZShuYW1lKTtcclxufVxyXG5mdW5jdGlvbiBnZXRBdHRyaWJ1dGUobmFtZSkge1xyXG4gICAgcmV0dXJuIHRoaXMuX2VsZW1lbnQuZ2V0QXR0cmlidXRlKG5hbWUpO1xyXG59XHJcbmZ1bmN0aW9uIHNldEF0dHJpYnV0ZShuYW1lLCB2YWx1ZSkge1xyXG4gICAgdGhpcy5fZWxlbWVudC5zZXRBdHRyaWJ1dGUobmFtZSwgdmFsdWUpO1xyXG59XHJcbmZ1bmN0aW9uIG1ha2VFbGVtZW50SW50b0FuY2hvcihlbGVtZW50LCBlbGVtZW50SW5zdHJ1Y3Rpb24pIHtcclxuICAgIHZhciBhbmNob3IgPSBET00uY3JlYXRlQ29tbWVudCgnYW5jaG9yJyk7XHJcbiAgICBpZiAoZWxlbWVudEluc3RydWN0aW9uKSB7XHJcbiAgICAgICAgdmFyIGZpcnN0Q2hpbGQgPSBlbGVtZW50LmZpcnN0Q2hpbGQ7XHJcbiAgICAgICAgaWYgKGZpcnN0Q2hpbGQgJiYgZmlyc3RDaGlsZC50YWdOYW1lID09PSAnQVUtQ09OVEVOVCcpIHtcclxuICAgICAgICAgICAgYW5jaG9yLmNvbnRlbnRFbGVtZW50ID0gZmlyc3RDaGlsZDtcclxuICAgICAgICB9XHJcbiAgICAgICAgYW5jaG9yLl9lbGVtZW50ID0gZWxlbWVudDtcclxuICAgICAgICBhbmNob3IuaGFzQXR0cmlidXRlID0gaGFzQXR0cmlidXRlO1xyXG4gICAgICAgIGFuY2hvci5nZXRBdHRyaWJ1dGUgPSBnZXRBdHRyaWJ1dGU7XHJcbiAgICAgICAgYW5jaG9yLnNldEF0dHJpYnV0ZSA9IHNldEF0dHJpYnV0ZTtcclxuICAgIH1cclxuICAgIERPTS5yZXBsYWNlTm9kZShhbmNob3IsIGVsZW1lbnQpO1xyXG4gICAgcmV0dXJuIGFuY2hvcjtcclxufVxyXG5mdW5jdGlvbiBhcHBseUluc3RydWN0aW9ucyhjb250YWluZXJzLCBlbGVtZW50LCBpbnN0cnVjdGlvbiwgY29udHJvbGxlcnMsIGJpbmRpbmdzLCBjaGlsZHJlbiwgc2hhZG93U2xvdHMsIHBhcnRSZXBsYWNlbWVudHMsIHJlc291cmNlcykge1xyXG4gICAgdmFyIGJlaGF2aW9ySW5zdHJ1Y3Rpb25zID0gaW5zdHJ1Y3Rpb24uYmVoYXZpb3JJbnN0cnVjdGlvbnM7XHJcbiAgICB2YXIgZXhwcmVzc2lvbnMgPSBpbnN0cnVjdGlvbi5leHByZXNzaW9ucztcclxuICAgIHZhciBlbGVtZW50Q29udGFpbmVyO1xyXG4gICAgdmFyIGk7XHJcbiAgICB2YXIgaWk7XHJcbiAgICB2YXIgY3VycmVudDtcclxuICAgIHZhciBpbnN0YW5jZTtcclxuICAgIGlmIChpbnN0cnVjdGlvbi5jb250ZW50RXhwcmVzc2lvbikge1xyXG4gICAgICAgIGJpbmRpbmdzLnB1c2goaW5zdHJ1Y3Rpb24uY29udGVudEV4cHJlc3Npb24uY3JlYXRlQmluZGluZyhlbGVtZW50Lm5leHRTaWJsaW5nKSk7XHJcbiAgICAgICAgZWxlbWVudC5uZXh0U2libGluZy5hdUludGVycG9sYXRpb25UYXJnZXQgPSB0cnVlO1xyXG4gICAgICAgIGVsZW1lbnQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChlbGVtZW50KTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZiAoaW5zdHJ1Y3Rpb24uc2hhZG93U2xvdCkge1xyXG4gICAgICAgIHZhciBjb21tZW50QW5jaG9yID0gRE9NLmNyZWF0ZUNvbW1lbnQoJ3Nsb3QnKTtcclxuICAgICAgICB2YXIgc2xvdCA9IHZvaWQgMDtcclxuICAgICAgICBpZiAoaW5zdHJ1Y3Rpb24uc2xvdERlc3RpbmF0aW9uKSB7XHJcbiAgICAgICAgICAgIHNsb3QgPSBuZXcgUGFzc1Rocm91Z2hTbG90KGNvbW1lbnRBbmNob3IsIGluc3RydWN0aW9uLnNsb3ROYW1lLCBpbnN0cnVjdGlvbi5zbG90RGVzdGluYXRpb24sIGluc3RydWN0aW9uLnNsb3RGYWxsYmFja0ZhY3RvcnkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgc2xvdCA9IG5ldyBTaGFkb3dTbG90KGNvbW1lbnRBbmNob3IsIGluc3RydWN0aW9uLnNsb3ROYW1lLCBpbnN0cnVjdGlvbi5zbG90RmFsbGJhY2tGYWN0b3J5KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgRE9NLnJlcGxhY2VOb2RlKGNvbW1lbnRBbmNob3IsIGVsZW1lbnQpO1xyXG4gICAgICAgIHNoYWRvd1Nsb3RzW2luc3RydWN0aW9uLnNsb3ROYW1lXSA9IHNsb3Q7XHJcbiAgICAgICAgY29udHJvbGxlcnMucHVzaChzbG90KTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZiAoaW5zdHJ1Y3Rpb24ubGV0RWxlbWVudCkge1xyXG4gICAgICAgIGZvciAoaSA9IDAsIGlpID0gZXhwcmVzc2lvbnMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICBiaW5kaW5ncy5wdXNoKGV4cHJlc3Npb25zW2ldLmNyZWF0ZUJpbmRpbmcoKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsZW1lbnQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChlbGVtZW50KTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZiAoYmVoYXZpb3JJbnN0cnVjdGlvbnMubGVuZ3RoKSB7XHJcbiAgICAgICAgaWYgKCFpbnN0cnVjdGlvbi5hbmNob3JJc0NvbnRhaW5lcikge1xyXG4gICAgICAgICAgICBlbGVtZW50ID0gbWFrZUVsZW1lbnRJbnRvQW5jaG9yKGVsZW1lbnQsIGluc3RydWN0aW9uLmVsZW1lbnRJbnN0cnVjdGlvbik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnRhaW5lcnNbaW5zdHJ1Y3Rpb24uaW5qZWN0b3JJZF0gPSBlbGVtZW50Q29udGFpbmVyID1cclxuICAgICAgICAgICAgY3JlYXRlRWxlbWVudENvbnRhaW5lcihjb250YWluZXJzW2luc3RydWN0aW9uLnBhcmVudEluamVjdG9ySWRdLCBlbGVtZW50LCBpbnN0cnVjdGlvbiwgY2hpbGRyZW4sIHBhcnRSZXBsYWNlbWVudHMsIHJlc291cmNlcyk7XHJcbiAgICAgICAgZm9yIChpID0gMCwgaWkgPSBiZWhhdmlvckluc3RydWN0aW9ucy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgIGN1cnJlbnQgPSBiZWhhdmlvckluc3RydWN0aW9uc1tpXTtcclxuICAgICAgICAgICAgaW5zdGFuY2UgPSBjdXJyZW50LnR5cGUuY3JlYXRlKGVsZW1lbnRDb250YWluZXIsIGN1cnJlbnQsIGVsZW1lbnQsIGJpbmRpbmdzKTtcclxuICAgICAgICAgICAgY29udHJvbGxlcnMucHVzaChpbnN0YW5jZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgZm9yIChpID0gMCwgaWkgPSBleHByZXNzaW9ucy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgYmluZGluZ3MucHVzaChleHByZXNzaW9uc1tpXS5jcmVhdGVCaW5kaW5nKGVsZW1lbnQpKTtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBzdHlsZVN0cmluZ1RvT2JqZWN0KHN0eWxlLCB0YXJnZXQpIHtcclxuICAgIHZhciBhdHRyaWJ1dGVzID0gc3R5bGUuc3BsaXQoJzsnKTtcclxuICAgIHZhciBmaXJzdEluZGV4T2ZDb2xvbjtcclxuICAgIHZhciBpO1xyXG4gICAgdmFyIGN1cnJlbnQ7XHJcbiAgICB2YXIga2V5O1xyXG4gICAgdmFyIHZhbHVlO1xyXG4gICAgdGFyZ2V0ID0gdGFyZ2V0IHx8IHt9O1xyXG4gICAgZm9yIChpID0gMDsgaSA8IGF0dHJpYnV0ZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICBjdXJyZW50ID0gYXR0cmlidXRlc1tpXTtcclxuICAgICAgICBmaXJzdEluZGV4T2ZDb2xvbiA9IGN1cnJlbnQuaW5kZXhPZignOicpO1xyXG4gICAgICAgIGtleSA9IGN1cnJlbnQuc3Vic3RyaW5nKDAsIGZpcnN0SW5kZXhPZkNvbG9uKS50cmltKCk7XHJcbiAgICAgICAgdmFsdWUgPSBjdXJyZW50LnN1YnN0cmluZyhmaXJzdEluZGV4T2ZDb2xvbiArIDEpLnRyaW0oKTtcclxuICAgICAgICB0YXJnZXRba2V5XSA9IHZhbHVlO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRhcmdldDtcclxufVxyXG5mdW5jdGlvbiBzdHlsZU9iamVjdFRvU3RyaW5nKG9iaikge1xyXG4gICAgdmFyIHJlc3VsdCA9ICcnO1xyXG4gICAgZm9yICh2YXIga2V5IGluIG9iaikge1xyXG4gICAgICAgIHJlc3VsdCArPSBrZXkgKyAnOicgKyBvYmpba2V5XSArICc7JztcclxuICAgIH1cclxuICAgIHJldHVybiByZXN1bHQ7XHJcbn1cclxuZnVuY3Rpb24gYXBwbHlTdXJyb2dhdGVJbnN0cnVjdGlvbihjb250YWluZXIsIGVsZW1lbnQsIGluc3RydWN0aW9uLCBjb250cm9sbGVycywgYmluZGluZ3MsIGNoaWxkcmVuKSB7XHJcbiAgICB2YXIgYmVoYXZpb3JJbnN0cnVjdGlvbnMgPSBpbnN0cnVjdGlvbi5iZWhhdmlvckluc3RydWN0aW9ucztcclxuICAgIHZhciBleHByZXNzaW9ucyA9IGluc3RydWN0aW9uLmV4cHJlc3Npb25zO1xyXG4gICAgdmFyIHByb3ZpZGVycyA9IGluc3RydWN0aW9uLnByb3ZpZGVycztcclxuICAgIHZhciB2YWx1ZXMgPSBpbnN0cnVjdGlvbi52YWx1ZXM7XHJcbiAgICB2YXIgaTtcclxuICAgIHZhciBpaTtcclxuICAgIHZhciBjdXJyZW50O1xyXG4gICAgdmFyIGluc3RhbmNlO1xyXG4gICAgdmFyIGN1cnJlbnRBdHRyaWJ1dGVWYWx1ZTtcclxuICAgIGkgPSBwcm92aWRlcnMubGVuZ3RoO1xyXG4gICAgd2hpbGUgKGktLSkge1xyXG4gICAgICAgIGNvbnRhaW5lci5fcmVzb2x2ZXJzLnNldChwcm92aWRlcnNbaV0sIHByb3ZpZGVyUmVzb2x2ZXJJbnN0YW5jZSk7XHJcbiAgICB9XHJcbiAgICBmb3IgKHZhciBrZXkgaW4gdmFsdWVzKSB7XHJcbiAgICAgICAgY3VycmVudEF0dHJpYnV0ZVZhbHVlID0gZWxlbWVudC5nZXRBdHRyaWJ1dGUoa2V5KTtcclxuICAgICAgICBpZiAoY3VycmVudEF0dHJpYnV0ZVZhbHVlKSB7XHJcbiAgICAgICAgICAgIGlmIChrZXkgPT09ICdjbGFzcycpIHtcclxuICAgICAgICAgICAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKCdjbGFzcycsIGN1cnJlbnRBdHRyaWJ1dGVWYWx1ZSArICcgJyArIHZhbHVlc1trZXldKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmIChrZXkgPT09ICdzdHlsZScpIHtcclxuICAgICAgICAgICAgICAgIHZhciBzdHlsZU9iamVjdCA9IHN0eWxlU3RyaW5nVG9PYmplY3QodmFsdWVzW2tleV0pO1xyXG4gICAgICAgICAgICAgICAgc3R5bGVTdHJpbmdUb09iamVjdChjdXJyZW50QXR0cmlidXRlVmFsdWUsIHN0eWxlT2JqZWN0KTtcclxuICAgICAgICAgICAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKCdzdHlsZScsIHN0eWxlT2JqZWN0VG9TdHJpbmcoc3R5bGVPYmplY3QpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZXNba2V5XSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKGJlaGF2aW9ySW5zdHJ1Y3Rpb25zLmxlbmd0aCkge1xyXG4gICAgICAgIGZvciAoaSA9IDAsIGlpID0gYmVoYXZpb3JJbnN0cnVjdGlvbnMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICBjdXJyZW50ID0gYmVoYXZpb3JJbnN0cnVjdGlvbnNbaV07XHJcbiAgICAgICAgICAgIGluc3RhbmNlID0gY3VycmVudC50eXBlLmNyZWF0ZShjb250YWluZXIsIGN1cnJlbnQsIGVsZW1lbnQsIGJpbmRpbmdzKTtcclxuICAgICAgICAgICAgaWYgKGluc3RhbmNlLmNvbnRlbnRWaWV3KSB7XHJcbiAgICAgICAgICAgICAgICBjaGlsZHJlbi5wdXNoKGluc3RhbmNlLmNvbnRlbnRWaWV3KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb250cm9sbGVycy5wdXNoKGluc3RhbmNlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBmb3IgKGkgPSAwLCBpaSA9IGV4cHJlc3Npb25zLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICBiaW5kaW5ncy5wdXNoKGV4cHJlc3Npb25zW2ldLmNyZWF0ZUJpbmRpbmcoZWxlbWVudCkpO1xyXG4gICAgfVxyXG59XHJcbnZhciBCb3VuZFZpZXdGYWN0b3J5ID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIEJvdW5kVmlld0ZhY3RvcnkocGFyZW50Q29udGFpbmVyLCB2aWV3RmFjdG9yeSwgcGFydFJlcGxhY2VtZW50cykge1xyXG4gICAgICAgIHRoaXMucGFyZW50Q29udGFpbmVyID0gcGFyZW50Q29udGFpbmVyO1xyXG4gICAgICAgIHRoaXMudmlld0ZhY3RvcnkgPSB2aWV3RmFjdG9yeTtcclxuICAgICAgICB0aGlzLmZhY3RvcnlDcmVhdGVJbnN0cnVjdGlvbiA9IHsgcGFydFJlcGxhY2VtZW50czogcGFydFJlcGxhY2VtZW50cyB9O1xyXG4gICAgfVxyXG4gICAgQm91bmRWaWV3RmFjdG9yeS5wcm90b3R5cGUuY3JlYXRlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciB2aWV3ID0gdGhpcy52aWV3RmFjdG9yeS5jcmVhdGUodGhpcy5wYXJlbnRDb250YWluZXIuY3JlYXRlQ2hpbGQoKSwgdGhpcy5mYWN0b3J5Q3JlYXRlSW5zdHJ1Y3Rpb24pO1xyXG4gICAgICAgIHZpZXcuX2lzVXNlckNvbnRyb2xsZWQgPSB0cnVlO1xyXG4gICAgICAgIHJldHVybiB2aWV3O1xyXG4gICAgfTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShCb3VuZFZpZXdGYWN0b3J5LnByb3RvdHlwZSwgXCJpc0NhY2hpbmdcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy52aWV3RmFjdG9yeS5pc0NhY2hpbmc7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgQm91bmRWaWV3RmFjdG9yeS5wcm90b3R5cGUuc2V0Q2FjaGVTaXplID0gZnVuY3Rpb24gKHNpemUsIGRvTm90T3ZlcnJpZGVJZkFscmVhZHlTZXQpIHtcclxuICAgICAgICB0aGlzLnZpZXdGYWN0b3J5LnNldENhY2hlU2l6ZShzaXplLCBkb05vdE92ZXJyaWRlSWZBbHJlYWR5U2V0KTtcclxuICAgIH07XHJcbiAgICBCb3VuZFZpZXdGYWN0b3J5LnByb3RvdHlwZS5nZXRDYWNoZWRWaWV3ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdGYWN0b3J5LmdldENhY2hlZFZpZXcoKTtcclxuICAgIH07XHJcbiAgICBCb3VuZFZpZXdGYWN0b3J5LnByb3RvdHlwZS5yZXR1cm5WaWV3VG9DYWNoZSA9IGZ1bmN0aW9uICh2aWV3KSB7XHJcbiAgICAgICAgdGhpcy52aWV3RmFjdG9yeS5yZXR1cm5WaWV3VG9DYWNoZSh2aWV3KTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gQm91bmRWaWV3RmFjdG9yeTtcclxufSgpKTtcclxudmFyIFZpZXdGYWN0b3J5ID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIFZpZXdGYWN0b3J5KHRlbXBsYXRlLCBpbnN0cnVjdGlvbnMsIHJlc291cmNlcykge1xyXG4gICAgICAgIHRoaXMuaXNDYWNoaW5nID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IHRlbXBsYXRlO1xyXG4gICAgICAgIHRoaXMuaW5zdHJ1Y3Rpb25zID0gaW5zdHJ1Y3Rpb25zO1xyXG4gICAgICAgIHRoaXMucmVzb3VyY2VzID0gcmVzb3VyY2VzO1xyXG4gICAgICAgIHRoaXMuY2FjaGVTaXplID0gLTE7XHJcbiAgICAgICAgdGhpcy5jYWNoZSA9IG51bGw7XHJcbiAgICB9XHJcbiAgICBWaWV3RmFjdG9yeS5wcm90b3R5cGUuc2V0Q2FjaGVTaXplID0gZnVuY3Rpb24gKHNpemUsIGRvTm90T3ZlcnJpZGVJZkFscmVhZHlTZXQpIHtcclxuICAgICAgICBpZiAoc2l6ZSkge1xyXG4gICAgICAgICAgICBpZiAoc2l6ZSA9PT0gJyonKSB7XHJcbiAgICAgICAgICAgICAgICBzaXplID0gTnVtYmVyLk1BWF9WQUxVRTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2Ygc2l6ZSA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgICAgIHNpemUgPSBwYXJzZUludChzaXplLCAxMCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuY2FjaGVTaXplID09PSAtMSB8fCAhZG9Ob3RPdmVycmlkZUlmQWxyZWFkeVNldCkge1xyXG4gICAgICAgICAgICB0aGlzLmNhY2hlU2l6ZSA9IE51bWJlcihzaXplKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuY2FjaGVTaXplID4gMCkge1xyXG4gICAgICAgICAgICB0aGlzLmNhY2hlID0gW107XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmNhY2hlID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5pc0NhY2hpbmcgPSB0aGlzLmNhY2hlU2l6ZSA+IDA7XHJcbiAgICB9O1xyXG4gICAgVmlld0ZhY3RvcnkucHJvdG90eXBlLmdldENhY2hlZFZpZXcgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2FjaGUgIT09IG51bGwgPyAodGhpcy5jYWNoZS5wb3AoKSB8fCBudWxsKSA6IG51bGw7XHJcbiAgICB9O1xyXG4gICAgVmlld0ZhY3RvcnkucHJvdG90eXBlLnJldHVyblZpZXdUb0NhY2hlID0gZnVuY3Rpb24gKHZpZXcpIHtcclxuICAgICAgICBpZiAodmlldy5pc0F0dGFjaGVkKSB7XHJcbiAgICAgICAgICAgIHZpZXcuZGV0YWNoZWQoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHZpZXcuaXNCb3VuZCkge1xyXG4gICAgICAgICAgICB2aWV3LnVuYmluZCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5jYWNoZSAhPT0gbnVsbCAmJiB0aGlzLmNhY2hlLmxlbmd0aCA8IHRoaXMuY2FjaGVTaXplKSB7XHJcbiAgICAgICAgICAgIHZpZXcuZnJvbUNhY2hlID0gdHJ1ZTtcclxuICAgICAgICAgICAgdGhpcy5jYWNoZS5wdXNoKHZpZXcpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBWaWV3RmFjdG9yeS5wcm90b3R5cGUuY3JlYXRlID0gZnVuY3Rpb24gKGNvbnRhaW5lciwgY3JlYXRlSW5zdHJ1Y3Rpb24sIGVsZW1lbnQpIHtcclxuICAgICAgICBjcmVhdGVJbnN0cnVjdGlvbiA9IGNyZWF0ZUluc3RydWN0aW9uIHx8IEJlaGF2aW9ySW5zdHJ1Y3Rpb24ubm9ybWFsO1xyXG4gICAgICAgIHZhciBjYWNoZWRWaWV3ID0gdGhpcy5nZXRDYWNoZWRWaWV3KCk7XHJcbiAgICAgICAgaWYgKGNhY2hlZFZpZXcgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGNhY2hlZFZpZXc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBmcmFnbWVudCA9IGNyZWF0ZUluc3RydWN0aW9uLmVuaGFuY2UgPyB0aGlzLnRlbXBsYXRlIDogdGhpcy50ZW1wbGF0ZS5jbG9uZU5vZGUodHJ1ZSk7XHJcbiAgICAgICAgdmFyIGluc3RydWN0YWJsZXMgPSBmcmFnbWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuYXUtdGFyZ2V0Jyk7XHJcbiAgICAgICAgdmFyIGluc3RydWN0aW9ucyA9IHRoaXMuaW5zdHJ1Y3Rpb25zO1xyXG4gICAgICAgIHZhciByZXNvdXJjZXMgPSB0aGlzLnJlc291cmNlcztcclxuICAgICAgICB2YXIgY29udHJvbGxlcnMgPSBbXTtcclxuICAgICAgICB2YXIgYmluZGluZ3MgPSBbXTtcclxuICAgICAgICB2YXIgY2hpbGRyZW4gPSBbXTtcclxuICAgICAgICB2YXIgc2hhZG93U2xvdHMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xyXG4gICAgICAgIHZhciBjb250YWluZXJzID0geyByb290OiBjb250YWluZXIgfTtcclxuICAgICAgICB2YXIgcGFydFJlcGxhY2VtZW50cyA9IGNyZWF0ZUluc3RydWN0aW9uLnBhcnRSZXBsYWNlbWVudHM7XHJcbiAgICAgICAgdmFyIGk7XHJcbiAgICAgICAgdmFyIGlpO1xyXG4gICAgICAgIHZhciB2aWV3O1xyXG4gICAgICAgIHZhciBpbnN0cnVjdGFibGU7XHJcbiAgICAgICAgdmFyIGluc3RydWN0aW9uO1xyXG4gICAgICAgIHRoaXMucmVzb3VyY2VzLl9pbnZva2VIb29rKCdiZWZvcmVDcmVhdGUnLCB0aGlzLCBjb250YWluZXIsIGZyYWdtZW50LCBjcmVhdGVJbnN0cnVjdGlvbik7XHJcbiAgICAgICAgaWYgKGVsZW1lbnQgJiYgdGhpcy5zdXJyb2dhdGVJbnN0cnVjdGlvbiAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICBhcHBseVN1cnJvZ2F0ZUluc3RydWN0aW9uKGNvbnRhaW5lciwgZWxlbWVudCwgdGhpcy5zdXJyb2dhdGVJbnN0cnVjdGlvbiwgY29udHJvbGxlcnMsIGJpbmRpbmdzLCBjaGlsZHJlbik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChjcmVhdGVJbnN0cnVjdGlvbi5lbmhhbmNlICYmIGZyYWdtZW50Lmhhc0F0dHJpYnV0ZSgnYXUtdGFyZ2V0LWlkJykpIHtcclxuICAgICAgICAgICAgaW5zdHJ1Y3RhYmxlID0gZnJhZ21lbnQ7XHJcbiAgICAgICAgICAgIGluc3RydWN0aW9uID0gaW5zdHJ1Y3Rpb25zW2luc3RydWN0YWJsZS5nZXRBdHRyaWJ1dGUoJ2F1LXRhcmdldC1pZCcpXTtcclxuICAgICAgICAgICAgYXBwbHlJbnN0cnVjdGlvbnMoY29udGFpbmVycywgaW5zdHJ1Y3RhYmxlLCBpbnN0cnVjdGlvbiwgY29udHJvbGxlcnMsIGJpbmRpbmdzLCBjaGlsZHJlbiwgc2hhZG93U2xvdHMsIHBhcnRSZXBsYWNlbWVudHMsIHJlc291cmNlcyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZvciAoaSA9IDAsIGlpID0gaW5zdHJ1Y3RhYmxlcy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgIGluc3RydWN0YWJsZSA9IGluc3RydWN0YWJsZXNbaV07XHJcbiAgICAgICAgICAgIGluc3RydWN0aW9uID0gaW5zdHJ1Y3Rpb25zW2luc3RydWN0YWJsZS5nZXRBdHRyaWJ1dGUoJ2F1LXRhcmdldC1pZCcpXTtcclxuICAgICAgICAgICAgYXBwbHlJbnN0cnVjdGlvbnMoY29udGFpbmVycywgaW5zdHJ1Y3RhYmxlLCBpbnN0cnVjdGlvbiwgY29udHJvbGxlcnMsIGJpbmRpbmdzLCBjaGlsZHJlbiwgc2hhZG93U2xvdHMsIHBhcnRSZXBsYWNlbWVudHMsIHJlc291cmNlcyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZpZXcgPSBuZXcgVmlldyhjb250YWluZXIsIHRoaXMsIGZyYWdtZW50LCBjb250cm9sbGVycywgYmluZGluZ3MsIGNoaWxkcmVuLCBzaGFkb3dTbG90cyk7XHJcbiAgICAgICAgaWYgKCFjcmVhdGVJbnN0cnVjdGlvbi5pbml0aWF0ZWRCeUJlaGF2aW9yKSB7XHJcbiAgICAgICAgICAgIHZpZXcuY3JlYXRlZCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnJlc291cmNlcy5faW52b2tlSG9vaygnYWZ0ZXJDcmVhdGUnLCB2aWV3KTtcclxuICAgICAgICByZXR1cm4gdmlldztcclxuICAgIH07XHJcbiAgICByZXR1cm4gVmlld0ZhY3Rvcnk7XHJcbn0oKSk7XG5cbnZhciBuZXh0SW5qZWN0b3JJZCA9IDA7XHJcbmZ1bmN0aW9uIGdldE5leHRJbmplY3RvcklkKCkge1xyXG4gICAgcmV0dXJuICsrbmV4dEluamVjdG9ySWQ7XHJcbn1cclxudmFyIGxhc3RBVVRhcmdldElEID0gMDtcclxuZnVuY3Rpb24gZ2V0TmV4dEFVVGFyZ2V0SUQoKSB7XHJcbiAgICByZXR1cm4gKCsrbGFzdEFVVGFyZ2V0SUQpLnRvU3RyaW5nKCk7XHJcbn1cclxuZnVuY3Rpb24gbWFrZUludG9JbnN0cnVjdGlvblRhcmdldChlbGVtZW50KSB7XHJcbiAgICB2YXIgdmFsdWUgPSBlbGVtZW50LmdldEF0dHJpYnV0ZSgnY2xhc3MnKTtcclxuICAgIHZhciBhdVRhcmdldElEID0gZ2V0TmV4dEFVVGFyZ2V0SUQoKTtcclxuICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKCdjbGFzcycsICh2YWx1ZSA/IHZhbHVlICsgJyBhdS10YXJnZXQnIDogJ2F1LXRhcmdldCcpKTtcclxuICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKCdhdS10YXJnZXQtaWQnLCBhdVRhcmdldElEKTtcclxuICAgIHJldHVybiBhdVRhcmdldElEO1xyXG59XHJcbmZ1bmN0aW9uIG1ha2VTaGFkb3dTbG90KGNvbXBpbGVyLCByZXNvdXJjZXMsIG5vZGUsIGluc3RydWN0aW9ucywgcGFyZW50SW5qZWN0b3JJZCkge1xyXG4gICAgdmFyIGF1U2hhZG93U2xvdCA9IERPTS5jcmVhdGVFbGVtZW50KCdhdS1zaGFkb3ctc2xvdCcpO1xyXG4gICAgRE9NLnJlcGxhY2VOb2RlKGF1U2hhZG93U2xvdCwgbm9kZSk7XHJcbiAgICB2YXIgYXVUYXJnZXRJRCA9IG1ha2VJbnRvSW5zdHJ1Y3Rpb25UYXJnZXQoYXVTaGFkb3dTbG90KTtcclxuICAgIHZhciBpbnN0cnVjdGlvbiA9IFRhcmdldEluc3RydWN0aW9uLnNoYWRvd1Nsb3QocGFyZW50SW5qZWN0b3JJZCk7XHJcbiAgICBpbnN0cnVjdGlvbi5zbG90TmFtZSA9IG5vZGUuZ2V0QXR0cmlidXRlKCduYW1lJykgfHwgU2hhZG93RE9NLmRlZmF1bHRTbG90S2V5O1xyXG4gICAgaW5zdHJ1Y3Rpb24uc2xvdERlc3RpbmF0aW9uID0gbm9kZS5nZXRBdHRyaWJ1dGUoJ3Nsb3QnKTtcclxuICAgIGlmIChub2RlLmlubmVySFRNTC50cmltKCkpIHtcclxuICAgICAgICB2YXIgZnJhZ21lbnQgPSBET00uY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xyXG4gICAgICAgIHZhciBjaGlsZCA9IHZvaWQgMDtcclxuICAgICAgICB3aGlsZSAoY2hpbGQgPSBub2RlLmZpcnN0Q2hpbGQpIHtcclxuICAgICAgICAgICAgZnJhZ21lbnQuYXBwZW5kQ2hpbGQoY2hpbGQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpbnN0cnVjdGlvbi5zbG90RmFsbGJhY2tGYWN0b3J5ID0gY29tcGlsZXIuY29tcGlsZShmcmFnbWVudCwgcmVzb3VyY2VzKTtcclxuICAgIH1cclxuICAgIGluc3RydWN0aW9uc1thdVRhcmdldElEXSA9IGluc3RydWN0aW9uO1xyXG4gICAgcmV0dXJuIGF1U2hhZG93U2xvdDtcclxufVxyXG52YXIgZGVmYXVsdExldEhhbmRsZXIgPSBCaW5kaW5nTGFuZ3VhZ2UucHJvdG90eXBlLmNyZWF0ZUxldEV4cHJlc3Npb25zO1xyXG52YXIgVmlld0NvbXBpbGVyID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIFZpZXdDb21waWxlcihiaW5kaW5nTGFuZ3VhZ2UsIHJlc291cmNlcykge1xyXG4gICAgICAgIHRoaXMuYmluZGluZ0xhbmd1YWdlID0gYmluZGluZ0xhbmd1YWdlO1xyXG4gICAgICAgIHRoaXMucmVzb3VyY2VzID0gcmVzb3VyY2VzO1xyXG4gICAgfVxyXG4gICAgVmlld0NvbXBpbGVyLmluamVjdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gW0JpbmRpbmdMYW5ndWFnZSwgVmlld1Jlc291cmNlc107XHJcbiAgICB9O1xyXG4gICAgVmlld0NvbXBpbGVyLnByb3RvdHlwZS5jb21waWxlID0gZnVuY3Rpb24gKHNvdXJjZSwgcmVzb3VyY2VzLCBjb21waWxlSW5zdHJ1Y3Rpb24pIHtcclxuICAgICAgICByZXNvdXJjZXMgPSByZXNvdXJjZXMgfHwgdGhpcy5yZXNvdXJjZXM7XHJcbiAgICAgICAgY29tcGlsZUluc3RydWN0aW9uID0gY29tcGlsZUluc3RydWN0aW9uIHx8IFZpZXdDb21waWxlSW5zdHJ1Y3Rpb24ubm9ybWFsO1xyXG4gICAgICAgIHNvdXJjZSA9IHR5cGVvZiBzb3VyY2UgPT09ICdzdHJpbmcnID8gRE9NLmNyZWF0ZVRlbXBsYXRlRnJvbU1hcmt1cChzb3VyY2UpIDogc291cmNlO1xyXG4gICAgICAgIHZhciBjb250ZW50O1xyXG4gICAgICAgIHZhciBwYXJ0O1xyXG4gICAgICAgIHZhciBjYWNoZVNpemU7XHJcbiAgICAgICAgaWYgKHNvdXJjZS5jb250ZW50KSB7XHJcbiAgICAgICAgICAgIHBhcnQgPSBzb3VyY2UuZ2V0QXR0cmlidXRlKCdwYXJ0Jyk7XHJcbiAgICAgICAgICAgIGNhY2hlU2l6ZSA9IHNvdXJjZS5nZXRBdHRyaWJ1dGUoJ3ZpZXctY2FjaGUnKTtcclxuICAgICAgICAgICAgY29udGVudCA9IERPTS5hZG9wdE5vZGUoc291cmNlLmNvbnRlbnQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgY29udGVudCA9IHNvdXJjZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29tcGlsZUluc3RydWN0aW9uLnRhcmdldFNoYWRvd0RPTSA9IGNvbXBpbGVJbnN0cnVjdGlvbi50YXJnZXRTaGFkb3dET00gJiYgRkVBVFVSRS5zaGFkb3dET007XHJcbiAgICAgICAgcmVzb3VyY2VzLl9pbnZva2VIb29rKCdiZWZvcmVDb21waWxlJywgY29udGVudCwgcmVzb3VyY2VzLCBjb21waWxlSW5zdHJ1Y3Rpb24pO1xyXG4gICAgICAgIHZhciBpbnN0cnVjdGlvbnMgPSB7fTtcclxuICAgICAgICB0aGlzLl9jb21waWxlTm9kZShjb250ZW50LCByZXNvdXJjZXMsIGluc3RydWN0aW9ucywgc291cmNlLCAncm9vdCcsICFjb21waWxlSW5zdHJ1Y3Rpb24udGFyZ2V0U2hhZG93RE9NKTtcclxuICAgICAgICB2YXIgZmlyc3RDaGlsZCA9IGNvbnRlbnQuZmlyc3RDaGlsZDtcclxuICAgICAgICBpZiAoZmlyc3RDaGlsZCAmJiBmaXJzdENoaWxkLm5vZGVUeXBlID09PSAxKSB7XHJcbiAgICAgICAgICAgIHZhciB0YXJnZXRJZCA9IGZpcnN0Q2hpbGQuZ2V0QXR0cmlidXRlKCdhdS10YXJnZXQtaWQnKTtcclxuICAgICAgICAgICAgaWYgKHRhcmdldElkKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaW5zID0gaW5zdHJ1Y3Rpb25zW3RhcmdldElkXTtcclxuICAgICAgICAgICAgICAgIGlmIChpbnMuc2hhZG93U2xvdCB8fCBpbnMubGlmdGluZyB8fCAoaW5zLmVsZW1lbnRJbnN0cnVjdGlvbiAmJiAhaW5zLmVsZW1lbnRJbnN0cnVjdGlvbi5hbmNob3JJc0NvbnRhaW5lcikpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb250ZW50Lmluc2VydEJlZm9yZShET00uY3JlYXRlQ29tbWVudCgndmlldycpLCBmaXJzdENoaWxkKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgZmFjdG9yeSA9IG5ldyBWaWV3RmFjdG9yeShjb250ZW50LCBpbnN0cnVjdGlvbnMsIHJlc291cmNlcyk7XHJcbiAgICAgICAgZmFjdG9yeS5zdXJyb2dhdGVJbnN0cnVjdGlvbiA9IGNvbXBpbGVJbnN0cnVjdGlvbi5jb21waWxlU3Vycm9nYXRlID8gdGhpcy5fY29tcGlsZVN1cnJvZ2F0ZShzb3VyY2UsIHJlc291cmNlcykgOiBudWxsO1xyXG4gICAgICAgIGZhY3RvcnkucGFydCA9IHBhcnQ7XHJcbiAgICAgICAgaWYgKGNhY2hlU2l6ZSkge1xyXG4gICAgICAgICAgICBmYWN0b3J5LnNldENhY2hlU2l6ZShjYWNoZVNpemUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXNvdXJjZXMuX2ludm9rZUhvb2soJ2FmdGVyQ29tcGlsZScsIGZhY3RvcnkpO1xyXG4gICAgICAgIHJldHVybiBmYWN0b3J5O1xyXG4gICAgfTtcclxuICAgIFZpZXdDb21waWxlci5wcm90b3R5cGUuX2NvbXBpbGVOb2RlID0gZnVuY3Rpb24gKG5vZGUsIHJlc291cmNlcywgaW5zdHJ1Y3Rpb25zLCBwYXJlbnROb2RlLCBwYXJlbnRJbmplY3RvcklkLCB0YXJnZXRMaWdodERPTSkge1xyXG4gICAgICAgIHN3aXRjaCAobm9kZS5ub2RlVHlwZSkge1xyXG4gICAgICAgICAgICBjYXNlIDE6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fY29tcGlsZUVsZW1lbnQobm9kZSwgcmVzb3VyY2VzLCBpbnN0cnVjdGlvbnMsIHBhcmVudE5vZGUsIHBhcmVudEluamVjdG9ySWQsIHRhcmdldExpZ2h0RE9NKTtcclxuICAgICAgICAgICAgY2FzZSAzOlxyXG4gICAgICAgICAgICAgICAgdmFyIGV4cHJlc3Npb24gPSByZXNvdXJjZXMuZ2V0QmluZGluZ0xhbmd1YWdlKHRoaXMuYmluZGluZ0xhbmd1YWdlKS5pbnNwZWN0VGV4dENvbnRlbnQocmVzb3VyY2VzLCBub2RlLndob2xlVGV4dCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoZXhwcmVzc2lvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBtYXJrZXIgPSBET00uY3JlYXRlRWxlbWVudCgnYXUtbWFya2VyJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGF1VGFyZ2V0SUQgPSBtYWtlSW50b0luc3RydWN0aW9uVGFyZ2V0KG1hcmtlcik7XHJcbiAgICAgICAgICAgICAgICAgICAgKG5vZGUucGFyZW50Tm9kZSB8fCBwYXJlbnROb2RlKS5pbnNlcnRCZWZvcmUobWFya2VyLCBub2RlKTtcclxuICAgICAgICAgICAgICAgICAgICBub2RlLnRleHRDb250ZW50ID0gJyAnO1xyXG4gICAgICAgICAgICAgICAgICAgIGluc3RydWN0aW9uc1thdVRhcmdldElEXSA9IFRhcmdldEluc3RydWN0aW9uLmNvbnRlbnRFeHByZXNzaW9uKGV4cHJlc3Npb24pO1xyXG4gICAgICAgICAgICAgICAgICAgIHdoaWxlIChub2RlLm5leHRTaWJsaW5nICYmIG5vZGUubmV4dFNpYmxpbmcubm9kZVR5cGUgPT09IDMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgKG5vZGUucGFyZW50Tm9kZSB8fCBwYXJlbnROb2RlKS5yZW1vdmVDaGlsZChub2RlLm5leHRTaWJsaW5nKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB3aGlsZSAobm9kZS5uZXh0U2libGluZyAmJiBub2RlLm5leHRTaWJsaW5nLm5vZGVUeXBlID09PSAzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUgPSBub2RlLm5leHRTaWJsaW5nO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiBub2RlLm5leHRTaWJsaW5nO1xyXG4gICAgICAgICAgICBjYXNlIDExOlxyXG4gICAgICAgICAgICAgICAgdmFyIGN1cnJlbnRDaGlsZCA9IG5vZGUuZmlyc3RDaGlsZDtcclxuICAgICAgICAgICAgICAgIHdoaWxlIChjdXJyZW50Q2hpbGQpIHtcclxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50Q2hpbGQgPSB0aGlzLl9jb21waWxlTm9kZShjdXJyZW50Q2hpbGQsIHJlc291cmNlcywgaW5zdHJ1Y3Rpb25zLCBub2RlLCBwYXJlbnRJbmplY3RvcklkLCB0YXJnZXRMaWdodERPTSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG5vZGUubmV4dFNpYmxpbmc7XHJcbiAgICB9O1xyXG4gICAgVmlld0NvbXBpbGVyLnByb3RvdHlwZS5fY29tcGlsZVN1cnJvZ2F0ZSA9IGZ1bmN0aW9uIChub2RlLCByZXNvdXJjZXMpIHtcclxuICAgICAgICB2YXIgdGFnTmFtZSA9IG5vZGUudGFnTmFtZS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICAgIHZhciBhdHRyaWJ1dGVzID0gbm9kZS5hdHRyaWJ1dGVzO1xyXG4gICAgICAgIHZhciBiaW5kaW5nTGFuZ3VhZ2UgPSByZXNvdXJjZXMuZ2V0QmluZGluZ0xhbmd1YWdlKHRoaXMuYmluZGluZ0xhbmd1YWdlKTtcclxuICAgICAgICB2YXIga25vd25BdHRyaWJ1dGU7XHJcbiAgICAgICAgdmFyIHByb3BlcnR5O1xyXG4gICAgICAgIHZhciBpbnN0cnVjdGlvbjtcclxuICAgICAgICB2YXIgaTtcclxuICAgICAgICB2YXIgaWk7XHJcbiAgICAgICAgdmFyIGF0dHI7XHJcbiAgICAgICAgdmFyIGF0dHJOYW1lO1xyXG4gICAgICAgIHZhciBhdHRyVmFsdWU7XHJcbiAgICAgICAgdmFyIGluZm87XHJcbiAgICAgICAgdmFyIHR5cGU7XHJcbiAgICAgICAgdmFyIGV4cHJlc3Npb25zID0gW107XHJcbiAgICAgICAgdmFyIGV4cHJlc3Npb247XHJcbiAgICAgICAgdmFyIGJlaGF2aW9ySW5zdHJ1Y3Rpb25zID0gW107XHJcbiAgICAgICAgdmFyIHZhbHVlcyA9IHt9O1xyXG4gICAgICAgIHZhciBoYXNWYWx1ZXMgPSBmYWxzZTtcclxuICAgICAgICB2YXIgcHJvdmlkZXJzID0gW107XHJcbiAgICAgICAgZm9yIChpID0gMCwgaWkgPSBhdHRyaWJ1dGVzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgYXR0ciA9IGF0dHJpYnV0ZXNbaV07XHJcbiAgICAgICAgICAgIGF0dHJOYW1lID0gYXR0ci5uYW1lO1xyXG4gICAgICAgICAgICBhdHRyVmFsdWUgPSBhdHRyLnZhbHVlO1xyXG4gICAgICAgICAgICBpbmZvID0gYmluZGluZ0xhbmd1YWdlLmluc3BlY3RBdHRyaWJ1dGUocmVzb3VyY2VzLCB0YWdOYW1lLCBhdHRyTmFtZSwgYXR0clZhbHVlKTtcclxuICAgICAgICAgICAgdHlwZSA9IHJlc291cmNlcy5nZXRBdHRyaWJ1dGUoaW5mby5hdHRyTmFtZSk7XHJcbiAgICAgICAgICAgIGlmICh0eXBlKSB7XHJcbiAgICAgICAgICAgICAgICBrbm93bkF0dHJpYnV0ZSA9IHJlc291cmNlcy5tYXBBdHRyaWJ1dGUoaW5mby5hdHRyTmFtZSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoa25vd25BdHRyaWJ1dGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eSA9IHR5cGUuYXR0cmlidXRlc1trbm93bkF0dHJpYnV0ZV07XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHByb3BlcnR5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGluZm8uZGVmYXVsdEJpbmRpbmdNb2RlID0gcHJvcGVydHkuZGVmYXVsdEJpbmRpbmdNb2RlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWluZm8uY29tbWFuZCAmJiAhaW5mby5leHByZXNzaW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmZvLmNvbW1hbmQgPSBwcm9wZXJ0eS5oYXNPcHRpb25zID8gJ29wdGlvbnMnIDogbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5mby5jb21tYW5kICYmIChpbmZvLmNvbW1hbmQgIT09ICdvcHRpb25zJykgJiYgdHlwZS5wcmltYXJ5UHJvcGVydHkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwcmltYXJ5UHJvcGVydHkgPSB0eXBlLnByaW1hcnlQcm9wZXJ0eTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJOYW1lID0gaW5mby5hdHRyTmFtZSA9IHByaW1hcnlQcm9wZXJ0eS5hdHRyaWJ1dGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmZvLmRlZmF1bHRCaW5kaW5nTW9kZSA9IHByaW1hcnlQcm9wZXJ0eS5kZWZhdWx0QmluZGluZ01vZGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaW5zdHJ1Y3Rpb24gPSBiaW5kaW5nTGFuZ3VhZ2UuY3JlYXRlQXR0cmlidXRlSW5zdHJ1Y3Rpb24ocmVzb3VyY2VzLCBub2RlLCBpbmZvLCB1bmRlZmluZWQsIHR5cGUpO1xyXG4gICAgICAgICAgICBpZiAoaW5zdHJ1Y3Rpb24pIHtcclxuICAgICAgICAgICAgICAgIGlmIChpbnN0cnVjdGlvbi5hbHRlcmVkQXR0cikge1xyXG4gICAgICAgICAgICAgICAgICAgIHR5cGUgPSByZXNvdXJjZXMuZ2V0QXR0cmlidXRlKGluc3RydWN0aW9uLmF0dHJOYW1lKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChpbnN0cnVjdGlvbi5kaXNjcmV0ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGV4cHJlc3Npb25zLnB1c2goaW5zdHJ1Y3Rpb24pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW5zdHJ1Y3Rpb24udHlwZSA9IHR5cGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2NvbmZpZ3VyZVByb3BlcnRpZXMoaW5zdHJ1Y3Rpb24sIHJlc291cmNlcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlLmxpZnRzQ29udGVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdZb3UgY2Fubm90IHBsYWNlIGEgdGVtcGxhdGUgY29udHJvbGxlciBvbiBhIHN1cnJvZ2F0ZSBlbGVtZW50LicpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYmVoYXZpb3JJbnN0cnVjdGlvbnMucHVzaChpbnN0cnVjdGlvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGV4cHJlc3Npb25zLnB1c2goaW5zdHJ1Y3Rpb24uYXR0cmlidXRlc1tpbnN0cnVjdGlvbi5hdHRyTmFtZV0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmICh0eXBlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaW5zdHJ1Y3Rpb24gPSBCZWhhdmlvckluc3RydWN0aW9uLmF0dHJpYnV0ZShhdHRyTmFtZSwgdHlwZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaW5zdHJ1Y3Rpb24uYXR0cmlidXRlc1tyZXNvdXJjZXMubWFwQXR0cmlidXRlKGF0dHJOYW1lKV0gPSBhdHRyVmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGUubGlmdHNDb250ZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignWW91IGNhbm5vdCBwbGFjZSBhIHRlbXBsYXRlIGNvbnRyb2xsZXIgb24gYSBzdXJyb2dhdGUgZWxlbWVudC4nKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJlaGF2aW9ySW5zdHJ1Y3Rpb25zLnB1c2goaW5zdHJ1Y3Rpb24pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGF0dHJOYW1lICE9PSAnaWQnICYmIGF0dHJOYW1lICE9PSAncGFydCcgJiYgYXR0ck5hbWUgIT09ICdyZXBsYWNlLXBhcnQnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaGFzVmFsdWVzID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB2YWx1ZXNbYXR0ck5hbWVdID0gYXR0clZhbHVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChleHByZXNzaW9ucy5sZW5ndGggfHwgYmVoYXZpb3JJbnN0cnVjdGlvbnMubGVuZ3RoIHx8IGhhc1ZhbHVlcykge1xyXG4gICAgICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IGJlaGF2aW9ySW5zdHJ1Y3Rpb25zLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgICAgIGluc3RydWN0aW9uID0gYmVoYXZpb3JJbnN0cnVjdGlvbnNbaV07XHJcbiAgICAgICAgICAgICAgICBpbnN0cnVjdGlvbi50eXBlLmNvbXBpbGUodGhpcywgcmVzb3VyY2VzLCBub2RlLCBpbnN0cnVjdGlvbik7XHJcbiAgICAgICAgICAgICAgICBwcm92aWRlcnMucHVzaChpbnN0cnVjdGlvbi50eXBlLnRhcmdldCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZm9yIChpID0gMCwgaWkgPSBleHByZXNzaW9ucy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgICAgICBleHByZXNzaW9uID0gZXhwcmVzc2lvbnNbaV07XHJcbiAgICAgICAgICAgICAgICBpZiAoZXhwcmVzc2lvbi5hdHRyVG9SZW1vdmUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG5vZGUucmVtb3ZlQXR0cmlidXRlKGV4cHJlc3Npb24uYXR0clRvUmVtb3ZlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gVGFyZ2V0SW5zdHJ1Y3Rpb24uc3Vycm9nYXRlKHByb3ZpZGVycywgYmVoYXZpb3JJbnN0cnVjdGlvbnMsIGV4cHJlc3Npb25zLCB2YWx1ZXMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH07XHJcbiAgICBWaWV3Q29tcGlsZXIucHJvdG90eXBlLl9jb21waWxlRWxlbWVudCA9IGZ1bmN0aW9uIChub2RlLCByZXNvdXJjZXMsIGluc3RydWN0aW9ucywgcGFyZW50Tm9kZSwgcGFyZW50SW5qZWN0b3JJZCwgdGFyZ2V0TGlnaHRET00pIHtcclxuICAgICAgICB2YXIgdGFnTmFtZSA9IG5vZGUudGFnTmFtZS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICAgIHZhciBhdHRyaWJ1dGVzID0gbm9kZS5hdHRyaWJ1dGVzO1xyXG4gICAgICAgIHZhciBleHByZXNzaW9ucyA9IFtdO1xyXG4gICAgICAgIHZhciBleHByZXNzaW9uO1xyXG4gICAgICAgIHZhciBiZWhhdmlvckluc3RydWN0aW9ucyA9IFtdO1xyXG4gICAgICAgIHZhciBwcm92aWRlcnMgPSBbXTtcclxuICAgICAgICB2YXIgYmluZGluZ0xhbmd1YWdlID0gcmVzb3VyY2VzLmdldEJpbmRpbmdMYW5ndWFnZSh0aGlzLmJpbmRpbmdMYW5ndWFnZSk7XHJcbiAgICAgICAgdmFyIGxpZnRpbmdJbnN0cnVjdGlvbjtcclxuICAgICAgICB2YXIgdmlld0ZhY3Rvcnk7XHJcbiAgICAgICAgdmFyIHR5cGU7XHJcbiAgICAgICAgdmFyIGVsZW1lbnRJbnN0cnVjdGlvbjtcclxuICAgICAgICB2YXIgZWxlbWVudFByb3BlcnR5O1xyXG4gICAgICAgIHZhciBpO1xyXG4gICAgICAgIHZhciBpaTtcclxuICAgICAgICB2YXIgYXR0cjtcclxuICAgICAgICB2YXIgYXR0ck5hbWU7XHJcbiAgICAgICAgdmFyIGF0dHJWYWx1ZTtcclxuICAgICAgICB2YXIgb3JpZ2luYWxBdHRyTmFtZTtcclxuICAgICAgICB2YXIgaW5zdHJ1Y3Rpb247XHJcbiAgICAgICAgdmFyIGluZm87XHJcbiAgICAgICAgdmFyIHByb3BlcnR5O1xyXG4gICAgICAgIHZhciBrbm93bkF0dHJpYnV0ZTtcclxuICAgICAgICB2YXIgYXVUYXJnZXRJRDtcclxuICAgICAgICB2YXIgaW5qZWN0b3JJZDtcclxuICAgICAgICBpZiAodGFnTmFtZSA9PT0gJ3Nsb3QnKSB7XHJcbiAgICAgICAgICAgIGlmICh0YXJnZXRMaWdodERPTSkge1xyXG4gICAgICAgICAgICAgICAgbm9kZSA9IG1ha2VTaGFkb3dTbG90KHRoaXMsIHJlc291cmNlcywgbm9kZSwgaW5zdHJ1Y3Rpb25zLCBwYXJlbnRJbmplY3RvcklkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gbm9kZS5uZXh0U2libGluZztcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAodGFnTmFtZSA9PT0gJ3RlbXBsYXRlJykge1xyXG4gICAgICAgICAgICBpZiAoISgnY29udGVudCcgaW4gbm9kZSkpIHtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignWW91IGNhbm5vdCBwbGFjZSBhIHRlbXBsYXRlIGVsZW1lbnQgd2l0aGluICcgKyBub2RlLm5hbWVzcGFjZVVSSSArICcgbmFtZXNwYWNlJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmlld0ZhY3RvcnkgPSB0aGlzLmNvbXBpbGUobm9kZSwgcmVzb3VyY2VzKTtcclxuICAgICAgICAgICAgdmlld0ZhY3RvcnkucGFydCA9IG5vZGUuZ2V0QXR0cmlidXRlKCdwYXJ0Jyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0eXBlID0gcmVzb3VyY2VzLmdldEVsZW1lbnQobm9kZS5nZXRBdHRyaWJ1dGUoJ2FzLWVsZW1lbnQnKSB8fCB0YWdOYW1lKTtcclxuICAgICAgICAgICAgaWYgKHRhZ05hbWUgPT09ICdsZXQnICYmICF0eXBlICYmIGJpbmRpbmdMYW5ndWFnZS5jcmVhdGVMZXRFeHByZXNzaW9ucyAhPT0gZGVmYXVsdExldEhhbmRsZXIpIHtcclxuICAgICAgICAgICAgICAgIGV4cHJlc3Npb25zID0gYmluZGluZ0xhbmd1YWdlLmNyZWF0ZUxldEV4cHJlc3Npb25zKHJlc291cmNlcywgbm9kZSk7XHJcbiAgICAgICAgICAgICAgICBhdVRhcmdldElEID0gbWFrZUludG9JbnN0cnVjdGlvblRhcmdldChub2RlKTtcclxuICAgICAgICAgICAgICAgIGluc3RydWN0aW9uc1thdVRhcmdldElEXSA9IFRhcmdldEluc3RydWN0aW9uLmxldEVsZW1lbnQoZXhwcmVzc2lvbnMpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5vZGUubmV4dFNpYmxpbmc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHR5cGUpIHtcclxuICAgICAgICAgICAgICAgIGVsZW1lbnRJbnN0cnVjdGlvbiA9IEJlaGF2aW9ySW5zdHJ1Y3Rpb24uZWxlbWVudChub2RlLCB0eXBlKTtcclxuICAgICAgICAgICAgICAgIHR5cGUucHJvY2Vzc0F0dHJpYnV0ZXModGhpcywgcmVzb3VyY2VzLCBub2RlLCBhdHRyaWJ1dGVzLCBlbGVtZW50SW5zdHJ1Y3Rpb24pO1xyXG4gICAgICAgICAgICAgICAgYmVoYXZpb3JJbnN0cnVjdGlvbnMucHVzaChlbGVtZW50SW5zdHJ1Y3Rpb24pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZvciAoaSA9IDAsIGlpID0gYXR0cmlidXRlcy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgIGF0dHIgPSBhdHRyaWJ1dGVzW2ldO1xyXG4gICAgICAgICAgICBvcmlnaW5hbEF0dHJOYW1lID0gYXR0ck5hbWUgPSBhdHRyLm5hbWU7XHJcbiAgICAgICAgICAgIGF0dHJWYWx1ZSA9IGF0dHIudmFsdWU7XHJcbiAgICAgICAgICAgIGluZm8gPSBiaW5kaW5nTGFuZ3VhZ2UuaW5zcGVjdEF0dHJpYnV0ZShyZXNvdXJjZXMsIHRhZ05hbWUsIGF0dHJOYW1lLCBhdHRyVmFsdWUpO1xyXG4gICAgICAgICAgICBpZiAodGFyZ2V0TGlnaHRET00gJiYgaW5mby5hdHRyTmFtZSA9PT0gJ3Nsb3QnKSB7XHJcbiAgICAgICAgICAgICAgICBpbmZvLmF0dHJOYW1lID0gYXR0ck5hbWUgPSAnYXUtc2xvdCc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdHlwZSA9IHJlc291cmNlcy5nZXRBdHRyaWJ1dGUoaW5mby5hdHRyTmFtZSk7XHJcbiAgICAgICAgICAgIGVsZW1lbnRQcm9wZXJ0eSA9IG51bGw7XHJcbiAgICAgICAgICAgIGlmICh0eXBlKSB7XHJcbiAgICAgICAgICAgICAgICBrbm93bkF0dHJpYnV0ZSA9IHJlc291cmNlcy5tYXBBdHRyaWJ1dGUoaW5mby5hdHRyTmFtZSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoa25vd25BdHRyaWJ1dGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eSA9IHR5cGUuYXR0cmlidXRlc1trbm93bkF0dHJpYnV0ZV07XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHByb3BlcnR5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGluZm8uZGVmYXVsdEJpbmRpbmdNb2RlID0gcHJvcGVydHkuZGVmYXVsdEJpbmRpbmdNb2RlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWluZm8uY29tbWFuZCAmJiAhaW5mby5leHByZXNzaW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmZvLmNvbW1hbmQgPSBwcm9wZXJ0eS5oYXNPcHRpb25zID8gJ29wdGlvbnMnIDogbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5mby5jb21tYW5kICYmIChpbmZvLmNvbW1hbmQgIT09ICdvcHRpb25zJykgJiYgdHlwZS5wcmltYXJ5UHJvcGVydHkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwcmltYXJ5UHJvcGVydHkgPSB0eXBlLnByaW1hcnlQcm9wZXJ0eTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJOYW1lID0gaW5mby5hdHRyTmFtZSA9IHByaW1hcnlQcm9wZXJ0eS5hdHRyaWJ1dGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmZvLmRlZmF1bHRCaW5kaW5nTW9kZSA9IHByaW1hcnlQcm9wZXJ0eS5kZWZhdWx0QmluZGluZ01vZGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAoZWxlbWVudEluc3RydWN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50UHJvcGVydHkgPSBlbGVtZW50SW5zdHJ1Y3Rpb24udHlwZS5hdHRyaWJ1dGVzW2luZm8uYXR0ck5hbWVdO1xyXG4gICAgICAgICAgICAgICAgaWYgKGVsZW1lbnRQcm9wZXJ0eSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGluZm8uZGVmYXVsdEJpbmRpbmdNb2RlID0gZWxlbWVudFByb3BlcnR5LmRlZmF1bHRCaW5kaW5nTW9kZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoZWxlbWVudFByb3BlcnR5KSB7XHJcbiAgICAgICAgICAgICAgICBpbnN0cnVjdGlvbiA9IGJpbmRpbmdMYW5ndWFnZS5jcmVhdGVBdHRyaWJ1dGVJbnN0cnVjdGlvbihyZXNvdXJjZXMsIG5vZGUsIGluZm8sIGVsZW1lbnRJbnN0cnVjdGlvbik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpbnN0cnVjdGlvbiA9IGJpbmRpbmdMYW5ndWFnZS5jcmVhdGVBdHRyaWJ1dGVJbnN0cnVjdGlvbihyZXNvdXJjZXMsIG5vZGUsIGluZm8sIHVuZGVmaW5lZCwgdHlwZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGluc3RydWN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaW5zdHJ1Y3Rpb24uYWx0ZXJlZEF0dHIpIHtcclxuICAgICAgICAgICAgICAgICAgICB0eXBlID0gcmVzb3VyY2VzLmdldEF0dHJpYnV0ZShpbnN0cnVjdGlvbi5hdHRyTmFtZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoaW5zdHJ1Y3Rpb24uZGlzY3JldGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBleHByZXNzaW9ucy5wdXNoKGluc3RydWN0aW9uKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGluc3RydWN0aW9uLnR5cGUgPSB0eXBlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9jb25maWd1cmVQcm9wZXJ0aWVzKGluc3RydWN0aW9uLCByZXNvdXJjZXMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZS5saWZ0c0NvbnRlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc3RydWN0aW9uLm9yaWdpbmFsQXR0ck5hbWUgPSBvcmlnaW5hbEF0dHJOYW1lO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlmdGluZ0luc3RydWN0aW9uID0gaW5zdHJ1Y3Rpb247XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJlaGF2aW9ySW5zdHJ1Y3Rpb25zLnB1c2goaW5zdHJ1Y3Rpb24pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGVsZW1lbnRQcm9wZXJ0eSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50SW5zdHJ1Y3Rpb24uYXR0cmlidXRlc1tpbmZvLmF0dHJOYW1lXS50YXJnZXRQcm9wZXJ0eSA9IGVsZW1lbnRQcm9wZXJ0eS5uYW1lO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZXhwcmVzc2lvbnMucHVzaChpbnN0cnVjdGlvbi5hdHRyaWJ1dGVzW2luc3RydWN0aW9uLmF0dHJOYW1lXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKHR5cGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBpbnN0cnVjdGlvbiA9IEJlaGF2aW9ySW5zdHJ1Y3Rpb24uYXR0cmlidXRlKGF0dHJOYW1lLCB0eXBlKTtcclxuICAgICAgICAgICAgICAgICAgICBpbnN0cnVjdGlvbi5hdHRyaWJ1dGVzW3Jlc291cmNlcy5tYXBBdHRyaWJ1dGUoYXR0ck5hbWUpXSA9IGF0dHJWYWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZS5saWZ0c0NvbnRlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW5zdHJ1Y3Rpb24ub3JpZ2luYWxBdHRyTmFtZSA9IG9yaWdpbmFsQXR0ck5hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpZnRpbmdJbnN0cnVjdGlvbiA9IGluc3RydWN0aW9uO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJlaGF2aW9ySW5zdHJ1Y3Rpb25zLnB1c2goaW5zdHJ1Y3Rpb24pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGVsZW1lbnRQcm9wZXJ0eSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnRJbnN0cnVjdGlvbi5hdHRyaWJ1dGVzW2F0dHJOYW1lXSA9IGF0dHJWYWx1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAobGlmdGluZ0luc3RydWN0aW9uKSB7XHJcbiAgICAgICAgICAgIGxpZnRpbmdJbnN0cnVjdGlvbi52aWV3RmFjdG9yeSA9IHZpZXdGYWN0b3J5O1xyXG4gICAgICAgICAgICBub2RlID0gbGlmdGluZ0luc3RydWN0aW9uLnR5cGUuY29tcGlsZSh0aGlzLCByZXNvdXJjZXMsIG5vZGUsIGxpZnRpbmdJbnN0cnVjdGlvbiwgcGFyZW50Tm9kZSk7XHJcbiAgICAgICAgICAgIGF1VGFyZ2V0SUQgPSBtYWtlSW50b0luc3RydWN0aW9uVGFyZ2V0KG5vZGUpO1xyXG4gICAgICAgICAgICBpbnN0cnVjdGlvbnNbYXVUYXJnZXRJRF0gPSBUYXJnZXRJbnN0cnVjdGlvbi5saWZ0aW5nKHBhcmVudEluamVjdG9ySWQsIGxpZnRpbmdJbnN0cnVjdGlvbik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB2YXIgc2tpcENvbnRlbnRQcm9jZXNzaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGlmIChleHByZXNzaW9ucy5sZW5ndGggfHwgYmVoYXZpb3JJbnN0cnVjdGlvbnMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICBpbmplY3RvcklkID0gYmVoYXZpb3JJbnN0cnVjdGlvbnMubGVuZ3RoID8gZ2V0TmV4dEluamVjdG9ySWQoKSA6IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgZm9yIChpID0gMCwgaWkgPSBiZWhhdmlvckluc3RydWN0aW9ucy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaW5zdHJ1Y3Rpb24gPSBiZWhhdmlvckluc3RydWN0aW9uc1tpXTtcclxuICAgICAgICAgICAgICAgICAgICBpbnN0cnVjdGlvbi50eXBlLmNvbXBpbGUodGhpcywgcmVzb3VyY2VzLCBub2RlLCBpbnN0cnVjdGlvbiwgcGFyZW50Tm9kZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcHJvdmlkZXJzLnB1c2goaW5zdHJ1Y3Rpb24udHlwZS50YXJnZXQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNraXBDb250ZW50UHJvY2Vzc2luZyA9IHNraXBDb250ZW50UHJvY2Vzc2luZyB8fCBpbnN0cnVjdGlvbi5za2lwQ29udGVudFByb2Nlc3Npbmc7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IGV4cHJlc3Npb25zLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgICAgICAgICBleHByZXNzaW9uID0gZXhwcmVzc2lvbnNbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGV4cHJlc3Npb24uYXR0clRvUmVtb3ZlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbm9kZS5yZW1vdmVBdHRyaWJ1dGUoZXhwcmVzc2lvbi5hdHRyVG9SZW1vdmUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGF1VGFyZ2V0SUQgPSBtYWtlSW50b0luc3RydWN0aW9uVGFyZ2V0KG5vZGUpO1xyXG4gICAgICAgICAgICAgICAgaW5zdHJ1Y3Rpb25zW2F1VGFyZ2V0SURdID0gVGFyZ2V0SW5zdHJ1Y3Rpb24ubm9ybWFsKGluamVjdG9ySWQsIHBhcmVudEluamVjdG9ySWQsIHByb3ZpZGVycywgYmVoYXZpb3JJbnN0cnVjdGlvbnMsIGV4cHJlc3Npb25zLCBlbGVtZW50SW5zdHJ1Y3Rpb24pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChza2lwQ29udGVudFByb2Nlc3NpbmcpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBub2RlLm5leHRTaWJsaW5nO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBjdXJyZW50Q2hpbGQgPSBub2RlLmZpcnN0Q2hpbGQ7XHJcbiAgICAgICAgICAgIHdoaWxlIChjdXJyZW50Q2hpbGQpIHtcclxuICAgICAgICAgICAgICAgIGN1cnJlbnRDaGlsZCA9IHRoaXMuX2NvbXBpbGVOb2RlKGN1cnJlbnRDaGlsZCwgcmVzb3VyY2VzLCBpbnN0cnVjdGlvbnMsIG5vZGUsIGluamVjdG9ySWQgfHwgcGFyZW50SW5qZWN0b3JJZCwgdGFyZ2V0TGlnaHRET00pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBub2RlLm5leHRTaWJsaW5nO1xyXG4gICAgfTtcclxuICAgIFZpZXdDb21waWxlci5wcm90b3R5cGUuX2NvbmZpZ3VyZVByb3BlcnRpZXMgPSBmdW5jdGlvbiAoaW5zdHJ1Y3Rpb24sIHJlc291cmNlcykge1xyXG4gICAgICAgIHZhciB0eXBlID0gaW5zdHJ1Y3Rpb24udHlwZTtcclxuICAgICAgICB2YXIgYXR0ck5hbWUgPSBpbnN0cnVjdGlvbi5hdHRyTmFtZTtcclxuICAgICAgICB2YXIgYXR0cmlidXRlcyA9IGluc3RydWN0aW9uLmF0dHJpYnV0ZXM7XHJcbiAgICAgICAgdmFyIHByb3BlcnR5O1xyXG4gICAgICAgIHZhciBrZXk7XHJcbiAgICAgICAgdmFyIHZhbHVlO1xyXG4gICAgICAgIHZhciBrbm93bkF0dHJpYnV0ZSA9IHJlc291cmNlcy5tYXBBdHRyaWJ1dGUoYXR0ck5hbWUpO1xyXG4gICAgICAgIGlmIChrbm93bkF0dHJpYnV0ZSAmJiBhdHRyTmFtZSBpbiBhdHRyaWJ1dGVzICYmIGtub3duQXR0cmlidXRlICE9PSBhdHRyTmFtZSkge1xyXG4gICAgICAgICAgICBhdHRyaWJ1dGVzW2tub3duQXR0cmlidXRlXSA9IGF0dHJpYnV0ZXNbYXR0ck5hbWVdO1xyXG4gICAgICAgICAgICBkZWxldGUgYXR0cmlidXRlc1thdHRyTmFtZV07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZvciAoa2V5IGluIGF0dHJpYnV0ZXMpIHtcclxuICAgICAgICAgICAgdmFsdWUgPSBhdHRyaWJ1dGVzW2tleV07XHJcbiAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gbnVsbCAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnKSB7XHJcbiAgICAgICAgICAgICAgICBwcm9wZXJ0eSA9IHR5cGUuYXR0cmlidXRlc1trZXldO1xyXG4gICAgICAgICAgICAgICAgaWYgKHByb3BlcnR5ICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YWx1ZS50YXJnZXRQcm9wZXJ0eSA9IHByb3BlcnR5Lm5hbWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB2YWx1ZS50YXJnZXRQcm9wZXJ0eSA9IGtleTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICByZXR1cm4gVmlld0NvbXBpbGVyO1xyXG59KCkpO1xuXG52YXIgVmlld0VuZ2luZUhvb2tzUmVzb3VyY2UgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gVmlld0VuZ2luZUhvb2tzUmVzb3VyY2UoKSB7XHJcbiAgICB9XHJcbiAgICBWaWV3RW5naW5lSG9va3NSZXNvdXJjZS5wcm90b3R5cGUuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uIChjb250YWluZXIsIHRhcmdldCkge1xyXG4gICAgICAgIHRoaXMuaW5zdGFuY2UgPSBjb250YWluZXIuZ2V0KHRhcmdldCk7XHJcbiAgICB9O1xyXG4gICAgVmlld0VuZ2luZUhvb2tzUmVzb3VyY2UucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKHJlZ2lzdHJ5LCBuYW1lKSB7XHJcbiAgICAgICAgcmVnaXN0cnkucmVnaXN0ZXJWaWV3RW5naW5lSG9va3ModGhpcy5pbnN0YW5jZSk7XHJcbiAgICB9O1xyXG4gICAgVmlld0VuZ2luZUhvb2tzUmVzb3VyY2UucHJvdG90eXBlLmxvYWQgPSBmdW5jdGlvbiAoY29udGFpbmVyLCB0YXJnZXQpIHsgfTtcclxuICAgIFZpZXdFbmdpbmVIb29rc1Jlc291cmNlLmNvbnZlbnRpb24gPSBmdW5jdGlvbiAobmFtZSkge1xyXG4gICAgICAgIGlmIChuYW1lLmVuZHNXaXRoKCdWaWV3RW5naW5lSG9va3MnKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFZpZXdFbmdpbmVIb29rc1Jlc291cmNlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIHJldHVybiBWaWV3RW5naW5lSG9va3NSZXNvdXJjZTtcclxufSgpKTtcclxuZnVuY3Rpb24gdmlld0VuZ2luZUhvb2tzKHRhcmdldCkge1xyXG4gICAgdmFyIGRlY28gPSBmdW5jdGlvbiAodCkge1xyXG4gICAgICAgIG1ldGFkYXRhLmRlZmluZShtZXRhZGF0YS5yZXNvdXJjZSwgbmV3IFZpZXdFbmdpbmVIb29rc1Jlc291cmNlKCksIHQpO1xyXG4gICAgfTtcclxuICAgIHJldHVybiB0YXJnZXQgPyBkZWNvKHRhcmdldCkgOiBkZWNvO1xyXG59XG5cbnZhciBSZXNvdXJjZU1vZHVsZSA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBSZXNvdXJjZU1vZHVsZShtb2R1bGVJZCkge1xyXG4gICAgICAgIHRoaXMuaWQgPSBtb2R1bGVJZDtcclxuICAgICAgICB0aGlzLm1vZHVsZUluc3RhbmNlID0gbnVsbDtcclxuICAgICAgICB0aGlzLm1haW5SZXNvdXJjZSA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5yZXNvdXJjZXMgPSBudWxsO1xyXG4gICAgICAgIHRoaXMudmlld1N0cmF0ZWd5ID0gbnVsbDtcclxuICAgICAgICB0aGlzLmlzSW5pdGlhbGl6ZWQgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLm9uTG9hZGVkID0gbnVsbDtcclxuICAgICAgICB0aGlzLmxvYWRDb250ZXh0ID0gbnVsbDtcclxuICAgIH1cclxuICAgIFJlc291cmNlTW9kdWxlLnByb3RvdHlwZS5pbml0aWFsaXplID0gZnVuY3Rpb24gKGNvbnRhaW5lcikge1xyXG4gICAgICAgIHZhciBjdXJyZW50ID0gdGhpcy5tYWluUmVzb3VyY2U7XHJcbiAgICAgICAgdmFyIHJlc291cmNlcyA9IHRoaXMucmVzb3VyY2VzO1xyXG4gICAgICAgIHZhciB2cyA9IHRoaXMudmlld1N0cmF0ZWd5O1xyXG4gICAgICAgIGlmICh0aGlzLmlzSW5pdGlhbGl6ZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmlzSW5pdGlhbGl6ZWQgPSB0cnVlO1xyXG4gICAgICAgIGlmIChjdXJyZW50ICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgY3VycmVudC5tZXRhZGF0YS52aWV3U3RyYXRlZ3kgPSB2cztcclxuICAgICAgICAgICAgY3VycmVudC5pbml0aWFsaXplKGNvbnRhaW5lcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IHJlc291cmNlcy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgIGN1cnJlbnQgPSByZXNvdXJjZXNbaV07XHJcbiAgICAgICAgICAgIGN1cnJlbnQubWV0YWRhdGEudmlld1N0cmF0ZWd5ID0gdnM7XHJcbiAgICAgICAgICAgIGN1cnJlbnQuaW5pdGlhbGl6ZShjb250YWluZXIpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBSZXNvdXJjZU1vZHVsZS5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAocmVnaXN0cnksIG5hbWUpIHtcclxuICAgICAgICB2YXIgbWFpbiA9IHRoaXMubWFpblJlc291cmNlO1xyXG4gICAgICAgIHZhciByZXNvdXJjZXMgPSB0aGlzLnJlc291cmNlcztcclxuICAgICAgICBpZiAobWFpbiAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIG1haW4ucmVnaXN0ZXIocmVnaXN0cnksIG5hbWUpO1xyXG4gICAgICAgICAgICBuYW1lID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gcmVzb3VyY2VzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgcmVzb3VyY2VzW2ldLnJlZ2lzdGVyKHJlZ2lzdHJ5LCBuYW1lKTtcclxuICAgICAgICAgICAgbmFtZSA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFJlc291cmNlTW9kdWxlLnByb3RvdHlwZS5sb2FkID0gZnVuY3Rpb24gKGNvbnRhaW5lciwgbG9hZENvbnRleHQpIHtcclxuICAgICAgICBpZiAodGhpcy5vbkxvYWRlZCAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5sb2FkQ29udGV4dCA9PT0gbG9hZENvbnRleHQgPyBQcm9taXNlLnJlc29sdmUoKSA6IHRoaXMub25Mb2FkZWQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBtYWluID0gdGhpcy5tYWluUmVzb3VyY2U7XHJcbiAgICAgICAgdmFyIHJlc291cmNlcyA9IHRoaXMucmVzb3VyY2VzO1xyXG4gICAgICAgIHZhciBsb2FkcztcclxuICAgICAgICBpZiAobWFpbiAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIGxvYWRzID0gbmV3IEFycmF5KHJlc291cmNlcy5sZW5ndGggKyAxKTtcclxuICAgICAgICAgICAgbG9hZHNbMF0gPSBtYWluLmxvYWQoY29udGFpbmVyLCBsb2FkQ29udGV4dCk7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IHJlc291cmNlcy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgICAgICBsb2Fkc1tpICsgMV0gPSByZXNvdXJjZXNbaV0ubG9hZChjb250YWluZXIsIGxvYWRDb250ZXh0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgbG9hZHMgPSBuZXcgQXJyYXkocmVzb3VyY2VzLmxlbmd0aCk7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IHJlc291cmNlcy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgICAgICBsb2Fkc1tpXSA9IHJlc291cmNlc1tpXS5sb2FkKGNvbnRhaW5lciwgbG9hZENvbnRleHQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMubG9hZENvbnRleHQgPSBsb2FkQ29udGV4dDtcclxuICAgICAgICB0aGlzLm9uTG9hZGVkID0gUHJvbWlzZS5hbGwobG9hZHMpO1xyXG4gICAgICAgIHJldHVybiB0aGlzLm9uTG9hZGVkO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBSZXNvdXJjZU1vZHVsZTtcclxufSgpKTtcclxudmFyIFJlc291cmNlRGVzY3JpcHRpb24gPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gUmVzb3VyY2VEZXNjcmlwdGlvbihrZXksIGV4cG9ydGVkVmFsdWUsIHJlc291cmNlVHlwZU1ldGEpIHtcclxuICAgICAgICBpZiAoIXJlc291cmNlVHlwZU1ldGEpIHtcclxuICAgICAgICAgICAgcmVzb3VyY2VUeXBlTWV0YSA9IG1ldGFkYXRhLmdldChtZXRhZGF0YS5yZXNvdXJjZSwgZXhwb3J0ZWRWYWx1ZSk7XHJcbiAgICAgICAgICAgIGlmICghcmVzb3VyY2VUeXBlTWV0YSkge1xyXG4gICAgICAgICAgICAgICAgcmVzb3VyY2VUeXBlTWV0YSA9IG5ldyBIdG1sQmVoYXZpb3JSZXNvdXJjZSgpO1xyXG4gICAgICAgICAgICAgICAgcmVzb3VyY2VUeXBlTWV0YS5lbGVtZW50TmFtZSA9IF9oeXBoZW5hdGUoa2V5KTtcclxuICAgICAgICAgICAgICAgIG1ldGFkYXRhLmRlZmluZShtZXRhZGF0YS5yZXNvdXJjZSwgcmVzb3VyY2VUeXBlTWV0YSwgZXhwb3J0ZWRWYWx1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHJlc291cmNlVHlwZU1ldGEgaW5zdGFuY2VvZiBIdG1sQmVoYXZpb3JSZXNvdXJjZSkge1xyXG4gICAgICAgICAgICBpZiAocmVzb3VyY2VUeXBlTWV0YS5lbGVtZW50TmFtZSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICByZXNvdXJjZVR5cGVNZXRhLmVsZW1lbnROYW1lID0gX2h5cGhlbmF0ZShrZXkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHJlc291cmNlVHlwZU1ldGEuYXR0cmlidXRlTmFtZSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICByZXNvdXJjZVR5cGVNZXRhLmF0dHJpYnV0ZU5hbWUgPSBfaHlwaGVuYXRlKGtleSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAocmVzb3VyY2VUeXBlTWV0YS5hdHRyaWJ1dGVOYW1lID09PSBudWxsICYmIHJlc291cmNlVHlwZU1ldGEuZWxlbWVudE5hbWUgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIEh0bWxCZWhhdmlvclJlc291cmNlLmNvbnZlbnRpb24oa2V5LCByZXNvdXJjZVR5cGVNZXRhKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmICghcmVzb3VyY2VUeXBlTWV0YS5uYW1lKSB7XHJcbiAgICAgICAgICAgIHJlc291cmNlVHlwZU1ldGEubmFtZSA9IF9oeXBoZW5hdGUoa2V5KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5tZXRhZGF0YSA9IHJlc291cmNlVHlwZU1ldGE7XHJcbiAgICAgICAgdGhpcy52YWx1ZSA9IGV4cG9ydGVkVmFsdWU7XHJcbiAgICB9XHJcbiAgICBSZXNvdXJjZURlc2NyaXB0aW9uLnByb3RvdHlwZS5pbml0aWFsaXplID0gZnVuY3Rpb24gKGNvbnRhaW5lcikge1xyXG4gICAgICAgIHRoaXMubWV0YWRhdGEuaW5pdGlhbGl6ZShjb250YWluZXIsIHRoaXMudmFsdWUpO1xyXG4gICAgfTtcclxuICAgIFJlc291cmNlRGVzY3JpcHRpb24ucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKHJlZ2lzdHJ5LCBuYW1lKSB7XHJcbiAgICAgICAgdGhpcy5tZXRhZGF0YS5yZWdpc3RlcihyZWdpc3RyeSwgbmFtZSk7XHJcbiAgICB9O1xyXG4gICAgUmVzb3VyY2VEZXNjcmlwdGlvbi5wcm90b3R5cGUubG9hZCA9IGZ1bmN0aW9uIChjb250YWluZXIsIGxvYWRDb250ZXh0KSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMubWV0YWRhdGEubG9hZChjb250YWluZXIsIHRoaXMudmFsdWUsIGxvYWRDb250ZXh0KTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gUmVzb3VyY2VEZXNjcmlwdGlvbjtcclxufSgpKTtcclxudmFyIE1vZHVsZUFuYWx5emVyID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIE1vZHVsZUFuYWx5emVyKCkge1xyXG4gICAgICAgIHRoaXMuY2FjaGUgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xyXG4gICAgfVxyXG4gICAgTW9kdWxlQW5hbHl6ZXIucHJvdG90eXBlLmdldEFuYWx5c2lzID0gZnVuY3Rpb24gKG1vZHVsZUlkKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2FjaGVbbW9kdWxlSWRdO1xyXG4gICAgfTtcclxuICAgIE1vZHVsZUFuYWx5emVyLnByb3RvdHlwZS5hbmFseXplID0gZnVuY3Rpb24gKG1vZHVsZUlkLCBtb2R1bGVJbnN0YW5jZSwgbWFpblJlc291cmNlS2V5KSB7XHJcbiAgICAgICAgdmFyIG1haW5SZXNvdXJjZTtcclxuICAgICAgICB2YXIgZmFsbGJhY2tWYWx1ZTtcclxuICAgICAgICB2YXIgZmFsbGJhY2tLZXk7XHJcbiAgICAgICAgdmFyIHJlc291cmNlVHlwZU1ldGE7XHJcbiAgICAgICAgdmFyIGtleTtcclxuICAgICAgICB2YXIgZXhwb3J0ZWRWYWx1ZTtcclxuICAgICAgICB2YXIgcmVzb3VyY2VzID0gW107XHJcbiAgICAgICAgdmFyIGNvbnZlbnRpb25hbDtcclxuICAgICAgICB2YXIgdnM7XHJcbiAgICAgICAgdmFyIHJlc291cmNlTW9kdWxlO1xyXG4gICAgICAgIHJlc291cmNlTW9kdWxlID0gdGhpcy5jYWNoZVttb2R1bGVJZF07XHJcbiAgICAgICAgaWYgKHJlc291cmNlTW9kdWxlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXNvdXJjZU1vZHVsZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmVzb3VyY2VNb2R1bGUgPSBuZXcgUmVzb3VyY2VNb2R1bGUobW9kdWxlSWQpO1xyXG4gICAgICAgIHRoaXMuY2FjaGVbbW9kdWxlSWRdID0gcmVzb3VyY2VNb2R1bGU7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBtb2R1bGVJbnN0YW5jZSA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICBtb2R1bGVJbnN0YW5jZSA9IHsgJ2RlZmF1bHQnOiBtb2R1bGVJbnN0YW5jZSB9O1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAobWFpblJlc291cmNlS2V5KSB7XHJcbiAgICAgICAgICAgIG1haW5SZXNvdXJjZSA9IG5ldyBSZXNvdXJjZURlc2NyaXB0aW9uKG1haW5SZXNvdXJjZUtleSwgbW9kdWxlSW5zdGFuY2VbbWFpblJlc291cmNlS2V5XSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZvciAoa2V5IGluIG1vZHVsZUluc3RhbmNlKSB7XHJcbiAgICAgICAgICAgIGV4cG9ydGVkVmFsdWUgPSBtb2R1bGVJbnN0YW5jZVtrZXldO1xyXG4gICAgICAgICAgICBpZiAoa2V5ID09PSBtYWluUmVzb3VyY2VLZXkgfHwgdHlwZW9mIGV4cG9ydGVkVmFsdWUgIT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJlc291cmNlVHlwZU1ldGEgPSBtZXRhZGF0YS5nZXQobWV0YWRhdGEucmVzb3VyY2UsIGV4cG9ydGVkVmFsdWUpO1xyXG4gICAgICAgICAgICBpZiAocmVzb3VyY2VUeXBlTWV0YSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc291cmNlVHlwZU1ldGEgaW5zdGFuY2VvZiBIdG1sQmVoYXZpb3JSZXNvdXJjZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIFZpZXdSZXNvdXJjZXMuY29udmVudGlvbihleHBvcnRlZFZhbHVlLCByZXNvdXJjZVR5cGVNZXRhKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzb3VyY2VUeXBlTWV0YS5hdHRyaWJ1dGVOYW1lID09PSBudWxsICYmIHJlc291cmNlVHlwZU1ldGEuZWxlbWVudE5hbWUgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgSHRtbEJlaGF2aW9yUmVzb3VyY2UuY29udmVudGlvbihrZXksIHJlc291cmNlVHlwZU1ldGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzb3VyY2VUeXBlTWV0YS5hdHRyaWJ1dGVOYW1lID09PSBudWxsICYmIHJlc291cmNlVHlwZU1ldGEuZWxlbWVudE5hbWUgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VUeXBlTWV0YS5lbGVtZW50TmFtZSA9IF9oeXBoZW5hdGUoa2V5KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoIW1haW5SZXNvdXJjZSAmJiByZXNvdXJjZVR5cGVNZXRhIGluc3RhbmNlb2YgSHRtbEJlaGF2aW9yUmVzb3VyY2UgJiYgcmVzb3VyY2VUeXBlTWV0YS5lbGVtZW50TmFtZSAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG1haW5SZXNvdXJjZSA9IG5ldyBSZXNvdXJjZURlc2NyaXB0aW9uKGtleSwgZXhwb3J0ZWRWYWx1ZSwgcmVzb3VyY2VUeXBlTWV0YSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByZXNvdXJjZXMucHVzaChuZXcgUmVzb3VyY2VEZXNjcmlwdGlvbihrZXksIGV4cG9ydGVkVmFsdWUsIHJlc291cmNlVHlwZU1ldGEpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmICh2aWV3U3RyYXRlZ3kuZGVjb3JhdGVzKGV4cG9ydGVkVmFsdWUpKSB7XHJcbiAgICAgICAgICAgICAgICB2cyA9IGV4cG9ydGVkVmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAoZXhwb3J0ZWRWYWx1ZSBpbnN0YW5jZW9mIFRlbXBsYXRlUmVnaXN0cnlFbnRyeSkge1xyXG4gICAgICAgICAgICAgICAgdnMgPSBuZXcgVGVtcGxhdGVSZWdpc3RyeVZpZXdTdHJhdGVneShtb2R1bGVJZCwgZXhwb3J0ZWRWYWx1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoY29udmVudGlvbmFsID0gVmlld1Jlc291cmNlcy5jb252ZW50aW9uKGV4cG9ydGVkVmFsdWUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnZlbnRpb25hbC5lbGVtZW50TmFtZSAhPT0gbnVsbCAmJiAhbWFpblJlc291cmNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1haW5SZXNvdXJjZSA9IG5ldyBSZXNvdXJjZURlc2NyaXB0aW9uKGtleSwgZXhwb3J0ZWRWYWx1ZSwgY29udmVudGlvbmFsKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc291cmNlcy5wdXNoKG5ldyBSZXNvdXJjZURlc2NyaXB0aW9uKGtleSwgZXhwb3J0ZWRWYWx1ZSwgY29udmVudGlvbmFsKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIG1ldGFkYXRhLmRlZmluZShtZXRhZGF0YS5yZXNvdXJjZSwgY29udmVudGlvbmFsLCBleHBvcnRlZFZhbHVlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGNvbnZlbnRpb25hbCA9IEh0bWxCZWhhdmlvclJlc291cmNlLmNvbnZlbnRpb24oa2V5KSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjb252ZW50aW9uYWwuZWxlbWVudE5hbWUgIT09IG51bGwgJiYgIW1haW5SZXNvdXJjZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtYWluUmVzb3VyY2UgPSBuZXcgUmVzb3VyY2VEZXNjcmlwdGlvbihrZXksIGV4cG9ydGVkVmFsdWUsIGNvbnZlbnRpb25hbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZXMucHVzaChuZXcgUmVzb3VyY2VEZXNjcmlwdGlvbihrZXksIGV4cG9ydGVkVmFsdWUsIGNvbnZlbnRpb25hbCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBtZXRhZGF0YS5kZWZpbmUobWV0YWRhdGEucmVzb3VyY2UsIGNvbnZlbnRpb25hbCwgZXhwb3J0ZWRWYWx1ZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChjb252ZW50aW9uYWwgPSBWYWx1ZUNvbnZlcnRlclJlc291cmNlLmNvbnZlbnRpb24oa2V5KVxyXG4gICAgICAgICAgICAgICAgICAgIHx8IEJpbmRpbmdCZWhhdmlvclJlc291cmNlLmNvbnZlbnRpb24oa2V5KVxyXG4gICAgICAgICAgICAgICAgICAgIHx8IFZpZXdFbmdpbmVIb29rc1Jlc291cmNlLmNvbnZlbnRpb24oa2V5KSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc291cmNlcy5wdXNoKG5ldyBSZXNvdXJjZURlc2NyaXB0aW9uKGtleSwgZXhwb3J0ZWRWYWx1ZSwgY29udmVudGlvbmFsKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgbWV0YWRhdGEuZGVmaW5lKG1ldGFkYXRhLnJlc291cmNlLCBjb252ZW50aW9uYWwsIGV4cG9ydGVkVmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoIWZhbGxiYWNrVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBmYWxsYmFja1ZhbHVlID0gZXhwb3J0ZWRWYWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICBmYWxsYmFja0tleSA9IGtleTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIW1haW5SZXNvdXJjZSAmJiBmYWxsYmFja1ZhbHVlKSB7XHJcbiAgICAgICAgICAgIG1haW5SZXNvdXJjZSA9IG5ldyBSZXNvdXJjZURlc2NyaXB0aW9uKGZhbGxiYWNrS2V5LCBmYWxsYmFja1ZhbHVlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmVzb3VyY2VNb2R1bGUubW9kdWxlSW5zdGFuY2UgPSBtb2R1bGVJbnN0YW5jZTtcclxuICAgICAgICByZXNvdXJjZU1vZHVsZS5tYWluUmVzb3VyY2UgPSBtYWluUmVzb3VyY2U7XHJcbiAgICAgICAgcmVzb3VyY2VNb2R1bGUucmVzb3VyY2VzID0gcmVzb3VyY2VzO1xyXG4gICAgICAgIHJlc291cmNlTW9kdWxlLnZpZXdTdHJhdGVneSA9IHZzO1xyXG4gICAgICAgIHJldHVybiByZXNvdXJjZU1vZHVsZTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gTW9kdWxlQW5hbHl6ZXI7XHJcbn0oKSk7XG5cbnZhciBsb2dnZXIgPSBMb2dNYW5hZ2VyLmdldExvZ2dlcigndGVtcGxhdGluZycpO1xyXG5mdW5jdGlvbiBlbnN1cmVSZWdpc3RyeUVudHJ5KGxvYWRlciwgdXJsT3JSZWdpc3RyeUVudHJ5KSB7XHJcbiAgICBpZiAodXJsT3JSZWdpc3RyeUVudHJ5IGluc3RhbmNlb2YgVGVtcGxhdGVSZWdpc3RyeUVudHJ5KSB7XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh1cmxPclJlZ2lzdHJ5RW50cnkpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGxvYWRlci5sb2FkVGVtcGxhdGUodXJsT3JSZWdpc3RyeUVudHJ5KTtcclxufVxyXG52YXIgUHJveHlWaWV3RmFjdG9yeSA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBQcm94eVZpZXdGYWN0b3J5KHByb21pc2UpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHByb21pc2UudGhlbihmdW5jdGlvbiAoeCkgeyByZXR1cm4gX3RoaXMudmlld0ZhY3RvcnkgPSB4OyB9KTtcclxuICAgIH1cclxuICAgIFByb3h5Vmlld0ZhY3RvcnkucHJvdG90eXBlLmNyZWF0ZSA9IGZ1bmN0aW9uIChjb250YWluZXIsIGJpbmRpbmdDb250ZXh0LCBjcmVhdGVJbnN0cnVjdGlvbiwgZWxlbWVudCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdGYWN0b3J5LmNyZWF0ZShjb250YWluZXIsIGJpbmRpbmdDb250ZXh0LCBjcmVhdGVJbnN0cnVjdGlvbiwgZWxlbWVudCk7XHJcbiAgICB9O1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFByb3h5Vmlld0ZhY3RvcnkucHJvdG90eXBlLCBcImlzQ2FjaGluZ1wiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnZpZXdGYWN0b3J5LmlzQ2FjaGluZztcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBQcm94eVZpZXdGYWN0b3J5LnByb3RvdHlwZS5zZXRDYWNoZVNpemUgPSBmdW5jdGlvbiAoc2l6ZSwgZG9Ob3RPdmVycmlkZUlmQWxyZWFkeVNldCkge1xyXG4gICAgICAgIHRoaXMudmlld0ZhY3Rvcnkuc2V0Q2FjaGVTaXplKHNpemUsIGRvTm90T3ZlcnJpZGVJZkFscmVhZHlTZXQpO1xyXG4gICAgfTtcclxuICAgIFByb3h5Vmlld0ZhY3RvcnkucHJvdG90eXBlLmdldENhY2hlZFZpZXcgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld0ZhY3RvcnkuZ2V0Q2FjaGVkVmlldygpO1xyXG4gICAgfTtcclxuICAgIFByb3h5Vmlld0ZhY3RvcnkucHJvdG90eXBlLnJldHVyblZpZXdUb0NhY2hlID0gZnVuY3Rpb24gKHZpZXcpIHtcclxuICAgICAgICB0aGlzLnZpZXdGYWN0b3J5LnJldHVyblZpZXdUb0NhY2hlKHZpZXcpO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBQcm94eVZpZXdGYWN0b3J5O1xyXG59KCkpO1xyXG52YXIgYXVTbG90QmVoYXZpb3IgPSBudWxsO1xyXG52YXIgVmlld0VuZ2luZSA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBWaWV3RW5naW5lKGxvYWRlciwgY29udGFpbmVyLCB2aWV3Q29tcGlsZXIsIG1vZHVsZUFuYWx5emVyLCBhcHBSZXNvdXJjZXMpIHtcclxuICAgICAgICB0aGlzLmxvYWRlciA9IGxvYWRlcjtcclxuICAgICAgICB0aGlzLmNvbnRhaW5lciA9IGNvbnRhaW5lcjtcclxuICAgICAgICB0aGlzLnZpZXdDb21waWxlciA9IHZpZXdDb21waWxlcjtcclxuICAgICAgICB0aGlzLm1vZHVsZUFuYWx5emVyID0gbW9kdWxlQW5hbHl6ZXI7XHJcbiAgICAgICAgdGhpcy5hcHBSZXNvdXJjZXMgPSBhcHBSZXNvdXJjZXM7XHJcbiAgICAgICAgdGhpcy5fcGx1Z2luTWFwID0ge307XHJcbiAgICAgICAgaWYgKGF1U2xvdEJlaGF2aW9yID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgIGF1U2xvdEJlaGF2aW9yID0gbmV3IEh0bWxCZWhhdmlvclJlc291cmNlKCk7XHJcbiAgICAgICAgICAgIGF1U2xvdEJlaGF2aW9yLmF0dHJpYnV0ZU5hbWUgPSAnYXUtc2xvdCc7XHJcbiAgICAgICAgICAgIG1ldGFkYXRhLmRlZmluZShtZXRhZGF0YS5yZXNvdXJjZSwgYXVTbG90QmVoYXZpb3IsIFNsb3RDdXN0b21BdHRyaWJ1dGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBhdVNsb3RCZWhhdmlvci5pbml0aWFsaXplKGNvbnRhaW5lciwgU2xvdEN1c3RvbUF0dHJpYnV0ZSk7XHJcbiAgICAgICAgYXVTbG90QmVoYXZpb3IucmVnaXN0ZXIoYXBwUmVzb3VyY2VzKTtcclxuICAgIH1cclxuICAgIFZpZXdFbmdpbmUuaW5qZWN0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBbTG9hZGVyLCBDb250YWluZXIsIFZpZXdDb21waWxlciwgTW9kdWxlQW5hbHl6ZXIsIFZpZXdSZXNvdXJjZXNdO1xyXG4gICAgfTtcclxuICAgIFZpZXdFbmdpbmUucHJvdG90eXBlLmFkZFJlc291cmNlUGx1Z2luID0gZnVuY3Rpb24gKGV4dGVuc2lvbiwgaW1wbGVtZW50YXRpb24pIHtcclxuICAgICAgICB2YXIgbmFtZSA9IGV4dGVuc2lvbi5yZXBsYWNlKCcuJywgJycpICsgJy1yZXNvdXJjZS1wbHVnaW4nO1xyXG4gICAgICAgIHRoaXMuX3BsdWdpbk1hcFtleHRlbnNpb25dID0gbmFtZTtcclxuICAgICAgICB0aGlzLmxvYWRlci5hZGRQbHVnaW4obmFtZSwgaW1wbGVtZW50YXRpb24pO1xyXG4gICAgfTtcclxuICAgIFZpZXdFbmdpbmUucHJvdG90eXBlLmxvYWRWaWV3RmFjdG9yeSA9IGZ1bmN0aW9uICh1cmxPclJlZ2lzdHJ5RW50cnksIGNvbXBpbGVJbnN0cnVjdGlvbiwgbG9hZENvbnRleHQsIHRhcmdldCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgbG9hZENvbnRleHQgPSBsb2FkQ29udGV4dCB8fCBuZXcgUmVzb3VyY2VMb2FkQ29udGV4dCgpO1xyXG4gICAgICAgIHJldHVybiBlbnN1cmVSZWdpc3RyeUVudHJ5KHRoaXMubG9hZGVyLCB1cmxPclJlZ2lzdHJ5RW50cnkpLnRoZW4oZnVuY3Rpb24gKHJlZ2lzdHJ5RW50cnkpIHtcclxuICAgICAgICAgICAgdmFyIHVybCA9IHJlZ2lzdHJ5RW50cnkuYWRkcmVzcztcclxuICAgICAgICAgICAgaWYgKHJlZ2lzdHJ5RW50cnkub25SZWFkeSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFsb2FkQ29udGV4dC5oYXNEZXBlbmRlbmN5KHVybCkpIHtcclxuICAgICAgICAgICAgICAgICAgICBsb2FkQ29udGV4dC5hZGREZXBlbmRlbmN5KHVybCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlZ2lzdHJ5RW50cnkub25SZWFkeTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChyZWdpc3RyeUVudHJ5LnRlbXBsYXRlID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlZ2lzdHJ5RW50cnkub25SZWFkeTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUobmV3IFByb3h5Vmlld0ZhY3RvcnkocmVnaXN0cnlFbnRyeS5vblJlYWR5KSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgbG9hZENvbnRleHQuYWRkRGVwZW5kZW5jeSh1cmwpO1xyXG4gICAgICAgICAgICByZWdpc3RyeUVudHJ5Lm9uUmVhZHkgPSBfdGhpcy5sb2FkVGVtcGxhdGVSZXNvdXJjZXMocmVnaXN0cnlFbnRyeSwgY29tcGlsZUluc3RydWN0aW9uLCBsb2FkQ29udGV4dCwgdGFyZ2V0KS50aGVuKGZ1bmN0aW9uIChyZXNvdXJjZXMpIHtcclxuICAgICAgICAgICAgICAgIHJlZ2lzdHJ5RW50cnkucmVzb3VyY2VzID0gcmVzb3VyY2VzO1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlZ2lzdHJ5RW50cnkudGVtcGxhdGUgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVnaXN0cnlFbnRyeS5mYWN0b3J5ID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHZhciB2aWV3RmFjdG9yeSA9IF90aGlzLnZpZXdDb21waWxlci5jb21waWxlKHJlZ2lzdHJ5RW50cnkudGVtcGxhdGUsIHJlc291cmNlcywgY29tcGlsZUluc3RydWN0aW9uKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZWdpc3RyeUVudHJ5LmZhY3RvcnkgPSB2aWV3RmFjdG9yeTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHJldHVybiByZWdpc3RyeUVudHJ5Lm9uUmVhZHk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgVmlld0VuZ2luZS5wcm90b3R5cGUubG9hZFRlbXBsYXRlUmVzb3VyY2VzID0gZnVuY3Rpb24gKHJlZ2lzdHJ5RW50cnksIGNvbXBpbGVJbnN0cnVjdGlvbiwgbG9hZENvbnRleHQsIHRhcmdldCkge1xyXG4gICAgICAgIHZhciByZXNvdXJjZXMgPSBuZXcgVmlld1Jlc291cmNlcyh0aGlzLmFwcFJlc291cmNlcywgcmVnaXN0cnlFbnRyeS5hZGRyZXNzKTtcclxuICAgICAgICB2YXIgZGVwZW5kZW5jaWVzID0gcmVnaXN0cnlFbnRyeS5kZXBlbmRlbmNpZXM7XHJcbiAgICAgICAgdmFyIGltcG9ydElkcztcclxuICAgICAgICB2YXIgbmFtZXM7XHJcbiAgICAgICAgY29tcGlsZUluc3RydWN0aW9uID0gY29tcGlsZUluc3RydWN0aW9uIHx8IFZpZXdDb21waWxlSW5zdHJ1Y3Rpb24ubm9ybWFsO1xyXG4gICAgICAgIGlmIChkZXBlbmRlbmNpZXMubGVuZ3RoID09PSAwICYmICFjb21waWxlSW5zdHJ1Y3Rpb24uYXNzb2NpYXRlZE1vZHVsZUlkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUocmVzb3VyY2VzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaW1wb3J0SWRzID0gZGVwZW5kZW5jaWVzLm1hcChmdW5jdGlvbiAoeCkgeyByZXR1cm4geC5zcmM7IH0pO1xyXG4gICAgICAgIG5hbWVzID0gZGVwZW5kZW5jaWVzLm1hcChmdW5jdGlvbiAoeCkgeyByZXR1cm4geC5uYW1lOyB9KTtcclxuICAgICAgICBsb2dnZXIuZGVidWcoXCJpbXBvcnRpbmcgcmVzb3VyY2VzIGZvciBcIi5jb25jYXQocmVnaXN0cnlFbnRyeS5hZGRyZXNzKSwgaW1wb3J0SWRzKTtcclxuICAgICAgICBpZiAodGFyZ2V0KSB7XHJcbiAgICAgICAgICAgIHZhciB2aWV3TW9kZWxSZXF1aXJlcyA9IG1ldGFkYXRhLmdldChWaWV3RW5naW5lLnZpZXdNb2RlbFJlcXVpcmVNZXRhZGF0YUtleSwgdGFyZ2V0KTtcclxuICAgICAgICAgICAgaWYgKHZpZXdNb2RlbFJlcXVpcmVzKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdGVtcGxhdGVJbXBvcnRDb3VudCA9IGltcG9ydElkcy5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSB2aWV3TW9kZWxSZXF1aXJlcy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJlcSA9IHZpZXdNb2RlbFJlcXVpcmVzW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpbXBvcnRJZCA9IHR5cGVvZiByZXEgPT09ICdmdW5jdGlvbidcclxuICAgICAgICAgICAgICAgICAgICAgICAgPyBPcmlnaW4uZ2V0KHJlcSkubW9kdWxlSWRcclxuICAgICAgICAgICAgICAgICAgICAgICAgOiByZWxhdGl2ZVRvRmlsZShyZXEuc3JjIHx8IHJlcSwgcmVnaXN0cnlFbnRyeS5hZGRyZXNzKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaW1wb3J0SWRzLmluZGV4T2YoaW1wb3J0SWQpID09PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbXBvcnRJZHMucHVzaChpbXBvcnRJZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWVzLnB1c2gocmVxLmFzKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoXCJpbXBvcnRpbmcgVmlld01vZGVsIHJlc291cmNlcyBmb3IgXCIuY29uY2F0KGNvbXBpbGVJbnN0cnVjdGlvbi5hc3NvY2lhdGVkTW9kdWxlSWQpLCBpbXBvcnRJZHMuc2xpY2UodGVtcGxhdGVJbXBvcnRDb3VudCkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLmltcG9ydFZpZXdSZXNvdXJjZXMoaW1wb3J0SWRzLCBuYW1lcywgcmVzb3VyY2VzLCBjb21waWxlSW5zdHJ1Y3Rpb24sIGxvYWRDb250ZXh0KTtcclxuICAgIH07XHJcbiAgICBWaWV3RW5naW5lLnByb3RvdHlwZS5pbXBvcnRWaWV3TW9kZWxSZXNvdXJjZSA9IGZ1bmN0aW9uIChtb2R1bGVJbXBvcnQsIG1vZHVsZU1lbWJlcikge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMubG9hZGVyLmxvYWRNb2R1bGUobW9kdWxlSW1wb3J0KS50aGVuKGZ1bmN0aW9uICh2aWV3TW9kZWxNb2R1bGUpIHtcclxuICAgICAgICAgICAgdmFyIG5vcm1hbGl6ZWRJZCA9IE9yaWdpbi5nZXQodmlld01vZGVsTW9kdWxlKS5tb2R1bGVJZDtcclxuICAgICAgICAgICAgdmFyIHJlc291cmNlTW9kdWxlID0gX3RoaXMubW9kdWxlQW5hbHl6ZXIuYW5hbHl6ZShub3JtYWxpemVkSWQsIHZpZXdNb2RlbE1vZHVsZSwgbW9kdWxlTWVtYmVyKTtcclxuICAgICAgICAgICAgaWYgKCFyZXNvdXJjZU1vZHVsZS5tYWluUmVzb3VyY2UpIHtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIk5vIHZpZXcgbW9kZWwgZm91bmQgaW4gbW9kdWxlIFxcXCJcIi5jb25jYXQobW9kdWxlSW1wb3J0LCBcIlxcXCIuXCIpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXNvdXJjZU1vZHVsZS5pbml0aWFsaXplKF90aGlzLmNvbnRhaW5lcik7XHJcbiAgICAgICAgICAgIHJldHVybiByZXNvdXJjZU1vZHVsZS5tYWluUmVzb3VyY2U7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgVmlld0VuZ2luZS5wcm90b3R5cGUuaW1wb3J0Vmlld1Jlc291cmNlcyA9IGZ1bmN0aW9uIChtb2R1bGVJZHMsIG5hbWVzLCByZXNvdXJjZXMsIGNvbXBpbGVJbnN0cnVjdGlvbiwgbG9hZENvbnRleHQpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIGxvYWRDb250ZXh0ID0gbG9hZENvbnRleHQgfHwgbmV3IFJlc291cmNlTG9hZENvbnRleHQoKTtcclxuICAgICAgICBjb21waWxlSW5zdHJ1Y3Rpb24gPSBjb21waWxlSW5zdHJ1Y3Rpb24gfHwgVmlld0NvbXBpbGVJbnN0cnVjdGlvbi5ub3JtYWw7XHJcbiAgICAgICAgbW9kdWxlSWRzID0gbW9kdWxlSWRzLm1hcChmdW5jdGlvbiAoeCkgeyByZXR1cm4gX3RoaXMuX2FwcGx5TG9hZGVyUGx1Z2luKHgpOyB9KTtcclxuICAgICAgICByZXR1cm4gdGhpcy5sb2FkZXIubG9hZEFsbE1vZHVsZXMobW9kdWxlSWRzKS50aGVuKGZ1bmN0aW9uIChpbXBvcnRzKSB7XHJcbiAgICAgICAgICAgIHZhciBpO1xyXG4gICAgICAgICAgICB2YXIgaWk7XHJcbiAgICAgICAgICAgIHZhciBhbmFseXNpcztcclxuICAgICAgICAgICAgdmFyIG5vcm1hbGl6ZWRJZDtcclxuICAgICAgICAgICAgdmFyIGN1cnJlbnQ7XHJcbiAgICAgICAgICAgIHZhciBhc3NvY2lhdGVkTW9kdWxlO1xyXG4gICAgICAgICAgICB2YXIgY29udGFpbmVyID0gX3RoaXMuY29udGFpbmVyO1xyXG4gICAgICAgICAgICB2YXIgbW9kdWxlQW5hbHl6ZXIgPSBfdGhpcy5tb2R1bGVBbmFseXplcjtcclxuICAgICAgICAgICAgdmFyIGFsbEFuYWx5c2lzID0gbmV3IEFycmF5KGltcG9ydHMubGVuZ3RoKTtcclxuICAgICAgICAgICAgZm9yIChpID0gMCwgaWkgPSBpbXBvcnRzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgICAgIGN1cnJlbnQgPSBpbXBvcnRzW2ldO1xyXG4gICAgICAgICAgICAgICAgbm9ybWFsaXplZElkID0gT3JpZ2luLmdldChjdXJyZW50KS5tb2R1bGVJZDtcclxuICAgICAgICAgICAgICAgIGFuYWx5c2lzID0gbW9kdWxlQW5hbHl6ZXIuYW5hbHl6ZShub3JtYWxpemVkSWQsIGN1cnJlbnQpO1xyXG4gICAgICAgICAgICAgICAgYW5hbHlzaXMuaW5pdGlhbGl6ZShjb250YWluZXIpO1xyXG4gICAgICAgICAgICAgICAgYW5hbHlzaXMucmVnaXN0ZXIocmVzb3VyY2VzLCBuYW1lc1tpXSk7XHJcbiAgICAgICAgICAgICAgICBhbGxBbmFseXNpc1tpXSA9IGFuYWx5c2lzO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChjb21waWxlSW5zdHJ1Y3Rpb24uYXNzb2NpYXRlZE1vZHVsZUlkKSB7XHJcbiAgICAgICAgICAgICAgICBhc3NvY2lhdGVkTW9kdWxlID0gbW9kdWxlQW5hbHl6ZXIuZ2V0QW5hbHlzaXMoY29tcGlsZUluc3RydWN0aW9uLmFzc29jaWF0ZWRNb2R1bGVJZCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoYXNzb2NpYXRlZE1vZHVsZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGFzc29jaWF0ZWRNb2R1bGUucmVnaXN0ZXIocmVzb3VyY2VzKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IGFsbEFuYWx5c2lzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgICAgIGFsbEFuYWx5c2lzW2ldID0gYWxsQW5hbHlzaXNbaV0ubG9hZChjb250YWluZXIsIGxvYWRDb250ZXh0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwoYWxsQW5hbHlzaXMpLnRoZW4oZnVuY3Rpb24gKCkgeyByZXR1cm4gcmVzb3VyY2VzOyB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICBWaWV3RW5naW5lLnByb3RvdHlwZS5fYXBwbHlMb2FkZXJQbHVnaW4gPSBmdW5jdGlvbiAoaWQpIHtcclxuICAgICAgICB2YXIgaW5kZXggPSBpZC5sYXN0SW5kZXhPZignLicpO1xyXG4gICAgICAgIGlmIChpbmRleCAhPT0gLTEpIHtcclxuICAgICAgICAgICAgdmFyIGV4dCA9IGlkLnN1YnN0cmluZyhpbmRleCk7XHJcbiAgICAgICAgICAgIHZhciBwbHVnaW5OYW1lID0gdGhpcy5fcGx1Z2luTWFwW2V4dF07XHJcbiAgICAgICAgICAgIGlmIChwbHVnaW5OYW1lID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBpZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5sb2FkZXIuYXBwbHlQbHVnaW5Ub1VybChpZCwgcGx1Z2luTmFtZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBpZDtcclxuICAgIH07XHJcbiAgICBWaWV3RW5naW5lLnZpZXdNb2RlbFJlcXVpcmVNZXRhZGF0YUtleSA9ICdhdXJlbGlhOnZpZXctbW9kZWwtcmVxdWlyZSc7XHJcbiAgICByZXR1cm4gVmlld0VuZ2luZTtcclxufSgpKTtcblxudmFyIENvbnRyb2xsZXIgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gQ29udHJvbGxlcihiZWhhdmlvciwgaW5zdHJ1Y3Rpb24sIHZpZXdNb2RlbCwgY29udGFpbmVyKSB7XHJcbiAgICAgICAgdGhpcy5iZWhhdmlvciA9IGJlaGF2aW9yO1xyXG4gICAgICAgIHRoaXMuaW5zdHJ1Y3Rpb24gPSBpbnN0cnVjdGlvbjtcclxuICAgICAgICB0aGlzLnZpZXdNb2RlbCA9IHZpZXdNb2RlbDtcclxuICAgICAgICB0aGlzLmlzQXR0YWNoZWQgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLnZpZXcgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuaXNCb3VuZCA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuc2NvcGUgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuY29udGFpbmVyID0gY29udGFpbmVyO1xyXG4gICAgICAgIHRoaXMuZWxlbWVudEV2ZW50cyA9IGNvbnRhaW5lci5lbGVtZW50RXZlbnRzIHx8IG51bGw7XHJcbiAgICAgICAgdmFyIG9ic2VydmVyTG9va3VwID0gYmVoYXZpb3Iub2JzZXJ2ZXJMb2NhdG9yLmdldE9yQ3JlYXRlT2JzZXJ2ZXJzTG9va3VwKHZpZXdNb2RlbCk7XHJcbiAgICAgICAgdmFyIGhhbmRsZXNCaW5kID0gYmVoYXZpb3IuaGFuZGxlc0JpbmQ7XHJcbiAgICAgICAgdmFyIGF0dHJpYnV0ZXMgPSBpbnN0cnVjdGlvbi5hdHRyaWJ1dGVzO1xyXG4gICAgICAgIHZhciBib3VuZFByb3BlcnRpZXMgPSB0aGlzLmJvdW5kUHJvcGVydGllcyA9IFtdO1xyXG4gICAgICAgIHZhciBwcm9wZXJ0aWVzID0gYmVoYXZpb3IucHJvcGVydGllcztcclxuICAgICAgICB2YXIgaTtcclxuICAgICAgICB2YXIgaWk7XHJcbiAgICAgICAgYmVoYXZpb3IuX2Vuc3VyZVByb3BlcnRpZXNEZWZpbmVkKHZpZXdNb2RlbCwgb2JzZXJ2ZXJMb29rdXApO1xyXG4gICAgICAgIGZvciAoaSA9IDAsIGlpID0gcHJvcGVydGllcy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgIHByb3BlcnRpZXNbaV0uX2luaXRpYWxpemUodmlld01vZGVsLCBvYnNlcnZlckxvb2t1cCwgYXR0cmlidXRlcywgaGFuZGxlc0JpbmQsIGJvdW5kUHJvcGVydGllcyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgQ29udHJvbGxlci5wcm90b3R5cGUuY3JlYXRlZCA9IGZ1bmN0aW9uIChvd25pbmdWaWV3KSB7XHJcbiAgICAgICAgaWYgKHRoaXMuYmVoYXZpb3IuaGFuZGxlc0NyZWF0ZWQpIHtcclxuICAgICAgICAgICAgdGhpcy52aWV3TW9kZWwuY3JlYXRlZChvd25pbmdWaWV3LCB0aGlzLnZpZXcpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBDb250cm9sbGVyLnByb3RvdHlwZS5hdXRvbWF0ZSA9IGZ1bmN0aW9uIChvdmVycmlkZUNvbnRleHQsIG93bmluZ1ZpZXcpIHtcclxuICAgICAgICB0aGlzLnZpZXcuYmluZGluZ0NvbnRleHQgPSB0aGlzLnZpZXdNb2RlbDtcclxuICAgICAgICB0aGlzLnZpZXcub3ZlcnJpZGVDb250ZXh0ID0gb3ZlcnJpZGVDb250ZXh0IHx8IGNyZWF0ZU92ZXJyaWRlQ29udGV4dCh0aGlzLnZpZXdNb2RlbCk7XHJcbiAgICAgICAgdGhpcy52aWV3Ll9pc1VzZXJDb250cm9sbGVkID0gdHJ1ZTtcclxuICAgICAgICBpZiAodGhpcy5iZWhhdmlvci5oYW5kbGVzQ3JlYXRlZCkge1xyXG4gICAgICAgICAgICB0aGlzLnZpZXdNb2RlbC5jcmVhdGVkKG93bmluZ1ZpZXcgfHwgbnVsbCwgdGhpcy52aWV3KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5iaW5kKHRoaXMudmlldyk7XHJcbiAgICB9O1xyXG4gICAgQ29udHJvbGxlci5wcm90b3R5cGUuYmluZCA9IGZ1bmN0aW9uIChzY29wZSkge1xyXG4gICAgICAgIHZhciBza2lwU2VsZlN1YnNjcmliZXIgPSB0aGlzLmJlaGF2aW9yLmhhbmRsZXNCaW5kO1xyXG4gICAgICAgIHZhciBib3VuZFByb3BlcnRpZXMgPSB0aGlzLmJvdW5kUHJvcGVydGllcztcclxuICAgICAgICB2YXIgaTtcclxuICAgICAgICB2YXIgaWk7XHJcbiAgICAgICAgdmFyIHg7XHJcbiAgICAgICAgdmFyIG9ic2VydmVyO1xyXG4gICAgICAgIHZhciBzZWxmU3Vic2NyaWJlcjtcclxuICAgICAgICBpZiAodGhpcy5pc0JvdW5kKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnNjb3BlID09PSBzY29wZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMudW5iaW5kKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaXNCb3VuZCA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5zY29wZSA9IHNjb3BlO1xyXG4gICAgICAgIGZvciAoaSA9IDAsIGlpID0gYm91bmRQcm9wZXJ0aWVzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgeCA9IGJvdW5kUHJvcGVydGllc1tpXTtcclxuICAgICAgICAgICAgb2JzZXJ2ZXIgPSB4Lm9ic2VydmVyO1xyXG4gICAgICAgICAgICBzZWxmU3Vic2NyaWJlciA9IG9ic2VydmVyLnNlbGZTdWJzY3JpYmVyO1xyXG4gICAgICAgICAgICBvYnNlcnZlci5wdWJsaXNoaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGlmIChza2lwU2VsZlN1YnNjcmliZXIpIHtcclxuICAgICAgICAgICAgICAgIG9ic2VydmVyLnNlbGZTdWJzY3JpYmVyID0gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB4LmJpbmRpbmcuYmluZChzY29wZSk7XHJcbiAgICAgICAgICAgIG9ic2VydmVyLmNhbGwoKTtcclxuICAgICAgICAgICAgb2JzZXJ2ZXIucHVibGlzaGluZyA9IHRydWU7XHJcbiAgICAgICAgICAgIG9ic2VydmVyLnNlbGZTdWJzY3JpYmVyID0gc2VsZlN1YnNjcmliZXI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBvdmVycmlkZUNvbnRleHQ7XHJcbiAgICAgICAgaWYgKHRoaXMudmlldyAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICBpZiAoc2tpcFNlbGZTdWJzY3JpYmVyKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnZpZXcudmlld01vZGVsU2NvcGUgPSBzY29wZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGhpcy52aWV3TW9kZWwgPT09IHNjb3BlLm92ZXJyaWRlQ29udGV4dC5iaW5kaW5nQ29udGV4dCkge1xyXG4gICAgICAgICAgICAgICAgb3ZlcnJpZGVDb250ZXh0ID0gc2NvcGUub3ZlcnJpZGVDb250ZXh0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuaW5zdHJ1Y3Rpb24uaW5oZXJpdEJpbmRpbmdDb250ZXh0KSB7XHJcbiAgICAgICAgICAgICAgICBvdmVycmlkZUNvbnRleHQgPSBjcmVhdGVPdmVycmlkZUNvbnRleHQodGhpcy52aWV3TW9kZWwsIHNjb3BlLm92ZXJyaWRlQ29udGV4dCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBvdmVycmlkZUNvbnRleHQgPSBjcmVhdGVPdmVycmlkZUNvbnRleHQodGhpcy52aWV3TW9kZWwpO1xyXG4gICAgICAgICAgICAgICAgb3ZlcnJpZGVDb250ZXh0Ll9fcGFyZW50T3ZlcnJpZGVDb250ZXh0ID0gc2NvcGUub3ZlcnJpZGVDb250ZXh0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMudmlldy5iaW5kKHRoaXMudmlld01vZGVsLCBvdmVycmlkZUNvbnRleHQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChza2lwU2VsZlN1YnNjcmliZXIpIHtcclxuICAgICAgICAgICAgb3ZlcnJpZGVDb250ZXh0ID0gc2NvcGUub3ZlcnJpZGVDb250ZXh0O1xyXG4gICAgICAgICAgICBpZiAoc2NvcGUub3ZlcnJpZGVDb250ZXh0Ll9fcGFyZW50T3ZlcnJpZGVDb250ZXh0ICE9PSB1bmRlZmluZWRcclxuICAgICAgICAgICAgICAgICYmIHRoaXMudmlld01vZGVsLnZpZXdGYWN0b3J5ICYmIHRoaXMudmlld01vZGVsLnZpZXdGYWN0b3J5LmZhY3RvcnlDcmVhdGVJbnN0cnVjdGlvbi5wYXJ0UmVwbGFjZW1lbnRzKSB7XHJcbiAgICAgICAgICAgICAgICBvdmVycmlkZUNvbnRleHQgPSBPYmplY3QuYXNzaWduKHt9LCBzY29wZS5vdmVycmlkZUNvbnRleHQpO1xyXG4gICAgICAgICAgICAgICAgb3ZlcnJpZGVDb250ZXh0LnBhcmVudE92ZXJyaWRlQ29udGV4dCA9IHNjb3BlLm92ZXJyaWRlQ29udGV4dC5fX3BhcmVudE92ZXJyaWRlQ29udGV4dDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLnZpZXdNb2RlbC5iaW5kKHNjb3BlLmJpbmRpbmdDb250ZXh0LCBvdmVycmlkZUNvbnRleHQpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBDb250cm9sbGVyLnByb3RvdHlwZS51bmJpbmQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNCb3VuZCkge1xyXG4gICAgICAgICAgICB2YXIgYm91bmRQcm9wZXJ0aWVzID0gdGhpcy5ib3VuZFByb3BlcnRpZXM7XHJcbiAgICAgICAgICAgIHZhciBpID0gdm9pZCAwO1xyXG4gICAgICAgICAgICB2YXIgaWkgPSB2b2lkIDA7XHJcbiAgICAgICAgICAgIHRoaXMuaXNCb3VuZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB0aGlzLnNjb3BlID0gbnVsbDtcclxuICAgICAgICAgICAgaWYgKHRoaXMudmlldyAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy52aWV3LnVuYmluZCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmJlaGF2aW9yLmhhbmRsZXNVbmJpbmQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudmlld01vZGVsLnVuYmluZCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmVsZW1lbnRFdmVudHMgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudEV2ZW50cy5kaXNwb3NlQWxsKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZm9yIChpID0gMCwgaWkgPSBib3VuZFByb3BlcnRpZXMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICAgICAgYm91bmRQcm9wZXJ0aWVzW2ldLmJpbmRpbmcudW5iaW5kKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgQ29udHJvbGxlci5wcm90b3R5cGUuYXR0YWNoZWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNBdHRhY2hlZCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaXNBdHRhY2hlZCA9IHRydWU7XHJcbiAgICAgICAgaWYgKHRoaXMuYmVoYXZpb3IuaGFuZGxlc0F0dGFjaGVkKSB7XHJcbiAgICAgICAgICAgIHRoaXMudmlld01vZGVsLmF0dGFjaGVkKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLnZpZXcgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgdGhpcy52aWV3LmF0dGFjaGVkKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIENvbnRyb2xsZXIucHJvdG90eXBlLmRldGFjaGVkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmlzQXR0YWNoZWQpIHtcclxuICAgICAgICAgICAgdGhpcy5pc0F0dGFjaGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnZpZXcgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudmlldy5kZXRhY2hlZCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmJlaGF2aW9yLmhhbmRsZXNEZXRhY2hlZCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy52aWV3TW9kZWwuZGV0YWNoZWQoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICByZXR1cm4gQ29udHJvbGxlcjtcclxufSgpKTtcblxudmFyIGxhc3RQcm92aWRlcklkID0gMDtcclxuZnVuY3Rpb24gbmV4dFByb3ZpZGVySWQoKSB7XHJcbiAgICByZXR1cm4gKytsYXN0UHJvdmlkZXJJZDtcclxufVxyXG5mdW5jdGlvbiBkb1Byb2Nlc3NDb250ZW50KCkgeyByZXR1cm4gdHJ1ZTsgfVxyXG5mdW5jdGlvbiBkb1Byb2Nlc3NBdHRyaWJ1dGVzKCkgeyB9XHJcbnZhciBIdG1sQmVoYXZpb3JSZXNvdXJjZSA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBIdG1sQmVoYXZpb3JSZXNvdXJjZSgpIHtcclxuICAgICAgICB0aGlzLmVsZW1lbnROYW1lID0gbnVsbDtcclxuICAgICAgICB0aGlzLmF0dHJpYnV0ZU5hbWUgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuYXR0cmlidXRlRGVmYXVsdEJpbmRpbmdNb2RlID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIHRoaXMubGlmdHNDb250ZW50ID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy50YXJnZXRTaGFkb3dET00gPSBmYWxzZTtcclxuICAgICAgICB0aGlzLnNoYWRvd0RPTU9wdGlvbnMgPSBudWxsO1xyXG4gICAgICAgIHRoaXMucHJvY2Vzc0F0dHJpYnV0ZXMgPSBkb1Byb2Nlc3NBdHRyaWJ1dGVzO1xyXG4gICAgICAgIHRoaXMucHJvY2Vzc0NvbnRlbnQgPSBkb1Byb2Nlc3NDb250ZW50O1xyXG4gICAgICAgIHRoaXMudXNlc1NoYWRvd0RPTSA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuY2hpbGRCaW5kaW5ncyA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5oYXNEeW5hbWljT3B0aW9ucyA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuY29udGFpbmVybGVzcyA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMucHJvcGVydGllcyA9IFtdO1xyXG4gICAgICAgIHRoaXMuYXR0cmlidXRlcyA9IHt9O1xyXG4gICAgICAgIHRoaXMuaXNJbml0aWFsaXplZCA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMucHJpbWFyeVByb3BlcnR5ID0gbnVsbDtcclxuICAgIH1cclxuICAgIEh0bWxCZWhhdmlvclJlc291cmNlLmNvbnZlbnRpb24gPSBmdW5jdGlvbiAobmFtZSwgZXhpc3RpbmcpIHtcclxuICAgICAgICB2YXIgYmVoYXZpb3I7XHJcbiAgICAgICAgaWYgKG5hbWUuZW5kc1dpdGgoJ0N1c3RvbUF0dHJpYnV0ZScpKSB7XHJcbiAgICAgICAgICAgIGJlaGF2aW9yID0gZXhpc3RpbmcgfHwgbmV3IEh0bWxCZWhhdmlvclJlc291cmNlKCk7XHJcbiAgICAgICAgICAgIGJlaGF2aW9yLmF0dHJpYnV0ZU5hbWUgPSBfaHlwaGVuYXRlKG5hbWUuc3Vic3RyaW5nKDAsIG5hbWUubGVuZ3RoIC0gMTUpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKG5hbWUuZW5kc1dpdGgoJ0N1c3RvbUVsZW1lbnQnKSkge1xyXG4gICAgICAgICAgICBiZWhhdmlvciA9IGV4aXN0aW5nIHx8IG5ldyBIdG1sQmVoYXZpb3JSZXNvdXJjZSgpO1xyXG4gICAgICAgICAgICBiZWhhdmlvci5lbGVtZW50TmFtZSA9IF9oeXBoZW5hdGUobmFtZS5zdWJzdHJpbmcoMCwgbmFtZS5sZW5ndGggLSAxMykpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gYmVoYXZpb3I7XHJcbiAgICB9O1xyXG4gICAgSHRtbEJlaGF2aW9yUmVzb3VyY2UucHJvdG90eXBlLmFkZENoaWxkQmluZGluZyA9IGZ1bmN0aW9uIChiZWhhdmlvcikge1xyXG4gICAgICAgIGlmICh0aGlzLmNoaWxkQmluZGluZ3MgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgdGhpcy5jaGlsZEJpbmRpbmdzID0gW107XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuY2hpbGRCaW5kaW5ncy5wdXNoKGJlaGF2aW9yKTtcclxuICAgIH07XHJcbiAgICBIdG1sQmVoYXZpb3JSZXNvdXJjZS5wcm90b3R5cGUuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uIChjb250YWluZXIsIHRhcmdldCkge1xyXG4gICAgICAgIHZhciBwcm90byA9IHRhcmdldC5wcm90b3R5cGU7XHJcbiAgICAgICAgdmFyIHByb3BlcnRpZXMgPSB0aGlzLnByb3BlcnRpZXM7XHJcbiAgICAgICAgdmFyIGF0dHJpYnV0ZU5hbWUgPSB0aGlzLmF0dHJpYnV0ZU5hbWU7XHJcbiAgICAgICAgdmFyIGF0dHJpYnV0ZURlZmF1bHRCaW5kaW5nTW9kZSA9IHRoaXMuYXR0cmlidXRlRGVmYXVsdEJpbmRpbmdNb2RlO1xyXG4gICAgICAgIHZhciBpO1xyXG4gICAgICAgIHZhciBpaTtcclxuICAgICAgICB2YXIgY3VycmVudDtcclxuICAgICAgICBpZiAodGhpcy5pc0luaXRpYWxpemVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5pc0luaXRpYWxpemVkID0gdHJ1ZTtcclxuICAgICAgICB0YXJnZXQuX19wcm92aWRlcklkX18gPSBuZXh0UHJvdmlkZXJJZCgpO1xyXG4gICAgICAgIHRoaXMub2JzZXJ2ZXJMb2NhdG9yID0gY29udGFpbmVyLmdldChPYnNlcnZlckxvY2F0b3IpO1xyXG4gICAgICAgIHRoaXMudGFza1F1ZXVlID0gY29udGFpbmVyLmdldChUYXNrUXVldWUpO1xyXG4gICAgICAgIHRoaXMudGFyZ2V0ID0gdGFyZ2V0O1xyXG4gICAgICAgIHRoaXMudXNlc1NoYWRvd0RPTSA9IHRoaXMudGFyZ2V0U2hhZG93RE9NICYmIEZFQVRVUkUuc2hhZG93RE9NO1xyXG4gICAgICAgIHRoaXMuaGFuZGxlc0NyZWF0ZWQgPSAoJ2NyZWF0ZWQnIGluIHByb3RvKTtcclxuICAgICAgICB0aGlzLmhhbmRsZXNCaW5kID0gKCdiaW5kJyBpbiBwcm90byk7XHJcbiAgICAgICAgdGhpcy5oYW5kbGVzVW5iaW5kID0gKCd1bmJpbmQnIGluIHByb3RvKTtcclxuICAgICAgICB0aGlzLmhhbmRsZXNBdHRhY2hlZCA9ICgnYXR0YWNoZWQnIGluIHByb3RvKTtcclxuICAgICAgICB0aGlzLmhhbmRsZXNEZXRhY2hlZCA9ICgnZGV0YWNoZWQnIGluIHByb3RvKTtcclxuICAgICAgICB0aGlzLmh0bWxOYW1lID0gdGhpcy5lbGVtZW50TmFtZSB8fCB0aGlzLmF0dHJpYnV0ZU5hbWU7XHJcbiAgICAgICAgaWYgKGF0dHJpYnV0ZU5hbWUgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgaWYgKHByb3BlcnRpZXMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICBuZXcgQmluZGFibGVQcm9wZXJ0eSh7XHJcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogJ3ZhbHVlJyxcclxuICAgICAgICAgICAgICAgICAgICBjaGFuZ2VIYW5kbGVyOiAndmFsdWVDaGFuZ2VkJyBpbiBwcm90byA/ICd2YWx1ZUNoYW5nZWQnIDogbnVsbCxcclxuICAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGU6IGF0dHJpYnV0ZU5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdEJpbmRpbmdNb2RlOiBhdHRyaWJ1dGVEZWZhdWx0QmluZGluZ01vZGVcclxuICAgICAgICAgICAgICAgIH0pLnJlZ2lzdGVyV2l0aCh0YXJnZXQsIHRoaXMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGN1cnJlbnQgPSBwcm9wZXJ0aWVzWzBdO1xyXG4gICAgICAgICAgICBpZiAocHJvcGVydGllcy5sZW5ndGggPT09IDEgJiYgY3VycmVudC5uYW1lID09PSAndmFsdWUnKSB7XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50LmlzRHluYW1pYyA9IGN1cnJlbnQuaGFzT3B0aW9ucyA9IHRoaXMuaGFzRHluYW1pY09wdGlvbnM7XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50LmRlZmluZU9uKHRhcmdldCwgdGhpcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IHByb3BlcnRpZXMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXNbaV0uZGVmaW5lT24odGFyZ2V0LCB0aGlzKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocHJvcGVydGllc1tpXS5wcmltYXJ5UHJvcGVydHkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucHJpbWFyeVByb3BlcnR5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ09ubHkgb25lIGJpbmRhYmxlIHByb3BlcnR5IG9uIGEgY3VzdG9tIGVsZW1lbnQgY2FuIGJlIGRlZmluZWQgYXMgdGhlIGRlZmF1bHQnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnByaW1hcnlQcm9wZXJ0eSA9IHByb3BlcnRpZXNbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY3VycmVudCA9IG5ldyBCaW5kYWJsZVByb3BlcnR5KHtcclxuICAgICAgICAgICAgICAgICAgICBuYW1lOiAndmFsdWUnLFxyXG4gICAgICAgICAgICAgICAgICAgIGNoYW5nZUhhbmRsZXI6ICd2YWx1ZUNoYW5nZWQnIGluIHByb3RvID8gJ3ZhbHVlQ2hhbmdlZCcgOiBudWxsLFxyXG4gICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZTogYXR0cmlidXRlTmFtZSxcclxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0QmluZGluZ01vZGU6IGF0dHJpYnV0ZURlZmF1bHRCaW5kaW5nTW9kZVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50Lmhhc09wdGlvbnMgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgY3VycmVudC5yZWdpc3RlcldpdGgodGFyZ2V0LCB0aGlzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgZm9yIChpID0gMCwgaWkgPSBwcm9wZXJ0aWVzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgICAgIHByb3BlcnRpZXNbaV0uZGVmaW5lT24odGFyZ2V0LCB0aGlzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLl9jb3B5SW5oZXJpdGVkUHJvcGVydGllcyhjb250YWluZXIsIHRhcmdldCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIEh0bWxCZWhhdmlvclJlc291cmNlLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChyZWdpc3RyeSwgbmFtZSkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgaWYgKHRoaXMuYXR0cmlidXRlTmFtZSAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICByZWdpc3RyeS5yZWdpc3RlckF0dHJpYnV0ZShuYW1lIHx8IHRoaXMuYXR0cmlidXRlTmFtZSwgdGhpcywgdGhpcy5hdHRyaWJ1dGVOYW1lKTtcclxuICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodGhpcy5hbGlhc2VzKSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hbGlhc2VzXHJcbiAgICAgICAgICAgICAgICAgICAgLmZvckVhY2goZnVuY3Rpb24gKGFsaWFzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVnaXN0cnkucmVnaXN0ZXJBdHRyaWJ1dGUoYWxpYXMsIF90aGlzLCBfdGhpcy5hdHRyaWJ1dGVOYW1lKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmVsZW1lbnROYW1lICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHJlZ2lzdHJ5LnJlZ2lzdGVyRWxlbWVudChuYW1lIHx8IHRoaXMuZWxlbWVudE5hbWUsIHRoaXMpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBIdG1sQmVoYXZpb3JSZXNvdXJjZS5wcm90b3R5cGUuYWxpYXNlcyA9IGZ1bmN0aW9uIChhbGlhc2VzKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdNZXRob2Qgbm90IGltcGxlbWVudGVkLicpO1xyXG4gICAgfTtcclxuICAgIEh0bWxCZWhhdmlvclJlc291cmNlLnByb3RvdHlwZS5sb2FkID0gZnVuY3Rpb24gKGNvbnRhaW5lciwgdGFyZ2V0LCBsb2FkQ29udGV4dCwgdmlld1N0cmF0ZWd5LCB0cmFuc2llbnRWaWV3KSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICB2YXIgb3B0aW9ucztcclxuICAgICAgICBpZiAodGhpcy5lbGVtZW50TmFtZSAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICB2aWV3U3RyYXRlZ3kgPSBjb250YWluZXIuZ2V0KFZpZXdMb2NhdG9yKS5nZXRWaWV3U3RyYXRlZ3kodmlld1N0cmF0ZWd5IHx8IHRoaXMudmlld1N0cmF0ZWd5IHx8IHRhcmdldCk7XHJcbiAgICAgICAgICAgIG9wdGlvbnMgPSBuZXcgVmlld0NvbXBpbGVJbnN0cnVjdGlvbih0aGlzLnRhcmdldFNoYWRvd0RPTSwgdHJ1ZSk7XHJcbiAgICAgICAgICAgIGlmICghdmlld1N0cmF0ZWd5Lm1vZHVsZUlkKSB7XHJcbiAgICAgICAgICAgICAgICB2aWV3U3RyYXRlZ3kubW9kdWxlSWQgPSBPcmlnaW4uZ2V0KHRhcmdldCkubW9kdWxlSWQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHZpZXdTdHJhdGVneVxyXG4gICAgICAgICAgICAgICAgLmxvYWRWaWV3RmFjdG9yeShjb250YWluZXIuZ2V0KFZpZXdFbmdpbmUpLCBvcHRpb25zLCBsb2FkQ29udGV4dCwgdGFyZ2V0KVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHZpZXdGYWN0b3J5KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXRyYW5zaWVudFZpZXcgfHwgIV90aGlzLnZpZXdGYWN0b3J5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMudmlld0ZhY3RvcnkgPSB2aWV3RmFjdG9yeTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiB2aWV3RmFjdG9yeTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUodGhpcyk7XHJcbiAgICB9O1xyXG4gICAgSHRtbEJlaGF2aW9yUmVzb3VyY2UucHJvdG90eXBlLmNvbXBpbGUgPSBmdW5jdGlvbiAoY29tcGlsZXIsIHJlc291cmNlcywgbm9kZSwgaW5zdHJ1Y3Rpb24sIHBhcmVudE5vZGUpIHtcclxuICAgICAgICBpZiAodGhpcy5saWZ0c0NvbnRlbnQpIHtcclxuICAgICAgICAgICAgaWYgKCFpbnN0cnVjdGlvbi52aWV3RmFjdG9yeSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHRlbXBsYXRlID0gRE9NLmNyZWF0ZUVsZW1lbnQoJ3RlbXBsYXRlJyk7XHJcbiAgICAgICAgICAgICAgICB2YXIgZnJhZ21lbnQgPSBET00uY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGNhY2hlU2l6ZSA9IG5vZGUuZ2V0QXR0cmlidXRlKCd2aWV3LWNhY2hlJyk7XHJcbiAgICAgICAgICAgICAgICB2YXIgcGFydCA9IG5vZGUuZ2V0QXR0cmlidXRlKCdwYXJ0Jyk7XHJcbiAgICAgICAgICAgICAgICBub2RlLnJlbW92ZUF0dHJpYnV0ZShpbnN0cnVjdGlvbi5vcmlnaW5hbEF0dHJOYW1lKTtcclxuICAgICAgICAgICAgICAgIERPTS5yZXBsYWNlTm9kZSh0ZW1wbGF0ZSwgbm9kZSwgcGFyZW50Tm9kZSk7XHJcbiAgICAgICAgICAgICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZChub2RlKTtcclxuICAgICAgICAgICAgICAgIGluc3RydWN0aW9uLnZpZXdGYWN0b3J5ID0gY29tcGlsZXIuY29tcGlsZShmcmFnbWVudCwgcmVzb3VyY2VzKTtcclxuICAgICAgICAgICAgICAgIGlmIChwYXJ0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaW5zdHJ1Y3Rpb24udmlld0ZhY3RvcnkucGFydCA9IHBhcnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgbm9kZS5yZW1vdmVBdHRyaWJ1dGUoJ3BhcnQnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChjYWNoZVNpemUpIHtcclxuICAgICAgICAgICAgICAgICAgICBpbnN0cnVjdGlvbi52aWV3RmFjdG9yeS5zZXRDYWNoZVNpemUoY2FjaGVTaXplKTtcclxuICAgICAgICAgICAgICAgICAgICBub2RlLnJlbW92ZUF0dHJpYnV0ZSgndmlldy1jYWNoZScpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgbm9kZSA9IHRlbXBsYXRlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKHRoaXMuZWxlbWVudE5hbWUgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgdmFyIHBhcnRSZXBsYWNlbWVudHMgPSB7fTtcclxuICAgICAgICAgICAgaWYgKHRoaXMucHJvY2Vzc0NvbnRlbnQoY29tcGlsZXIsIHJlc291cmNlcywgbm9kZSwgaW5zdHJ1Y3Rpb24pICYmIG5vZGUuaGFzQ2hpbGROb2RlcygpKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgY3VycmVudENoaWxkID0gbm9kZS5maXJzdENoaWxkO1xyXG4gICAgICAgICAgICAgICAgdmFyIGNvbnRlbnRFbGVtZW50ID0gdGhpcy51c2VzU2hhZG93RE9NID8gbnVsbCA6IERPTS5jcmVhdGVFbGVtZW50KCdhdS1jb250ZW50Jyk7XHJcbiAgICAgICAgICAgICAgICB2YXIgbmV4dFNpYmxpbmcgPSB2b2lkIDA7XHJcbiAgICAgICAgICAgICAgICB2YXIgdG9SZXBsYWNlID0gdm9pZCAwO1xyXG4gICAgICAgICAgICAgICAgd2hpbGUgKGN1cnJlbnRDaGlsZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG5leHRTaWJsaW5nID0gY3VycmVudENoaWxkLm5leHRTaWJsaW5nO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50Q2hpbGQudGFnTmFtZSA9PT0gJ1RFTVBMQVRFJyAmJiAodG9SZXBsYWNlID0gY3VycmVudENoaWxkLmdldEF0dHJpYnV0ZSgncmVwbGFjZS1wYXJ0JykpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnRSZXBsYWNlbWVudHNbdG9SZXBsYWNlXSA9IGNvbXBpbGVyLmNvbXBpbGUoY3VycmVudENoaWxkLCByZXNvdXJjZXMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBET00ucmVtb3ZlTm9kZShjdXJyZW50Q2hpbGQsIHBhcmVudE5vZGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnN0cnVjdGlvbi5wYXJ0UmVwbGFjZW1lbnRzID0gcGFydFJlcGxhY2VtZW50cztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoY29udGVudEVsZW1lbnQgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRDaGlsZC5ub2RlVHlwZSA9PT0gMyAmJiBfaXNBbGxXaGl0ZXNwYWNlKGN1cnJlbnRDaGlsZCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIERPTS5yZW1vdmVOb2RlKGN1cnJlbnRDaGlsZCwgcGFyZW50Tm9kZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50RWxlbWVudC5hcHBlbmRDaGlsZChjdXJyZW50Q2hpbGQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRDaGlsZCA9IG5leHRTaWJsaW5nO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKGNvbnRlbnRFbGVtZW50ICE9PSBudWxsICYmIGNvbnRlbnRFbGVtZW50Lmhhc0NoaWxkTm9kZXMoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIG5vZGUuYXBwZW5kQ2hpbGQoY29udGVudEVsZW1lbnQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaW5zdHJ1Y3Rpb24uc2tpcENvbnRlbnRQcm9jZXNzaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpbnN0cnVjdGlvbi5za2lwQ29udGVudFByb2Nlc3NpbmcgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKCF0aGlzLnByb2Nlc3NDb250ZW50KGNvbXBpbGVyLCByZXNvdXJjZXMsIG5vZGUsIGluc3RydWN0aW9uKSkge1xyXG4gICAgICAgICAgICBpbnN0cnVjdGlvbi5za2lwQ29udGVudFByb2Nlc3NpbmcgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbm9kZTtcclxuICAgIH07XHJcbiAgICBIdG1sQmVoYXZpb3JSZXNvdXJjZS5wcm90b3R5cGUuY3JlYXRlID0gZnVuY3Rpb24gKGNvbnRhaW5lciwgaW5zdHJ1Y3Rpb24sIGVsZW1lbnQsIGJpbmRpbmdzKSB7XHJcbiAgICAgICAgdmFyIHZpZXdIb3N0O1xyXG4gICAgICAgIHZhciBhdSA9IG51bGw7XHJcbiAgICAgICAgaW5zdHJ1Y3Rpb24gPSBpbnN0cnVjdGlvbiB8fCBCZWhhdmlvckluc3RydWN0aW9uLm5vcm1hbDtcclxuICAgICAgICBlbGVtZW50ID0gZWxlbWVudCB8fCBudWxsO1xyXG4gICAgICAgIGJpbmRpbmdzID0gYmluZGluZ3MgfHwgbnVsbDtcclxuICAgICAgICBpZiAodGhpcy5lbGVtZW50TmFtZSAhPT0gbnVsbCAmJiBlbGVtZW50KSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnVzZXNTaGFkb3dET00pIHtcclxuICAgICAgICAgICAgICAgIHZpZXdIb3N0ID0gZWxlbWVudC5hdHRhY2hTaGFkb3codGhpcy5zaGFkb3dET01PcHRpb25zKTtcclxuICAgICAgICAgICAgICAgIGNvbnRhaW5lci5yZWdpc3Rlckluc3RhbmNlKERPTS5ib3VuZGFyeSwgdmlld0hvc3QpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdmlld0hvc3QgPSBlbGVtZW50O1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMudGFyZ2V0U2hhZG93RE9NKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyLnJlZ2lzdGVySW5zdGFuY2UoRE9NLmJvdW5kYXJ5LCB2aWV3SG9zdCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGVsZW1lbnQgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgZWxlbWVudC5hdSA9IGF1ID0gZWxlbWVudC5hdSB8fCB7fTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIHZpZXdNb2RlbCA9IGluc3RydWN0aW9uLnZpZXdNb2RlbCB8fCBjb250YWluZXIuZ2V0KHRoaXMudGFyZ2V0KTtcclxuICAgICAgICB2YXIgY29udHJvbGxlciA9IG5ldyBDb250cm9sbGVyKHRoaXMsIGluc3RydWN0aW9uLCB2aWV3TW9kZWwsIGNvbnRhaW5lcik7XHJcbiAgICAgICAgdmFyIGNoaWxkQmluZGluZ3MgPSB0aGlzLmNoaWxkQmluZGluZ3M7XHJcbiAgICAgICAgdmFyIHZpZXdGYWN0b3J5O1xyXG4gICAgICAgIGlmICh0aGlzLmxpZnRzQ29udGVudCkge1xyXG4gICAgICAgICAgICBhdS5jb250cm9sbGVyID0gY29udHJvbGxlcjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAodGhpcy5lbGVtZW50TmFtZSAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICB2aWV3RmFjdG9yeSA9IGluc3RydWN0aW9uLnZpZXdGYWN0b3J5IHx8IHRoaXMudmlld0ZhY3Rvcnk7XHJcbiAgICAgICAgICAgIGNvbnRhaW5lci52aWV3TW9kZWwgPSB2aWV3TW9kZWw7XHJcbiAgICAgICAgICAgIGlmICh2aWV3RmFjdG9yeSkge1xyXG4gICAgICAgICAgICAgICAgY29udHJvbGxlci52aWV3ID0gdmlld0ZhY3RvcnkuY3JlYXRlKGNvbnRhaW5lciwgaW5zdHJ1Y3Rpb24sIGVsZW1lbnQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChlbGVtZW50ICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICBhdS5jb250cm9sbGVyID0gY29udHJvbGxlcjtcclxuICAgICAgICAgICAgICAgIGlmIChjb250cm9sbGVyLnZpZXcpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMudXNlc1NoYWRvd0RPTSAmJiAoZWxlbWVudC5jaGlsZE5vZGVzLmxlbmd0aCA9PT0gMSB8fCBlbGVtZW50LmNvbnRlbnRFbGVtZW50KSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY29udGVudEVsZW1lbnQgPSBlbGVtZW50LmNoaWxkTm9kZXNbMF0gfHwgZWxlbWVudC5jb250ZW50RWxlbWVudDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlci52aWV3LmNvbnRlbnRWaWV3ID0geyBmcmFnbWVudDogY29udGVudEVsZW1lbnQgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudEVsZW1lbnQucGFyZW50Tm9kZSAmJiBET00ucmVtb3ZlTm9kZShjb250ZW50RWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpbnN0cnVjdGlvbi5hbmNob3JJc0NvbnRhaW5lcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2hpbGRCaW5kaW5ncyAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gY2hpbGRCaW5kaW5ncy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlci52aWV3LmFkZEJpbmRpbmcoY2hpbGRCaW5kaW5nc1tpXS5jcmVhdGUoZWxlbWVudCwgdmlld01vZGVsLCBjb250cm9sbGVyKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlci52aWV3LmFwcGVuZE5vZGVzVG8odmlld0hvc3QpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlci52aWV3Lmluc2VydE5vZGVzQmVmb3JlKHZpZXdIb3N0KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChjaGlsZEJpbmRpbmdzICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gY2hpbGRCaW5kaW5ncy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJpbmRpbmdzLnB1c2goY2hpbGRCaW5kaW5nc1tpXS5jcmVhdGUoZWxlbWVudCwgdmlld01vZGVsLCBjb250cm9sbGVyKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKGNvbnRyb2xsZXIudmlldykge1xyXG4gICAgICAgICAgICAgICAgY29udHJvbGxlci52aWV3LmNvbnRyb2xsZXIgPSBjb250cm9sbGVyO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNoaWxkQmluZGluZ3MgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBjaGlsZEJpbmRpbmdzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlci52aWV3LmFkZEJpbmRpbmcoY2hpbGRCaW5kaW5nc1tpXS5jcmVhdGUoaW5zdHJ1Y3Rpb24uaG9zdCwgdmlld01vZGVsLCBjb250cm9sbGVyKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKGNoaWxkQmluZGluZ3MgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IGNoaWxkQmluZGluZ3MubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGJpbmRpbmdzLnB1c2goY2hpbGRCaW5kaW5nc1tpXS5jcmVhdGUoaW5zdHJ1Y3Rpb24uaG9zdCwgdmlld01vZGVsLCBjb250cm9sbGVyKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoY2hpbGRCaW5kaW5ncyAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBjaGlsZEJpbmRpbmdzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgICAgIGJpbmRpbmdzLnB1c2goY2hpbGRCaW5kaW5nc1tpXS5jcmVhdGUoZWxlbWVudCwgdmlld01vZGVsLCBjb250cm9sbGVyKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGF1ICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIGF1W3RoaXMuaHRtbE5hbWVdID0gY29udHJvbGxlcjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGluc3RydWN0aW9uLmluaXRpYXRlZEJ5QmVoYXZpb3IgJiYgdmlld0ZhY3RvcnkpIHtcclxuICAgICAgICAgICAgY29udHJvbGxlci52aWV3LmNyZWF0ZWQoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGNvbnRyb2xsZXI7XHJcbiAgICB9O1xyXG4gICAgSHRtbEJlaGF2aW9yUmVzb3VyY2UucHJvdG90eXBlLl9lbnN1cmVQcm9wZXJ0aWVzRGVmaW5lZCA9IGZ1bmN0aW9uIChpbnN0YW5jZSwgbG9va3VwKSB7XHJcbiAgICAgICAgdmFyIHByb3BlcnRpZXM7XHJcbiAgICAgICAgdmFyIGk7XHJcbiAgICAgICAgdmFyIGlpO1xyXG4gICAgICAgIHZhciBvYnNlcnZlcjtcclxuICAgICAgICBpZiAoJ19fcHJvcGVydGllc0RlZmluZWRfXycgaW4gbG9va3VwKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgbG9va3VwLl9fcHJvcGVydGllc0RlZmluZWRfXyA9IHRydWU7XHJcbiAgICAgICAgcHJvcGVydGllcyA9IHRoaXMucHJvcGVydGllcztcclxuICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IHByb3BlcnRpZXMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICBvYnNlcnZlciA9IHByb3BlcnRpZXNbaV0uY3JlYXRlT2JzZXJ2ZXIoaW5zdGFuY2UpO1xyXG4gICAgICAgICAgICBpZiAob2JzZXJ2ZXIgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgbG9va3VwW29ic2VydmVyLnByb3BlcnR5TmFtZV0gPSBvYnNlcnZlcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBIdG1sQmVoYXZpb3JSZXNvdXJjZS5wcm90b3R5cGUuX2NvcHlJbmhlcml0ZWRQcm9wZXJ0aWVzID0gZnVuY3Rpb24gKGNvbnRhaW5lciwgdGFyZ2V0KSB7XHJcbiAgICAgICAgdmFyIGJlaGF2aW9yO1xyXG4gICAgICAgIHZhciBkZXJpdmVkID0gdGFyZ2V0O1xyXG4gICAgICAgIHdoaWxlICh0cnVlKSB7XHJcbiAgICAgICAgICAgIHZhciBwcm90byA9IE9iamVjdC5nZXRQcm90b3R5cGVPZih0YXJnZXQucHJvdG90eXBlKTtcclxuICAgICAgICAgICAgdGFyZ2V0ID0gcHJvdG8gJiYgcHJvdG8uY29uc3RydWN0b3I7XHJcbiAgICAgICAgICAgIGlmICghdGFyZ2V0KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgYmVoYXZpb3IgPSBtZXRhZGF0YS5nZXRPd24obWV0YWRhdGEucmVzb3VyY2UsIHRhcmdldCk7XHJcbiAgICAgICAgICAgIGlmIChiZWhhdmlvcikge1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgYmVoYXZpb3IuaW5pdGlhbGl6ZShjb250YWluZXIsIHRhcmdldCk7XHJcbiAgICAgICAgdmFyIF9sb29wXzEgPSBmdW5jdGlvbiAoaSwgaWkpIHtcclxuICAgICAgICAgICAgdmFyIHByb3AgPSBiZWhhdmlvci5wcm9wZXJ0aWVzW2ldO1xyXG4gICAgICAgICAgICBpZiAodGhpc18xLnByb3BlcnRpZXMuc29tZShmdW5jdGlvbiAocCkgeyByZXR1cm4gcC5uYW1lID09PSBwcm9wLm5hbWU7IH0pKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJjb250aW51ZVwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG5ldyBCaW5kYWJsZVByb3BlcnR5KHByb3ApLnJlZ2lzdGVyV2l0aChkZXJpdmVkLCB0aGlzXzEpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgdmFyIHRoaXNfMSA9IHRoaXM7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gYmVoYXZpb3IucHJvcGVydGllcy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgIF9sb29wXzEoaSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIHJldHVybiBIdG1sQmVoYXZpb3JSZXNvdXJjZTtcclxufSgpKTtcblxuZnVuY3Rpb24gcmVnaXN0ZXIobG9va3VwLCBuYW1lLCByZXNvdXJjZSwgdHlwZSkge1xyXG4gICAgaWYgKCFuYW1lKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdmFyIGV4aXN0aW5nID0gbG9va3VwW25hbWVdO1xyXG4gICAgaWYgKGV4aXN0aW5nKSB7XHJcbiAgICAgICAgaWYgKGV4aXN0aW5nICE9PSByZXNvdXJjZSkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJBdHRlbXB0ZWQgdG8gcmVnaXN0ZXIgXCIuY29uY2F0KHR5cGUsIFwiIHdoZW4gb25lIHdpdGggdGhlIHNhbWUgbmFtZSBhbHJlYWR5IGV4aXN0cy4gTmFtZTogXCIpLmNvbmNhdChuYW1lLCBcIi5cIikpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBsb29rdXBbbmFtZV0gPSByZXNvdXJjZTtcclxufVxyXG5mdW5jdGlvbiB2YWxpZGF0ZUJlaGF2aW9yTmFtZShuYW1lLCB0eXBlKSB7XHJcbiAgICBpZiAoL1tBLVpdLy50ZXN0KG5hbWUpKSB7XHJcbiAgICAgICAgdmFyIG5ld05hbWUgPSBfaHlwaGVuYXRlKG5hbWUpO1xyXG4gICAgICAgIExvZ01hbmFnZXJcclxuICAgICAgICAgICAgLmdldExvZ2dlcigndGVtcGxhdGluZycpXHJcbiAgICAgICAgICAgIC53YXJuKFwiJ1wiLmNvbmNhdChuYW1lLCBcIicgaXMgbm90IGEgdmFsaWQgXCIpLmNvbmNhdCh0eXBlLCBcIiBuYW1lIGFuZCBoYXMgYmVlbiBjb252ZXJ0ZWQgdG8gJ1wiKS5jb25jYXQobmV3TmFtZSwgXCInLiBVcHBlci1jYXNlIGxldHRlcnMgYXJlIG5vdCBhbGxvd2VkIGJlY2F1c2UgdGhlIERPTSBpcyBub3QgY2FzZS1zZW5zaXRpdmUuXCIpKTtcclxuICAgICAgICByZXR1cm4gbmV3TmFtZTtcclxuICAgIH1cclxuICAgIHJldHVybiBuYW1lO1xyXG59XHJcbnZhciBjb252ZW50aW9uTWFyayA9ICdfX2F1X3Jlc291cmNlX18nO1xyXG52YXIgVmlld1Jlc291cmNlcyA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBWaWV3UmVzb3VyY2VzKHBhcmVudCwgdmlld1VybCkge1xyXG4gICAgICAgIHRoaXMuYmluZGluZ0xhbmd1YWdlID0gbnVsbDtcclxuICAgICAgICB0aGlzLnBhcmVudCA9IHBhcmVudCB8fCBudWxsO1xyXG4gICAgICAgIHRoaXMuaGFzUGFyZW50ID0gdGhpcy5wYXJlbnQgIT09IG51bGw7XHJcbiAgICAgICAgdGhpcy52aWV3VXJsID0gdmlld1VybCB8fCAnJztcclxuICAgICAgICB0aGlzLmxvb2t1cEZ1bmN0aW9ucyA9IHtcclxuICAgICAgICAgICAgdmFsdWVDb252ZXJ0ZXJzOiB0aGlzLmdldFZhbHVlQ29udmVydGVyLmJpbmQodGhpcyksXHJcbiAgICAgICAgICAgIGJpbmRpbmdCZWhhdmlvcnM6IHRoaXMuZ2V0QmluZGluZ0JlaGF2aW9yLmJpbmQodGhpcylcclxuICAgICAgICB9O1xyXG4gICAgICAgIHRoaXMuYXR0cmlidXRlcyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XHJcbiAgICAgICAgdGhpcy5lbGVtZW50cyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XHJcbiAgICAgICAgdGhpcy52YWx1ZUNvbnZlcnRlcnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xyXG4gICAgICAgIHRoaXMuYmluZGluZ0JlaGF2aW9ycyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XHJcbiAgICAgICAgdGhpcy5hdHRyaWJ1dGVNYXAgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xyXG4gICAgICAgIHRoaXMudmFsdWVzID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcclxuICAgICAgICB0aGlzLmJlZm9yZUNvbXBpbGUgPSB0aGlzLmFmdGVyQ29tcGlsZSA9IHRoaXMuYmVmb3JlQ3JlYXRlID0gdGhpcy5hZnRlckNyZWF0ZSA9IHRoaXMuYmVmb3JlQmluZCA9IHRoaXMuYmVmb3JlVW5iaW5kID0gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBWaWV3UmVzb3VyY2VzLmNvbnZlbnRpb24gPSBmdW5jdGlvbiAodGFyZ2V0LCBleGlzdGluZykge1xyXG4gICAgICAgIHZhciByZXNvdXJjZTtcclxuICAgICAgICBpZiAoZXhpc3RpbmcgJiYgY29udmVudGlvbk1hcmsgaW4gZXhpc3RpbmcpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGV4aXN0aW5nO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoJyRyZXNvdXJjZScgaW4gdGFyZ2V0KSB7XHJcbiAgICAgICAgICAgIHZhciBjb25maWcgPSB0YXJnZXQuJHJlc291cmNlO1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIGNvbmZpZyA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgICAgIHJlc291cmNlID0gZXhpc3RpbmcgfHwgbmV3IEh0bWxCZWhhdmlvclJlc291cmNlKCk7XHJcbiAgICAgICAgICAgICAgICByZXNvdXJjZVtjb252ZW50aW9uTWFya10gPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFyZXNvdXJjZS5lbGVtZW50TmFtZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc291cmNlLmVsZW1lbnROYW1lID0gdmFsaWRhdGVCZWhhdmlvck5hbWUoY29uZmlnLCAnY3VzdG9tIGVsZW1lbnQnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgY29uZmlnID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uZmlnID0gY29uZmlnLmNhbGwodGFyZ2V0KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgY29uZmlnID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZyA9IHsgbmFtZTogY29uZmlnIH07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjb25maWcgPSBPYmplY3QuYXNzaWduKHt9LCBjb25maWcpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlc291cmNlVHlwZSA9IGNvbmZpZy50eXBlIHx8ICdlbGVtZW50JztcclxuICAgICAgICAgICAgICAgIHZhciBuYW1lXzEgPSBjb25maWcubmFtZTtcclxuICAgICAgICAgICAgICAgIHN3aXRjaCAocmVzb3VyY2VUeXBlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnZWxlbWVudCc6XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnYXR0cmlidXRlJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2UgPSBleGlzdGluZyB8fCBuZXcgSHRtbEJlaGF2aW9yUmVzb3VyY2UoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VbY29udmVudGlvbk1hcmtdID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc291cmNlVHlwZSA9PT0gJ2VsZW1lbnQnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXJlc291cmNlLmVsZW1lbnROYW1lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2UuZWxlbWVudE5hbWUgPSBuYW1lXzFcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyB2YWxpZGF0ZUJlaGF2aW9yTmFtZShuYW1lXzEsICdjdXN0b20gZWxlbWVudCcpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogX2h5cGhlbmF0ZSh0YXJnZXQubmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXJlc291cmNlLmF0dHJpYnV0ZU5hbWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZS5hdHRyaWJ1dGVOYW1lID0gbmFtZV8xXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gdmFsaWRhdGVCZWhhdmlvck5hbWUobmFtZV8xLCAnY3VzdG9tIGF0dHJpYnV0ZScpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogX2h5cGhlbmF0ZSh0YXJnZXQubmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCd0ZW1wbGF0ZUNvbnRyb2xsZXInIGluIGNvbmZpZykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlnLmxpZnRzQ29udGVudCA9IGNvbmZpZy50ZW1wbGF0ZUNvbnRyb2xsZXI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgY29uZmlnLnRlbXBsYXRlQ29udHJvbGxlcjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoJ2RlZmF1bHRCaW5kaW5nTW9kZScgaW4gY29uZmlnICYmIHJlc291cmNlLmF0dHJpYnV0ZURlZmF1bHRCaW5kaW5nTW9kZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25maWcuYXR0cmlidXRlRGVmYXVsdEJpbmRpbmdNb2RlID0gY29uZmlnLmRlZmF1bHRCaW5kaW5nTW9kZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBjb25maWcuZGVmYXVsdEJpbmRpbmdNb2RlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBjb25maWcubmFtZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihyZXNvdXJjZSwgY29uZmlnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAndmFsdWVDb252ZXJ0ZXInOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZSA9IG5ldyBWYWx1ZUNvbnZlcnRlclJlc291cmNlKGNhbWVsQ2FzZShuYW1lXzEgfHwgdGFyZ2V0Lm5hbWUpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnYmluZGluZ0JlaGF2aW9yJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2UgPSBuZXcgQmluZGluZ0JlaGF2aW9yUmVzb3VyY2UoY2FtZWxDYXNlKG5hbWVfMSB8fCB0YXJnZXQubmFtZSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICd2aWV3RW5naW5lSG9va3MnOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZSA9IG5ldyBWaWV3RW5naW5lSG9va3NSZXNvdXJjZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAocmVzb3VyY2UgaW5zdGFuY2VvZiBIdG1sQmVoYXZpb3JSZXNvdXJjZSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGJpbmRhYmxlcyA9IHR5cGVvZiBjb25maWcgPT09ICdzdHJpbmcnID8gdW5kZWZpbmVkIDogY29uZmlnLmJpbmRhYmxlcztcclxuICAgICAgICAgICAgICAgIHZhciBjdXJyZW50UHJvcHMgPSByZXNvdXJjZS5wcm9wZXJ0aWVzO1xyXG4gICAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoYmluZGFibGVzKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IGJpbmRhYmxlcy5sZW5ndGg7IGlpID4gaTsgKytpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwcm9wID0gYmluZGFibGVzW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXByb3AgfHwgKHR5cGVvZiBwcm9wICE9PSAnc3RyaW5nJyAmJiAhcHJvcC5uYW1lKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBiaW5kYWJsZSBwcm9wZXJ0eSBhdCBcXFwiXCIuY29uY2F0KGksIFwiXFxcIiBmb3IgY2xhc3MgXFxcIlwiKS5jb25jYXQodGFyZ2V0Lm5hbWUsIFwiXFxcIi4gRXhwZWN0ZWQgZWl0aGVyIGEgc3RyaW5nIG9yIGFuIG9iamVjdCB3aXRoIFxcXCJuYW1lXFxcIiBwcm9wZXJ0eS5cIikpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuZXdQcm9wID0gbmV3IEJpbmRhYmxlUHJvcGVydHkocHJvcCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBleGlzdGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwLCBqaiA9IGN1cnJlbnRQcm9wcy5sZW5ndGg7IGpqID4gajsgKytqKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudFByb3BzW2pdLm5hbWUgPT09IG5ld1Byb3AubmFtZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4aXN0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChleGlzdGVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXdQcm9wLnJlZ2lzdGVyV2l0aCh0YXJnZXQsIHJlc291cmNlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlc291cmNlO1xyXG4gICAgfTtcclxuICAgIFZpZXdSZXNvdXJjZXMucHJvdG90eXBlLl90cnlBZGRIb29rID0gZnVuY3Rpb24gKG9iaiwgbmFtZSkge1xyXG4gICAgICAgIGlmICh0eXBlb2Ygb2JqW25hbWVdID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgIHZhciBmdW5jID0gb2JqW25hbWVdLmJpbmQob2JqKTtcclxuICAgICAgICAgICAgdmFyIGNvdW50ZXIgPSAxO1xyXG4gICAgICAgICAgICB2YXIgY2FsbGJhY2tOYW1lID0gdm9pZCAwO1xyXG4gICAgICAgICAgICB3aGlsZSAodGhpc1tjYWxsYmFja05hbWUgPSBuYW1lICsgY291bnRlci50b1N0cmluZygpXSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICBjb3VudGVyKys7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpc1tuYW1lXSA9IHRydWU7XHJcbiAgICAgICAgICAgIHRoaXNbY2FsbGJhY2tOYW1lXSA9IGZ1bmM7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFZpZXdSZXNvdXJjZXMucHJvdG90eXBlLl9pbnZva2VIb29rID0gZnVuY3Rpb24gKG5hbWUsIG9uZSwgdHdvLCB0aHJlZSwgZm91cikge1xyXG4gICAgICAgIGlmICh0aGlzLmhhc1BhcmVudCkge1xyXG4gICAgICAgICAgICB0aGlzLnBhcmVudC5faW52b2tlSG9vayhuYW1lLCBvbmUsIHR3bywgdGhyZWUsIGZvdXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpc1tuYW1lXSkge1xyXG4gICAgICAgICAgICB0aGlzW25hbWUgKyAnMSddKG9uZSwgdHdvLCB0aHJlZSwgZm91cik7XHJcbiAgICAgICAgICAgIHZhciBjYWxsYmFja05hbWUgPSBuYW1lICsgJzInO1xyXG4gICAgICAgICAgICBpZiAodGhpc1tjYWxsYmFja05hbWVdKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzW2NhbGxiYWNrTmFtZV0ob25lLCB0d28sIHRocmVlLCBmb3VyKTtcclxuICAgICAgICAgICAgICAgIGNhbGxiYWNrTmFtZSA9IG5hbWUgKyAnMyc7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpc1tjYWxsYmFja05hbWVdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpc1tjYWxsYmFja05hbWVdKG9uZSwgdHdvLCB0aHJlZSwgZm91cik7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNvdW50ZXIgPSA0O1xyXG4gICAgICAgICAgICAgICAgICAgIHdoaWxlICh0aGlzW2NhbGxiYWNrTmFtZSA9IG5hbWUgKyBjb3VudGVyLnRvU3RyaW5nKCldICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpc1tjYWxsYmFja05hbWVdKG9uZSwgdHdvLCB0aHJlZSwgZm91cik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50ZXIrKztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgVmlld1Jlc291cmNlcy5wcm90b3R5cGUucmVnaXN0ZXJWaWV3RW5naW5lSG9va3MgPSBmdW5jdGlvbiAoaG9va3MpIHtcclxuICAgICAgICB0aGlzLl90cnlBZGRIb29rKGhvb2tzLCAnYmVmb3JlQ29tcGlsZScpO1xyXG4gICAgICAgIHRoaXMuX3RyeUFkZEhvb2soaG9va3MsICdhZnRlckNvbXBpbGUnKTtcclxuICAgICAgICB0aGlzLl90cnlBZGRIb29rKGhvb2tzLCAnYmVmb3JlQ3JlYXRlJyk7XHJcbiAgICAgICAgdGhpcy5fdHJ5QWRkSG9vayhob29rcywgJ2FmdGVyQ3JlYXRlJyk7XHJcbiAgICAgICAgdGhpcy5fdHJ5QWRkSG9vayhob29rcywgJ2JlZm9yZUJpbmQnKTtcclxuICAgICAgICB0aGlzLl90cnlBZGRIb29rKGhvb2tzLCAnYmVmb3JlVW5iaW5kJyk7XHJcbiAgICB9O1xyXG4gICAgVmlld1Jlc291cmNlcy5wcm90b3R5cGUuZ2V0QmluZGluZ0xhbmd1YWdlID0gZnVuY3Rpb24gKGJpbmRpbmdMYW5ndWFnZUZhbGxiYWNrKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuYmluZGluZ0xhbmd1YWdlIHx8ICh0aGlzLmJpbmRpbmdMYW5ndWFnZSA9IGJpbmRpbmdMYW5ndWFnZUZhbGxiYWNrKTtcclxuICAgIH07XHJcbiAgICBWaWV3UmVzb3VyY2VzLnByb3RvdHlwZS5wYXRjaEluUGFyZW50ID0gZnVuY3Rpb24gKG5ld1BhcmVudCkge1xyXG4gICAgICAgIHZhciBvcmlnaW5hbFBhcmVudCA9IHRoaXMucGFyZW50O1xyXG4gICAgICAgIHRoaXMucGFyZW50ID0gbmV3UGFyZW50IHx8IG51bGw7XHJcbiAgICAgICAgdGhpcy5oYXNQYXJlbnQgPSB0aGlzLnBhcmVudCAhPT0gbnVsbDtcclxuICAgICAgICBpZiAobmV3UGFyZW50LnBhcmVudCA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICBuZXdQYXJlbnQucGFyZW50ID0gb3JpZ2luYWxQYXJlbnQ7XHJcbiAgICAgICAgICAgIG5ld1BhcmVudC5oYXNQYXJlbnQgPSBvcmlnaW5hbFBhcmVudCAhPT0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgVmlld1Jlc291cmNlcy5wcm90b3R5cGUucmVsYXRpdmVUb1ZpZXcgPSBmdW5jdGlvbiAocGF0aCkge1xyXG4gICAgICAgIHJldHVybiByZWxhdGl2ZVRvRmlsZShwYXRoLCB0aGlzLnZpZXdVcmwpO1xyXG4gICAgfTtcclxuICAgIFZpZXdSZXNvdXJjZXMucHJvdG90eXBlLnJlZ2lzdGVyRWxlbWVudCA9IGZ1bmN0aW9uICh0YWdOYW1lLCBiZWhhdmlvcikge1xyXG4gICAgICAgIHJlZ2lzdGVyKHRoaXMuZWxlbWVudHMsIHRhZ05hbWUsIGJlaGF2aW9yLCAnYW4gRWxlbWVudCcpO1xyXG4gICAgfTtcclxuICAgIFZpZXdSZXNvdXJjZXMucHJvdG90eXBlLmdldEVsZW1lbnQgPSBmdW5jdGlvbiAodGFnTmFtZSkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmVsZW1lbnRzW3RhZ05hbWVdIHx8ICh0aGlzLmhhc1BhcmVudCA/IHRoaXMucGFyZW50LmdldEVsZW1lbnQodGFnTmFtZSkgOiBudWxsKTtcclxuICAgIH07XHJcbiAgICBWaWV3UmVzb3VyY2VzLnByb3RvdHlwZS5tYXBBdHRyaWJ1dGUgPSBmdW5jdGlvbiAoYXR0cmlidXRlKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuYXR0cmlidXRlTWFwW2F0dHJpYnV0ZV0gfHwgKHRoaXMuaGFzUGFyZW50ID8gdGhpcy5wYXJlbnQubWFwQXR0cmlidXRlKGF0dHJpYnV0ZSkgOiBudWxsKTtcclxuICAgIH07XHJcbiAgICBWaWV3UmVzb3VyY2VzLnByb3RvdHlwZS5yZWdpc3RlckF0dHJpYnV0ZSA9IGZ1bmN0aW9uIChhdHRyaWJ1dGUsIGJlaGF2aW9yLCBrbm93bkF0dHJpYnV0ZSkge1xyXG4gICAgICAgIHRoaXMuYXR0cmlidXRlTWFwW2F0dHJpYnV0ZV0gPSBrbm93bkF0dHJpYnV0ZTtcclxuICAgICAgICByZWdpc3Rlcih0aGlzLmF0dHJpYnV0ZXMsIGF0dHJpYnV0ZSwgYmVoYXZpb3IsICdhbiBBdHRyaWJ1dGUnKTtcclxuICAgIH07XHJcbiAgICBWaWV3UmVzb3VyY2VzLnByb3RvdHlwZS5nZXRBdHRyaWJ1dGUgPSBmdW5jdGlvbiAoYXR0cmlidXRlKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuYXR0cmlidXRlc1thdHRyaWJ1dGVdIHx8ICh0aGlzLmhhc1BhcmVudCA/IHRoaXMucGFyZW50LmdldEF0dHJpYnV0ZShhdHRyaWJ1dGUpIDogbnVsbCk7XHJcbiAgICB9O1xyXG4gICAgVmlld1Jlc291cmNlcy5wcm90b3R5cGUucmVnaXN0ZXJWYWx1ZUNvbnZlcnRlciA9IGZ1bmN0aW9uIChuYW1lLCB2YWx1ZUNvbnZlcnRlcikge1xyXG4gICAgICAgIHJlZ2lzdGVyKHRoaXMudmFsdWVDb252ZXJ0ZXJzLCBuYW1lLCB2YWx1ZUNvbnZlcnRlciwgJ2EgVmFsdWVDb252ZXJ0ZXInKTtcclxuICAgIH07XHJcbiAgICBWaWV3UmVzb3VyY2VzLnByb3RvdHlwZS5nZXRWYWx1ZUNvbnZlcnRlciA9IGZ1bmN0aW9uIChuYW1lKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudmFsdWVDb252ZXJ0ZXJzW25hbWVdIHx8ICh0aGlzLmhhc1BhcmVudCA/IHRoaXMucGFyZW50LmdldFZhbHVlQ29udmVydGVyKG5hbWUpIDogbnVsbCk7XHJcbiAgICB9O1xyXG4gICAgVmlld1Jlc291cmNlcy5wcm90b3R5cGUucmVnaXN0ZXJCaW5kaW5nQmVoYXZpb3IgPSBmdW5jdGlvbiAobmFtZSwgYmluZGluZ0JlaGF2aW9yKSB7XHJcbiAgICAgICAgcmVnaXN0ZXIodGhpcy5iaW5kaW5nQmVoYXZpb3JzLCBuYW1lLCBiaW5kaW5nQmVoYXZpb3IsICdhIEJpbmRpbmdCZWhhdmlvcicpO1xyXG4gICAgfTtcclxuICAgIFZpZXdSZXNvdXJjZXMucHJvdG90eXBlLmdldEJpbmRpbmdCZWhhdmlvciA9IGZ1bmN0aW9uIChuYW1lKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuYmluZGluZ0JlaGF2aW9yc1tuYW1lXSB8fCAodGhpcy5oYXNQYXJlbnQgPyB0aGlzLnBhcmVudC5nZXRCaW5kaW5nQmVoYXZpb3IobmFtZSkgOiBudWxsKTtcclxuICAgIH07XHJcbiAgICBWaWV3UmVzb3VyY2VzLnByb3RvdHlwZS5yZWdpc3RlclZhbHVlID0gZnVuY3Rpb24gKG5hbWUsIHZhbHVlKSB7XHJcbiAgICAgICAgcmVnaXN0ZXIodGhpcy52YWx1ZXMsIG5hbWUsIHZhbHVlLCAnYSB2YWx1ZScpO1xyXG4gICAgfTtcclxuICAgIFZpZXdSZXNvdXJjZXMucHJvdG90eXBlLmdldFZhbHVlID0gZnVuY3Rpb24gKG5hbWUpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy52YWx1ZXNbbmFtZV0gfHwgKHRoaXMuaGFzUGFyZW50ID8gdGhpcy5wYXJlbnQuZ2V0VmFsdWUobmFtZSkgOiBudWxsKTtcclxuICAgIH07XHJcbiAgICBWaWV3UmVzb3VyY2VzLnByb3RvdHlwZS5hdXRvUmVnaXN0ZXIgPSBmdW5jdGlvbiAoY29udGFpbmVyLCBpbXBsKSB7XHJcbiAgICAgICAgdmFyIHJlc291cmNlVHlwZU1ldGEgPSBtZXRhZGF0YS5nZXRPd24obWV0YWRhdGEucmVzb3VyY2UsIGltcGwpO1xyXG4gICAgICAgIGlmIChyZXNvdXJjZVR5cGVNZXRhKSB7XHJcbiAgICAgICAgICAgIGlmIChyZXNvdXJjZVR5cGVNZXRhIGluc3RhbmNlb2YgSHRtbEJlaGF2aW9yUmVzb3VyY2UpIHtcclxuICAgICAgICAgICAgICAgIFZpZXdSZXNvdXJjZXMuY29udmVudGlvbihpbXBsLCByZXNvdXJjZVR5cGVNZXRhKTtcclxuICAgICAgICAgICAgICAgIGlmIChyZXNvdXJjZVR5cGVNZXRhLmF0dHJpYnV0ZU5hbWUgPT09IG51bGwgJiYgcmVzb3VyY2VUeXBlTWV0YS5lbGVtZW50TmFtZSA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIEh0bWxCZWhhdmlvclJlc291cmNlLmNvbnZlbnRpb24oaW1wbC5uYW1lLCByZXNvdXJjZVR5cGVNZXRhKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChyZXNvdXJjZVR5cGVNZXRhLmF0dHJpYnV0ZU5hbWUgPT09IG51bGwgJiYgcmVzb3VyY2VUeXBlTWV0YS5lbGVtZW50TmFtZSA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc291cmNlVHlwZU1ldGEuZWxlbWVudE5hbWUgPSBfaHlwaGVuYXRlKGltcGwubmFtZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHJlc291cmNlVHlwZU1ldGEgPSBWaWV3UmVzb3VyY2VzLmNvbnZlbnRpb24oaW1wbClcclxuICAgICAgICAgICAgICAgIHx8IEh0bWxCZWhhdmlvclJlc291cmNlLmNvbnZlbnRpb24oaW1wbC5uYW1lKVxyXG4gICAgICAgICAgICAgICAgfHwgVmFsdWVDb252ZXJ0ZXJSZXNvdXJjZS5jb252ZW50aW9uKGltcGwubmFtZSlcclxuICAgICAgICAgICAgICAgIHx8IEJpbmRpbmdCZWhhdmlvclJlc291cmNlLmNvbnZlbnRpb24oaW1wbC5uYW1lKVxyXG4gICAgICAgICAgICAgICAgfHwgVmlld0VuZ2luZUhvb2tzUmVzb3VyY2UuY29udmVudGlvbihpbXBsLm5hbWUpO1xyXG4gICAgICAgICAgICBpZiAoIXJlc291cmNlVHlwZU1ldGEpIHtcclxuICAgICAgICAgICAgICAgIHJlc291cmNlVHlwZU1ldGEgPSBuZXcgSHRtbEJlaGF2aW9yUmVzb3VyY2UoKTtcclxuICAgICAgICAgICAgICAgIHJlc291cmNlVHlwZU1ldGEuZWxlbWVudE5hbWUgPSBfaHlwaGVuYXRlKGltcGwubmFtZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgbWV0YWRhdGEuZGVmaW5lKG1ldGFkYXRhLnJlc291cmNlLCByZXNvdXJjZVR5cGVNZXRhLCBpbXBsKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmVzb3VyY2VUeXBlTWV0YS5pbml0aWFsaXplKGNvbnRhaW5lciwgaW1wbCk7XHJcbiAgICAgICAgcmVzb3VyY2VUeXBlTWV0YS5yZWdpc3Rlcih0aGlzLCB1bmRlZmluZWQpO1xyXG4gICAgICAgIHJldHVybiByZXNvdXJjZVR5cGVNZXRhO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBWaWV3UmVzb3VyY2VzO1xyXG59KCkpO1xuXG52YXIgdmlld1N0cmF0ZWd5ID0gcHJvdG9jb2wuY3JlYXRlKCdhdXJlbGlhOnZpZXctc3RyYXRlZ3knLCB7XHJcbiAgICB2YWxpZGF0ZTogZnVuY3Rpb24gKHRhcmdldCkge1xyXG4gICAgICAgIGlmICghKHR5cGVvZiB0YXJnZXQubG9hZFZpZXdGYWN0b3J5ID09PSAnZnVuY3Rpb24nKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gJ1ZpZXcgc3RyYXRlZ2llcyBtdXN0IGltcGxlbWVudDogbG9hZFZpZXdGYWN0b3J5KHZpZXdFbmdpbmU6IFZpZXdFbmdpbmUsIGNvbXBpbGVJbnN0cnVjdGlvbjogVmlld0NvbXBpbGVJbnN0cnVjdGlvbiwgbG9hZENvbnRleHQ/OiBSZXNvdXJjZUxvYWRDb250ZXh0KTogUHJvbWlzZTxWaWV3RmFjdG9yeT4nO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH0sXHJcbiAgICBjb21wb3NlOiBmdW5jdGlvbiAodGFyZ2V0KSB7XHJcbiAgICAgICAgaWYgKCEodHlwZW9mIHRhcmdldC5tYWtlUmVsYXRpdmVUbyA9PT0gJ2Z1bmN0aW9uJykpIHtcclxuICAgICAgICAgICAgdGFyZ2V0Lm1ha2VSZWxhdGl2ZVRvID0gUExBVEZPUk0ubm9vcDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0pO1xyXG52YXIgUmVsYXRpdmVWaWV3U3RyYXRlZ3kgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gUmVsYXRpdmVWaWV3U3RyYXRlZ3kocGF0aCkge1xyXG4gICAgICAgIHRoaXMucGF0aCA9IHBhdGg7XHJcbiAgICAgICAgdGhpcy5hYnNvbHV0ZVBhdGggPSBudWxsO1xyXG4gICAgfVxyXG4gICAgUmVsYXRpdmVWaWV3U3RyYXRlZ3kucHJvdG90eXBlLmxvYWRWaWV3RmFjdG9yeSA9IGZ1bmN0aW9uICh2aWV3RW5naW5lLCBjb21waWxlSW5zdHJ1Y3Rpb24sIGxvYWRDb250ZXh0LCB0YXJnZXQpIHtcclxuICAgICAgICBpZiAodGhpcy5hYnNvbHV0ZVBhdGggPT09IG51bGwgJiYgdGhpcy5tb2R1bGVJZCkge1xyXG4gICAgICAgICAgICB0aGlzLmFic29sdXRlUGF0aCA9IHJlbGF0aXZlVG9GaWxlKHRoaXMucGF0aCwgdGhpcy5tb2R1bGVJZCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbXBpbGVJbnN0cnVjdGlvbi5hc3NvY2lhdGVkTW9kdWxlSWQgPSB0aGlzLm1vZHVsZUlkO1xyXG4gICAgICAgIHJldHVybiB2aWV3RW5naW5lLmxvYWRWaWV3RmFjdG9yeSh0aGlzLmFic29sdXRlUGF0aCB8fCB0aGlzLnBhdGgsIGNvbXBpbGVJbnN0cnVjdGlvbiwgbG9hZENvbnRleHQsIHRhcmdldCk7XHJcbiAgICB9O1xyXG4gICAgUmVsYXRpdmVWaWV3U3RyYXRlZ3kucHJvdG90eXBlLm1ha2VSZWxhdGl2ZVRvID0gZnVuY3Rpb24gKGZpbGUpIHtcclxuICAgICAgICBpZiAodGhpcy5hYnNvbHV0ZVBhdGggPT09IG51bGwpIHtcclxuICAgICAgICAgICAgdGhpcy5hYnNvbHV0ZVBhdGggPSByZWxhdGl2ZVRvRmlsZSh0aGlzLnBhdGgsIGZpbGUpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBSZWxhdGl2ZVZpZXdTdHJhdGVneSA9IF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIHZpZXdTdHJhdGVneSgpXHJcbiAgICBdLCBSZWxhdGl2ZVZpZXdTdHJhdGVneSk7XHJcbiAgICByZXR1cm4gUmVsYXRpdmVWaWV3U3RyYXRlZ3k7XHJcbn0oKSk7XHJcbnZhciBDb252ZW50aW9uYWxWaWV3U3RyYXRlZ3kgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gQ29udmVudGlvbmFsVmlld1N0cmF0ZWd5KHZpZXdMb2NhdG9yLCBvcmlnaW4pIHtcclxuICAgICAgICB0aGlzLm1vZHVsZUlkID0gb3JpZ2luLm1vZHVsZUlkO1xyXG4gICAgICAgIHRoaXMudmlld1VybCA9IHZpZXdMb2NhdG9yLmNvbnZlcnRPcmlnaW5Ub1ZpZXdVcmwob3JpZ2luKTtcclxuICAgIH1cclxuICAgIENvbnZlbnRpb25hbFZpZXdTdHJhdGVneS5wcm90b3R5cGUubG9hZFZpZXdGYWN0b3J5ID0gZnVuY3Rpb24gKHZpZXdFbmdpbmUsIGNvbXBpbGVJbnN0cnVjdGlvbiwgbG9hZENvbnRleHQsIHRhcmdldCkge1xyXG4gICAgICAgIGNvbXBpbGVJbnN0cnVjdGlvbi5hc3NvY2lhdGVkTW9kdWxlSWQgPSB0aGlzLm1vZHVsZUlkO1xyXG4gICAgICAgIHJldHVybiB2aWV3RW5naW5lLmxvYWRWaWV3RmFjdG9yeSh0aGlzLnZpZXdVcmwsIGNvbXBpbGVJbnN0cnVjdGlvbiwgbG9hZENvbnRleHQsIHRhcmdldCk7XHJcbiAgICB9O1xyXG4gICAgQ29udmVudGlvbmFsVmlld1N0cmF0ZWd5ID0gX19kZWNvcmF0ZShbXHJcbiAgICAgICAgdmlld1N0cmF0ZWd5KClcclxuICAgIF0sIENvbnZlbnRpb25hbFZpZXdTdHJhdGVneSk7XHJcbiAgICByZXR1cm4gQ29udmVudGlvbmFsVmlld1N0cmF0ZWd5O1xyXG59KCkpO1xyXG52YXIgTm9WaWV3U3RyYXRlZ3kgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gTm9WaWV3U3RyYXRlZ3koZGVwZW5kZW5jaWVzLCBkZXBlbmRlbmN5QmFzZVVybCkge1xyXG4gICAgICAgIHRoaXMuZGVwZW5kZW5jaWVzID0gZGVwZW5kZW5jaWVzIHx8IG51bGw7XHJcbiAgICAgICAgdGhpcy5kZXBlbmRlbmN5QmFzZVVybCA9IGRlcGVuZGVuY3lCYXNlVXJsIHx8ICcnO1xyXG4gICAgfVxyXG4gICAgTm9WaWV3U3RyYXRlZ3kucHJvdG90eXBlLmxvYWRWaWV3RmFjdG9yeSA9IGZ1bmN0aW9uICh2aWV3RW5naW5lLCBjb21waWxlSW5zdHJ1Y3Rpb24sIGxvYWRDb250ZXh0LCB0YXJnZXQpIHtcclxuICAgICAgICB2YXIgZW50cnkgPSB0aGlzLmVudHJ5O1xyXG4gICAgICAgIHZhciBkZXBlbmRlbmNpZXMgPSB0aGlzLmRlcGVuZGVuY2llcztcclxuICAgICAgICBpZiAoZW50cnkgJiYgZW50cnkuZmFjdG9yeUlzUmVhZHkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShudWxsKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5lbnRyeSA9IGVudHJ5ID0gbmV3IFRlbXBsYXRlUmVnaXN0cnlFbnRyeSh0aGlzLm1vZHVsZUlkIHx8IHRoaXMuZGVwZW5kZW5jeUJhc2VVcmwpO1xyXG4gICAgICAgIGVudHJ5LmRlcGVuZGVuY2llcyA9IFtdO1xyXG4gICAgICAgIGVudHJ5LnRlbXBsYXRlSXNMb2FkZWQgPSB0cnVlO1xyXG4gICAgICAgIGlmIChkZXBlbmRlbmNpZXMgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gZGVwZW5kZW5jaWVzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgICAgIHZhciBjdXJyZW50ID0gZGVwZW5kZW5jaWVzW2ldO1xyXG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBjdXJyZW50ID09PSAnc3RyaW5nJyB8fCB0eXBlb2YgY3VycmVudCA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGVudHJ5LmFkZERlcGVuZGVuY3koY3VycmVudCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBlbnRyeS5hZGREZXBlbmRlbmN5KGN1cnJlbnQuZnJvbSwgY3VycmVudC5hcyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgY29tcGlsZUluc3RydWN0aW9uLmFzc29jaWF0ZWRNb2R1bGVJZCA9IHRoaXMubW9kdWxlSWQ7XHJcbiAgICAgICAgcmV0dXJuIHZpZXdFbmdpbmUubG9hZFZpZXdGYWN0b3J5KGVudHJ5LCBjb21waWxlSW5zdHJ1Y3Rpb24sIGxvYWRDb250ZXh0LCB0YXJnZXQpO1xyXG4gICAgfTtcclxuICAgIE5vVmlld1N0cmF0ZWd5ID0gX19kZWNvcmF0ZShbXHJcbiAgICAgICAgdmlld1N0cmF0ZWd5KClcclxuICAgIF0sIE5vVmlld1N0cmF0ZWd5KTtcclxuICAgIHJldHVybiBOb1ZpZXdTdHJhdGVneTtcclxufSgpKTtcclxudmFyIFRlbXBsYXRlUmVnaXN0cnlWaWV3U3RyYXRlZ3kgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gVGVtcGxhdGVSZWdpc3RyeVZpZXdTdHJhdGVneShtb2R1bGVJZCwgZW50cnkpIHtcclxuICAgICAgICB0aGlzLm1vZHVsZUlkID0gbW9kdWxlSWQ7XHJcbiAgICAgICAgdGhpcy5lbnRyeSA9IGVudHJ5O1xyXG4gICAgfVxyXG4gICAgVGVtcGxhdGVSZWdpc3RyeVZpZXdTdHJhdGVneS5wcm90b3R5cGUubG9hZFZpZXdGYWN0b3J5ID0gZnVuY3Rpb24gKHZpZXdFbmdpbmUsIGNvbXBpbGVJbnN0cnVjdGlvbiwgbG9hZENvbnRleHQsIHRhcmdldCkge1xyXG4gICAgICAgIHZhciBlbnRyeSA9IHRoaXMuZW50cnk7XHJcbiAgICAgICAgaWYgKGVudHJ5LmZhY3RvcnlJc1JlYWR5KSB7XHJcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoZW50cnkuZmFjdG9yeSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbXBpbGVJbnN0cnVjdGlvbi5hc3NvY2lhdGVkTW9kdWxlSWQgPSB0aGlzLm1vZHVsZUlkO1xyXG4gICAgICAgIHJldHVybiB2aWV3RW5naW5lLmxvYWRWaWV3RmFjdG9yeShlbnRyeSwgY29tcGlsZUluc3RydWN0aW9uLCBsb2FkQ29udGV4dCwgdGFyZ2V0KTtcclxuICAgIH07XHJcbiAgICBUZW1wbGF0ZVJlZ2lzdHJ5Vmlld1N0cmF0ZWd5ID0gX19kZWNvcmF0ZShbXHJcbiAgICAgICAgdmlld1N0cmF0ZWd5KClcclxuICAgIF0sIFRlbXBsYXRlUmVnaXN0cnlWaWV3U3RyYXRlZ3kpO1xyXG4gICAgcmV0dXJuIFRlbXBsYXRlUmVnaXN0cnlWaWV3U3RyYXRlZ3k7XHJcbn0oKSk7XHJcbnZhciBJbmxpbmVWaWV3U3RyYXRlZ3kgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gSW5saW5lVmlld1N0cmF0ZWd5KG1hcmt1cCwgZGVwZW5kZW5jaWVzLCBkZXBlbmRlbmN5QmFzZVVybCkge1xyXG4gICAgICAgIHRoaXMubWFya3VwID0gbWFya3VwO1xyXG4gICAgICAgIHRoaXMuZGVwZW5kZW5jaWVzID0gZGVwZW5kZW5jaWVzIHx8IG51bGw7XHJcbiAgICAgICAgdGhpcy5kZXBlbmRlbmN5QmFzZVVybCA9IGRlcGVuZGVuY3lCYXNlVXJsIHx8ICcnO1xyXG4gICAgfVxyXG4gICAgSW5saW5lVmlld1N0cmF0ZWd5LnByb3RvdHlwZS5sb2FkVmlld0ZhY3RvcnkgPSBmdW5jdGlvbiAodmlld0VuZ2luZSwgY29tcGlsZUluc3RydWN0aW9uLCBsb2FkQ29udGV4dCwgdGFyZ2V0KSB7XHJcbiAgICAgICAgdmFyIGVudHJ5ID0gdGhpcy5lbnRyeTtcclxuICAgICAgICB2YXIgZGVwZW5kZW5jaWVzID0gdGhpcy5kZXBlbmRlbmNpZXM7XHJcbiAgICAgICAgaWYgKGVudHJ5ICYmIGVudHJ5LmZhY3RvcnlJc1JlYWR5KSB7XHJcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoZW50cnkuZmFjdG9yeSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZW50cnkgPSBlbnRyeSA9IG5ldyBUZW1wbGF0ZVJlZ2lzdHJ5RW50cnkodGhpcy5tb2R1bGVJZCB8fCB0aGlzLmRlcGVuZGVuY3lCYXNlVXJsKTtcclxuICAgICAgICBlbnRyeS50ZW1wbGF0ZSA9IERPTS5jcmVhdGVUZW1wbGF0ZUZyb21NYXJrdXAodGhpcy5tYXJrdXApO1xyXG4gICAgICAgIGlmIChkZXBlbmRlbmNpZXMgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gZGVwZW5kZW5jaWVzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgICAgIHZhciBjdXJyZW50ID0gZGVwZW5kZW5jaWVzW2ldO1xyXG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBjdXJyZW50ID09PSAnc3RyaW5nJyB8fCB0eXBlb2YgY3VycmVudCA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGVudHJ5LmFkZERlcGVuZGVuY3koY3VycmVudCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBlbnRyeS5hZGREZXBlbmRlbmN5KGN1cnJlbnQuZnJvbSwgY3VycmVudC5hcyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgY29tcGlsZUluc3RydWN0aW9uLmFzc29jaWF0ZWRNb2R1bGVJZCA9IHRoaXMubW9kdWxlSWQ7XHJcbiAgICAgICAgcmV0dXJuIHZpZXdFbmdpbmUubG9hZFZpZXdGYWN0b3J5KGVudHJ5LCBjb21waWxlSW5zdHJ1Y3Rpb24sIGxvYWRDb250ZXh0LCB0YXJnZXQpO1xyXG4gICAgfTtcclxuICAgIElubGluZVZpZXdTdHJhdGVneSA9IF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIHZpZXdTdHJhdGVneSgpXHJcbiAgICBdLCBJbmxpbmVWaWV3U3RyYXRlZ3kpO1xyXG4gICAgcmV0dXJuIElubGluZVZpZXdTdHJhdGVneTtcclxufSgpKTtcclxudmFyIFN0YXRpY1ZpZXdTdHJhdGVneSA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBTdGF0aWNWaWV3U3RyYXRlZ3koY29uZmlnKSB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBjb25maWcgPT09ICdzdHJpbmcnIHx8IChjb25maWcgaW5zdGFuY2VvZiBET00uRWxlbWVudCAmJiBjb25maWcudGFnTmFtZSA9PT0gJ1RFTVBMQVRFJykpIHtcclxuICAgICAgICAgICAgY29uZmlnID0ge1xyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGU6IGNvbmZpZ1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnRlbXBsYXRlID0gY29uZmlnLnRlbXBsYXRlO1xyXG4gICAgICAgIHRoaXMuZGVwZW5kZW5jaWVzID0gY29uZmlnLmRlcGVuZGVuY2llcyB8fCBbXTtcclxuICAgICAgICB0aGlzLmZhY3RvcnlJc1JlYWR5ID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5vblJlYWR5ID0gbnVsbDtcclxuICAgICAgICB0aGlzLm1vZHVsZUlkID0gJ3VuZGVmaW5lZCc7XHJcbiAgICB9XHJcbiAgICBTdGF0aWNWaWV3U3RyYXRlZ3kucHJvdG90eXBlLmxvYWRWaWV3RmFjdG9yeSA9IGZ1bmN0aW9uICh2aWV3RW5naW5lLCBjb21waWxlSW5zdHJ1Y3Rpb24sIGxvYWRDb250ZXh0LCB0YXJnZXQpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIGlmICh0aGlzLmZhY3RvcnlJc1JlYWR5KSB7XHJcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUodGhpcy5mYWN0b3J5KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyICRkZXBzID0gdGhpcy5kZXBlbmRlbmNpZXM7XHJcbiAgICAgICAgdmFyIGRlcHMgPSB0eXBlb2YgJGRlcHMgPT09ICdmdW5jdGlvbicgPyAkZGVwcygpIDogJGRlcHM7XHJcbiAgICAgICAgZGVwcyA9IGRlcHMgPyBkZXBzIDogW107XHJcbiAgICAgICAgZGVwcyA9IEFycmF5LmlzQXJyYXkoZGVwcykgPyBkZXBzIDogW2RlcHNdO1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLmFsbChkZXBzKS50aGVuKGZ1bmN0aW9uIChkZXBlbmRlbmNpZXMpIHtcclxuICAgICAgICAgICAgdmFyIGNvbnRhaW5lciA9IHZpZXdFbmdpbmUuY29udGFpbmVyO1xyXG4gICAgICAgICAgICB2YXIgYXBwUmVzb3VyY2VzID0gdmlld0VuZ2luZS5hcHBSZXNvdXJjZXM7XHJcbiAgICAgICAgICAgIHZhciB2aWV3Q29tcGlsZXIgPSB2aWV3RW5naW5lLnZpZXdDb21waWxlcjtcclxuICAgICAgICAgICAgdmFyIHZpZXdSZXNvdXJjZXMgPSBuZXcgVmlld1Jlc291cmNlcyhhcHBSZXNvdXJjZXMpO1xyXG4gICAgICAgICAgICB2YXIgcmVzb3VyY2U7XHJcbiAgICAgICAgICAgIHZhciBlbERlcHMgPSBbXTtcclxuICAgICAgICAgICAgaWYgKHRhcmdldCkge1xyXG4gICAgICAgICAgICAgICAgdmlld1Jlc291cmNlcy5hdXRvUmVnaXN0ZXIoY29udGFpbmVyLCB0YXJnZXQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGZvciAodmFyIF9pID0gMCwgZGVwZW5kZW5jaWVzXzEgPSBkZXBlbmRlbmNpZXM7IF9pIDwgZGVwZW5kZW5jaWVzXzEubGVuZ3RoOyBfaSsrKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGVwID0gZGVwZW5kZW5jaWVzXzFbX2ldO1xyXG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBkZXAgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXNvdXJjZSA9IHZpZXdSZXNvdXJjZXMuYXV0b1JlZ2lzdGVyKGNvbnRhaW5lciwgZGVwKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzb3VyY2UuZWxlbWVudE5hbWUgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxEZXBzLnB1c2gocmVzb3VyY2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGRlcCAmJiB0eXBlb2YgZGVwID09PSAnb2JqZWN0Jykge1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGtleSBpbiBkZXApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGV4cG9ydGVkID0gZGVwW2tleV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZXhwb3J0ZWQgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc291cmNlID0gdmlld1Jlc291cmNlcy5hdXRvUmVnaXN0ZXIoY29udGFpbmVyLCBleHBvcnRlZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzb3VyY2UuZWxlbWVudE5hbWUgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbERlcHMucHVzaChyZXNvdXJjZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJkZXBlbmRlbmN5IG5laXRoZXIgZnVuY3Rpb24gbm9yIG9iamVjdC4gUmVjZWl2ZWQ6IFxcXCJcIi5jb25jYXQodHlwZW9mIGRlcCwgXCJcXFwiXCIpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwoZWxEZXBzLm1hcChmdW5jdGlvbiAoZWwpIHsgcmV0dXJuIGVsLmxvYWQoY29udGFpbmVyLCBlbC50YXJnZXQpOyB9KSkudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZmFjdG9yeSA9IF90aGlzLnRlbXBsYXRlICE9PSBudWxsXHJcbiAgICAgICAgICAgICAgICAgICAgPyB2aWV3Q29tcGlsZXIuY29tcGlsZShfdGhpcy50ZW1wbGF0ZSwgdmlld1Jlc291cmNlcywgY29tcGlsZUluc3RydWN0aW9uKVxyXG4gICAgICAgICAgICAgICAgICAgIDogbnVsbDtcclxuICAgICAgICAgICAgICAgIF90aGlzLmZhY3RvcnlJc1JlYWR5ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIF90aGlzLmZhY3RvcnkgPSBmYWN0b3J5O1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhY3Rvcnk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIFN0YXRpY1ZpZXdTdHJhdGVneSA9IF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIHZpZXdTdHJhdGVneSgpXHJcbiAgICBdLCBTdGF0aWNWaWV3U3RyYXRlZ3kpO1xyXG4gICAgcmV0dXJuIFN0YXRpY1ZpZXdTdHJhdGVneTtcclxufSgpKTtcblxuZnVuY3Rpb24gcmVtb3ZlKHZpZXdTbG90LCBwcmV2aW91cykge1xyXG4gICAgcmV0dXJuIEFycmF5LmlzQXJyYXkocHJldmlvdXMpXHJcbiAgICAgICAgPyB2aWV3U2xvdC5yZW1vdmVNYW55KHByZXZpb3VzLCB0cnVlKVxyXG4gICAgICAgIDogdmlld1Nsb3QucmVtb3ZlKHByZXZpb3VzLCB0cnVlKTtcclxufVxyXG52YXIgU3dhcFN0cmF0ZWdpZXMgPSB7XHJcbiAgICBiZWZvcmU6IGZ1bmN0aW9uICh2aWV3U2xvdCwgcHJldmlvdXMsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgcmV0dXJuIChwcmV2aW91cyA9PT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICA/IGNhbGxiYWNrKClcclxuICAgICAgICAgICAgOiBjYWxsYmFjaygpLnRoZW4oZnVuY3Rpb24gKCkgeyByZXR1cm4gcmVtb3ZlKHZpZXdTbG90LCBwcmV2aW91cyk7IH0pO1xyXG4gICAgfSxcclxuICAgIHdpdGg6IGZ1bmN0aW9uICh2aWV3U2xvdCwgcHJldmlvdXMsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgcmV0dXJuIChwcmV2aW91cyA9PT0gdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICA/IGNhbGxiYWNrKClcclxuICAgICAgICAgICAgOiBQcm9taXNlLmFsbChbcmVtb3ZlKHZpZXdTbG90LCBwcmV2aW91cyksIGNhbGxiYWNrKCldKTtcclxuICAgIH0sXHJcbiAgICBhZnRlcjogZnVuY3Rpb24gKHZpZXdTbG90LCBwcmV2aW91cywgY2FsbGJhY2spIHtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHZpZXdTbG90LnJlbW92ZUFsbCh0cnVlKSkudGhlbihjYWxsYmFjayk7XHJcbiAgICB9XHJcbn07XG5cbmZ1bmN0aW9uIHRyeUFjdGl2YXRlVmlld01vZGVsKGNvbnRleHQpIHtcclxuICAgIGlmIChjb250ZXh0LnNraXBBY3RpdmF0aW9uIHx8IHR5cGVvZiBjb250ZXh0LnZpZXdNb2RlbC5hY3RpdmF0ZSAhPT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcclxuICAgIH1cclxuICAgIHJldHVybiBjb250ZXh0LnZpZXdNb2RlbC5hY3RpdmF0ZShjb250ZXh0Lm1vZGVsKSB8fCBQcm9taXNlLnJlc29sdmUoKTtcclxufVxyXG52YXIgQ29tcG9zaXRpb25FbmdpbmUgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gQ29tcG9zaXRpb25FbmdpbmUodmlld0VuZ2luZSwgdmlld0xvY2F0b3IpIHtcclxuICAgICAgICB0aGlzLnZpZXdFbmdpbmUgPSB2aWV3RW5naW5lO1xyXG4gICAgICAgIHRoaXMudmlld0xvY2F0b3IgPSB2aWV3TG9jYXRvcjtcclxuICAgIH1cclxuICAgIENvbXBvc2l0aW9uRW5naW5lLnByb3RvdHlwZS5fc3dhcCA9IGZ1bmN0aW9uIChjb250ZXh0LCB2aWV3KSB7XHJcbiAgICAgICAgdmFyIHN3YXBTdHJhdGVneSA9IFN3YXBTdHJhdGVnaWVzW2NvbnRleHQuc3dhcE9yZGVyXSB8fCBTd2FwU3RyYXRlZ2llcy5hZnRlcjtcclxuICAgICAgICB2YXIgcHJldmlvdXNWaWV3cyA9IGNvbnRleHQudmlld1Nsb3QuY2hpbGRyZW4uc2xpY2UoKTtcclxuICAgICAgICByZXR1cm4gc3dhcFN0cmF0ZWd5KGNvbnRleHQudmlld1Nsb3QsIHByZXZpb3VzVmlld3MsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShjb250ZXh0LnZpZXdTbG90LmFkZCh2aWV3KSkudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoY29udGV4dC5jdXJyZW50Q29udHJvbGxlcikge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRleHQuY3VycmVudENvbnRyb2xsZXIudW5iaW5kKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpZiAoY29udGV4dC5jb21wb3NpdGlvblRyYW5zYWN0aW9uTm90aWZpZXIpIHtcclxuICAgICAgICAgICAgICAgIGNvbnRleHQuY29tcG9zaXRpb25UcmFuc2FjdGlvbk5vdGlmaWVyLmRvbmUoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIENvbXBvc2l0aW9uRW5naW5lLnByb3RvdHlwZS5fY3JlYXRlQ29udHJvbGxlckFuZFN3YXAgPSBmdW5jdGlvbiAoY29udGV4dCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlQ29udHJvbGxlcihjb250ZXh0KS50aGVuKGZ1bmN0aW9uIChjb250cm9sbGVyKSB7XHJcbiAgICAgICAgICAgIGlmIChjb250ZXh0LmNvbXBvc2l0aW9uVHJhbnNhY3Rpb25Pd25lcnNoaXBUb2tlbikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbnRleHQuY29tcG9zaXRpb25UcmFuc2FjdGlvbk93bmVyc2hpcFRva2VuXHJcbiAgICAgICAgICAgICAgICAgICAgLndhaXRGb3JDb21wb3NpdGlvbkNvbXBsZXRlKClcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlci5hdXRvbWF0ZShjb250ZXh0Lm92ZXJyaWRlQ29udGV4dCwgY29udGV4dC5vd25pbmdWaWV3KTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMuX3N3YXAoY29udGV4dCwgY29udHJvbGxlci52aWV3KTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkgeyByZXR1cm4gY29udHJvbGxlcjsgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29udHJvbGxlci5hdXRvbWF0ZShjb250ZXh0Lm92ZXJyaWRlQ29udGV4dCwgY29udGV4dC5vd25pbmdWaWV3KTtcclxuICAgICAgICAgICAgcmV0dXJuIF90aGlzLl9zd2FwKGNvbnRleHQsIGNvbnRyb2xsZXIudmlldykudGhlbihmdW5jdGlvbiAoKSB7IHJldHVybiBjb250cm9sbGVyOyB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICBDb21wb3NpdGlvbkVuZ2luZS5wcm90b3R5cGUuY3JlYXRlQ29udHJvbGxlciA9IGZ1bmN0aW9uIChjb250ZXh0KSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICB2YXIgY2hpbGRDb250YWluZXI7XHJcbiAgICAgICAgdmFyIHZpZXdNb2RlbDtcclxuICAgICAgICB2YXIgdmlld01vZGVsUmVzb3VyY2U7XHJcbiAgICAgICAgdmFyIG07XHJcbiAgICAgICAgcmV0dXJuIHRoaXNcclxuICAgICAgICAgICAgLmVuc3VyZVZpZXdNb2RlbChjb250ZXh0KVxyXG4gICAgICAgICAgICAudGhlbih0cnlBY3RpdmF0ZVZpZXdNb2RlbClcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBjaGlsZENvbnRhaW5lciA9IGNvbnRleHQuY2hpbGRDb250YWluZXI7XHJcbiAgICAgICAgICAgIHZpZXdNb2RlbCA9IGNvbnRleHQudmlld01vZGVsO1xyXG4gICAgICAgICAgICB2aWV3TW9kZWxSZXNvdXJjZSA9IGNvbnRleHQudmlld01vZGVsUmVzb3VyY2U7XHJcbiAgICAgICAgICAgIG0gPSB2aWV3TW9kZWxSZXNvdXJjZS5tZXRhZGF0YTtcclxuICAgICAgICAgICAgdmFyIHZpZXdTdHJhdGVneSA9IF90aGlzLnZpZXdMb2NhdG9yLmdldFZpZXdTdHJhdGVneShjb250ZXh0LnZpZXcgfHwgdmlld01vZGVsKTtcclxuICAgICAgICAgICAgaWYgKGNvbnRleHQudmlld1Jlc291cmNlcykge1xyXG4gICAgICAgICAgICAgICAgdmlld1N0cmF0ZWd5Lm1ha2VSZWxhdGl2ZVRvKGNvbnRleHQudmlld1Jlc291cmNlcy52aWV3VXJsKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gbS5sb2FkKGNoaWxkQ29udGFpbmVyLCB2aWV3TW9kZWxSZXNvdXJjZS52YWx1ZSwgbnVsbCwgdmlld1N0cmF0ZWd5LCB0cnVlKTtcclxuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uICh2aWV3RmFjdG9yeSkgeyByZXR1cm4gbS5jcmVhdGUoY2hpbGRDb250YWluZXIsIEJlaGF2aW9ySW5zdHJ1Y3Rpb24uZHluYW1pYyhjb250ZXh0Lmhvc3QsIHZpZXdNb2RlbCwgdmlld0ZhY3RvcnkpKTsgfSk7XHJcbiAgICB9O1xyXG4gICAgQ29tcG9zaXRpb25FbmdpbmUucHJvdG90eXBlLmVuc3VyZVZpZXdNb2RlbCA9IGZ1bmN0aW9uIChjb250ZXh0KSB7XHJcbiAgICAgICAgdmFyIGNoaWxkQ29udGFpbmVyID0gY29udGV4dC5jaGlsZENvbnRhaW5lciA9IChjb250ZXh0LmNoaWxkQ29udGFpbmVyIHx8IGNvbnRleHQuY29udGFpbmVyLmNyZWF0ZUNoaWxkKCkpO1xyXG4gICAgICAgIGlmICh0eXBlb2YgY29udGV4dC52aWV3TW9kZWwgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgIGNvbnRleHQudmlld01vZGVsID0gY29udGV4dC52aWV3UmVzb3VyY2VzXHJcbiAgICAgICAgICAgICAgICA/IGNvbnRleHQudmlld1Jlc291cmNlcy5yZWxhdGl2ZVRvVmlldyhjb250ZXh0LnZpZXdNb2RlbClcclxuICAgICAgICAgICAgICAgIDogY29udGV4dC52aWV3TW9kZWw7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnZpZXdFbmdpbmUuaW1wb3J0Vmlld01vZGVsUmVzb3VyY2UoY29udGV4dC52aWV3TW9kZWwpLnRoZW4oZnVuY3Rpb24gKHZpZXdNb2RlbFJlc291cmNlKSB7XHJcbiAgICAgICAgICAgICAgICBjaGlsZENvbnRhaW5lci5hdXRvUmVnaXN0ZXIodmlld01vZGVsUmVzb3VyY2UudmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNvbnRleHQuaG9zdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNoaWxkQ29udGFpbmVyLnJlZ2lzdGVySW5zdGFuY2UoRE9NLkVsZW1lbnQsIGNvbnRleHQuaG9zdCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjb250ZXh0LnZpZXdNb2RlbCA9IGNoaWxkQ29udGFpbmVyLnZpZXdNb2RlbCA9IGNoaWxkQ29udGFpbmVyLmdldCh2aWV3TW9kZWxSZXNvdXJjZS52YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICBjb250ZXh0LnZpZXdNb2RlbFJlc291cmNlID0gdmlld01vZGVsUmVzb3VyY2U7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY29udGV4dDtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBjdG9yID0gY29udGV4dC52aWV3TW9kZWwuY29uc3RydWN0b3I7XHJcbiAgICAgICAgdmFyIGlzQ2xhc3MgPSB0eXBlb2YgY29udGV4dC52aWV3TW9kZWwgPT09ICdmdW5jdGlvbic7XHJcbiAgICAgICAgaWYgKGlzQ2xhc3MpIHtcclxuICAgICAgICAgICAgY3RvciA9IGNvbnRleHQudmlld01vZGVsO1xyXG4gICAgICAgICAgICBjaGlsZENvbnRhaW5lci5hdXRvUmVnaXN0ZXIoY3Rvcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBtID0gbWV0YWRhdGEuZ2V0T3JDcmVhdGVPd24obWV0YWRhdGEucmVzb3VyY2UsIEh0bWxCZWhhdmlvclJlc291cmNlLCBjdG9yKTtcclxuICAgICAgICBtLmVsZW1lbnROYW1lID0gbS5lbGVtZW50TmFtZSB8fCAnZHluYW1pYy1lbGVtZW50JztcclxuICAgICAgICBtLmluaXRpYWxpemUoaXNDbGFzcyA/IGNoaWxkQ29udGFpbmVyIDogKGNvbnRleHQuY29udGFpbmVyIHx8IGNoaWxkQ29udGFpbmVyKSwgY3Rvcik7XHJcbiAgICAgICAgY29udGV4dC52aWV3TW9kZWxSZXNvdXJjZSA9IHsgbWV0YWRhdGE6IG0sIHZhbHVlOiBjdG9yIH07XHJcbiAgICAgICAgaWYgKGNvbnRleHQuaG9zdCkge1xyXG4gICAgICAgICAgICBjaGlsZENvbnRhaW5lci5yZWdpc3Rlckluc3RhbmNlKERPTS5FbGVtZW50LCBjb250ZXh0Lmhvc3QpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjaGlsZENvbnRhaW5lci52aWV3TW9kZWwgPSBjb250ZXh0LnZpZXdNb2RlbCA9IGlzQ2xhc3MgPyBjaGlsZENvbnRhaW5lci5nZXQoY3RvcikgOiBjb250ZXh0LnZpZXdNb2RlbDtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGNvbnRleHQpO1xyXG4gICAgfTtcclxuICAgIENvbXBvc2l0aW9uRW5naW5lLnByb3RvdHlwZS5jb21wb3NlID0gZnVuY3Rpb24gKGNvbnRleHQpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIGNvbnRleHQuY2hpbGRDb250YWluZXIgPSBjb250ZXh0LmNoaWxkQ29udGFpbmVyIHx8IGNvbnRleHQuY29udGFpbmVyLmNyZWF0ZUNoaWxkKCk7XHJcbiAgICAgICAgY29udGV4dC52aWV3ID0gdGhpcy52aWV3TG9jYXRvci5nZXRWaWV3U3RyYXRlZ3koY29udGV4dC52aWV3KTtcclxuICAgICAgICB2YXIgdHJhbnNhY3Rpb24gPSBjb250ZXh0LmNoaWxkQ29udGFpbmVyLmdldChDb21wb3NpdGlvblRyYW5zYWN0aW9uKTtcclxuICAgICAgICB2YXIgY29tcG9zaXRpb25UcmFuc2FjdGlvbk93bmVyc2hpcFRva2VuID0gdHJhbnNhY3Rpb24udHJ5Q2FwdHVyZSgpO1xyXG4gICAgICAgIGlmIChjb21wb3NpdGlvblRyYW5zYWN0aW9uT3duZXJzaGlwVG9rZW4pIHtcclxuICAgICAgICAgICAgY29udGV4dC5jb21wb3NpdGlvblRyYW5zYWN0aW9uT3duZXJzaGlwVG9rZW4gPSBjb21wb3NpdGlvblRyYW5zYWN0aW9uT3duZXJzaGlwVG9rZW47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBjb250ZXh0LmNvbXBvc2l0aW9uVHJhbnNhY3Rpb25Ob3RpZmllciA9IHRyYW5zYWN0aW9uLmVubGlzdCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoY29udGV4dC52aWV3TW9kZWwpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NyZWF0ZUNvbnRyb2xsZXJBbmRTd2FwKGNvbnRleHQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChjb250ZXh0LnZpZXcpIHtcclxuICAgICAgICAgICAgaWYgKGNvbnRleHQudmlld1Jlc291cmNlcykge1xyXG4gICAgICAgICAgICAgICAgY29udGV4dC52aWV3Lm1ha2VSZWxhdGl2ZVRvKGNvbnRleHQudmlld1Jlc291cmNlcy52aWV3VXJsKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gY29udGV4dC52aWV3LmxvYWRWaWV3RmFjdG9yeSh0aGlzLnZpZXdFbmdpbmUsIG5ldyBWaWV3Q29tcGlsZUluc3RydWN0aW9uKCkpLnRoZW4oZnVuY3Rpb24gKHZpZXdGYWN0b3J5KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gdmlld0ZhY3RvcnkuY3JlYXRlKGNvbnRleHQuY2hpbGRDb250YWluZXIpO1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0LmJpbmQoY29udGV4dC5iaW5kaW5nQ29udGV4dCwgY29udGV4dC5vdmVycmlkZUNvbnRleHQpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNvbnRleHQuY29tcG9zaXRpb25UcmFuc2FjdGlvbk93bmVyc2hpcFRva2VuKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbnRleHQuY29tcG9zaXRpb25UcmFuc2FjdGlvbk93bmVyc2hpcFRva2VuLndhaXRGb3JDb21wb3NpdGlvbkNvbXBsZXRlKClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuX3N3YXAoY29udGV4dCwgcmVzdWx0KTsgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkgeyByZXR1cm4gcmVzdWx0OyB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5fc3dhcChjb250ZXh0LCByZXN1bHQpLnRoZW4oZnVuY3Rpb24gKCkgeyByZXR1cm4gcmVzdWx0OyB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKGNvbnRleHQudmlld1Nsb3QpIHtcclxuICAgICAgICAgICAgY29udGV4dC52aWV3U2xvdC5yZW1vdmVBbGwoKTtcclxuICAgICAgICAgICAgaWYgKGNvbnRleHQuY29tcG9zaXRpb25UcmFuc2FjdGlvbk5vdGlmaWVyKSB7XHJcbiAgICAgICAgICAgICAgICBjb250ZXh0LmNvbXBvc2l0aW9uVHJhbnNhY3Rpb25Ob3RpZmllci5kb25lKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShudWxsKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShudWxsKTtcclxuICAgIH07XHJcbiAgICBDb21wb3NpdGlvbkVuZ2luZSA9IF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIGluamVjdChWaWV3RW5naW5lLCBWaWV3TG9jYXRvcilcclxuICAgIF0sIENvbXBvc2l0aW9uRW5naW5lKTtcclxuICAgIHJldHVybiBDb21wb3NpdGlvbkVuZ2luZTtcclxufSgpKTtcblxudmFyIGFuaW1hdGlvbkV2ZW50ID0ge1xyXG4gICAgZW50ZXJCZWdpbjogJ2FuaW1hdGlvbjplbnRlcjpiZWdpbicsXHJcbiAgICBlbnRlckFjdGl2ZTogJ2FuaW1hdGlvbjplbnRlcjphY3RpdmUnLFxyXG4gICAgZW50ZXJEb25lOiAnYW5pbWF0aW9uOmVudGVyOmRvbmUnLFxyXG4gICAgZW50ZXJUaW1lb3V0OiAnYW5pbWF0aW9uOmVudGVyOnRpbWVvdXQnLFxyXG4gICAgbGVhdmVCZWdpbjogJ2FuaW1hdGlvbjpsZWF2ZTpiZWdpbicsXHJcbiAgICBsZWF2ZUFjdGl2ZTogJ2FuaW1hdGlvbjpsZWF2ZTphY3RpdmUnLFxyXG4gICAgbGVhdmVEb25lOiAnYW5pbWF0aW9uOmxlYXZlOmRvbmUnLFxyXG4gICAgbGVhdmVUaW1lb3V0OiAnYW5pbWF0aW9uOmxlYXZlOnRpbWVvdXQnLFxyXG4gICAgc3RhZ2dlck5leHQ6ICdhbmltYXRpb246c3RhZ2dlcjpuZXh0JyxcclxuICAgIHJlbW92ZUNsYXNzQmVnaW46ICdhbmltYXRpb246cmVtb3ZlLWNsYXNzOmJlZ2luJyxcclxuICAgIHJlbW92ZUNsYXNzQWN0aXZlOiAnYW5pbWF0aW9uOnJlbW92ZS1jbGFzczphY3RpdmUnLFxyXG4gICAgcmVtb3ZlQ2xhc3NEb25lOiAnYW5pbWF0aW9uOnJlbW92ZS1jbGFzczpkb25lJyxcclxuICAgIHJlbW92ZUNsYXNzVGltZW91dDogJ2FuaW1hdGlvbjpyZW1vdmUtY2xhc3M6dGltZW91dCcsXHJcbiAgICBhZGRDbGFzc0JlZ2luOiAnYW5pbWF0aW9uOmFkZC1jbGFzczpiZWdpbicsXHJcbiAgICBhZGRDbGFzc0FjdGl2ZTogJ2FuaW1hdGlvbjphZGQtY2xhc3M6YWN0aXZlJyxcclxuICAgIGFkZENsYXNzRG9uZTogJ2FuaW1hdGlvbjphZGQtY2xhc3M6ZG9uZScsXHJcbiAgICBhZGRDbGFzc1RpbWVvdXQ6ICdhbmltYXRpb246YWRkLWNsYXNzOnRpbWVvdXQnLFxyXG4gICAgYW5pbWF0ZUJlZ2luOiAnYW5pbWF0aW9uOmFuaW1hdGU6YmVnaW4nLFxyXG4gICAgYW5pbWF0ZUFjdGl2ZTogJ2FuaW1hdGlvbjphbmltYXRlOmFjdGl2ZScsXHJcbiAgICBhbmltYXRlRG9uZTogJ2FuaW1hdGlvbjphbmltYXRlOmRvbmUnLFxyXG4gICAgYW5pbWF0ZVRpbWVvdXQ6ICdhbmltYXRpb246YW5pbWF0ZTp0aW1lb3V0JyxcclxuICAgIHNlcXVlbmNlQmVnaW46ICdhbmltYXRpb246c2VxdWVuY2U6YmVnaW4nLFxyXG4gICAgc2VxdWVuY2VEb25lOiAnYW5pbWF0aW9uOnNlcXVlbmNlOmRvbmUnXHJcbn07XG5cbmZ1bmN0aW9uIGNyZWF0ZUNoaWxkT2JzZXJ2ZXJEZWNvcmF0b3Ioc2VsZWN0b3JPckNvbmZpZywgYWxsKSB7XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKHRhcmdldCwga2V5LCBkZXNjcmlwdG9yKSB7XHJcbiAgICAgICAgdmFyIGFjdHVhbFRhcmdldCA9IHR5cGVvZiBrZXkgPT09ICdzdHJpbmcnID8gdGFyZ2V0LmNvbnN0cnVjdG9yIDogdGFyZ2V0O1xyXG4gICAgICAgIHZhciByID0gbWV0YWRhdGEuZ2V0T3JDcmVhdGVPd24obWV0YWRhdGEucmVzb3VyY2UsIEh0bWxCZWhhdmlvclJlc291cmNlLCBhY3R1YWxUYXJnZXQpO1xyXG4gICAgICAgIGlmICh0eXBlb2Ygc2VsZWN0b3JPckNvbmZpZyA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgc2VsZWN0b3JPckNvbmZpZyA9IHtcclxuICAgICAgICAgICAgICAgIHNlbGVjdG9yOiBzZWxlY3Rvck9yQ29uZmlnLFxyXG4gICAgICAgICAgICAgICAgbmFtZToga2V5XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChkZXNjcmlwdG9yKSB7XHJcbiAgICAgICAgICAgIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlO1xyXG4gICAgICAgICAgICBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHNlbGVjdG9yT3JDb25maWcuYWxsID0gYWxsO1xyXG4gICAgICAgIHIuYWRkQ2hpbGRCaW5kaW5nKG5ldyBDaGlsZE9ic2VydmVyKHNlbGVjdG9yT3JDb25maWcpKTtcclxuICAgIH07XHJcbn1cclxuZnVuY3Rpb24gY2hpbGRyZW4oc2VsZWN0b3JPckNvbmZpZykge1xyXG4gICAgcmV0dXJuIGNyZWF0ZUNoaWxkT2JzZXJ2ZXJEZWNvcmF0b3Ioc2VsZWN0b3JPckNvbmZpZywgdHJ1ZSk7XHJcbn1cclxuZnVuY3Rpb24gY2hpbGQoc2VsZWN0b3JPckNvbmZpZykge1xyXG4gICAgcmV0dXJuIGNyZWF0ZUNoaWxkT2JzZXJ2ZXJEZWNvcmF0b3Ioc2VsZWN0b3JPckNvbmZpZywgZmFsc2UpO1xyXG59XHJcbnZhciBDaGlsZE9ic2VydmVyID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIENoaWxkT2JzZXJ2ZXIoY29uZmlnKSB7XHJcbiAgICAgICAgdGhpcy5uYW1lID0gY29uZmlnLm5hbWU7XHJcbiAgICAgICAgdGhpcy5jaGFuZ2VIYW5kbGVyID0gY29uZmlnLmNoYW5nZUhhbmRsZXIgfHwgdGhpcy5uYW1lICsgJ0NoYW5nZWQnO1xyXG4gICAgICAgIHRoaXMuc2VsZWN0b3IgPSBjb25maWcuc2VsZWN0b3I7XHJcbiAgICAgICAgdGhpcy5hbGwgPSBjb25maWcuYWxsO1xyXG4gICAgfVxyXG4gICAgQ2hpbGRPYnNlcnZlci5wcm90b3R5cGUuY3JlYXRlID0gZnVuY3Rpb24gKHZpZXdIb3N0LCB2aWV3TW9kZWwsIGNvbnRyb2xsZXIpIHtcclxuICAgICAgICByZXR1cm4gbmV3IENoaWxkT2JzZXJ2ZXJCaW5kZXIodGhpcy5zZWxlY3Rvciwgdmlld0hvc3QsIHRoaXMubmFtZSwgdmlld01vZGVsLCBjb250cm9sbGVyLCB0aGlzLmNoYW5nZUhhbmRsZXIsIHRoaXMuYWxsKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gQ2hpbGRPYnNlcnZlcjtcclxufSgpKTtcclxudmFyIG5vTXV0YXRpb25zID0gW107XHJcbmZ1bmN0aW9uIHRyYWNrTXV0YXRpb24oZ3JvdXBlZE11dGF0aW9ucywgYmluZGVyLCByZWNvcmQpIHtcclxuICAgIHZhciBtdXRhdGlvbnMgPSBncm91cGVkTXV0YXRpb25zLmdldChiaW5kZXIpO1xyXG4gICAgaWYgKCFtdXRhdGlvbnMpIHtcclxuICAgICAgICBtdXRhdGlvbnMgPSBbXTtcclxuICAgICAgICBncm91cGVkTXV0YXRpb25zLnNldChiaW5kZXIsIG11dGF0aW9ucyk7XHJcbiAgICB9XHJcbiAgICBtdXRhdGlvbnMucHVzaChyZWNvcmQpO1xyXG59XHJcbmZ1bmN0aW9uIG9uQ2hpbGRDaGFuZ2UobXV0YXRpb25zLCBvYnNlcnZlcikge1xyXG4gICAgdmFyIGJpbmRlcnMgPSBvYnNlcnZlci5iaW5kZXJzO1xyXG4gICAgdmFyIGJpbmRlcnNMZW5ndGggPSBiaW5kZXJzLmxlbmd0aDtcclxuICAgIHZhciBncm91cGVkTXV0YXRpb25zID0gbmV3IE1hcCgpO1xyXG4gICAgZm9yICh2YXIgaSA9IDAsIGlpID0gbXV0YXRpb25zLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICB2YXIgcmVjb3JkID0gbXV0YXRpb25zW2ldO1xyXG4gICAgICAgIHZhciBhZGRlZCA9IHJlY29yZC5hZGRlZE5vZGVzO1xyXG4gICAgICAgIHZhciByZW1vdmVkID0gcmVjb3JkLnJlbW92ZWROb2RlcztcclxuICAgICAgICBmb3IgKHZhciBqID0gMCwgamogPSByZW1vdmVkLmxlbmd0aDsgaiA8IGpqOyArK2opIHtcclxuICAgICAgICAgICAgdmFyIG5vZGUgPSByZW1vdmVkW2pdO1xyXG4gICAgICAgICAgICBpZiAobm9kZS5ub2RlVHlwZSA9PT0gMSkge1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgayA9IDA7IGsgPCBiaW5kZXJzTGVuZ3RoOyArK2spIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgYmluZGVyID0gYmluZGVyc1trXTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoYmluZGVyLm9uUmVtb3ZlKG5vZGUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRyYWNrTXV0YXRpb24oZ3JvdXBlZE11dGF0aW9ucywgYmluZGVyLCByZWNvcmQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBmb3IgKHZhciBqID0gMCwgamogPSBhZGRlZC5sZW5ndGg7IGogPCBqajsgKytqKSB7XHJcbiAgICAgICAgICAgIHZhciBub2RlID0gYWRkZWRbal07XHJcbiAgICAgICAgICAgIGlmIChub2RlLm5vZGVUeXBlID09PSAxKSB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBrID0gMDsgayA8IGJpbmRlcnNMZW5ndGg7ICsraykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBiaW5kZXIgPSBiaW5kZXJzW2tdO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChiaW5kZXIub25BZGQobm9kZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHJhY2tNdXRhdGlvbihncm91cGVkTXV0YXRpb25zLCBiaW5kZXIsIHJlY29yZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgZ3JvdXBlZE11dGF0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uIChtdXRhdGlvblJlY29yZHMsIGJpbmRlcikge1xyXG4gICAgICAgIGlmIChiaW5kZXIuaXNCb3VuZCAmJiBiaW5kZXIuY2hhbmdlSGFuZGxlciAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICBiaW5kZXIudmlld01vZGVsW2JpbmRlci5jaGFuZ2VIYW5kbGVyXShtdXRhdGlvblJlY29yZHMpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG59XHJcbnZhciBDaGlsZE9ic2VydmVyQmluZGVyID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIENoaWxkT2JzZXJ2ZXJCaW5kZXIoc2VsZWN0b3IsIHZpZXdIb3N0LCBwcm9wZXJ0eSwgdmlld01vZGVsLCBjb250cm9sbGVyLCBjaGFuZ2VIYW5kbGVyLCBhbGwpIHtcclxuICAgICAgICB0aGlzLnNlbGVjdG9yID0gc2VsZWN0b3I7XHJcbiAgICAgICAgdGhpcy52aWV3SG9zdCA9IHZpZXdIb3N0O1xyXG4gICAgICAgIHRoaXMucHJvcGVydHkgPSBwcm9wZXJ0eTtcclxuICAgICAgICB0aGlzLnZpZXdNb2RlbCA9IHZpZXdNb2RlbDtcclxuICAgICAgICB0aGlzLmNvbnRyb2xsZXIgPSBjb250cm9sbGVyO1xyXG4gICAgICAgIHRoaXMuY2hhbmdlSGFuZGxlciA9IGNoYW5nZUhhbmRsZXIgaW4gdmlld01vZGVsID8gY2hhbmdlSGFuZGxlciA6IG51bGw7XHJcbiAgICAgICAgdGhpcy51c2VzU2hhZG93RE9NID0gY29udHJvbGxlci5iZWhhdmlvci51c2VzU2hhZG93RE9NO1xyXG4gICAgICAgIHRoaXMuYWxsID0gYWxsO1xyXG4gICAgICAgIGlmICghdGhpcy51c2VzU2hhZG93RE9NICYmIGNvbnRyb2xsZXIudmlldyAmJiBjb250cm9sbGVyLnZpZXcuY29udGVudFZpZXcpIHtcclxuICAgICAgICAgICAgdGhpcy5jb250ZW50VmlldyA9IGNvbnRyb2xsZXIudmlldy5jb250ZW50VmlldztcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29udGVudFZpZXcgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnNvdXJjZSA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5pc0JvdW5kID0gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBDaGlsZE9ic2VydmVyQmluZGVyLnByb3RvdHlwZS5tYXRjaGVzID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcclxuICAgICAgICBpZiAoZWxlbWVudC5tYXRjaGVzKHRoaXMuc2VsZWN0b3IpKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmNvbnRlbnRWaWV3ID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgY29udGVudFZpZXcgPSB0aGlzLmNvbnRlbnRWaWV3O1xyXG4gICAgICAgICAgICB2YXIgYXNzaWduZWRTbG90ID0gZWxlbWVudC5hdUFzc2lnbmVkU2xvdDtcclxuICAgICAgICAgICAgaWYgKGFzc2lnbmVkU2xvdCAmJiBhc3NpZ25lZFNsb3QucHJvamVjdEZyb21BbmNob3JzKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYW5jaG9ycyA9IGFzc2lnbmVkU2xvdC5wcm9qZWN0RnJvbUFuY2hvcnM7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBhbmNob3JzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoYW5jaG9yc1tpXS5hdU93bmVyVmlldyA9PT0gY29udGVudFZpZXcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBlbGVtZW50LmF1T3duZXJWaWV3ID09PSBjb250ZW50VmlldztcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfTtcclxuICAgIENoaWxkT2JzZXJ2ZXJCaW5kZXIucHJvdG90eXBlLmJpbmQgPSBmdW5jdGlvbiAoc291cmNlKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNCb3VuZCkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5zb3VyY2UgPT09IHNvdXJjZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuc291cmNlID0gc291cmNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmlzQm91bmQgPSB0cnVlO1xyXG4gICAgICAgIHZhciB2aWV3SG9zdCA9IHRoaXMudmlld0hvc3Q7XHJcbiAgICAgICAgdmFyIHZpZXdNb2RlbCA9IHRoaXMudmlld01vZGVsO1xyXG4gICAgICAgIHZhciBvYnNlcnZlciA9IHZpZXdIb3N0Ll9fY2hpbGRPYnNlcnZlcl9fO1xyXG4gICAgICAgIGlmICghb2JzZXJ2ZXIpIHtcclxuICAgICAgICAgICAgb2JzZXJ2ZXIgPSB2aWV3SG9zdC5fX2NoaWxkT2JzZXJ2ZXJfXyA9IERPTS5jcmVhdGVNdXRhdGlvbk9ic2VydmVyKG9uQ2hpbGRDaGFuZ2UpO1xyXG4gICAgICAgICAgICB2YXIgb3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgICAgIGNoaWxkTGlzdDogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIHN1YnRyZWU6ICF0aGlzLnVzZXNTaGFkb3dET01cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgb2JzZXJ2ZXIub2JzZXJ2ZSh2aWV3SG9zdCwgb3B0aW9ucyk7XHJcbiAgICAgICAgICAgIG9ic2VydmVyLmJpbmRlcnMgPSBbXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgb2JzZXJ2ZXIuYmluZGVycy5wdXNoKHRoaXMpO1xyXG4gICAgICAgIGlmICh0aGlzLnVzZXNTaGFkb3dET00pIHtcclxuICAgICAgICAgICAgdmFyIGN1cnJlbnQgPSB2aWV3SG9zdC5maXJzdEVsZW1lbnRDaGlsZDtcclxuICAgICAgICAgICAgaWYgKHRoaXMuYWxsKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaXRlbXMgPSB2aWV3TW9kZWxbdGhpcy5wcm9wZXJ0eV07XHJcbiAgICAgICAgICAgICAgICBpZiAoIWl0ZW1zKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbXMgPSB2aWV3TW9kZWxbdGhpcy5wcm9wZXJ0eV0gPSBbXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW1zLnNwbGljZSgwKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHdoaWxlIChjdXJyZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMubWF0Y2hlcyhjdXJyZW50KSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpdGVtcy5wdXNoKGN1cnJlbnQuYXUgJiYgY3VycmVudC5hdS5jb250cm9sbGVyID8gY3VycmVudC5hdS5jb250cm9sbGVyLnZpZXdNb2RlbCA6IGN1cnJlbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50ID0gY3VycmVudC5uZXh0RWxlbWVudFNpYmxpbmc7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jaGFuZ2VIYW5kbGVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy52aWV3TW9kZWxbdGhpcy5jaGFuZ2VIYW5kbGVyXShub011dGF0aW9ucyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB3aGlsZSAoY3VycmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm1hdGNoZXMoY3VycmVudCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gY3VycmVudC5hdSAmJiBjdXJyZW50LmF1LmNvbnRyb2xsZXIgPyBjdXJyZW50LmF1LmNvbnRyb2xsZXIudmlld01vZGVsIDogY3VycmVudDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52aWV3TW9kZWxbdGhpcy5wcm9wZXJ0eV0gPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuY2hhbmdlSGFuZGxlciAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy52aWV3TW9kZWxbdGhpcy5jaGFuZ2VIYW5kbGVyXSh2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnQgPSBjdXJyZW50Lm5leHRFbGVtZW50U2libGluZztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBDaGlsZE9ic2VydmVyQmluZGVyLnByb3RvdHlwZS5vblJlbW92ZSA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XHJcbiAgICAgICAgaWYgKHRoaXMubWF0Y2hlcyhlbGVtZW50KSkge1xyXG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBlbGVtZW50LmF1ICYmIGVsZW1lbnQuYXUuY29udHJvbGxlciA/IGVsZW1lbnQuYXUuY29udHJvbGxlci52aWV3TW9kZWwgOiBlbGVtZW50O1xyXG4gICAgICAgICAgICBpZiAodGhpcy5hbGwpIHtcclxuICAgICAgICAgICAgICAgIHZhciBpdGVtcyA9ICh0aGlzLnZpZXdNb2RlbFt0aGlzLnByb3BlcnR5XSB8fCAodGhpcy52aWV3TW9kZWxbdGhpcy5wcm9wZXJ0eV0gPSBbXSkpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGluZGV4ID0gaXRlbXMuaW5kZXhPZih2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoaW5kZXggIT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbXMuc3BsaWNlKGluZGV4LCAxKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBjdXJyZW50VmFsdWUgPSB0aGlzLnZpZXdNb2RlbFt0aGlzLnByb3BlcnR5XTtcclxuICAgICAgICAgICAgaWYgKGN1cnJlbnRWYWx1ZSA9PT0gdmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudmlld01vZGVsW3RoaXMucHJvcGVydHldID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzQm91bmQgJiYgdGhpcy5jaGFuZ2VIYW5kbGVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy52aWV3TW9kZWxbdGhpcy5jaGFuZ2VIYW5kbGVyXSh2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfTtcclxuICAgIENoaWxkT2JzZXJ2ZXJCaW5kZXIucHJvdG90eXBlLm9uQWRkID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcclxuICAgICAgICBpZiAodGhpcy5tYXRjaGVzKGVsZW1lbnQpKSB7XHJcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGVsZW1lbnQuYXUgJiYgZWxlbWVudC5hdS5jb250cm9sbGVyID8gZWxlbWVudC5hdS5jb250cm9sbGVyLnZpZXdNb2RlbCA6IGVsZW1lbnQ7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmFsbCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGl0ZW1zID0gKHRoaXMudmlld01vZGVsW3RoaXMucHJvcGVydHldIHx8ICh0aGlzLnZpZXdNb2RlbFt0aGlzLnByb3BlcnR5XSA9IFtdKSk7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zZWxlY3RvciA9PT0gJyonKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbXMucHVzaCh2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSAwO1xyXG4gICAgICAgICAgICAgICAgdmFyIHByZXYgPSBlbGVtZW50LnByZXZpb3VzRWxlbWVudFNpYmxpbmc7XHJcbiAgICAgICAgICAgICAgICB3aGlsZSAocHJldikge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm1hdGNoZXMocHJldikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXgrKztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgcHJldiA9IHByZXYucHJldmlvdXNFbGVtZW50U2libGluZztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGl0ZW1zLnNwbGljZShpbmRleCwgMCwgdmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy52aWV3TW9kZWxbdGhpcy5wcm9wZXJ0eV0gPSB2YWx1ZTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuaXNCb3VuZCAmJiB0aGlzLmNoYW5nZUhhbmRsZXIgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudmlld01vZGVsW3RoaXMuY2hhbmdlSGFuZGxlcl0odmFsdWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH07XHJcbiAgICBDaGlsZE9ic2VydmVyQmluZGVyLnByb3RvdHlwZS51bmJpbmQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmlzQm91bmQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmlzQm91bmQgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLnNvdXJjZSA9IG51bGw7XHJcbiAgICAgICAgdmFyIGNoaWxkT2JzZXJ2ZXIgPSB0aGlzLnZpZXdIb3N0Ll9fY2hpbGRPYnNlcnZlcl9fO1xyXG4gICAgICAgIGlmIChjaGlsZE9ic2VydmVyKSB7XHJcbiAgICAgICAgICAgIHZhciBiaW5kZXJzID0gY2hpbGRPYnNlcnZlci5iaW5kZXJzO1xyXG4gICAgICAgICAgICBpZiAoYmluZGVycyAmJiBiaW5kZXJzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGlkeCA9IGJpbmRlcnMuaW5kZXhPZih0aGlzKTtcclxuICAgICAgICAgICAgICAgIGlmIChpZHggIT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYmluZGVycy5zcGxpY2UoaWR4LCAxKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChiaW5kZXJzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNoaWxkT2JzZXJ2ZXIuZGlzY29ubmVjdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudmlld0hvc3QuX19jaGlsZE9ic2VydmVyX18gPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnVzZXNTaGFkb3dET00pIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudmlld01vZGVsW3RoaXMucHJvcGVydHldID0gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICByZXR1cm4gQ2hpbGRPYnNlcnZlckJpbmRlcjtcclxufSgpKTtcblxudmFyIEVsZW1lbnRDb25maWdSZXNvdXJjZSA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBFbGVtZW50Q29uZmlnUmVzb3VyY2UoKSB7XHJcbiAgICB9XHJcbiAgICBFbGVtZW50Q29uZmlnUmVzb3VyY2UucHJvdG90eXBlLmluaXRpYWxpemUgPSBmdW5jdGlvbiAoY29udGFpbmVyLCB0YXJnZXQpIHsgfTtcclxuICAgIEVsZW1lbnRDb25maWdSZXNvdXJjZS5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAocmVnaXN0cnksIG5hbWUpIHsgfTtcclxuICAgIEVsZW1lbnRDb25maWdSZXNvdXJjZS5wcm90b3R5cGUubG9hZCA9IGZ1bmN0aW9uIChjb250YWluZXIsIHRhcmdldCkge1xyXG4gICAgICAgIHZhciBjb25maWcgPSBuZXcgdGFyZ2V0KCk7XHJcbiAgICAgICAgdmFyIGV2ZW50TWFuYWdlciA9IGNvbnRhaW5lci5nZXQoRXZlbnRNYW5hZ2VyKTtcclxuICAgICAgICBldmVudE1hbmFnZXIucmVnaXN0ZXJFbGVtZW50Q29uZmlnKGNvbmZpZyk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIEVsZW1lbnRDb25maWdSZXNvdXJjZTtcclxufSgpKTtcblxuZnVuY3Rpb24gcmVzb3VyY2UoaW5zdGFuY2VPckNvbmZpZykge1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uICh0YXJnZXQpIHtcclxuICAgICAgICB2YXIgaXNDb25maWcgPSB0eXBlb2YgaW5zdGFuY2VPckNvbmZpZyA9PT0gJ3N0cmluZycgfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKGluc3RhbmNlT3JDb25maWcpID09PSBPYmplY3QucHJvdG90eXBlO1xyXG4gICAgICAgIGlmIChpc0NvbmZpZykge1xyXG4gICAgICAgICAgICB0YXJnZXQuJHJlc291cmNlID0gaW5zdGFuY2VPckNvbmZpZztcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIG1ldGFkYXRhLmRlZmluZShtZXRhZGF0YS5yZXNvdXJjZSwgaW5zdGFuY2VPckNvbmZpZywgdGFyZ2V0KTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG59XHJcbmZ1bmN0aW9uIGJlaGF2aW9yKG92ZXJyaWRlKSB7XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKHRhcmdldCkge1xyXG4gICAgICAgIGlmIChvdmVycmlkZSBpbnN0YW5jZW9mIEh0bWxCZWhhdmlvclJlc291cmNlKSB7XHJcbiAgICAgICAgICAgIG1ldGFkYXRhLmRlZmluZShtZXRhZGF0YS5yZXNvdXJjZSwgb3ZlcnJpZGUsIHRhcmdldCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB2YXIgciA9IG1ldGFkYXRhLmdldE9yQ3JlYXRlT3duKG1ldGFkYXRhLnJlc291cmNlLCBIdG1sQmVoYXZpb3JSZXNvdXJjZSwgdGFyZ2V0KTtcclxuICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihyLCBvdmVycmlkZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxufVxyXG5mdW5jdGlvbiBjdXN0b21FbGVtZW50KG5hbWUpIHtcclxuICAgIHJldHVybiBmdW5jdGlvbiAodGFyZ2V0KSB7XHJcbiAgICAgICAgdmFyIHIgPSBtZXRhZGF0YS5nZXRPckNyZWF0ZU93bihtZXRhZGF0YS5yZXNvdXJjZSwgSHRtbEJlaGF2aW9yUmVzb3VyY2UsIHRhcmdldCk7XHJcbiAgICAgICAgci5lbGVtZW50TmFtZSA9IHZhbGlkYXRlQmVoYXZpb3JOYW1lKG5hbWUsICdjdXN0b20gZWxlbWVudCcpO1xyXG4gICAgfTtcclxufVxyXG5mdW5jdGlvbiBjdXN0b21BdHRyaWJ1dGUobmFtZSwgZGVmYXVsdEJpbmRpbmdNb2RlLCBhbGlhc2VzKSB7XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKHRhcmdldCkge1xyXG4gICAgICAgIHZhciByID0gbWV0YWRhdGEuZ2V0T3JDcmVhdGVPd24obWV0YWRhdGEucmVzb3VyY2UsIEh0bWxCZWhhdmlvclJlc291cmNlLCB0YXJnZXQpO1xyXG4gICAgICAgIHIuYXR0cmlidXRlTmFtZSA9IHZhbGlkYXRlQmVoYXZpb3JOYW1lKG5hbWUsICdjdXN0b20gYXR0cmlidXRlJyk7XHJcbiAgICAgICAgci5hdHRyaWJ1dGVEZWZhdWx0QmluZGluZ01vZGUgPSBkZWZhdWx0QmluZGluZ01vZGU7XHJcbiAgICAgICAgci5hbGlhc2VzID0gYWxpYXNlcztcclxuICAgIH07XHJcbn1cclxuZnVuY3Rpb24gdGVtcGxhdGVDb250cm9sbGVyKHRhcmdldCkge1xyXG4gICAgdmFyIGRlY28gPSBmdW5jdGlvbiAodCkge1xyXG4gICAgICAgIHZhciByID0gbWV0YWRhdGEuZ2V0T3JDcmVhdGVPd24obWV0YWRhdGEucmVzb3VyY2UsIEh0bWxCZWhhdmlvclJlc291cmNlLCB0KTtcclxuICAgICAgICByLmxpZnRzQ29udGVudCA9IHRydWU7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIHRhcmdldCA/IGRlY28odGFyZ2V0KSA6IGRlY287XHJcbn1cclxuZnVuY3Rpb24gYmluZGFibGUobmFtZU9yQ29uZmlnT3JUYXJnZXQsIGtleSwgZGVzY3JpcHRvcikge1xyXG4gICAgdmFyIGRlY28gPSBmdW5jdGlvbiAodGFyZ2V0LCBrZXkyLCBkZXNjcmlwdG9yMikge1xyXG4gICAgICAgIHZhciBhY3R1YWxUYXJnZXQgPSBrZXkyID8gdGFyZ2V0LmNvbnN0cnVjdG9yIDogdGFyZ2V0O1xyXG4gICAgICAgIHZhciByID0gbWV0YWRhdGEuZ2V0T3JDcmVhdGVPd24obWV0YWRhdGEucmVzb3VyY2UsIEh0bWxCZWhhdmlvclJlc291cmNlLCBhY3R1YWxUYXJnZXQpO1xyXG4gICAgICAgIHZhciBwcm9wO1xyXG4gICAgICAgIGlmIChrZXkyKSB7XHJcbiAgICAgICAgICAgIG5hbWVPckNvbmZpZ09yVGFyZ2V0ID0gbmFtZU9yQ29uZmlnT3JUYXJnZXQgfHwge307XHJcbiAgICAgICAgICAgIG5hbWVPckNvbmZpZ09yVGFyZ2V0Lm5hbWUgPSBrZXkyO1xyXG4gICAgICAgIH1cclxuICAgICAgICBwcm9wID0gbmV3IEJpbmRhYmxlUHJvcGVydHkobmFtZU9yQ29uZmlnT3JUYXJnZXQpO1xyXG4gICAgICAgIHJldHVybiBwcm9wLnJlZ2lzdGVyV2l0aChhY3R1YWxUYXJnZXQsIHIsIGRlc2NyaXB0b3IyKTtcclxuICAgIH07XHJcbiAgICBpZiAoIW5hbWVPckNvbmZpZ09yVGFyZ2V0KSB7XHJcbiAgICAgICAgcmV0dXJuIGRlY287XHJcbiAgICB9XHJcbiAgICBpZiAoa2V5KSB7XHJcbiAgICAgICAgdmFyIHRhcmdldCA9IG5hbWVPckNvbmZpZ09yVGFyZ2V0O1xyXG4gICAgICAgIG5hbWVPckNvbmZpZ09yVGFyZ2V0ID0gbnVsbDtcclxuICAgICAgICByZXR1cm4gZGVjbyh0YXJnZXQsIGtleSwgZGVzY3JpcHRvcik7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZGVjbztcclxufVxyXG5mdW5jdGlvbiBkeW5hbWljT3B0aW9ucyh0YXJnZXQpIHtcclxuICAgIHZhciBkZWNvID0gZnVuY3Rpb24gKHQpIHtcclxuICAgICAgICB2YXIgciA9IG1ldGFkYXRhLmdldE9yQ3JlYXRlT3duKG1ldGFkYXRhLnJlc291cmNlLCBIdG1sQmVoYXZpb3JSZXNvdXJjZSwgdCk7XHJcbiAgICAgICAgci5oYXNEeW5hbWljT3B0aW9ucyA9IHRydWU7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIHRhcmdldCA/IGRlY28odGFyZ2V0KSA6IGRlY287XHJcbn1cclxudmFyIGRlZmF1bHRTaGFkb3dET01PcHRpb25zID0geyBtb2RlOiAnb3BlbicgfTtcclxuZnVuY3Rpb24gdXNlU2hhZG93RE9NKHRhcmdldE9yT3B0aW9ucykge1xyXG4gICAgdmFyIG9wdGlvbnMgPSB0eXBlb2YgdGFyZ2V0T3JPcHRpb25zID09PSAnZnVuY3Rpb24nIHx8ICF0YXJnZXRPck9wdGlvbnNcclxuICAgICAgICA/IGRlZmF1bHRTaGFkb3dET01PcHRpb25zXHJcbiAgICAgICAgOiB0YXJnZXRPck9wdGlvbnM7XHJcbiAgICB2YXIgZGVjbyA9IGZ1bmN0aW9uICh0KSB7XHJcbiAgICAgICAgdmFyIHIgPSBtZXRhZGF0YS5nZXRPckNyZWF0ZU93bihtZXRhZGF0YS5yZXNvdXJjZSwgSHRtbEJlaGF2aW9yUmVzb3VyY2UsIHQpO1xyXG4gICAgICAgIHIudGFyZ2V0U2hhZG93RE9NID0gdHJ1ZTtcclxuICAgICAgICByLnNoYWRvd0RPTU9wdGlvbnMgPSBvcHRpb25zO1xyXG4gICAgfTtcclxuICAgIHJldHVybiB0eXBlb2YgdGFyZ2V0T3JPcHRpb25zID09PSAnZnVuY3Rpb24nID8gZGVjbyh0YXJnZXRPck9wdGlvbnMpIDogZGVjbztcclxufVxyXG5mdW5jdGlvbiBwcm9jZXNzQXR0cmlidXRlcyhwcm9jZXNzb3IpIHtcclxuICAgIHJldHVybiBmdW5jdGlvbiAodCkge1xyXG4gICAgICAgIHZhciByID0gbWV0YWRhdGEuZ2V0T3JDcmVhdGVPd24obWV0YWRhdGEucmVzb3VyY2UsIEh0bWxCZWhhdmlvclJlc291cmNlLCB0KTtcclxuICAgICAgICByLnByb2Nlc3NBdHRyaWJ1dGVzID0gZnVuY3Rpb24gKGNvbXBpbGVyLCByZXNvdXJjZXMsIG5vZGUsIGF0dHJpYnV0ZXMsIGVsZW1lbnRJbnN0cnVjdGlvbikge1xyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgcHJvY2Vzc29yKGNvbXBpbGVyLCByZXNvdXJjZXMsIG5vZGUsIGF0dHJpYnV0ZXMsIGVsZW1lbnRJbnN0cnVjdGlvbik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICBMb2dNYW5hZ2VyLmdldExvZ2dlcigndGVtcGxhdGluZycpLmVycm9yKGVycm9yKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9O1xyXG59XHJcbmZ1bmN0aW9uIGRvTm90UHJvY2Vzc0NvbnRlbnQoKSB7IHJldHVybiBmYWxzZTsgfVxyXG5mdW5jdGlvbiBwcm9jZXNzQ29udGVudChwcm9jZXNzb3IpIHtcclxuICAgIHJldHVybiBmdW5jdGlvbiAodCkge1xyXG4gICAgICAgIHZhciByID0gbWV0YWRhdGEuZ2V0T3JDcmVhdGVPd24obWV0YWRhdGEucmVzb3VyY2UsIEh0bWxCZWhhdmlvclJlc291cmNlLCB0KTtcclxuICAgICAgICByLnByb2Nlc3NDb250ZW50ID0gcHJvY2Vzc29yID8gZnVuY3Rpb24gKGNvbXBpbGVyLCByZXNvdXJjZXMsIG5vZGUsIGluc3RydWN0aW9uKSB7XHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcHJvY2Vzc29yKGNvbXBpbGVyLCByZXNvdXJjZXMsIG5vZGUsIGluc3RydWN0aW9uKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIExvZ01hbmFnZXIuZ2V0TG9nZ2VyKCd0ZW1wbGF0aW5nJykuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSA6IGRvTm90UHJvY2Vzc0NvbnRlbnQ7XHJcbiAgICB9O1xyXG59XHJcbmZ1bmN0aW9uIGNvbnRhaW5lcmxlc3ModGFyZ2V0KSB7XHJcbiAgICB2YXIgZGVjbyA9IGZ1bmN0aW9uICh0KSB7XHJcbiAgICAgICAgdmFyIHIgPSBtZXRhZGF0YS5nZXRPckNyZWF0ZU93bihtZXRhZGF0YS5yZXNvdXJjZSwgSHRtbEJlaGF2aW9yUmVzb3VyY2UsIHQpO1xyXG4gICAgICAgIHIuY29udGFpbmVybGVzcyA9IHRydWU7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIHRhcmdldCA/IGRlY28odGFyZ2V0KSA6IGRlY287XHJcbn1cclxuZnVuY3Rpb24gdXNlVmlld1N0cmF0ZWd5KHN0cmF0ZWd5KSB7XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKHRhcmdldCkge1xyXG4gICAgICAgIG1ldGFkYXRhLmRlZmluZShWaWV3TG9jYXRvci52aWV3U3RyYXRlZ3lNZXRhZGF0YUtleSwgc3RyYXRlZ3ksIHRhcmdldCk7XHJcbiAgICB9O1xyXG59XHJcbmZ1bmN0aW9uIHVzZVZpZXcocGF0aCkge1xyXG4gICAgcmV0dXJuIHVzZVZpZXdTdHJhdGVneShuZXcgUmVsYXRpdmVWaWV3U3RyYXRlZ3kocGF0aCkpO1xyXG59XHJcbmZ1bmN0aW9uIGlubGluZVZpZXcobWFya3VwLCBkZXBlbmRlbmNpZXMsIGRlcGVuZGVuY3lCYXNlVXJsKSB7XHJcbiAgICByZXR1cm4gdXNlVmlld1N0cmF0ZWd5KG5ldyBJbmxpbmVWaWV3U3RyYXRlZ3kobWFya3VwLCBkZXBlbmRlbmNpZXMsIGRlcGVuZGVuY3lCYXNlVXJsKSk7XHJcbn1cclxuZnVuY3Rpb24gbm9WaWV3KHRhcmdldE9yRGVwZW5kZW5jaWVzLCBkZXBlbmRlbmN5QmFzZVVybCkge1xyXG4gICAgdmFyIHRhcmdldDtcclxuICAgIHZhciBkZXBlbmRlbmNpZXM7XHJcbiAgICBpZiAodHlwZW9mIHRhcmdldE9yRGVwZW5kZW5jaWVzID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgdGFyZ2V0ID0gdGFyZ2V0T3JEZXBlbmRlbmNpZXM7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICBkZXBlbmRlbmNpZXMgPSB0YXJnZXRPckRlcGVuZGVuY2llcztcclxuICAgICAgICB0YXJnZXQgPSB1bmRlZmluZWQ7XHJcbiAgICB9XHJcbiAgICB2YXIgZGVjbyA9IGZ1bmN0aW9uICh0KSB7XHJcbiAgICAgICAgbWV0YWRhdGEuZGVmaW5lKFZpZXdMb2NhdG9yLnZpZXdTdHJhdGVneU1ldGFkYXRhS2V5LCBuZXcgTm9WaWV3U3RyYXRlZ3koZGVwZW5kZW5jaWVzLCBkZXBlbmRlbmN5QmFzZVVybCksIHQpO1xyXG4gICAgfTtcclxuICAgIHJldHVybiB0YXJnZXQgPyBkZWNvKHRhcmdldCkgOiBkZWNvO1xyXG59XHJcbmZ1bmN0aW9uIHZpZXcodGVtcGxhdGVPckNvbmZpZykge1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uICh0YXJnZXQpIHtcclxuICAgICAgICB0YXJnZXQuJHZpZXcgPSB0ZW1wbGF0ZU9yQ29uZmlnO1xyXG4gICAgfTtcclxufVxyXG5mdW5jdGlvbiBlbGVtZW50Q29uZmlnKHRhcmdldCkge1xyXG4gICAgdmFyIGRlY28gPSBmdW5jdGlvbiAodCkge1xyXG4gICAgICAgIG1ldGFkYXRhLmRlZmluZShtZXRhZGF0YS5yZXNvdXJjZSwgbmV3IEVsZW1lbnRDb25maWdSZXNvdXJjZSgpLCB0KTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gdGFyZ2V0ID8gZGVjbyh0YXJnZXQpIDogZGVjbztcclxufVxyXG5mdW5jdGlvbiB2aWV3UmVzb3VyY2VzKCkge1xyXG4gICAgdmFyIHJlc291cmNlcyA9IFtdO1xyXG4gICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHtcclxuICAgICAgICByZXNvdXJjZXNbX2ldID0gYXJndW1lbnRzW19pXTtcclxuICAgIH1cclxuICAgIHJldHVybiBmdW5jdGlvbiAodGFyZ2V0KSB7XHJcbiAgICAgICAgbWV0YWRhdGEuZGVmaW5lKFZpZXdFbmdpbmUudmlld01vZGVsUmVxdWlyZU1ldGFkYXRhS2V5LCByZXNvdXJjZXMsIHRhcmdldCk7XHJcbiAgICB9O1xyXG59XG5cbnZhciBUZW1wbGF0aW5nRW5naW5lID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIFRlbXBsYXRpbmdFbmdpbmUoY29udGFpbmVyLCBtb2R1bGVBbmFseXplciwgdmlld0NvbXBpbGVyLCBjb21wb3NpdGlvbkVuZ2luZSkge1xyXG4gICAgICAgIHRoaXMuX2NvbnRhaW5lciA9IGNvbnRhaW5lcjtcclxuICAgICAgICB0aGlzLl9tb2R1bGVBbmFseXplciA9IG1vZHVsZUFuYWx5emVyO1xyXG4gICAgICAgIHRoaXMuX3ZpZXdDb21waWxlciA9IHZpZXdDb21waWxlcjtcclxuICAgICAgICB0aGlzLl9jb21wb3NpdGlvbkVuZ2luZSA9IGNvbXBvc2l0aW9uRW5naW5lO1xyXG4gICAgICAgIGNvbnRhaW5lci5yZWdpc3Rlckluc3RhbmNlKEFuaW1hdG9yLCBBbmltYXRvci5pbnN0YW5jZSA9IG5ldyBBbmltYXRvcigpKTtcclxuICAgIH1cclxuICAgIFRlbXBsYXRpbmdFbmdpbmUucHJvdG90eXBlLmNvbmZpZ3VyZUFuaW1hdG9yID0gZnVuY3Rpb24gKGFuaW1hdG9yKSB7XHJcbiAgICAgICAgdGhpcy5fY29udGFpbmVyLnVucmVnaXN0ZXIoQW5pbWF0b3IpO1xyXG4gICAgICAgIHRoaXMuX2NvbnRhaW5lci5yZWdpc3Rlckluc3RhbmNlKEFuaW1hdG9yLCBBbmltYXRvci5pbnN0YW5jZSA9IGFuaW1hdG9yKTtcclxuICAgIH07XHJcbiAgICBUZW1wbGF0aW5nRW5naW5lLnByb3RvdHlwZS5jb21wb3NlID0gZnVuY3Rpb24gKGNvbnRleHQpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fY29tcG9zaXRpb25FbmdpbmUuY29tcG9zZShjb250ZXh0KTtcclxuICAgIH07XHJcbiAgICBUZW1wbGF0aW5nRW5naW5lLnByb3RvdHlwZS5lbmhhbmNlID0gZnVuY3Rpb24gKGluc3RydWN0aW9uKSB7XHJcbiAgICAgICAgaWYgKGluc3RydWN0aW9uIGluc3RhbmNlb2YgRE9NLkVsZW1lbnQpIHtcclxuICAgICAgICAgICAgaW5zdHJ1Y3Rpb24gPSB7IGVsZW1lbnQ6IGluc3RydWN0aW9uIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBjb21waWxlckluc3RydWN0aW9ucyA9IHsgbGV0RXhwcmVzc2lvbnM6IFtdIH07XHJcbiAgICAgICAgdmFyIHJlc291cmNlcyA9IGluc3RydWN0aW9uLnJlc291cmNlcyB8fCB0aGlzLl9jb250YWluZXIuZ2V0KFZpZXdSZXNvdXJjZXMpO1xyXG4gICAgICAgIHRoaXMuX3ZpZXdDb21waWxlci5fY29tcGlsZU5vZGUoaW5zdHJ1Y3Rpb24uZWxlbWVudCwgcmVzb3VyY2VzLCBjb21waWxlckluc3RydWN0aW9ucywgaW5zdHJ1Y3Rpb24uZWxlbWVudC5wYXJlbnROb2RlLCAncm9vdCcsIHRydWUpO1xyXG4gICAgICAgIHZhciBmYWN0b3J5ID0gbmV3IFZpZXdGYWN0b3J5KGluc3RydWN0aW9uLmVsZW1lbnQsIGNvbXBpbGVySW5zdHJ1Y3Rpb25zLCByZXNvdXJjZXMpO1xyXG4gICAgICAgIHZhciBjb250YWluZXIgPSBpbnN0cnVjdGlvbi5jb250YWluZXIgfHwgdGhpcy5fY29udGFpbmVyLmNyZWF0ZUNoaWxkKCk7XHJcbiAgICAgICAgdmFyIHZpZXcgPSBmYWN0b3J5LmNyZWF0ZShjb250YWluZXIsIEJlaGF2aW9ySW5zdHJ1Y3Rpb24uZW5oYW5jZSgpKTtcclxuICAgICAgICB2aWV3LmJpbmQoaW5zdHJ1Y3Rpb24uYmluZGluZ0NvbnRleHQgfHwge30sIGluc3RydWN0aW9uLm92ZXJyaWRlQ29udGV4dCk7XHJcbiAgICAgICAgdmlldy5maXJzdENoaWxkID0gdmlldy5sYXN0Q2hpbGQgPSB2aWV3LmZyYWdtZW50O1xyXG4gICAgICAgIHZpZXcuZnJhZ21lbnQgPSBET00uY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xyXG4gICAgICAgIHZpZXcuYXR0YWNoZWQoKTtcclxuICAgICAgICByZXR1cm4gdmlldztcclxuICAgIH07XHJcbiAgICBUZW1wbGF0aW5nRW5naW5lLmluamVjdCA9IFtDb250YWluZXIsIE1vZHVsZUFuYWx5emVyLCBWaWV3Q29tcGlsZXIsIENvbXBvc2l0aW9uRW5naW5lXTtcclxuICAgIHJldHVybiBUZW1wbGF0aW5nRW5naW5lO1xyXG59KCkpO1xuXG5leHBvcnQgeyBBbmltYXRvciwgQmVoYXZpb3JJbnN0cnVjdGlvbiwgQmVoYXZpb3JQcm9wZXJ0eU9ic2VydmVyLCBCaW5kYWJsZVByb3BlcnR5LCBCaW5kaW5nTGFuZ3VhZ2UsIEJvdW5kVmlld0ZhY3RvcnksIENvbXBvc2l0aW9uRW5naW5lLCBDb21wb3NpdGlvblRyYW5zYWN0aW9uLCBDb21wb3NpdGlvblRyYW5zYWN0aW9uTm90aWZpZXIsIENvbXBvc2l0aW9uVHJhbnNhY3Rpb25Pd25lcnNoaXBUb2tlbiwgQ29udHJvbGxlciwgQ29udmVudGlvbmFsVmlld1N0cmF0ZWd5LCBFbGVtZW50Q29uZmlnUmVzb3VyY2UsIEVsZW1lbnRFdmVudHMsIEh0bWxCZWhhdmlvclJlc291cmNlLCBJbmxpbmVWaWV3U3RyYXRlZ3ksIE1vZHVsZUFuYWx5emVyLCBOb1ZpZXdTdHJhdGVneSwgUGFzc1Rocm91Z2hTbG90LCBSZWxhdGl2ZVZpZXdTdHJhdGVneSwgUmVzb3VyY2VEZXNjcmlwdGlvbiwgUmVzb3VyY2VMb2FkQ29udGV4dCwgUmVzb3VyY2VNb2R1bGUsIFNoYWRvd0RPTSwgU2hhZG93U2xvdCwgU2xvdEN1c3RvbUF0dHJpYnV0ZSwgU3RhdGljVmlld1N0cmF0ZWd5LCBTd2FwU3RyYXRlZ2llcywgVGFyZ2V0SW5zdHJ1Y3Rpb24sIFRlbXBsYXRlUmVnaXN0cnlWaWV3U3RyYXRlZ3ksIFRlbXBsYXRpbmdFbmdpbmUsIFZpZXcsIFZpZXdDb21waWxlSW5zdHJ1Y3Rpb24sIFZpZXdDb21waWxlciwgVmlld0VuZ2luZSwgVmlld0VuZ2luZUhvb2tzUmVzb3VyY2UsIFZpZXdGYWN0b3J5LCBWaWV3TG9jYXRvciwgVmlld1Jlc291cmNlcywgVmlld1Nsb3QsIF9oeXBoZW5hdGUsIF9pc0FsbFdoaXRlc3BhY2UsIGFuaW1hdGlvbkV2ZW50LCBiZWhhdmlvciwgYmluZGFibGUsIGNoaWxkLCBjaGlsZHJlbiwgY29udGFpbmVybGVzcywgY3VzdG9tQXR0cmlidXRlLCBjdXN0b21FbGVtZW50LCBkeW5hbWljT3B0aW9ucywgZWxlbWVudENvbmZpZywgaW5saW5lVmlldywgbm9WaWV3LCBwcm9jZXNzQXR0cmlidXRlcywgcHJvY2Vzc0NvbnRlbnQsIHJlc291cmNlLCB0ZW1wbGF0ZUNvbnRyb2xsZXIsIHVzZVNoYWRvd0RPTSwgdXNlVmlldywgdXNlVmlld1N0cmF0ZWd5LCB2YWxpZGF0ZUJlaGF2aW9yTmFtZSwgdmlldywgdmlld0VuZ2luZUhvb2tzLCB2aWV3UmVzb3VyY2VzLCB2aWV3U3RyYXRlZ3kgfTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWF1cmVsaWEtdGVtcGxhdGluZy5qcy5tYXBcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpRUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///gCht\n");

/***/ })

}]);